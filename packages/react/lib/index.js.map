{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@docstack/react/../../node_modules/react/jsx-runtime.js","webpack://@docstack/react/../../node_modules/react/cjs/react-jsx-runtime.production.min.js","webpack://@docstack/react/external module \"react\"","webpack://@docstack/react/webpack/bootstrap","webpack://@docstack/react/webpack/runtime/define property getters","webpack://@docstack/react/webpack/runtime/hasOwnProperty shorthand","webpack://@docstack/react/./src/components/StackProvider/index.tsx","webpack://@docstack/react/./src/hooks/index.ts","webpack://@docstack/react/./src/hooks/class.ts"],"sourcesContent":["'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","module.exports = __WEBPACK_EXTERNAL_MODULE_react__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { createContext, useRef, useCallback, useEffect, useState } from 'react';\nimport { DocStack } from '@docstack/client'; // Import your DocStack class\n// You can give it a default value, e.g., null, which can be checked later.\nexport const DocStackContext = createContext(null);\nconst StackProvider = (props) => {\n    const { config, children } = props;\n    // Use a ref to store the DocStack instance\n    const docStackRef = useRef(null);\n    const [docStack, setDocStack] = useState(null);\n    const setsDocStackWhenReady = useCallback(() => {\n        setDocStack(docStackRef.current);\n    }, []);\n    useEffect(() => {\n        if (docStackRef.current === null && config.length) {\n            console.log(\"DocStack provider - init instance\", { config });\n            const instance = new DocStack(...config);\n            docStackRef.current = instance;\n            docStackRef.current.addEventListener(\"ready\", setsDocStackWhenReady);\n        }\n        // Optional: Cleanup function to remove listeners\n        return () => {\n            if (docStackRef.current) {\n                // docStackRef.current.removeEventListener(\"ready\", setsDocStackWhenReady);\n                // docStackRef.current.getStore().removeAllListeners();\n            }\n        };\n    }, [config, setsDocStackWhenReady]);\n    return (_jsx(DocStackContext.Provider, { value: docStack, children: children }));\n};\nexport default StackProvider;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n// src/hooks/useFind.js\nimport { useContext, useEffect, useRef, useState } from 'react';\nimport { DocStackContext } from '../components/StackProvider';\nexport const useQuerySQL = (stack, sql, ...params) => {\n    const docStack = useContext(DocStackContext);\n    const [result, setResult] = useState({ rows: [], ast: [] });\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n    // [TODO] Solve bounce of component because of StrictMode or other reasons\n    const queryRef = useRef(false);\n    useEffect(() => {\n        if (!docStack) {\n            // Handle the case where the provider is not yet initialized or missing\n            // You could throw an error or return an empty state.\n            console.error('useClassList must be used within a DocStackProvider.');\n            setLoading(false);\n            return;\n        }\n        const runQuery = () => __awaiter(void 0, void 0, void 0, function* () {\n            try {\n                const stackInstance = docStack.getStack(stack);\n                if (stackInstance) {\n                    // Run the initial query\n                    console.log(\"Preparing to run query\", { sql, params });\n                    debugger;\n                    const queryResult = yield stackInstance.query(sql, ...params);\n                    setResult(queryResult);\n                }\n                else {\n                    console.log(\"Could not find corresponding stack\", { stack });\n                }\n            }\n            catch (err) {\n                console.log(\"Got error while running query\", { error: err });\n                setError(err);\n            }\n            finally {\n                setLoading(false);\n            }\n        });\n        if (!queryRef.current) {\n            queryRef.current = true;\n            setLoading(true);\n            runQuery();\n        }\n        else {\n            console.log(\"Already performing query\");\n        }\n        return () => {\n            //\n        };\n    }, [docStack, stack, params]);\n    return { loading, result, error };\n};\nexport const useFind = (stack, query, sort, limit = 50) => {\n    const docStack = useContext(DocStackContext);\n    const [docs, setDocs] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n    useEffect(() => {\n        // Check if the docStack instance is available\n        if (!docStack) {\n            // Handle the case where the provider is not yet initialized or missing\n            // You could throw an error or return an empty state.\n            console.error('useFind must be used within a DocStackProvider.');\n            setLoading(false);\n            return;\n        }\n        setLoading(true);\n        const runQuery = () => __awaiter(void 0, void 0, void 0, function* () {\n            try {\n                const stackInstance = docStack.getStack(stack);\n                if (stackInstance) {\n                    // Run the initial query\n                    const initialDocs = yield stackInstance.findDocuments(query.selector, query.fields);\n                    if (initialDocs.docs.length) {\n                        let docs = initialDocs.docs; // [TODO] Check types\n                        setDocs(docs);\n                    }\n                }\n            }\n            catch (err) {\n                setError(err);\n            }\n            finally {\n                setLoading(false);\n            }\n        });\n        runQuery();\n        // Set up the listener for changes\n        const changeListener = (change) => {\n            // Logic to handle the change and update the docs state\n            // This part is crucial for real-time updates.\n            // You'll need to re-run the query or intelligently update the docs array\n            // based on the change object (add, update, delete).\n            // A simple way is to re-run the query.\n            // runQuery();\n        };\n        // [TODO] Implement events\n        docStack.addEventListener('change', changeListener);\n        // Cleanup function: remove the listener when the component unmounts\n        return () => {\n            docStack.removeEventListener('change', changeListener);\n        };\n    }, [docStack, JSON.stringify(query)]); // Re-run if docStack or query changes\n    return { docs, loading, error };\n};\nexport const useClassCreate = () => {\n};\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useContext, useCallback, useEffect, useRef, useState } from \"react\";\nimport { DocStackContext } from \"../components/StackProvider\";\nimport { Class } from \"@docstack/client\";\nexport const useClassCreate = (stack) => {\n    const docStack = useContext(DocStackContext);\n    return useCallback((className, classDesc) => __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            if (!docStack) {\n                // Handle the case where the provider is not yet initialized or missing\n                // You could throw an error or return an empty state.\n                console.error('useClassCreate must be used within a DocStackProvider.');\n                // setLoading(false);\n                return Promise.resolve(null);\n            }\n            // Run the initial query\n            const stackInstance = docStack.getStack(stack);\n            if (stackInstance) {\n                const classObj_ = yield Class.create(stackInstance, className, \"class\", classDesc);\n                yield stackInstance.addClass(classObj_);\n                return classObj_;\n            }\n            return null;\n        }\n        catch (err) {\n            // setError(err);\n            console.error(err);\n            return null;\n        }\n    }), [docStack, stack]);\n};\nexport const useClassList = (conf) => {\n    const { stack, filter, search } = conf;\n    const docStack = useContext(DocStackContext);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState();\n    const [classList, setClassList] = useState([]);\n    // [TODO] Solve bounce of component because of StrictMode or other reasons\n    const queryRef = useRef(false);\n    useEffect(() => {\n        if (!docStack) {\n            // Handle the case where the provider is not yet initialized or missing\n            // You could throw an error or return an empty state.\n            console.error('useClassList must be used within a DocStackProvider.');\n            setLoading(false);\n            return;\n        }\n        const changeListener = (change) => {\n            setClassList([...change.detail]);\n        };\n        const fetchClasses = () => __awaiter(void 0, void 0, void 0, function* () {\n            try {\n                // Run the initial query\n                const stackInstance = docStack.getStack(stack);\n                if (stackInstance) {\n                    const classList = yield stackInstance.getClasses({ filter, search });\n                    setClassList(classList);\n                    stackInstance.addEventListener(\"classListChange\", changeListener);\n                }\n            }\n            catch (err) {\n                setError(err);\n            }\n            finally {\n                setLoading(false);\n            }\n        });\n        if (!queryRef.current) {\n            queryRef.current = true;\n            setLoading(true);\n            fetchClasses();\n        }\n        else {\n            console.log(\"Already performing query\");\n        }\n        return () => {\n            setClassList([]);\n            const stackInstance = docStack.getStack(stack);\n            if (stackInstance)\n                stackInstance.removeEventListener(\"classListChange\", changeListener);\n            // queryRef.current = false;\n        };\n    }, [docStack, stack, filter, search]);\n    return { loading, classList, error };\n};\nexport const useClass = (stack, className) => {\n    const docStack = useContext(DocStackContext);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState();\n    const [classObj, setClass] = useState();\n    const reqRef = useRef(false);\n    useEffect(() => {\n        if (!docStack) {\n            // Handle the case where the provider is not yet initialized or missing\n            // You could throw an error or return an empty state.\n            console.error('useClass must be used within a DocStackProvider.');\n            setLoading(false);\n            return;\n        }\n        const fetchClass = () => __awaiter(void 0, void 0, void 0, function* () {\n            try {\n                const stackInstance = docStack.getStack(stack);\n                if (stackInstance) {\n                    const res = yield stackInstance.getClass(className);\n                    // TODO: manage class model (schema!) updates\n                    if (res) {\n                        setClass(res);\n                    }\n                }\n            }\n            catch (e) {\n                setError(e);\n            }\n            finally {\n                setLoading(false);\n            }\n        });\n        if (!reqRef.current) {\n            reqRef.current = true;\n            setLoading(true);\n            fetchClass();\n        }\n        return () => {\n            // reqRef.current = false;\n        };\n    }, [docStack, stack, className]);\n    return { loading, error, classObj };\n};\nexport const useClassDocs = (stack, className, query = {}) => {\n    const docStack = useContext(DocStackContext);\n    const [classObj, setClass] = useState();\n    const [docs, setDocs] = useState([]);\n    const docsRef = useRef([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n    useEffect(() => {\n        // Only run if the docStack is available and a className is provided\n        if (!docStack || !className) {\n            setLoading(false);\n            return;\n        }\n        const fetchClass = () => __awaiter(void 0, void 0, void 0, function* () {\n            setLoading(true);\n            setError(null);\n            try {\n                const stackInstance = docStack.getStack(stack);\n                if (stackInstance) {\n                    const retrievedClass = yield stackInstance.getClass(className);\n                    if (retrievedClass) {\n                        setClass(retrievedClass);\n                    }\n                }\n            }\n            catch (err) {\n                setError(err);\n                setLoading(false);\n            }\n        });\n        fetchClass();\n        return () => {\n            // clean what?\n        };\n    }, [docStack, stack, className]); // Dependency on docStack and className\n    useEffect(() => {\n        if (!classObj) {\n            return;\n        }\n        const runQueryAndListen = () => __awaiter(void 0, void 0, void 0, function* () {\n            setLoading(true);\n            try {\n                const initialDocs = yield classObj.getCards(query);\n                docsRef.current = initialDocs;\n                setDocs(docsRef.current);\n            }\n            catch (err) {\n                setError(err);\n            }\n            finally {\n                setLoading(false);\n            }\n            const changeListener = (change) => {\n                const doc = change.detail.doc;\n                console.log(\"useClassDocs - detail\", { detail: change.detail });\n                if (!doc.active) {\n                    // A doc was deleted\n                    console.log(\"useClassDocs - a doc was deleted\", { doc });\n                    const docIndex = docsRef.current.findIndex((d) => d._id == doc._id);\n                    if (docIndex != -1) {\n                        docsRef.current = [\n                            ...docsRef.current.slice(0, docIndex),\n                            ...docsRef.current.slice(docIndex + 1, docsRef.current.length)\n                        ];\n                    }\n                }\n                else {\n                    // A doc was changed or added\n                    console.log(\"useClassDocs - a doc was changed or added\", { doc });\n                    const docIndex = docsRef.current.findIndex((d) => d._id == doc._id);\n                    if (docIndex != -1) {\n                        // A doc was changed\n                        console.log(\"useClassDocs - a doc was changed\", { doc });\n                        docsRef.current = [\n                            ...docsRef.current.slice(0, docIndex),\n                            doc,\n                            ...docsRef.current.slice(docIndex + 1, docsRef.current.length)\n                        ];\n                    }\n                    else {\n                        // A doc was added\n                        console.log(\"useClassDocs - a doc was added\", { doc });\n                        docsRef.current.push(doc);\n                    }\n                }\n                setDocs([...docsRef.current]);\n            };\n            classObj.addEventListener('doc', changeListener);\n            return () => {\n                classObj.removeEventListener('doc', changeListener);\n            };\n        });\n        runQueryAndListen();\n    }, [classObj, JSON.stringify(query)]); // Dependency on classObj and query\n    return { docs, loading, error };\n};\n"],"names":["module","exports","f","k","Symbol","for","m","Object","prototype","hasOwnProperty","n","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","p","key","ref","__self","__source","jsx","c","a","g","b","d","e","h","call","defaultProps","$$typeof","type","props","_owner","current","__WEBPACK_EXTERNAL_MODULE_react__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","definition","o","defineProperty","enumerable","get","obj","prop","DocStackContext","createContext","config","children","docStackRef","useRef","docStack","setDocStack","useState","setsDocStackWhenReady","useCallback","useEffect","length","console","log","instance","DocStack","addEventListener","Provider","value","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","result","done","then","apply","useQuerySQL","stack","sql","params","useContext","setResult","rows","ast","loading","setLoading","error","setError","queryRef","stackInstance","getStack","queryResult","query","err","useFind","sort","limit","docs","setDocs","initialDocs","findDocuments","selector","fields","changeListener","change","removeEventListener","JSON","stringify","className","classDesc","classObj_","Class","create","addClass","useClassList","conf","filter","search","classList","setClassList","detail","getClasses","useClass","classObj","setClass","reqRef","res","getClass","useClassDocs","docsRef","retrievedClass","getCards","doc","active","docIndex","findIndex","_id","slice","push"],"sourceRoot":""}