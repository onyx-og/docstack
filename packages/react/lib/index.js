/*! For license information please see index.js.LICENSE.txt */
import*as e from"react";import{Class as t,DocStack as r}from"@docstack/client";var n={85:(e,t,r)=>{e.exports=r(335)},335:(e,t,r)=>{var n=r(649),o=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,r){var n,i={},u=null,l=null;for(n in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,n)&&!a.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:o,type:e,key:u,ref:l,props:i,_owner:c.current}}},649:t=>{t.exports=e}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return n[e](r,r.exports,s),r.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var c=s(85),a=s(649);const i=(0,a.createContext)(null),u=e=>{const{config:t,children:n}=e,o=(0,a.useRef)(null),[s,u]=(0,a.useState)(null),l=(0,a.useCallback)(()=>{u(o.current)},[]);return(0,a.useEffect)(()=>{if(null===o.current&&t.length){console.log("DocStack provider - init instance",{config:t});const e=new r(...t);o.current=e,o.current.addEventListener("ready",l)}return()=>{o.current}},[t,l]),(0,c.jsx)(i.Provider,{value:s,children:n})};const l=(e,t,r,n=50)=>{const o=(0,a.useContext)(i),[s,c]=(0,a.useState)([]),[u,l]=(0,a.useState)(!0),[d,f]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!o)return console.error("useFind must be used within a DocStackProvider."),void l(!1);var r,n,s,a;l(!0),r=void 0,n=void 0,a=function*(){try{const r=o.getStack(e);if(r){const e=yield r.findDocuments(t.selector,t.fields);if(e.docs.length){let t=e.docs;c(t)}}}catch(e){f(e)}finally{l(!1)}},new((s=void 0)||(s=Promise))(function(e,t){function o(e){try{i(a.next(e))}catch(e){t(e)}}function c(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s(function(e){e(r)})).then(o,c)}i((a=a.apply(r,n||[])).next())});const i=e=>{};return o.addEventListener("change",i),()=>{o.removeEventListener("change",i)}},[o,JSON.stringify(t)]),{docs:s,loading:u,error:d}};var d=function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function c(e){try{i(n.next(e))}catch(e){s(e)}}function a(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(c,a)}i((n=n.apply(e,t||[])).next())})};const f=e=>{const r=(0,a.useContext)(i);return(0,a.useCallback)((n,o)=>d(void 0,void 0,void 0,function*(){try{if(!r)return console.error("useClassCreate must be used within a DocStackProvider."),Promise.resolve(null);const s=r.getStack(e);if(s){const e=yield t.create(s,n,"class",o);return yield s.addClass(e),e}return null}catch(e){return console.error(e),null}}),[r,e])},v=e=>{const{stack:t,filter:r,search:n}=e,o=(0,a.useContext)(i),[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(),[f,v]=(0,a.useState)([]),y=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if(!o)return console.error("useClassList must be used within a DocStackProvider."),void c(!1);const e=e=>{v([...e.detail])};return y.current?console.log("Already performing query"):(y.current=!0,c(!0),d(void 0,void 0,void 0,function*(){try{const s=o.getStack(t);if(s){const t=yield s.getClasses({filter:r,search:n});v(t),s.addEventListener("classListChange",e)}}catch(e){l(e)}finally{c(!1)}})),()=>{v([]);const r=o.getStack(t);r&&r.removeEventListener("classListChange",e)}},[o,t,r,n]),{loading:s,classList:f,error:u}},y=(e,t)=>{const r=(0,a.useContext)(i),[n,o]=(0,a.useState)(!1),[s,c]=(0,a.useState)(),[u,l]=(0,a.useState)(),f=(0,a.useRef)(!1);return(0,a.useEffect)(()=>r?(f.current||(f.current=!0,o(!0),d(void 0,void 0,void 0,function*(){try{const n=r.getStack(e);if(n){const e=yield n.getClass(t);e&&l(e)}}catch(e){c(e)}finally{o(!1)}})),()=>{}):(console.error("useClass must be used within a DocStackProvider."),void o(!1)),[r,e,t]),{loading:n,error:s,classObj:u}},g=(e,t,r={})=>{const n=(0,a.useContext)(i),[o,s]=(0,a.useState)(),[c,u]=(0,a.useState)([]),l=(0,a.useRef)([]),[f,v]=(0,a.useState)(!0),[y,g]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(n&&t)return d(void 0,void 0,void 0,function*(){v(!0),g(null);try{const r=n.getStack(e);if(r){const e=yield r.getClass(t);e&&s(e)}}catch(e){g(e),v(!1)}}),()=>{};v(!1)},[n,e,t]),(0,a.useEffect)(()=>{o&&d(void 0,void 0,void 0,function*(){v(!0);try{const e=yield o.getCards(r);l.current=e,u(l.current)}catch(e){g(e)}finally{v(!1)}const e=e=>{const t=e.detail.doc;if(console.log("useClassDocs - detail",{detail:e.detail}),t.active){console.log("useClassDocs - a doc was changed or added",{doc:t});const e=l.current.findIndex(e=>e._id==t._id);-1!=e?(console.log("useClassDocs - a doc was changed",{doc:t}),l.current=[...l.current.slice(0,e),t,...l.current.slice(e+1,l.current.length)]):(console.log("useClassDocs - a doc was added",{doc:t}),l.current.push(t))}else{console.log("useClassDocs - a doc was deleted",{doc:t});const e=l.current.findIndex(e=>e._id==t._id);-1!=e&&(l.current=[...l.current.slice(0,e),...l.current.slice(e+1,l.current.length)])}u([...l.current])};return o.addEventListener("doc",e),()=>{o.removeEventListener("doc",e)}})},[o,JSON.stringify(r)]),{docs:c,loading:f,error:y}};export{i as DocStackContext,u as StackProvider,y as useClass,f as useClassCreate,g as useClassDocs,v as useClassList,l as useFind};
//# sourceMappingURL=index.js.map