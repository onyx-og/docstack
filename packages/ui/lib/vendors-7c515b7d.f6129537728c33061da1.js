"use strict";(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[9589],{58161:(e,i,t)=>{t.d(i,{$y:()=>f,AV:()=>b,Am:()=>l,D1:()=>_,EK:()=>w,Mu:()=>C,Nu:()=>m,O8:()=>R,Vs:()=>L,pN:()=>u,pY:()=>g,rX:()=>c,uN:()=>p});var n=t(35380),o=(t(31710),t(32293)),s=t(35544),r=t(24800),d=t(55818),a=t(81304),h=t(53334);function l(e,i,t,n){if(0===e.length)return i;if(0===i.length)return e;const o=[];let s=0,r=0;for(;s<e.length&&r<i.length;){const d=e[s],a=i[r],h=t(d),l=t(a);h<l?(o.push(d),s++):h>l?(o.push(a),r++):(o.push(n(d,a)),s++,r++)}for(;s<e.length;)o.push(e[s]),s++;for(;r<i.length;)o.push(i[r]),r++;return o}function g(e,i){const t=new o.Cm,n=e.createDecorationsCollection();return t.add((0,s.zL)({debugName:()=>`Apply decorations from ${i.debugName}`},e=>{const t=i.read(e);n.set(t)})),t.add({dispose:()=>{n.clear()}}),t}function c(e,i){return e.appendChild(i),(0,o.s)(()=>{i.remove()})}function f(e,i){return e.prepend(i),(0,o.s)(()=>{i.remove()})}class u extends o.jG{get width(){return this._width}get height(){return this._height}get automaticLayout(){return this._automaticLayout}constructor(e,i){super(),this._automaticLayout=!1,this.elementSizeObserver=this._register(new r.u(e,i)),this._width=(0,s.FY)(this,this.elementSizeObserver.getWidth()),this._height=(0,s.FY)(this,this.elementSizeObserver.getHeight()),this._register(this.elementSizeObserver.onDidChange(e=>(0,s.Rn)(e=>{this._width.set(this.elementSizeObserver.getWidth(),e),this._height.set(this.elementSizeObserver.getHeight(),e)})))}observe(e){this.elementSizeObserver.observe(e)}setAutomaticLayout(e){this._automaticLayout=e,e?this.elementSizeObserver.startObserving():this.elementSizeObserver.stopObserving()}}function m(e,i,t){let n=i.get(),o=n,r=n;const d=(0,s.FY)("animatedValue",n);let a,h=-1;function l(){const i=Date.now()-h;var t,s,g;r=Math.floor((s=o,g=n-o,(t=i)===300?s+g:g*(1-Math.pow(2,-10*t/300))+s)),i<300?a=e.requestAnimationFrame(l):r=n,d.set(r,void 0)}return t.add((0,s.Y)({createEmptyChangeSummary:()=>({animate:!1}),handleChange:(e,t)=>(e.didChange(i)&&(t.animate=t.animate||e.change),!0)},(t,s)=>{void 0!==a&&(e.cancelAnimationFrame(a),a=void 0),o=r,n=i.read(t),h=Date.now()-(s.animate?0:300),l()})),d}class p extends o.jG{constructor(e,i,t){super(),this._register(new v(e,t)),this._register(b(t,{height:i.actualHeight,top:i.actualTop}))}}class _{get afterLineNumber(){return this._afterLineNumber.get()}constructor(e,i){this._afterLineNumber=e,this.heightInPx=i,this.domNode=document.createElement("div"),this._actualTop=(0,s.FY)(this,void 0),this._actualHeight=(0,s.FY)(this,void 0),this.actualTop=this._actualTop,this.actualHeight=this._actualHeight,this.showInHiddenAreas=!0,this.onChange=this._afterLineNumber,this.onDomNodeTop=e=>{this._actualTop.set(e,void 0)},this.onComputedHeight=e=>{this._actualHeight.set(e,void 0)}}}class v{static{this._counter=0}constructor(e,i){this._editor=e,this._domElement=i,this._overlayWidgetId="managedOverlayWidget-"+v._counter++,this._overlayWidget={getId:()=>this._overlayWidgetId,getDomNode:()=>this._domElement,getPosition:()=>null},this._editor.addOverlayWidget(this._overlayWidget)}dispose(){this._editor.removeOverlayWidget(this._overlayWidget)}}function b(e,i){return(0,s.fm)(t=>{for(let[n,o]of Object.entries(i))o&&"object"==typeof o&&"read"in o&&(o=o.read(t)),"number"==typeof o&&(o=`${o}px`),n=n.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),e.style[n]=o})}function L(e,i,t,n){const r=new o.Cm,d=[];return r.add((0,s.yC)((o,r)=>{const a=i.read(o),h=new Map,l=new Map;t&&t(!0),e.changeViewZones(e=>{for(const i of d)e.removeZone(i),n?.delete(i);d.length=0;for(const i of a){const t=e.addZone(i);i.setZoneId&&i.setZoneId(t),d.push(t),n?.add(t),h.set(i,t)}}),t&&t(!1),r.add((0,s.Y)({createEmptyChangeSummary:()=>({zoneIds:[]}),handleChange(e,i){const t=l.get(e.changedObservable);return void 0!==t&&i.zoneIds.push(t),!0}},(i,n)=>{for(const e of a)e.onChange&&(l.set(e.onChange,h.get(e)),e.onChange.read(i));t&&t(!0),e.changeViewZones(e=>{for(const i of n.zoneIds)e.layoutZone(i)}),t&&t(!1)}))})),r.add({dispose(){t&&t(!0),e.changeViewZones(e=>{for(const i of d)e.removeZone(i)}),n?.clear(),t&&t(!1)}}),r}function C(e,i){const t=(0,n.Uk)(i,i=>i.original.startLineNumber<=e.lineNumber);if(!t)return a.Q.fromPositions(e);if(t.original.endLineNumberExclusive<=e.lineNumber){const i=e.lineNumber-t.original.endLineNumberExclusive+t.modified.endLineNumberExclusive;return a.Q.fromPositions(new d.y(i,e.column))}if(!t.innerChanges)return a.Q.fromPositions(new d.y(t.modified.startLineNumber,1));const o=(0,n.Uk)(t.innerChanges,i=>i.originalRange.getStartPosition().isBeforeOrEqual(e));if(!o){const i=e.lineNumber-t.original.startLineNumber+t.modified.startLineNumber;return a.Q.fromPositions(new d.y(i,e.column))}if(o.originalRange.containsPosition(e))return o.modifiedRange;{const i=(s=o.originalRange.getEndPosition(),r=e,s.lineNumber===r.lineNumber?new h.W(0,r.column-s.column):new h.W(r.lineNumber-s.lineNumber,r.column-1));return a.Q.fromPositions(i.addToPosition(o.modifiedRange.getEndPosition()))}var s,r}function w(e,i){let t;return e.filter(e=>{const n=i(e,t);return t=e,n})}class R{static create(e,i=void 0){return new S(e,e,i)}static createWithDisposable(e,i,t=void 0){const n=new o.Cm;return n.add(i),n.add(e),new S(e,n,t)}}class S extends R{constructor(e,i,t){super(),this.object=e,this._disposable=i,this._debugOwner=t,this._refCount=1,this._isDisposed=!1,this._owners=[],t&&this._addOwner(t)}_addOwner(e){e&&this._owners.push(e)}createNewRef(e){return this._refCount++,e&&this._addOwner(e),new M(this,e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._decreaseRefCount(this._debugOwner))}_decreaseRefCount(e){if(this._refCount--,0===this._refCount&&this._disposable.dispose(),e){const i=this._owners.indexOf(e);-1!==i&&this._owners.splice(i,1)}}}class M extends R{constructor(e,i){super(),this._base=e,this._debugOwner=i,this._isDisposed=!1}get object(){return this._base.object}createNewRef(e){return this._base.createNewRef(e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._base._decreaseRefCount(this._debugOwner))}}},62163:(e,i,t)=>{t.d(i,{T:()=>tt});var n=t(79284),o=t(35380),s=t(73226),r=t(22573),d=t(32293),a=t(35544),h=t(96607),l=t(48053),g=t(2894),c=t(85137),f=t(60971),u=t(46442),m=t(81244),p=t(18083),_=t(95830),v=t(6995),b=t(36972),L=t(94850),C=t(19258),w=t(58161),R=t(90853),S=t(81394),M=t(66401),y=t(55818),N=t(81304),E=t(43960),I=t(49471),D=t(57922),x=t(60926),T=t(50791),O=t(12003),V=t(1850),A=t(35184),P=t(45511),W=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r},k=function(e,i){return function(t,n){i(t,n,e)}};const H=(0,P.pU)("diff-review-insert",b.W.add,(0,O.kg)("accessibleDiffViewerInsertIcon","Icon for 'Insert' in accessible diff viewer.")),B=(0,P.pU)("diff-review-remove",b.W.remove,(0,O.kg)("accessibleDiffViewerRemoveIcon","Icon for 'Remove' in accessible diff viewer.")),F=(0,P.pU)("diff-review-close",b.W.close,(0,O.kg)("accessibleDiffViewerCloseIcon","Icon for 'Close' in accessible diff viewer."));let z=class extends d.jG{static{this._ttPolicy=(0,u.H)("diffReview",{createHTML:e=>e})}constructor(e,i,t,n,o,s,r,d,h){super(),this._parentNode=e,this._visible=i,this._setVisible=t,this._canClose=n,this._width=o,this._height=s,this._diffs=r,this._models=d,this._instantiationService=h,this._state=(0,a.rm)(this,(e,i)=>{const t=this._visible.read(e);if(this._parentNode.style.visibility=t?"visible":"hidden",!t)return null;const n=i.add(this._instantiationService.createInstance(U,this._diffs,this._models,this._setVisible,this._canClose));return{model:n,view:i.add(this._instantiationService.createInstance(K,this._parentNode,n,this._width,this._height,this._models))}}).recomputeInitiallyAndOnChange(this._store)}next(){(0,a.Rn)(e=>{const i=this._visible.get();this._setVisible(!0,e),i&&this._state.get().model.nextGroup(e)})}prev(){(0,a.Rn)(e=>{this._setVisible(!0,e),this._state.get().model.previousGroup(e)})}close(){(0,a.Rn)(e=>{this._setVisible(!1,e)})}};z=W([k(8,A._Y)],z);let U=class extends d.jG{constructor(e,i,t,n,o){super(),this._diffs=e,this._models=i,this._setVisible=t,this.canClose=n,this._accessibilitySignalService=o,this._groups=(0,a.FY)(this,[]),this._currentGroupIdx=(0,a.FY)(this,0),this._currentElementIdx=(0,a.FY)(this,0),this.groups=this._groups,this.currentGroup=this._currentGroupIdx.map((e,i)=>this._groups.read(i)[e]),this.currentGroupIndex=this._currentGroupIdx,this.currentElement=this._currentElementIdx.map((e,i)=>this.currentGroup.read(i)?.lines[e]),this._register((0,a.fm)(e=>{const i=this._diffs.read(e);if(!i)return void this._groups.set([],void 0);const t=function(e,i,t){const n=[];for(const o of(0,v.n)(e,(e,i)=>i.modified.startLineNumber-e.modified.endLineNumberExclusive<2*j)){const e=[];e.push(new Y);const s=new S.M(Math.max(1,o[0].original.startLineNumber-j),Math.min(o[o.length-1].original.endLineNumberExclusive+j,i+1)),r=new S.M(Math.max(1,o[0].modified.startLineNumber-j),Math.min(o[o.length-1].modified.endLineNumberExclusive+j,t+1));(0,v.pN)(o,(i,t)=>{const n=new S.M(i?i.original.endLineNumberExclusive:s.startLineNumber,t?t.original.startLineNumber:s.endLineNumberExclusive),o=new S.M(i?i.modified.endLineNumberExclusive:r.startLineNumber,t?t.modified.startLineNumber:r.endLineNumberExclusive);n.forEach(i=>{e.push(new Q(i,o.startLineNumber+(i-n.startLineNumber)))}),t&&(t.original.forEach(i=>{e.push(new q(t,i))}),t.modified.forEach(i=>{e.push(new $(t,i))}))});const d=o[0].modified.join(o[o.length-1].modified),a=o[0].original.join(o[o.length-1].original);n.push(new G(new E.WL(d,a),e))}return n}(i,this._models.getOriginalModel().getLineCount(),this._models.getModifiedModel().getLineCount());(0,a.Rn)(e=>{const i=this._models.getModifiedPosition();if(i){const n=t.findIndex(e=>i?.lineNumber<e.range.modified.endLineNumberExclusive);-1!==n&&this._currentGroupIdx.set(n,e)}this._groups.set(t,e)})})),this._register((0,a.fm)(e=>{const i=this.currentElement.read(e);i?.type===Z.Deleted?this._accessibilitySignalService.playSignal(V.Rh.diffLineDeleted,{source:"accessibleDiffViewer.currentElementChanged"}):i?.type===Z.Added&&this._accessibilitySignalService.playSignal(V.Rh.diffLineInserted,{source:"accessibleDiffViewer.currentElementChanged"})})),this._register((0,a.fm)(e=>{const i=this.currentElement.read(e);if(i&&i.type!==Z.Header){const e=i.modifiedLineNumber??i.diff.modified.startLineNumber;this._models.modifiedSetSelection(N.Q.fromPositions(new y.y(e,1)))}}))}_goToGroupDelta(e,i){const t=this.groups.get();!t||t.length<=1||(0,a.PO)(i,i=>{this._currentGroupIdx.set(M.L.ofLength(t.length).clipCyclic(this._currentGroupIdx.get()+e),i),this._currentElementIdx.set(0,i)})}nextGroup(e){this._goToGroupDelta(1,e)}previousGroup(e){this._goToGroupDelta(-1,e)}_goToLineDelta(e){const i=this.currentGroup.get();!i||i.lines.length<=1||(0,a.Rn)(t=>{this._currentElementIdx.set(M.L.ofLength(i.lines.length).clip(this._currentElementIdx.get()+e),t)})}goToNextLine(){this._goToLineDelta(1)}goToPreviousLine(){this._goToLineDelta(-1)}goToLine(e){const i=this.currentGroup.get();if(!i)return;const t=i.lines.indexOf(e);-1!==t&&(0,a.Rn)(e=>{this._currentElementIdx.set(t,e)})}revealCurrentElementInEditor(){if(!this.canClose.get())return;this._setVisible(!1,void 0);const e=this.currentElement.get();e&&(e.type===Z.Deleted?this._models.originalReveal(N.Q.fromPositions(new y.y(e.originalLineNumber,1))):this._models.modifiedReveal(e.type!==Z.Header?N.Q.fromPositions(new y.y(e.modifiedLineNumber,1)):void 0))}close(){this.canClose.get()&&(this._setVisible(!1,void 0),this._models.modifiedFocus())}};U=W([k(4,V.Nt)],U);const j=3;var Z;!function(e){e[e.Header=0]="Header",e[e.Unchanged=1]="Unchanged",e[e.Deleted=2]="Deleted",e[e.Added=3]="Added"}(Z||(Z={}));class G{constructor(e,i){this.range=e,this.lines=i}}class Y{constructor(){this.type=Z.Header}}class q{constructor(e,i){this.diff=e,this.originalLineNumber=i,this.type=Z.Deleted,this.modifiedLineNumber=void 0}}class ${constructor(e,i){this.diff=e,this.modifiedLineNumber=i,this.type=Z.Added,this.originalLineNumber=void 0}}class Q{constructor(e,i){this.originalLineNumber=e,this.modifiedLineNumber=i,this.type=Z.Unchanged}}let K=class extends d.jG{constructor(e,i,t,o,s,r){super(),this._element=e,this._model=i,this._width=t,this._height=o,this._models=s,this._languageService=r,this.domNode=this._element,this.domNode.className="monaco-component diff-review monaco-editor-background";const h=document.createElement("div");h.className="diff-review-actions",this._actionBar=this._register(new m.E(h)),this._register((0,a.fm)(e=>{this._actionBar.clear(),this._model.canClose.read(e)&&this._actionBar.push(new _.rc("diffreview.close",(0,O.kg)("label.close","Close"),"close-diff-review "+L.L.asClassName(F),!0,async()=>i.close()),{label:!1,icon:!0})})),this._content=document.createElement("div"),this._content.className="diff-review-content",this._content.setAttribute("role","code"),this._scrollbar=this._register(new p.MU(this._content,{})),(0,n.Ln)(this.domNode,this._scrollbar.getDomNode(),h),this._register((0,a.fm)(e=>{this._height.read(e),this._width.read(e),this._scrollbar.scanDomNode()})),this._register((0,d.s)(()=>{(0,n.Ln)(this.domNode)})),this._register((0,w.AV)(this.domNode,{width:this._width,height:this._height})),this._register((0,w.AV)(this._content,{width:this._width,height:this._height})),this._register((0,a.yC)((e,i)=>{this._model.currentGroup.read(e),this._render(i)})),this._register((0,n.b2)(this.domNode,"keydown",e=>{(e.equals(18)||e.equals(2066)||e.equals(530))&&(e.preventDefault(),this._model.goToNextLine()),(e.equals(16)||e.equals(2064)||e.equals(528))&&(e.preventDefault(),this._model.goToPreviousLine()),(e.equals(9)||e.equals(2057)||e.equals(521)||e.equals(1033))&&(e.preventDefault(),this._model.close()),(e.equals(10)||e.equals(3))&&(e.preventDefault(),this._model.revealCurrentElementInEditor())}))}_render(e){const i=this._models.getOriginalOptions(),t=this._models.getModifiedOptions(),o=document.createElement("div");o.className="diff-review-table",o.setAttribute("role","list"),o.setAttribute("aria-label",(0,O.kg)("ariaLabel","Accessible Diff Viewer. Use arrow up and down to navigate.")),(0,C.M)(o,t.get(50)),(0,n.Ln)(this._content,o);const s=this._models.getOriginalModel(),r=this._models.getModifiedModel();if(!s||!r)return;const d=s.getOptions(),h=r.getOptions(),l=t.get(67),g=this._model.currentGroup.get();for(const c of g?.lines||[]){if(!g)break;let f;if(c.type===Z.Header){const e=document.createElement("div");e.className="diff-review-row",e.setAttribute("role","listitem");const i=g.range,t=this._model.currentGroupIndex.get(),n=this._model.groups.get().length,o=e=>0===e?(0,O.kg)("no_lines_changed","no lines changed"):1===e?(0,O.kg)("one_line_changed","1 line changed"):(0,O.kg)("more_lines_changed","{0} lines changed",e),s=o(i.original.length),r=o(i.modified.length);e.setAttribute("aria-label",(0,O.kg)({key:"header",comment:["This is the ARIA label for a git diff header.","A git diff header looks like this: @@ -154,12 +159,39 @@.","That encodes that at original line 154 (which is now line 159), 12 lines were removed/changed with 39 lines.","Variables 0 and 1 refer to the diff index out of total number of diffs.","Variables 2 and 4 will be numbers (a line number).",'Variables 3 and 5 will be "no lines changed", "1 line changed" or "X lines changed", localized separately.']},"Difference {0} of {1}: original line {2}, {3}, modified line {4}, {5}",t+1,n,i.original.startLineNumber,s,i.modified.startLineNumber,r));const d=document.createElement("div");d.className="diff-review-cell diff-review-summary",d.appendChild(document.createTextNode(`${t+1}/${n}: @@ -${i.original.startLineNumber},${i.original.length} +${i.modified.startLineNumber},${i.modified.length} @@`)),e.appendChild(d),f=e}else f=this._createRow(c,l,this._width.get(),i,s,d,t,r,h);o.appendChild(f);const u=(0,a.un)(e=>this._model.currentElement.read(e)===c);e.add((0,a.fm)(e=>{const i=u.read(e);f.tabIndex=i?0:-1,i&&f.focus()})),e.add((0,n.ko)(f,"focus",()=>{this._model.goToLine(c)}))}this._scrollbar.scanDomNode()}_createRow(e,i,t,n,o,s,r,d,a){const h=n.get(146),l=h.glyphMarginWidth+h.lineNumbersWidth,g=r.get(146),c=10+g.glyphMarginWidth+g.lineNumbersWidth;let f="diff-review-row",u="",m=null;switch(e.type){case Z.Added:f="diff-review-row line-insert",u=" char-insert",m=H;break;case Z.Deleted:f="diff-review-row line-delete",u=" char-delete",m=B}const p=document.createElement("div");p.style.minWidth=t+"px",p.className=f,p.setAttribute("role","listitem"),p.ariaLevel="";const _=document.createElement("div");_.className="diff-review-cell",_.style.height=`${i}px`,p.appendChild(_);const v=document.createElement("span");v.style.width=l+"px",v.style.minWidth=l+"px",v.className="diff-review-line-number"+u,void 0!==e.originalLineNumber?v.appendChild(document.createTextNode(String(e.originalLineNumber))):v.innerText=" ",_.appendChild(v);const b=document.createElement("span");b.style.width=c+"px",b.style.minWidth=c+"px",b.style.paddingRight="10px",b.className="diff-review-line-number"+u,void 0!==e.modifiedLineNumber?b.appendChild(document.createTextNode(String(e.modifiedLineNumber))):b.innerText=" ",_.appendChild(b);const C=document.createElement("span");if(C.className="diff-review-spacer",m){const e=document.createElement("span");e.className=L.L.asClassName(m),e.innerText="  ",C.appendChild(e)}else C.innerText="  ";let w;if(_.appendChild(C),void 0!==e.modifiedLineNumber){let i=this._getLineHtml(d,r,a.tabSize,e.modifiedLineNumber,this._languageService.languageIdCodec);z._ttPolicy&&(i=z._ttPolicy.createHTML(i)),_.insertAdjacentHTML("beforeend",i),w=d.getLineContent(e.modifiedLineNumber)}else{let i=this._getLineHtml(o,n,s.tabSize,e.originalLineNumber,this._languageService.languageIdCodec);z._ttPolicy&&(i=z._ttPolicy.createHTML(i)),_.insertAdjacentHTML("beforeend",i),w=o.getLineContent(e.originalLineNumber)}0===w.length&&(w=(0,O.kg)("blankLine","blank"));let R="";switch(e.type){case Z.Unchanged:R=e.originalLineNumber===e.modifiedLineNumber?(0,O.kg)({key:"unchangedLine",comment:["The placeholders are contents of the line and should not be translated."]},"{0} unchanged line {1}",w,e.originalLineNumber):(0,O.kg)("equalLine","{0} original line {1} modified line {2}",w,e.originalLineNumber,e.modifiedLineNumber);break;case Z.Added:R=(0,O.kg)("insertLine","+ {0} modified line {1}",w,e.modifiedLineNumber);break;case Z.Deleted:R=(0,O.kg)("deleteLine","- {0} original line {1}",w,e.originalLineNumber)}return p.setAttribute("aria-label",R),p}_getLineHtml(e,i,t,n,o){const s=e.getLineContent(n),r=i.get(50),d=D.f.createEmpty(s,o),a=T.qL.isBasicASCII(s,e.mightContainNonBasicASCII()),h=T.qL.containsRTL(s,a,e.mightContainRTL());return(0,x.Md)(new x.zL(r.isMonospace&&!i.get(33),r.canUseHalfwidthRightwardsArrow,s,!1,a,h,0,d,[],t,0,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,i.get(118),i.get(100),i.get(95),i.get(51)!==R.Bc.OFF,null)).html}};K=W([k(5,I.L)],K);class X{constructor(e){this.editors=e}getOriginalModel(){return this.editors.original.getModel()}getOriginalOptions(){return this.editors.original.getOptions()}originalReveal(e){this.editors.original.revealRange(e),this.editors.original.setSelection(e),this.editors.original.focus()}getModifiedModel(){return this.editors.modified.getModel()}getModifiedOptions(){return this.editors.modified.getOptions()}modifiedReveal(e){e&&(this.editors.modified.revealRange(e),this.editors.modified.setSelection(e)),this.editors.modified.focus()}modifiedSetSelection(e){this.editors.modified.setSelection(e)}modifiedFocus(){this.editors.modified.focus()}getModifiedPosition(){return this.editors.modified.getPosition()??void 0}}var J=t(30325),ee=t(69708),ie=t(84795),te=t(39292);(0,te.x1A)("diffEditor.move.border","#8b8b8b9c",(0,O.kg)("diffEditor.move.border","The border color for text that got moved in the diff editor.")),(0,te.x1A)("diffEditor.moveActive.border","#FFA500",(0,O.kg)("diffEditor.moveActive.border","The active border color for text that got moved in the diff editor.")),(0,te.x1A)("diffEditor.unchangedRegionShadow",{dark:"#000000",light:"#737373BF",hcDark:"#000000",hcLight:"#737373BF"},(0,O.kg)("diffEditor.unchangedRegionShadow","The color of the shadow around unchanged region widgets."));const ne=(0,P.pU)("diff-insert",b.W.add,(0,O.kg)("diffInsertIcon","Line decoration for inserts in the diff editor.")),oe=(0,P.pU)("diff-remove",b.W.remove,(0,O.kg)("diffRemoveIcon","Line decoration for removals in the diff editor.")),se=ie.kI.register({className:"line-insert",description:"line-insert",isWholeLine:!0,linesDecorationsClassName:"insert-sign "+L.L.asClassName(ne),marginClassName:"gutter-insert"}),re=ie.kI.register({className:"line-delete",description:"line-delete",isWholeLine:!0,linesDecorationsClassName:"delete-sign "+L.L.asClassName(oe),marginClassName:"gutter-delete"}),de=ie.kI.register({className:"line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),ae=ie.kI.register({className:"line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),he=ie.kI.register({className:"char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),le=ie.kI.register({className:"char-insert",description:"char-insert",isWholeLine:!0}),ge=ie.kI.register({className:"char-insert diff-range-empty",description:"char-insert diff-range-empty"}),ce=ie.kI.register({className:"char-delete",description:"char-delete",shouldFillLineOnLineBreak:!0}),fe=ie.kI.register({className:"char-delete",description:"char-delete",isWholeLine:!0}),ue=ie.kI.register({className:"char-delete diff-range-empty",description:"char-delete diff-range-empty"});var me,pe=t(31710),_e=t(17531),ve=t(30222),be=t(22143),Le=t(41796),Ce=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r},we=function(e,i){return function(t,n){i(t,n,e)}};const Re=(0,A.u1)("diffProviderFactoryService");let Se=class{constructor(e){this.instantiationService=e}createDiffProvider(e){return this.instantiationService.createInstance(Me,e)}};Se=Ce([we(0,A._Y)],Se),(0,_e.v)(Re,Se,1);let Me=class{static{me=this}static{this.diffCache=new Map}constructor(e,i,t){this.editorWorkerService=i,this.telemetryService=t,this.onDidChangeEventEmitter=new r.vl,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="advanced",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(e)}dispose(){this.diffAlgorithmOnDidChangeSubscription?.dispose()}async computeDiff(e,i,t,n){if("string"!=typeof this.diffAlgorithm)return this.diffAlgorithm.computeDiff(e,i,t,n);if(e.isDisposed()||i.isDisposed())return{changes:[],identical:!0,quitEarly:!1,moves:[]};if(1===e.getLineCount()&&1===e.getLineMaxColumn(1))return 1===i.getLineCount()&&1===i.getLineMaxColumn(1)?{changes:[],identical:!0,quitEarly:!1,moves:[]}:{changes:[new E.wm(new S.M(1,2),new S.M(1,i.getLineCount()+1),[new E.q6(e.getFullModelRange(),i.getFullModelRange())])],identical:!1,quitEarly:!1,moves:[]};const o=JSON.stringify([e.uri.toString(),i.uri.toString()]),s=JSON.stringify([e.id,i.id,e.getAlternativeVersionId(),i.getAlternativeVersionId(),JSON.stringify(t)]),r=me.diffCache.get(o);if(r&&r.context===s)return r.result;const d=ve.W.create(),a=await this.editorWorkerService.computeDiff(e.uri,i.uri,t,this.diffAlgorithm),h=d.elapsed();if(this.telemetryService.publicLog2("diffEditor.computeDiff",{timeMs:h,timedOut:a?.quitEarly??!0,detectedMoves:t.computeMoves?a?.moves.length??0:-1}),n.isCancellationRequested)return{changes:[],identical:!1,quitEarly:!0,moves:[]};if(!a)throw new Error("no diff result available");return me.diffCache.size>10&&me.diffCache.delete(me.diffCache.keys().next().value),me.diffCache.set(o,{result:a,context:s}),a}setOptions(e){let i=!1;e.diffAlgorithm&&this.diffAlgorithm!==e.diffAlgorithm&&(this.diffAlgorithmOnDidChangeSubscription?.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=e.diffAlgorithm,"string"!=typeof e.diffAlgorithm&&(this.diffAlgorithmOnDidChangeSubscription=e.diffAlgorithm.onDidChange(()=>this.onDidChangeEventEmitter.fire())),i=!0),i&&this.onDidChangeEventEmitter.fire()}};Me=me=Ce([we(1,be.IEditorWorkerService),we(2,Le.k)],Me);var ye=t(51767),Ne=t(32643),Ee=t(24717),Ie=t(60439),De=t(79119),xe=t(72667);let Te=class extends d.jG{setActiveMovedText(e){this._activeMovedText.set(e,void 0)}constructor(e,i,t){super(),this.model=e,this._options=i,this._diffProviderFactoryService=t,this._isDiffUpToDate=(0,a.FY)(this,!1),this.isDiffUpToDate=this._isDiffUpToDate,this._diff=(0,a.FY)(this,void 0),this.diff=this._diff,this._unchangedRegions=(0,a.FY)(this,void 0),this.unchangedRegions=(0,a.un)(this,e=>this._options.hideUnchangedRegions.read(e)?this._unchangedRegions.read(e)?.regions??[]:((0,a.Rn)(e=>{for(const i of this._unchangedRegions.get()?.regions||[])i.collapseAll(e)}),[])),this.movedTextToCompare=(0,a.FY)(this,void 0),this._activeMovedText=(0,a.FY)(this,void 0),this._hoveredMovedText=(0,a.FY)(this,void 0),this.activeMovedText=(0,a.un)(this,e=>this.movedTextToCompare.read(e)??this._hoveredMovedText.read(e)??this._activeMovedText.read(e)),this._cancellationTokenSource=new pe.Qi,this._diffProvider=(0,a.un)(this,e=>{const i=this._diffProviderFactoryService.createDiffProvider({diffAlgorithm:this._options.diffAlgorithm.read(e)});return{diffProvider:i,onChangeSignal:(0,a.yQ)("onDidChange",i.onDidChange)}}),this._register((0,d.s)(()=>this._cancellationTokenSource.cancel()));const n=(0,a.Yd)("contentChangedSignal"),o=this._register(new J.uC(()=>n.trigger(void 0),200));this._register((0,a.fm)(i=>{const t=this._unchangedRegions.read(i);if(!t||t.regions.some(e=>e.isDragged.read(i)))return;const n=t.originalDecorationIds.map(i=>e.original.getDecorationRange(i)).map(e=>e?S.M.fromRangeInclusive(e):void 0),o=t.modifiedDecorationIds.map(i=>e.modified.getDecorationRange(i)).map(e=>e?S.M.fromRangeInclusive(e):void 0),s=t.regions.map((e,t)=>n[t]&&o[t]?new We(n[t].startLineNumber,o[t].startLineNumber,n[t].length,e.visibleLineCountTop.read(i),e.visibleLineCountBottom.read(i)):void 0).filter(ee.O9),r=[];let d=!1;for(const e of(0,v.n)(s,(e,t)=>e.getHiddenModifiedRange(i).endLineNumberExclusive===t.getHiddenModifiedRange(i).startLineNumber))if(e.length>1){d=!0;const i=e.reduce((e,i)=>e+i.lineCount,0),t=new We(e[0].originalLineNumber,e[0].modifiedLineNumber,i,e[0].visibleLineCountTop.get(),e[e.length-1].visibleLineCountBottom.get());r.push(t)}else r.push(e[0]);if(d){const i=e.original.deltaDecorations(t.originalDecorationIds,r.map(e=>({range:e.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),n=e.modified.deltaDecorations(t.modifiedDecorationIds,r.map(e=>({range:e.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));(0,a.Rn)(e=>{this._unchangedRegions.set({regions:r,originalDecorationIds:i,modifiedDecorationIds:n},e)})}}));const s=(i,t,n)=>{const o=We.fromDiffs(i.changes,e.original.getLineCount(),e.modified.getLineCount(),this._options.hideUnchangedRegionsMinimumLineCount.read(n),this._options.hideUnchangedRegionsContextLineCount.read(n));let s;const r=this._unchangedRegions.get();if(r){const i=r.originalDecorationIds.map(i=>e.original.getDecorationRange(i)).map(e=>e?S.M.fromRangeInclusive(e):void 0),t=r.modifiedDecorationIds.map(i=>e.modified.getDecorationRange(i)).map(e=>e?S.M.fromRangeInclusive(e):void 0);let o=(0,w.EK)(r.regions.map((e,n)=>{if(!i[n]||!t[n])return;const o=i[n].length;return new We(i[n].startLineNumber,t[n].startLineNumber,o,Math.min(e.visibleLineCountTop.get(),o),Math.min(e.visibleLineCountBottom.get(),o-e.visibleLineCountTop.get()))}).filter(ee.O9),(e,i)=>!i||e.modifiedLineNumber>=i.modifiedLineNumber+i.lineCount&&e.originalLineNumber>=i.originalLineNumber+i.lineCount).map(e=>new E.WL(e.getHiddenOriginalRange(n),e.getHiddenModifiedRange(n)));o=E.WL.clip(o,S.M.ofLength(1,e.original.getLineCount()),S.M.ofLength(1,e.modified.getLineCount())),s=E.WL.inverse(o,e.original.getLineCount(),e.modified.getLineCount())}const d=[];if(s)for(const e of o){const i=s.filter(i=>i.original.intersectsStrict(e.originalUnchangedRange)&&i.modified.intersectsStrict(e.modifiedUnchangedRange));d.push(...e.setVisibleRanges(i,t))}else d.push(...o);const a=e.original.deltaDecorations(r?.originalDecorationIds||[],d.map(e=>({range:e.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),h=e.modified.deltaDecorations(r?.modifiedDecorationIds||[],d.map(e=>({range:e.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));this._unchangedRegions.set({regions:d,originalDecorationIds:a,modifiedDecorationIds:h},t)};this._register(e.modified.onDidChangeContent(i=>{if(this._diff.get()){Ee.c.fromModelContentChanges(i.changes);const t=(this._lastDiff,e.original,void e.modified);t&&(this._lastDiff=t,(0,a.Rn)(e=>{this._diff.set(Ae.fromDiffResult(this._lastDiff),e),s(t,e);const i=this.movedTextToCompare.get();this.movedTextToCompare.set(i?this._lastDiff.moves.find(e=>e.lineRangeMapping.modified.intersect(i.lineRangeMapping.modified)):void 0,e)}))}this._isDiffUpToDate.set(!1,void 0),o.schedule()})),this._register(e.original.onDidChangeContent(i=>{if(this._diff.get()){Ee.c.fromModelContentChanges(i.changes);const t=(this._lastDiff,e.original,void e.modified);t&&(this._lastDiff=t,(0,a.Rn)(e=>{this._diff.set(Ae.fromDiffResult(this._lastDiff),e),s(t,e);const i=this.movedTextToCompare.get();this.movedTextToCompare.set(i?this._lastDiff.moves.find(e=>e.lineRangeMapping.modified.intersect(i.lineRangeMapping.modified)):void 0,e)}))}this._isDiffUpToDate.set(!1,void 0),o.schedule()})),this._register((0,a.yC)(async(i,t)=>{this._options.hideUnchangedRegionsMinimumLineCount.read(i),this._options.hideUnchangedRegionsContextLineCount.read(i),o.cancel(),n.read(i);const r=this._diffProvider.read(i);r.onChangeSignal.read(i),(0,ye.b)(Ne.D8,i),(0,ye.b)(De.NC,i),this._isDiffUpToDate.set(!1,void 0);let d=[];t.add(e.original.onDidChangeContent(e=>{const i=Ee.c.fromModelContentChanges(e.changes);d=(0,Ie.M)(d,i)}));let h=[];t.add(e.modified.onDidChangeContent(e=>{const i=Ee.c.fromModelContentChanges(e.changes);h=(0,Ie.M)(h,i)}));let l=await r.diffProvider.computeDiff(e.original,e.modified,{ignoreTrimWhitespace:this._options.ignoreTrimWhitespace.read(i),maxComputationTimeMs:this._options.maxComputationTimeMs.read(i),computeMoves:this._options.showMoves.read(i)},this._cancellationTokenSource.token);var g,c,f;this._cancellationTokenSource.token.isCancellationRequested||e.original.isDisposed()||e.modified.isDisposed()||(g=l,c=e.original,f=e.modified,l={changes:g.changes.map(e=>new E.wm(e.original,e.modified,e.innerChanges?e.innerChanges.map(e=>function(e,i,t){let n=e.originalRange,o=e.modifiedRange;return 1===n.startColumn&&1===o.startColumn&&(1!==n.endColumn||1!==o.endColumn)&&n.endColumn===i.getLineMaxColumn(n.endLineNumber)&&o.endColumn===t.getLineMaxColumn(o.endLineNumber)&&n.endLineNumber<i.getLineCount()&&o.endLineNumber<t.getLineCount()&&(n=n.setEndPosition(n.endLineNumber+1,1),o=o.setEndPosition(o.endLineNumber+1,1)),new E.q6(n,o)}(e,c,f)):void 0)),moves:g.moves,identical:g.identical,quitEarly:g.quitEarly},e.original,l=void e.modified??l,e.original,l=void e.modified??l,(0,a.Rn)(e=>{s(l,e),this._lastDiff=l;const i=Ae.fromDiffResult(l);this._diff.set(i,e),this._isDiffUpToDate.set(!0,e);const t=this.movedTextToCompare.get();this.movedTextToCompare.set(t?this._lastDiff.moves.find(e=>e.lineRangeMapping.modified.intersect(t.lineRangeMapping.modified)):void 0,e)}))}))}ensureModifiedLineIsVisible(e,i,t){if(0===this.diff.get()?.mappings.length)return;const n=this._unchangedRegions.get()?.regions||[];for(const o of n)if(o.getHiddenModifiedRange(void 0).contains(e))return void o.showModifiedLine(e,i,t)}ensureOriginalLineIsVisible(e,i,t){if(0===this.diff.get()?.mappings.length)return;const n=this._unchangedRegions.get()?.regions||[];for(const o of n)if(o.getHiddenOriginalRange(void 0).contains(e))return void o.showOriginalLine(e,i,t)}async waitForDiff(){await(0,a.oJ)(this.isDiffUpToDate,e=>e)}serializeState(){const e=this._unchangedRegions.get();return{collapsedRegions:e?.regions.map(e=>({range:e.getHiddenModifiedRange(void 0).serialize()}))}}restoreSerializedState(e){const i=e.collapsedRegions?.map(e=>S.M.deserialize(e.range)),t=this._unchangedRegions.get();t&&i&&(0,a.Rn)(e=>{for(const n of t.regions)for(const t of i)if(n.modifiedUnchangedRange.intersect(t)){n.setHiddenModifiedRange(t,e);break}})}};var Oe,Ve;Te=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r}([(Oe=2,Ve=Re,function(e,i){Ve(e,i,Oe)})],Te);class Ae{static fromDiffResult(e){return new Ae(e.changes.map(e=>new Pe(e)),e.moves||[],e.identical,e.quitEarly)}constructor(e,i,t,n){this.mappings=e,this.movedTexts=i,this.identical=t,this.quitEarly=n}}class Pe{constructor(e){this.lineRangeMapping=e}}class We{static fromDiffs(e,i,t,n,o){const s=E.wm.inverse(e,i,t),r=[];for(const e of s){let s=e.original.startLineNumber,d=e.modified.startLineNumber,a=e.original.length;const h=1===s&&1===d,l=s+a===i+1&&d+a===t+1;(h||l)&&a>=o+n?(h&&!l&&(a-=o),l&&!h&&(s+=o,d+=o,a-=o),r.push(new We(s,d,a,0,0))):a>=2*o+n&&(s+=o,d+=o,a-=2*o,r.push(new We(s,d,a,0,0)))}return r}get originalUnchangedRange(){return S.M.ofLength(this.originalLineNumber,this.lineCount)}get modifiedUnchangedRange(){return S.M.ofLength(this.modifiedLineNumber,this.lineCount)}constructor(e,i,t,n,o){this.originalLineNumber=e,this.modifiedLineNumber=i,this.lineCount=t,this._visibleLineCountTop=(0,a.FY)(this,0),this.visibleLineCountTop=this._visibleLineCountTop,this._visibleLineCountBottom=(0,a.FY)(this,0),this.visibleLineCountBottom=this._visibleLineCountBottom,this._shouldHideControls=(0,a.un)(this,e=>this.visibleLineCountTop.read(e)+this.visibleLineCountBottom.read(e)===this.lineCount&&!this.isDragged.read(e)),this.isDragged=(0,a.FY)(this,void 0);const s=Math.max(Math.min(n,this.lineCount),0),r=Math.max(Math.min(o,this.lineCount-n),0);(0,xe.V7)(n===s),(0,xe.V7)(o===r),this._visibleLineCountTop.set(s,void 0),this._visibleLineCountBottom.set(r,void 0)}setVisibleRanges(e,i){const t=[],n=new S.S(e.map(e=>e.modified)).subtractFrom(this.modifiedUnchangedRange);let o=this.originalLineNumber,s=this.modifiedLineNumber;const r=this.modifiedLineNumber+this.lineCount;if(0===n.ranges.length)this.showAll(i),t.push(this);else{let e=0;for(const d of n.ranges){const a=e===n.ranges.length-1;e++;const h=(a?r:d.endLineNumberExclusive)-s,l=new We(o,s,h,0,0);l.setHiddenModifiedRange(d,i),t.push(l),o=l.originalUnchangedRange.endLineNumberExclusive,s=l.modifiedUnchangedRange.endLineNumberExclusive}}return t}shouldHideControls(e){return this._shouldHideControls.read(e)}getHiddenOriginalRange(e){return S.M.ofLength(this.originalLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}getHiddenModifiedRange(e){return S.M.ofLength(this.modifiedLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}setHiddenModifiedRange(e,i){const t=e.startLineNumber-this.modifiedLineNumber,n=this.modifiedLineNumber+this.lineCount-e.endLineNumberExclusive;this.setState(t,n,i)}getMaxVisibleLineCountTop(){return this.lineCount-this._visibleLineCountBottom.get()}getMaxVisibleLineCountBottom(){return this.lineCount-this._visibleLineCountTop.get()}showMoreAbove(e=10,i){const t=this.getMaxVisibleLineCountTop();this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+e,t),i)}showMoreBelow(e=10,i){const t=this.lineCount-this._visibleLineCountTop.get();this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+e,t),i)}showAll(e){this._visibleLineCountBottom.set(this.lineCount-this._visibleLineCountTop.get(),e)}showModifiedLine(e,i,t){const n=e+1-(this.modifiedLineNumber+this._visibleLineCountTop.get()),o=this.modifiedLineNumber-this._visibleLineCountBottom.get()+this.lineCount-e;0===i&&n<o||1===i?this._visibleLineCountTop.set(this._visibleLineCountTop.get()+n,t):this._visibleLineCountBottom.set(this._visibleLineCountBottom.get()+o,t)}showOriginalLine(e,i,t){const n=e-this.originalLineNumber,o=this.originalLineNumber+this.lineCount-e;0===i&&n<o||1===i?this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+o-n,this.getMaxVisibleLineCountTop()),t):this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+n-o,this.getMaxVisibleLineCountBottom()),t)}collapseAll(e){this._visibleLineCountTop.set(0,e),this._visibleLineCountBottom.set(0,e)}setState(e,i,t){e=Math.max(Math.min(e,this.lineCount),0),i=Math.max(Math.min(i,this.lineCount-e),0),this._visibleLineCountTop.set(e,t),this._visibleLineCountBottom.set(i,t)}}var ke=t(69958);class He extends d.jG{get visibility(){return this._visibility}set visibility(e){this._visibility!==e&&(this._visibility=e,this._diffActions.style.visibility=e?"visible":"hidden")}constructor(e,i,t,o,s,r,d,a,h){super(),this._getViewZoneId=e,this._marginDomNode=i,this._modifiedEditor=t,this._diff=o,this._editor=s,this._viewLineCounts=r,this._originalTextModel=d,this._contextMenuService=a,this._clipboardService=h,this._visibility=!1,this._marginDomNode.style.zIndex="10",this._diffActions=document.createElement("div"),this._diffActions.className=L.L.asClassName(b.W.lightBulb)+" lightbulb-glyph",this._diffActions.style.position="absolute";const l=this._modifiedEditor.getOption(67);this._diffActions.style.right="0px",this._diffActions.style.visibility="hidden",this._diffActions.style.height=`${l}px`,this._diffActions.style.lineHeight=`${l}px`,this._marginDomNode.appendChild(this._diffActions);let g=0;const c=t.getOption(128)&&!ke.un,f=(e,i)=>{this._contextMenuService.showContextMenu({domForShadowRoot:c?t.getDomNode()??void 0:void 0,getAnchor:()=>({x:e,y:i}),getActions:()=>{const e=[],i=o.modified.isEmpty;return e.push(new _.rc("diff.clipboard.copyDeletedContent",i?o.original.length>1?(0,O.kg)("diff.clipboard.copyDeletedLinesContent.label","Copy deleted lines"):(0,O.kg)("diff.clipboard.copyDeletedLinesContent.single.label","Copy deleted line"):o.original.length>1?(0,O.kg)("diff.clipboard.copyChangedLinesContent.label","Copy changed lines"):(0,O.kg)("diff.clipboard.copyChangedLinesContent.single.label","Copy changed line"),void 0,!0,async()=>{const e=this._originalTextModel.getValueInRange(o.original.toExclusiveRange());await this._clipboardService.writeText(e)})),o.original.length>1&&e.push(new _.rc("diff.clipboard.copyDeletedLineContent",i?(0,O.kg)("diff.clipboard.copyDeletedLineContent.label","Copy deleted line ({0})",o.original.startLineNumber+g):(0,O.kg)("diff.clipboard.copyChangedLineContent.label","Copy changed line ({0})",o.original.startLineNumber+g),void 0,!0,async()=>{let e=this._originalTextModel.getLineContent(o.original.startLineNumber+g);""===e&&(e=0===this._originalTextModel.getEndOfLineSequence()?"\n":"\r\n"),await this._clipboardService.writeText(e)})),t.getOption(92)||e.push(new _.rc("diff.inline.revertChange",(0,O.kg)("diff.inline.revertChange.label","Revert this change"),void 0,!0,async()=>{this._editor.revert(this._diff)})),e},autoSelectFirstItem:!0})};this._register((0,n.b2)(this._diffActions,"mousedown",e=>{if(!e.leftButton)return;const{top:i,height:t}=(0,n.BK)(this._diffActions),o=Math.floor(l/3);e.preventDefault(),f(e.posx,i+t+o)})),this._register(t.onMouseMove(e=>{8!==e.target.type&&5!==e.target.type||e.target.detail.viewZoneId!==this._getViewZoneId()?this.visibility=!1:(g=this._updateLightBulbPosition(this._marginDomNode,e.event.browserEvent.y,l),this.visibility=!0)})),this._register(t.onMouseDown(e=>{!e.event.leftButton||8!==e.target.type&&5!==e.target.type||e.target.detail.viewZoneId===this._getViewZoneId()&&(e.event.preventDefault(),g=this._updateLightBulbPosition(this._marginDomNode,e.event.browserEvent.y,l),f(e.event.posx,e.event.posy+l))}))}_updateLightBulbPosition(e,i,t){const{top:o}=(0,n.BK)(e),s=i-o,r=Math.floor(s/t),d=r*t;if(this._diffActions.style.top=`${d}px`,this._viewLineCounts){let e=0;for(let i=0;i<this._viewLineCounts.length;i++)if(e+=this._viewLineCounts[i],r<e)return i}return r}}var Be=t(15801),Fe=t(68716);const ze=(0,u.H)("diffEditorWidget",{createHTML:e=>e});function Ue(e,i,t,n){(0,C.M)(n,i.fontInfo);const o=t.length>0,s=new Be.fe(1e4);let r=0,d=0;const a=[];for(let n=0;n<e.lineTokens.length;n++){const h=n+1,l=e.lineTokens[n],g=e.lineBreakData[n],c=Fe.d.filter(t,h,1,Number.MAX_SAFE_INTEGER);if(g){let t=0;for(const n of g.breakOffsets){const a=l.sliceAndInflate(t,n,0);r=Math.max(r,Ge(d,a,Fe.d.extractWrapped(c,t,n),o,e.mightContainNonBasicASCII,e.mightContainRTL,i,s)),d++,t=n}a.push(g.breakOffsets.length)}else a.push(1),r=Math.max(r,Ge(d,l,c,o,e.mightContainNonBasicASCII,e.mightContainRTL,i,s)),d++}r+=i.scrollBeyondLastColumn;const h=s.build(),l=ze?ze.createHTML(h):h;return n.innerHTML=l,{heightInLines:d,minWidthInPx:r*i.typicalHalfwidthCharacterWidth,viewLineCounts:a}}class je{constructor(e,i,t,n){this.lineTokens=e,this.lineBreakData=i,this.mightContainNonBasicASCII=t,this.mightContainRTL=n}}class Ze{static fromEditor(e){const i=e.getOptions(),t=i.get(50),n=i.get(146);return new Ze(e.getModel()?.getOptions().tabSize||0,t,i.get(33),t.typicalHalfwidthCharacterWidth,i.get(105),i.get(67),n.decorationsWidth,i.get(118),i.get(100),i.get(95),i.get(51))}constructor(e,i,t,n,o,s,r,d,a,h,l){this.tabSize=e,this.fontInfo=i,this.disableMonospaceOptimizations=t,this.typicalHalfwidthCharacterWidth=n,this.scrollBeyondLastColumn=o,this.lineHeight=s,this.lineDecorationsWidth=r,this.stopRenderingLineAfter=d,this.renderWhitespace=a,this.renderControlCharacters=h,this.fontLigatures=l}}function Ge(e,i,t,n,o,s,r,d){d.appendString('<div class="view-line'),n||d.appendString(" char-delete"),d.appendString('" style="top:'),d.appendString(String(e*r.lineHeight)),d.appendString('px;width:1000000px;">');const a=i.getLineContent(),h=T.qL.isBasicASCII(a,o),l=T.qL.containsRTL(a,h,s),g=(0,x.UW)(new x.zL(r.fontInfo.isMonospace&&!r.disableMonospaceOptimizations,r.fontInfo.canUseHalfwidthRightwardsArrow,a,!1,h,l,0,i,t,r.tabSize,0,r.fontInfo.spaceWidth,r.fontInfo.middotWidth,r.fontInfo.wsmiddotWidth,r.stopRenderingLineAfter,r.renderWhitespace,r.renderControlCharacters,r.fontLigatures!==R.Bc.OFF,null),d);return d.appendString("</div>"),g.characterMapping.getHorizontalOffset(g.characterMapping.length)}var Ye=t(70235),qe=t(61293),$e=function(e,i){return function(t,n){i(t,n,e)}};let Qe=class extends d.jG{constructor(e,i,t,o,s,r,h,l,g,c){super(),this._targetWindow=e,this._editors=i,this._diffModel=t,this._options=o,this._diffEditorWidget=s,this._canIgnoreViewZoneUpdateEvent=r,this._origViewZonesToIgnore=h,this._modViewZonesToIgnore=l,this._clipboardService=g,this._contextMenuService=c,this._originalTopPadding=(0,a.FY)(this,0),this._originalScrollOffset=(0,a.FY)(this,0),this._originalScrollOffsetAnimated=(0,w.Nu)(this._targetWindow,this._originalScrollOffset,this._store),this._modifiedTopPadding=(0,a.FY)(this,0),this._modifiedScrollOffset=(0,a.FY)(this,0),this._modifiedScrollOffsetAnimated=(0,w.Nu)(this._targetWindow,this._modifiedScrollOffset,this._store);const f=(0,a.FY)("invalidateAlignmentsState",0),u=this._register(new J.uC(()=>{f.set(f.get()+1,void 0)},0));this._register(this._editors.original.onDidChangeViewZones(e=>{this._canIgnoreViewZoneUpdateEvent()||u.schedule()})),this._register(this._editors.modified.onDidChangeViewZones(e=>{this._canIgnoreViewZoneUpdateEvent()||u.schedule()})),this._register(this._editors.original.onDidChangeConfiguration(e=>{(e.hasChanged(147)||e.hasChanged(67))&&u.schedule()})),this._register(this._editors.modified.onDidChangeConfiguration(e=>{(e.hasChanged(147)||e.hasChanged(67))&&u.schedule()}));const m=this._diffModel.map(e=>e?(0,a.y0)(this,e.model.original.onDidChangeTokens,()=>2===e.model.original.tokenization.backgroundTokenizationState):void 0).map((e,i)=>e?.read(i)),p=(0,a.un)(e=>{const i=this._diffModel.read(e),t=i?.diff.read(e);if(!i||!t)return null;f.read(e);const n=this._options.renderSideBySide.read(e);return Ke(this._editors.original,this._editors.modified,t.mappings,this._origViewZonesToIgnore,this._modViewZonesToIgnore,n)}),_=(0,a.un)(e=>{const i=this._diffModel.read(e)?.movedTextToCompare.read(e);if(!i)return null;f.read(e);const t=i.changes.map(e=>new Pe(e));return Ke(this._editors.original,this._editors.modified,t,this._origViewZonesToIgnore,this._modViewZonesToIgnore,!0)});function v(){const e=document.createElement("div");return e.className="diagonal-fill",e}const R=this._register(new d.Cm);this.viewZones=(0,a.rm)(this,(e,i)=>{R.clear();const t=p.read(e)||[],o=[],r=[],d=this._modifiedTopPadding.read(e);d>0&&r.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:d,showInHiddenAreas:!0,suppressMouseDown:!0});const a=this._originalTopPadding.read(e);a>0&&o.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:a,showInHiddenAreas:!0,suppressMouseDown:!0});const h=this._options.renderSideBySide.read(e),l=h?void 0:this._editors.modified._getViewModel()?.createLineBreaksComputer();if(l){const y=this._editors.original.getModel();for(const N of t)if(N.diff)for(let E=N.originalRange.startLineNumber;E<N.originalRange.endLineNumberExclusive;E++){if(E>y.getLineCount())return{orig:o,mod:r};l?.addRequest(y.getLineContent(E),null,null)}}const g=l?.finalize()??[];let c=0;const f=this._editors.modified.getOption(67),u=this._diffModel.read(e)?.movedTextToCompare.read(e),w=this._editors.original.getModel()?.mightContainNonBasicASCII()??!1,S=this._editors.original.getModel()?.mightContainRTL()??!1,M=Ze.fromEditor(this._editors.modified);for(const I of t)if(!I.diff||h||this._options.useTrueInlineDiffRendering.read(e)&&Je(I.diff)){const D=I.modifiedHeightInPx-I.originalHeightInPx;if(D>0){if(u?.lineRangeMapping.original.delta(-1).deltaLength(2).contains(I.originalRange.endLineNumberExclusive-1))continue;o.push({afterLineNumber:I.originalRange.endLineNumberExclusive-1,domNode:v(),heightInPx:D,showInHiddenAreas:!0,suppressMouseDown:!0})}else{if(u?.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(I.modifiedRange.endLineNumberExclusive-1))continue;function x(){const e=document.createElement("div");return e.className="arrow-revert-change "+L.L.asClassName(b.W.arrowRight),i.add((0,n.ko)(e,"mousedown",e=>e.stopPropagation())),i.add((0,n.ko)(e,"click",e=>{e.stopPropagation(),s.revert(I.diff)})),(0,n.$)("div",{},e)}let O;I.diff&&I.diff.modified.isEmpty&&this._options.shouldRenderOldRevertArrows.read(e)&&(O=x()),r.push({afterLineNumber:I.modifiedRange.endLineNumberExclusive-1,domNode:v(),heightInPx:-D,marginDomNode:O,showInHiddenAreas:!0,suppressMouseDown:!0})}}else{if(!I.originalRange.isEmpty){m.read(e);const A=document.createElement("div");A.classList.add("view-lines","line-delete","monaco-mouse-cursor-text");const P=this._editors.original.getModel();if(I.originalRange.endLineNumberExclusive-1>P.getLineCount())return{orig:o,mod:r};const W=new je(I.originalRange.mapToLineArray(e=>P.tokenization.getLineTokens(e)),I.originalRange.mapToLineArray(e=>g[c++]),w,S),k=[];for(const z of I.diff.innerChanges||[])k.push(new T.kI(z.originalRange.delta(-(I.diff.original.startLineNumber-1)),ce.className,0));const H=Ue(W,M,k,A),B=document.createElement("div");if(B.className="inline-deleted-margin-view-zone",(0,C.M)(B,M.fontInfo),this._options.renderIndicators.read(e))for(let U=0;U<H.heightInLines;U++){const j=document.createElement("div");j.className=`delete-sign ${L.L.asClassName(oe)}`,j.setAttribute("style",`position:absolute;top:${U*f}px;width:${M.lineDecorationsWidth}px;height:${f}px;right:0;`),B.appendChild(j)}let F;R.add(new He(()=>(0,ee.eU)(F),B,this._editors.modified,I.diff,this._diffEditorWidget,H.viewLineCounts,this._editors.original.getModel(),this._contextMenuService,this._clipboardService));for(let Z=0;Z<H.viewLineCounts.length;Z++){const G=H.viewLineCounts[Z];G>1&&o.push({afterLineNumber:I.originalRange.startLineNumber+Z,domNode:v(),heightInPx:(G-1)*f,showInHiddenAreas:!0,suppressMouseDown:!0})}r.push({afterLineNumber:I.modifiedRange.startLineNumber-1,domNode:A,heightInPx:H.heightInLines*f,minWidthInPx:H.minWidthInPx,marginDomNode:B,setZoneId(e){F=e},showInHiddenAreas:!0,suppressMouseDown:!0})}const V=document.createElement("div");V.className="gutter-delete",o.push({afterLineNumber:I.originalRange.endLineNumberExclusive-1,domNode:v(),heightInPx:I.modifiedHeightInPx,marginDomNode:V,showInHiddenAreas:!0,suppressMouseDown:!0})}for(const Y of _.read(e)??[]){if(!u?.lineRangeMapping.original.intersect(Y.originalRange)||!u?.lineRangeMapping.modified.intersect(Y.modifiedRange))continue;const q=Y.modifiedHeightInPx-Y.originalHeightInPx;q>0?o.push({afterLineNumber:Y.originalRange.endLineNumberExclusive-1,domNode:v(),heightInPx:q,showInHiddenAreas:!0,suppressMouseDown:!0}):r.push({afterLineNumber:Y.modifiedRange.endLineNumberExclusive-1,domNode:v(),heightInPx:-q,showInHiddenAreas:!0,suppressMouseDown:!0})}return{orig:o,mod:r}});let S=!1;this._register(this._editors.original.onDidScrollChange(e=>{e.scrollLeftChanged&&!S&&(S=!0,this._editors.modified.setScrollLeft(e.scrollLeft),S=!1)})),this._register(this._editors.modified.onDidScrollChange(e=>{e.scrollLeftChanged&&!S&&(S=!0,this._editors.original.setScrollLeft(e.scrollLeft),S=!1)})),this._originalScrollTop=(0,a.y0)(this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=(0,a.y0)(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._register((0,a.fm)(e=>{const i=this._originalScrollTop.read(e)-(this._originalScrollOffsetAnimated.get()-this._modifiedScrollOffsetAnimated.read(e))-(this._originalTopPadding.get()-this._modifiedTopPadding.read(e));i!==this._editors.modified.getScrollTop()&&this._editors.modified.setScrollTop(i,1)})),this._register((0,a.fm)(e=>{const i=this._modifiedScrollTop.read(e)-(this._modifiedScrollOffsetAnimated.get()-this._originalScrollOffsetAnimated.read(e))-(this._modifiedTopPadding.get()-this._originalTopPadding.read(e));i!==this._editors.original.getScrollTop()&&this._editors.original.setScrollTop(i,1)})),this._register((0,a.fm)(e=>{const i=this._diffModel.read(e)?.movedTextToCompare.read(e);let t=0;if(i){const e=this._editors.original.getTopForLineNumber(i.lineRangeMapping.original.startLineNumber,!0)-this._originalTopPadding.get();t=this._editors.modified.getTopForLineNumber(i.lineRangeMapping.modified.startLineNumber,!0)-this._modifiedTopPadding.get()-e}t>0?(this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(t,void 0)):t<0?(this._modifiedTopPadding.set(-t,void 0),this._originalTopPadding.set(0,void 0)):setTimeout(()=>{this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(0,void 0)},400),this._editors.modified.hasTextFocus()?this._originalScrollOffset.set(this._modifiedScrollOffset.get()-t,void 0,!0):this._modifiedScrollOffset.set(this._originalScrollOffset.get()+t,void 0,!0)}))}};function Ke(e,i,t,n,o,s){const r=new v.j3(Xe(e,n)),d=new v.j3(Xe(i,o)),a=e.getOption(67),h=i.getOption(67),l=[];let g=0,c=0;function f(e,i){for(;;){let t=r.peek(),n=d.peek();if(t&&t.lineNumber>=e&&(t=void 0),n&&n.lineNumber>=i&&(n=void 0),!t&&!n)break;const o=t?t.lineNumber-g:Number.MAX_VALUE,s=n?n.lineNumber-c:Number.MAX_VALUE;o<s?(r.dequeue(),n={lineNumber:t.lineNumber-g+c,heightInPx:0}):o>s?(d.dequeue(),t={lineNumber:n.lineNumber-c+g,heightInPx:0}):(r.dequeue(),d.dequeue()),l.push({originalRange:S.M.ofLength(t.lineNumber,1),modifiedRange:S.M.ofLength(n.lineNumber,1),originalHeightInPx:a+t.heightInPx,modifiedHeightInPx:h+n.heightInPx,diff:void 0})}}for(const u of t){const m=u.lineRangeMapping;f(m.original.startLineNumber,m.modified.startLineNumber);let p=!0,_=m.modified.startLineNumber,b=m.original.startLineNumber;function L(e,i,t=!1){if(e<b||i<_)return;if(p)p=!1;else if(!t&&(e===b||i===_))return;const n=new S.M(b,e),o=new S.M(_,i);if(n.isEmpty&&o.isEmpty)return;const s=r.takeWhile(i=>i.lineNumber<e)?.reduce((e,i)=>e+i.heightInPx,0)??0,g=d.takeWhile(e=>e.lineNumber<i)?.reduce((e,i)=>e+i.heightInPx,0)??0;l.push({originalRange:n,modifiedRange:o,originalHeightInPx:n.length*a+s,modifiedHeightInPx:o.length*h+g,diff:u.lineRangeMapping}),b=e,_=i}if(s)for(const C of m.innerChanges||[]){C.originalRange.startColumn>1&&C.modifiedRange.startColumn>1&&L(C.originalRange.startLineNumber,C.modifiedRange.startLineNumber);const w=e.getModel(),R=C.originalRange.endLineNumber<=w.getLineCount()?w.getLineMaxColumn(C.originalRange.endLineNumber):Number.MAX_SAFE_INTEGER;C.originalRange.endColumn<R&&L(C.originalRange.endLineNumber,C.modifiedRange.endLineNumber)}L(m.original.endLineNumberExclusive,m.modified.endLineNumberExclusive,!0),g=m.original.endLineNumberExclusive,c=m.modified.endLineNumberExclusive}return f(Number.MAX_VALUE,Number.MAX_VALUE),l}function Xe(e,i){const t=[],n=[],o=-1!==e.getOption(147).wrappingColumn,s=e._getViewModel().coordinatesConverter,r=e.getOption(67);if(o)for(let i=1;i<=e.getModel().getLineCount();i++){const e=s.getModelLineViewLineCount(i);e>1&&n.push({lineNumber:i,heightInPx:r*(e-1)})}for(const n of e.getWhitespaces()){if(i.has(n.id))continue;const e=0===n.afterLineNumber?0:s.convertViewPositionToModelPosition(new y.y(n.afterLineNumber,1)).lineNumber;t.push({lineNumber:e,heightInPx:n.height})}return(0,w.Am)(t,n,e=>e.lineNumber,(e,i)=>({lineNumber:e.lineNumber,heightInPx:e.heightInPx+i.heightInPx}))}function Je(e){return!!e.innerChanges&&e.innerChanges.every(e=>ei(e.modifiedRange)&&ei(e.originalRange)||e.originalRange.equalsRange(new N.Q(1,1,1,1)))}function ei(e){return e.startLineNumber===e.endLineNumber}Qe=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r}([$e(8,Ye.h),$e(9,qe.Z)],Qe);class ii extends d.jG{static{this.movedCodeBlockPadding=4}constructor(e,i,t,n,o){super(),this._rootElement=e,this._diffModel=i,this._originalEditorLayoutInfo=t,this._modifiedEditorLayoutInfo=n,this._editors=o,this._originalScrollTop=(0,a.y0)(this,this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=(0,a.y0)(this,this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._viewZonesChanged=(0,a.yQ)("onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this.width=(0,a.FY)(this,0),this._modifiedViewZonesChangedSignal=(0,a.yQ)("modified.onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this._originalViewZonesChangedSignal=(0,a.yQ)("original.onDidChangeViewZones",this._editors.original.onDidChangeViewZones),this._state=(0,a.rm)(this,(e,i)=>{this._element.replaceChildren();const t=this._diffModel.read(e),n=t?.diff.read(e)?.movedTexts;if(!n||0===n.length)return void this.width.set(0,void 0);this._viewZonesChanged.read(e);const o=this._originalEditorLayoutInfo.read(e),s=this._modifiedEditorLayoutInfo.read(e);if(!o||!s)return void this.width.set(0,void 0);this._modifiedViewZonesChangedSignal.read(e),this._originalViewZonesChangedSignal.read(e);const r=n.map(i=>{function t(e,i){return(i.getTopForLineNumber(e.startLineNumber,!0)+i.getTopForLineNumber(e.endLineNumberExclusive,!0))/2}const n=t(i.lineRangeMapping.original,this._editors.original),o=this._originalScrollTop.read(e),s=t(i.lineRangeMapping.modified,this._editors.modified),r=n-o,d=s-this._modifiedScrollTop.read(e),a=Math.min(n,s),h=Math.max(n,s);return{range:new M.L(a,h),from:r,to:d,fromWithoutScroll:n,toWithoutScroll:s,move:i}});r.sort((0,v.nH)((0,v.VE)(e=>e.fromWithoutScroll>e.toWithoutScroll,v.TS),(0,v.VE)(e=>e.fromWithoutScroll>e.toWithoutScroll?e.fromWithoutScroll:-e.toWithoutScroll,v.U9)));const d=ti.compute(r.map(e=>e.range)),h=o.verticalScrollbarWidth,l=10*(d.getTrackCount()-1)+20,g=h+l+(s.contentLeft-ii.movedCodeBlockPadding);let c=0;for(const e of r){const n=h+10+10*d.getTrack(c),o=15,r=15,l=g,f=s.glyphMarginWidth+s.lineNumbersWidth,u=18,m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.classList.add("arrow-rectangle"),m.setAttribute("x",""+(l-f)),m.setAttribute("y",""+(e.to-u/2)),m.setAttribute("width",`${f}`),m.setAttribute("height",`${u}`),this._element.appendChild(m);const p=document.createElementNS("http://www.w3.org/2000/svg","g"),_=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttribute("d",`M 0 ${e.from} L ${n} ${e.from} L ${n} ${e.to} L ${l-r} ${e.to}`),_.setAttribute("fill","none"),p.appendChild(_);const v=document.createElementNS("http://www.w3.org/2000/svg","polygon");v.classList.add("arrow"),i.add((0,a.fm)(i=>{_.classList.toggle("currentMove",e.move===t.activeMovedText.read(i)),v.classList.toggle("currentMove",e.move===t.activeMovedText.read(i))})),v.setAttribute("points",`${l-r},${e.to-o/2} ${l},${e.to} ${l-r},${e.to+o/2}`),p.appendChild(v),this._element.appendChild(p),c++}this.width.set(l,void 0)}),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("class","moved-blocks-lines"),this._rootElement.appendChild(this._element),this._register((0,d.s)(()=>this._element.remove())),this._register((0,a.fm)(e=>{const i=this._originalEditorLayoutInfo.read(e),t=this._modifiedEditorLayoutInfo.read(e);i&&t&&(this._element.style.left=i.width-i.verticalScrollbarWidth+"px",this._element.style.height=`${i.height}px`,this._element.style.width=`${i.verticalScrollbarWidth+i.contentLeft-ii.movedCodeBlockPadding+this.width.read(e)}px`)})),this._register((0,a.OI)(this._state));const s=(0,a.un)(e=>{const i=this._diffModel.read(e),t=i?.diff.read(e);return t?t.movedTexts.map(e=>({move:e,original:new w.D1((0,a.lk)(e.lineRangeMapping.original.startLineNumber-1),18),modified:new w.D1((0,a.lk)(e.lineRangeMapping.modified.startLineNumber-1),18)})):[]});this._register((0,w.Vs)(this._editors.original,s.map(e=>e.map(e=>e.original)))),this._register((0,w.Vs)(this._editors.modified,s.map(e=>e.map(e=>e.modified)))),this._register((0,a.yC)((e,i)=>{const t=s.read(e);for(const e of t)i.add(new ni(this._editors.original,e.original,e.move,"original",this._diffModel.get())),i.add(new ni(this._editors.modified,e.modified,e.move,"modified",this._diffModel.get()))}));const r=(0,a.yQ)("original.onDidFocusEditorWidget",e=>this._editors.original.onDidFocusEditorWidget(()=>setTimeout(()=>e(void 0),0))),h=(0,a.yQ)("modified.onDidFocusEditorWidget",e=>this._editors.modified.onDidFocusEditorWidget(()=>setTimeout(()=>e(void 0),0)));let l="modified";this._register((0,a.Y)({createEmptyChangeSummary:()=>{},handleChange:(e,i)=>(e.didChange(r)&&(l="original"),e.didChange(h)&&(l="modified"),!0)},e=>{r.read(e),h.read(e);const i=this._diffModel.read(e);if(!i)return;const t=i.diff.read(e);let n;if(t&&"original"===l){const i=this._editors.originalCursor.read(e);i&&(n=t.movedTexts.find(e=>e.lineRangeMapping.original.contains(i.lineNumber)))}if(t&&"modified"===l){const i=this._editors.modifiedCursor.read(e);i&&(n=t.movedTexts.find(e=>e.lineRangeMapping.modified.contains(i.lineNumber)))}n!==i.movedTextToCompare.get()&&i.movedTextToCompare.set(void 0,void 0),i.setActiveMovedText(n)}))}}class ti{static compute(e){const i=[],t=[];for(const n of e){let e=i.findIndex(e=>!e.intersectsStrict(n));if(-1===e){const t=6;i.length>=t?e=(0,o.TM)(i,(0,v.VE)(e=>e.intersectWithRangeLength(n),v.U9)):(e=i.length,i.push(new M.h))}i[e].addRange(n),t.push(e)}return new ti(i.length,t)}constructor(e,i){this._trackCount=e,this.trackPerLineIdx=i}getTrack(e){return this.trackPerLineIdx[e]}getTrackCount(){return this._trackCount}}class ni extends w.uN{constructor(e,i,t,o,s){const r=(0,n.h)("div.diff-hidden-lines-widget");super(e,i,r.root),this._editor=e,this._move=t,this._kind=o,this._diffModel=s,this._nodes=(0,n.h)("div.diff-moved-code-block",{style:{marginRight:"4px"}},[(0,n.h)("div.text-content@textContent"),(0,n.h)("div.action-bar@actionBar")]),r.root.appendChild(this._nodes.root);const d=(0,a.y0)(this._editor.onDidLayoutChange,()=>this._editor.getLayoutInfo());let h;this._register((0,w.AV)(this._nodes.root,{paddingRight:d.map(e=>e.verticalScrollbarWidth)})),h=t.changes.length>0?"original"===this._kind?(0,O.kg)("codeMovedToWithChanges","Code moved with changes to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):(0,O.kg)("codeMovedFromWithChanges","Code moved with changes from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1):"original"===this._kind?(0,O.kg)("codeMovedTo","Code moved to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):(0,O.kg)("codeMovedFrom","Code moved from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1);const l=this._register(new m.E(this._nodes.actionBar,{highlightToggledItems:!0})),g=new _.rc("",h,"",!1);l.push(g,{icon:!1,label:!0});const c=new _.rc("","Compare",L.L.asClassName(b.W.compareChanges),!0,()=>{this._editor.focus(),this._diffModel.movedTextToCompare.set(this._diffModel.movedTextToCompare.get()===t?void 0:this._move,void 0)});this._register((0,a.fm)(e=>{const i=this._diffModel.movedTextToCompare.read(e)===t;c.checked=i})),l.push(c,{icon:!1,label:!0})}}class oi extends d.jG{constructor(e,i,t,n){super(),this._editors=e,this._diffModel=i,this._options=t,this._decorations=(0,a.un)(this,e=>{const i=this._diffModel.read(e),t=i?.diff.read(e);if(!t)return null;const n=this._diffModel.read(e).movedTextToCompare.read(e),o=this._options.renderIndicators.read(e),s=this._options.showEmptyDecorations.read(e),r=[],d=[];if(!n)for(const n of t.mappings)if(n.lineRangeMapping.original.isEmpty||r.push({range:n.lineRangeMapping.original.toInclusiveRange(),options:o?re:ae}),n.lineRangeMapping.modified.isEmpty||d.push({range:n.lineRangeMapping.modified.toInclusiveRange(),options:o?se:de}),n.lineRangeMapping.modified.isEmpty||n.lineRangeMapping.original.isEmpty)n.lineRangeMapping.original.isEmpty||r.push({range:n.lineRangeMapping.original.toInclusiveRange(),options:fe}),n.lineRangeMapping.modified.isEmpty||d.push({range:n.lineRangeMapping.modified.toInclusiveRange(),options:le});else{const t=this._options.useTrueInlineDiffRendering.read(e)&&Je(n.lineRangeMapping);for(const e of n.lineRangeMapping.innerChanges||[])if(n.lineRangeMapping.original.contains(e.originalRange.startLineNumber)&&r.push({range:e.originalRange,options:e.originalRange.isEmpty()&&s?ue:ce}),n.lineRangeMapping.modified.contains(e.modifiedRange.startLineNumber)&&d.push({range:e.modifiedRange,options:e.modifiedRange.isEmpty()&&s&&!t?ge:he}),t){const t=i.model.original.getValueInRange(e.originalRange);d.push({range:e.modifiedRange,options:{description:"deleted-text",before:{content:t,inlineClassName:"inline-deleted-text"},zIndex:1e5,showIfCollapsed:!0}})}}if(n)for(const e of n.changes){const i=e.original.toInclusiveRange();i&&r.push({range:i,options:o?re:ae});const t=e.modified.toInclusiveRange();t&&d.push({range:t,options:o?se:de});for(const i of e.innerChanges||[])r.push({range:i.originalRange,options:ce}),d.push({range:i.modifiedRange,options:he})}const a=this._diffModel.read(e).activeMovedText.read(e);for(const e of t.movedTexts)r.push({range:e.lineRangeMapping.original.toInclusiveRange(),options:{description:"moved",blockClassName:"movedOriginal"+(e===a?" currentMove":""),blockPadding:[ii.movedCodeBlockPadding,0,ii.movedCodeBlockPadding,ii.movedCodeBlockPadding]}}),d.push({range:e.lineRangeMapping.modified.toInclusiveRange(),options:{description:"moved",blockClassName:"movedModified"+(e===a?" currentMove":""),blockPadding:[4,0,4,4]}});return{originalDecorations:r,modifiedDecorations:d}}),this._register((0,w.pY)(this._editors.original,this._decorations.map(e=>e?.originalDecorations||[]))),this._register((0,w.pY)(this._editors.modified,this._decorations.map(e=>e?.modifiedDecorations||[])))}}var si=t(57932);class ri{resetSash(){this._sashRatio.set(void 0,void 0)}constructor(e,i){this._options=e,this.dimensions=i,this.sashLeft=(0,h.dQ)(this,e=>{const i=this._sashRatio.read(e)??this._options.splitViewDefaultRatio.read(e);return this._computeSashLeft(i,e)},(e,i)=>{const t=this.dimensions.width.get();this._sashRatio.set(e/t,i)}),this._sashRatio=(0,a.FY)(this,void 0)}_computeSashLeft(e,i){const t=this.dimensions.width.read(i),n=Math.floor(this._options.splitViewDefaultRatio.read(i)*t),o=this._options.enableSplitViewResizing.read(i)?Math.floor(e*t):n,s=100;return t<=200?n:o<s?s:o>t-s?t-s:o}}class di extends d.jG{constructor(e,i,t,n,o,s){super(),this._domNode=e,this._dimensions=i,this._enabled=t,this._boundarySashes=n,this.sashLeft=o,this._resetSash=s,this._sash=this._register(new si.m(this._domNode,{getVerticalSashTop:e=>0,getVerticalSashLeft:e=>this.sashLeft.get(),getVerticalSashHeight:e=>this._dimensions.height.get()},{orientation:0})),this._startSashPosition=void 0,this._register(this._sash.onDidStart(()=>{this._startSashPosition=this.sashLeft.get()})),this._register(this._sash.onDidChange(e=>{this.sashLeft.set(this._startSashPosition+(e.currentX-e.startX),void 0)})),this._register(this._sash.onDidEnd(()=>this._sash.layout())),this._register(this._sash.onDidReset(()=>this._resetSash())),this._register((0,a.fm)(e=>{const i=this._boundarySashes.read(e);i&&(this._sash.orthogonalEndSash=i.bottom)})),this._register((0,a.fm)(e=>{const i=this._enabled.read(e);this._sash.state=i?3:0,this.sashLeft.read(e),this._dimensions.height.read(e),this._sash.layout()}))}}class ai extends d.jG{constructor(e,i,t){super(),this._editor=e,this._domNode=i,this.itemProvider=t,this.scrollTop=(0,a.y0)(this,this._editor.onDidScrollChange,e=>this._editor.getScrollTop()),this.isScrollTopZero=this.scrollTop.map(e=>0===e),this.modelAttached=(0,a.y0)(this,this._editor.onDidChangeModel,e=>this._editor.hasModel()),this.editorOnDidChangeViewZones=(0,a.yQ)("onDidChangeViewZones",this._editor.onDidChangeViewZones),this.editorOnDidContentSizeChange=(0,a.yQ)("onDidContentSizeChange",this._editor.onDidContentSizeChange),this.domNodeSizeChanged=(0,a.Yd)("domNodeSizeChanged"),this.views=new Map,this._domNode.className="gutter monaco-editor";const o=this._domNode.appendChild((0,n.h)("div.scroll-decoration",{role:"presentation",ariaHidden:"true",style:{width:"100%"}}).root),s=new ResizeObserver(()=>{(0,a.Rn)(e=>{this.domNodeSizeChanged.trigger(e)})});s.observe(this._domNode),this._register((0,d.s)(()=>s.disconnect())),this._register((0,a.fm)(e=>{o.className=this.isScrollTopZero.read(e)?"":"scroll-decoration"})),this._register((0,a.fm)(e=>this.render(e)))}dispose(){super.dispose(),(0,n.Ln)(this._domNode)}render(e){if(!this.modelAttached.read(e))return;this.domNodeSizeChanged.read(e),this.editorOnDidChangeViewZones.read(e),this.editorOnDidContentSizeChange.read(e);const i=this.scrollTop.read(e),t=this._editor.getVisibleRanges(),n=new Set(this.views.keys()),o=M.L.ofStartAndLength(0,this._domNode.clientHeight);if(!o.isEmpty)for(const s of t){const t=new S.M(s.startLineNumber,s.endLineNumber+1),r=this.itemProvider.getIntersectingGutterItems(t,e);(0,a.Rn)(e=>{for(const s of r){if(!s.range.intersect(t))continue;n.delete(s.id);let r=this.views.get(s.id);if(r)r.item.set(s,e);else{const e=document.createElement("div");this._domNode.appendChild(e);const i=(0,a.FY)("item",s),t=this.itemProvider.createView(i,e);r=new hi(i,t,e),this.views.set(s.id,r)}const d=s.range.startLineNumber<=this._editor.getModel().getLineCount()?this._editor.getTopForLineNumber(s.range.startLineNumber,!0)-i:this._editor.getBottomForLineNumber(s.range.startLineNumber-1,!1)-i,h=(1===s.range.endLineNumberExclusive?Math.max(d,this._editor.getTopForLineNumber(s.range.startLineNumber,!1)-i):Math.max(d,this._editor.getBottomForLineNumber(s.range.endLineNumberExclusive-1,!0)-i))-d;r.domNode.style.top=`${d}px`,r.domNode.style.height=`${h}px`,r.gutterItemView.layout(M.L.ofStartAndLength(d,h),o)}})}for(const e of n){const i=this.views.get(e);i.gutterItemView.dispose(),i.domNode.remove(),this.views.delete(e)}}}class hi{constructor(e,i,t){this.item=e,this.gutterItemView=i,this.domNode=t}}var li=t(19592),gi=t(50234),ci=t(22400),fi=t(1393),ui=t(78504),mi=t(49693),pi=t(41133),_i=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r},vi=function(e,i){return function(t,n){i(t,n,e)}};const bi=[];let Li=class extends d.jG{constructor(e,i,t,o,s,r,d,l,g){super(),this._diffModel=i,this._editors=t,this._options=o,this._sashLayout=s,this._boundarySashes=r,this._instantiationService=d,this._contextKeyService=l,this._menuService=g,this._menu=this._register(this._menuService.createMenu(ui.D8.DiffEditorHunkToolbar,this._contextKeyService)),this._actions=(0,a.y0)(this,this._menu.onDidChange,()=>this._menu.getActions()),this._hasActions=this._actions.map(e=>e.length>0),this._showSash=(0,a.un)(this,e=>this._options.renderSideBySide.read(e)&&this._hasActions.read(e)),this.width=(0,a.un)(this,e=>this._hasActions.read(e)?35:0),this.elements=(0,n.h)("div.gutter@gutter",{style:{position:"absolute",height:"100%",width:"35px"}},[]),this._currentDiff=(0,a.un)(this,e=>{const i=this._diffModel.read(e);if(!i)return;const t=i.diff.read(e)?.mappings,n=this._editors.modifiedCursor.read(e);return n?t?.find(e=>e.lineRangeMapping.modified.contains(n.lineNumber)):void 0}),this._selectedDiffs=(0,a.un)(this,e=>{const i=this._diffModel.read(e),t=i?.diff.read(e);if(!t)return bi;const n=this._editors.modifiedSelections.read(e);if(n.every(e=>e.isEmpty()))return bi;const o=new S.S(n.map(e=>S.M.fromRangeInclusive(e))),s=t.mappings.filter(e=>e.lineRangeMapping.innerChanges&&o.intersects(e.lineRangeMapping.modified)).map(e=>({mapping:e,rangeMappings:e.lineRangeMapping.innerChanges.filter(e=>n.some(i=>N.Q.areIntersecting(e.modifiedRange,i)))}));return 0===s.length||s.every(e=>0===e.rangeMappings.length)?bi:s}),this._register((0,w.$y)(e,this.elements.root)),this._register((0,n.ko)(this.elements.root,"click",()=>{this._editors.modified.focus()})),this._register((0,w.AV)(this.elements.root,{display:this._hasActions.map(e=>e?"block":"none")})),(0,h.a0)(this,i=>this._showSash.read(i)?new di(e,this._sashLayout.dimensions,this._options.enableSplitViewResizing,this._boundarySashes,(0,h.dQ)(this,e=>this._sashLayout.sashLeft.read(e)-35,(e,i)=>this._sashLayout.sashLeft.set(e+35,i)),()=>this._sashLayout.resetSash()):void 0).recomputeInitiallyAndOnChange(this._store),this._register(new ai(this._editors.modified,this.elements.root,{getIntersectingGutterItems:(e,i)=>{const t=this._diffModel.read(i);if(!t)return[];const n=t.diff.read(i);if(!n)return[];const o=this._selectedDiffs.read(i);if(o.length>0){const e=E.wm.fromRangeMappings(o.flatMap(e=>e.rangeMappings));return[new Ci(e,!0,ui.D8.DiffEditorSelectionToolbar,void 0,t.model.original.uri,t.model.modified.uri)]}const s=this._currentDiff.read(i);return n.mappings.map(e=>new Ci(e.lineRangeMapping.withInnerChangesFromLineRanges(),e.lineRangeMapping===s?.lineRangeMapping,ui.D8.DiffEditorHunkToolbar,void 0,t.model.original.uri,t.model.modified.uri))},createView:(e,i)=>this._instantiationService.createInstance(wi,e,i,this)})),this._register((0,n.ko)(this.elements.gutter,n.Bx.MOUSE_WHEEL,e=>{this._editors.modified.getOption(104).handleMouseWheel&&this._editors.modified.delegateScrollFromMouseWheelEvent(e)},{passive:!1}))}computeStagedValue(e){const i=e.innerChanges??[],t=new ci.m(this._editors.modifiedModel.get()),n=new ci.m(this._editors.original.getModel()),o=new gi.mF(i.map(e=>e.toTextEdit(t)));return o.apply(n)}layout(e){this.elements.gutter.style.left=e+"px"}};Li=_i([vi(6,A._Y),vi(7,mi.fN),vi(8,ui.ez)],Li);class Ci{constructor(e,i,t,n,o,s){this.mapping=e,this.showAlways=i,this.menuId=t,this.rangeOverride=n,this.originalUri=o,this.modifiedUri=s}get id(){return this.mapping.modified.toString()}get range(){return this.rangeOverride??this.mapping.modified}}let wi=class extends d.jG{constructor(e,i,t,o){super(),this._item=e,this._elements=(0,n.h)("div.gutterItem",{style:{height:"20px",width:"34px"}},[(0,n.h)("div.background@background",{},[]),(0,n.h)("div.buttons@buttons",{},[])]),this._showAlways=this._item.map(this,e=>e.showAlways),this._menuId=this._item.map(this,e=>e.menuId),this._isSmall=(0,a.FY)(this,!1),this._lastItemRange=void 0,this._lastViewRange=void 0;const s=this._register(o.createInstance(pi.fO,"element",!0,{position:{hoverPosition:1}}));this._register((0,w.rX)(i,this._elements.root)),this._register((0,a.fm)(e=>{const i=this._showAlways.read(e);this._elements.root.classList.toggle("noTransition",!0),this._elements.root.classList.toggle("showAlways",i),setTimeout(()=>{this._elements.root.classList.toggle("noTransition",!1)},0)})),this._register((0,a.yC)((e,i)=>{this._elements.buttons.replaceChildren();const n=i.add(o.createInstance(fi.m,this._elements.buttons,this._menuId.read(e),{orientation:1,hoverDelegate:s,toolbarOptions:{primaryGroup:e=>e.startsWith("primary")},overflowBehavior:{maxItems:this._isSmall.read(e)?1:3},hiddenItemStrategy:0,actionRunner:new li.I(()=>{const e=this._item.get(),i=e.mapping;return{mapping:i,originalWithModifiedChanges:t.computeStagedValue(i),originalUri:e.originalUri,modifiedUri:e.modifiedUri}}),menuOptions:{shouldForwardArgs:!0}}));i.add(n.onDidChangeMenuItems(()=>{this._lastItemRange&&this.layout(this._lastItemRange,this._lastViewRange)}))}))}layout(e,i){this._lastItemRange=e,this._lastViewRange=i;let t=this._elements.buttons.clientHeight;this._isSmall.set(1===this._item.get().mapping.original.startLineNumber&&e.length<30,void 0),t=this._elements.buttons.clientHeight;const n=e.length/2-t/2,o=t;let s=e.start+n;const r=M.L.tryCreate(o,i.endExclusive-o-t),d=M.L.tryCreate(e.start+o,e.endExclusive-t-o);d&&r&&d.start<d.endExclusive&&(s=r.clip(s),s=d.clip(s)),this._elements.buttons.style.top=s-e.start+"px"}};wi=_i([vi(3,A._Y)],wi);var Ri,Si=t(819),Mi=t(21643),yi=t(39503),Ni=t(5826);let Ei=class extends d.jG{static{Ri=this}static{this._breadcrumbsSourceFactory=(0,a.FY)(Ri,()=>({dispose(){},getBreadcrumbItems:(e,i)=>[]}))}static setBreadcrumbsSourceFactory(e){this._breadcrumbsSourceFactory.set(e,void 0)}get isUpdatingHiddenAreas(){return this._isUpdatingHiddenAreas}constructor(e,i,t,n){super(),this._editors=e,this._diffModel=i,this._options=t,this._instantiationService=n,this._modifiedOutlineSource=(0,h.a0)(this,e=>{const i=this._editors.modifiedModel.read(e),t=Ri._breadcrumbsSourceFactory.read(e);return i&&t?t(i,this._instantiationService):void 0}),this._isUpdatingHiddenAreas=!1,this._register(this._editors.original.onDidChangeCursorPosition(e=>{if(1===e.reason)return;const i=this._diffModel.get();(0,a.Rn)(e=>{for(const t of this._editors.original.getSelections()||[])i?.ensureOriginalLineIsVisible(t.getStartPosition().lineNumber,0,e),i?.ensureOriginalLineIsVisible(t.getEndPosition().lineNumber,0,e)})})),this._register(this._editors.modified.onDidChangeCursorPosition(e=>{if(1===e.reason)return;const i=this._diffModel.get();(0,a.Rn)(e=>{for(const t of this._editors.modified.getSelections()||[])i?.ensureModifiedLineIsVisible(t.getStartPosition().lineNumber,0,e),i?.ensureModifiedLineIsVisible(t.getEndPosition().lineNumber,0,e)})}));const o=this._diffModel.map((e,i)=>{const t=e?.unchangedRegions.read(i)??[];return 1===t.length&&1===t[0].modifiedLineNumber&&t[0].lineCount===this._editors.modifiedModel.read(i)?.getLineCount()?[]:t});this.viewZones=(0,a.rm)(this,(e,i)=>{const t=this._modifiedOutlineSource.read(e);if(!t)return{origViewZones:[],modViewZones:[]};const n=[],s=[],r=this._options.renderSideBySide.read(e),d=this._options.compactMode.read(e),h=o.read(e);for(let o=0;o<h.length;o++){const l=h[o];if(!l.shouldHideControls(e)&&(!d||0!==o&&o!==h.length-1))if(d){{const e=(0,a.un)(this,e=>l.getHiddenOriginalRange(e).startLineNumber-1),t=new w.D1(e,12);n.push(t),i.add(new Ii(this._editors.original,t,l,!r))}{const e=(0,a.un)(this,e=>l.getHiddenModifiedRange(e).startLineNumber-1),t=new w.D1(e,12);s.push(t),i.add(new Ii(this._editors.modified,t,l))}}else{{const e=(0,a.un)(this,e=>l.getHiddenOriginalRange(e).startLineNumber-1),o=new w.D1(e,24);n.push(o),i.add(new Di(this._editors.original,o,l,l.originalUnchangedRange,!r,t,e=>this._diffModel.get().ensureModifiedLineIsVisible(e,2,void 0),this._options))}{const e=(0,a.un)(this,e=>l.getHiddenModifiedRange(e).startLineNumber-1),n=new w.D1(e,24);s.push(n),i.add(new Di(this._editors.modified,n,l,l.modifiedUnchangedRange,!1,t,e=>this._diffModel.get().ensureModifiedLineIsVisible(e,2,void 0),this._options))}}}return{origViewZones:n,modViewZones:s}});const s={description:"unchanged lines",className:"diff-unchanged-lines",isWholeLine:!0},r={description:"Fold Unchanged",glyphMarginHoverMessage:new Mi.Bc(void 0,{isTrusted:!0,supportThemeIcons:!0}).appendMarkdown((0,O.kg)("foldUnchanged","Fold Unchanged Region")),glyphMarginClassName:"fold-unchanged "+L.L.asClassName(b.W.fold),zIndex:10001};this._register((0,w.pY)(this._editors.original,(0,a.un)(this,e=>{const i=o.read(e),t=i.map(e=>({range:e.originalUnchangedRange.toInclusiveRange(),options:s}));for(const n of i)n.shouldHideControls(e)&&t.push({range:N.Q.fromPositions(new y.y(n.originalLineNumber,1)),options:r});return t}))),this._register((0,w.pY)(this._editors.modified,(0,a.un)(this,e=>{const i=o.read(e),t=i.map(e=>({range:e.modifiedUnchangedRange.toInclusiveRange(),options:s}));for(const n of i)n.shouldHideControls(e)&&t.push({range:S.M.ofLength(n.modifiedLineNumber,1).toInclusiveRange(),options:r});return t}))),this._register((0,a.fm)(e=>{const i=o.read(e);this._isUpdatingHiddenAreas=!0;try{this._editors.original.setHiddenAreas(i.map(i=>i.getHiddenOriginalRange(e).toInclusiveRange()).filter(ee.O9)),this._editors.modified.setHiddenAreas(i.map(i=>i.getHiddenModifiedRange(e).toInclusiveRange()).filter(ee.O9))}finally{this._isUpdatingHiddenAreas=!1}})),this._register(this._editors.modified.onMouseUp(e=>{if(!e.event.rightButton&&e.target.position&&e.target.element?.className.includes("fold-unchanged")){const i=e.target.position.lineNumber,t=this._diffModel.get();if(!t)return;const n=t.unchangedRegions.get().find(e=>e.modifiedUnchangedRange.includes(i));if(!n)return;n.collapseAll(void 0),e.event.stopPropagation(),e.event.preventDefault()}})),this._register(this._editors.original.onMouseUp(e=>{if(!e.event.rightButton&&e.target.position&&e.target.element?.className.includes("fold-unchanged")){const i=e.target.position.lineNumber,t=this._diffModel.get();if(!t)return;const n=t.unchangedRegions.get().find(e=>e.originalUnchangedRange.includes(i));if(!n)return;n.collapseAll(void 0),e.event.stopPropagation(),e.event.preventDefault()}}))}};Ei=Ri=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r}([function(e,i){return function(t,n){i(t,n,e)}}(3,A._Y)],Ei);class Ii extends w.uN{constructor(e,i,t,o=!1){const s=(0,n.h)("div.diff-hidden-lines-widget");super(e,i,s.root),this._unchangedRegion=t,this._hide=o,this._nodes=(0,n.h)("div.diff-hidden-lines-compact",[(0,n.h)("div.line-left",[]),(0,n.h)("div.text@text",[]),(0,n.h)("div.line-right",[])]),s.root.appendChild(this._nodes.root),this._hide&&this._nodes.root.replaceChildren(),this._register((0,a.fm)(e=>{if(!this._hide){const i=this._unchangedRegion.getHiddenModifiedRange(e).length,t=(0,O.kg)("hiddenLines","{0} hidden lines",i);this._nodes.text.innerText=t}}))}}class Di extends w.uN{constructor(e,i,t,o,s,r,d,h){const l=(0,n.h)("div.diff-hidden-lines-widget");super(e,i,l.root),this._editor=e,this._unchangedRegion=t,this._unchangedRegionRange=o,this._hide=s,this._modifiedOutlineSource=r,this._revealModifiedHiddenLine=d,this._options=h,this._nodes=(0,n.h)("div.diff-hidden-lines",[(0,n.h)("div.top@top",{title:(0,O.kg)("diff.hiddenLines.top","Click or drag to show more above")}),(0,n.h)("div.center@content",{style:{display:"flex"}},[(0,n.h)("div@first",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexShrink:"0"}},[(0,n.$)("a",{title:(0,O.kg)("showUnchangedRegion","Show Unchanged Region"),role:"button",onclick:()=>{this._unchangedRegion.showAll(void 0)}},...(0,Si.n)("$(unfold)"))]),(0,n.h)("div@others",{style:{display:"flex",justifyContent:"center",alignItems:"center"}})]),(0,n.h)("div.bottom@bottom",{title:(0,O.kg)("diff.bottom","Click or drag to show more below"),role:"button"})]),l.root.appendChild(this._nodes.root),this._hide?(0,n.Ln)(this._nodes.first):this._register((0,w.AV)(this._nodes.first,{width:(0,yi.Ud)(this._editor).layoutInfoContentLeft})),this._register((0,a.fm)(e=>{const i=this._unchangedRegion.visibleLineCountTop.read(e)+this._unchangedRegion.visibleLineCountBottom.read(e)===this._unchangedRegion.lineCount;this._nodes.bottom.classList.toggle("canMoveTop",!i),this._nodes.bottom.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(e)>0),this._nodes.top.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(e)>0),this._nodes.top.classList.toggle("canMoveBottom",!i);const t=this._unchangedRegion.isDragged.read(e),n=this._editor.getDomNode();n&&(n.classList.toggle("draggingUnchangedRegion",!!t),"top"===t?(n.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(e)>0),n.classList.toggle("canMoveBottom",!i)):"bottom"===t?(n.classList.toggle("canMoveTop",!i),n.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(e)>0)):(n.classList.toggle("canMoveTop",!1),n.classList.toggle("canMoveBottom",!1)))}));const g=this._editor;this._register((0,n.ko)(this._nodes.top,"mousedown",e=>{if(0!==e.button)return;this._nodes.top.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),e.preventDefault();const i=e.clientY;let t=!1;const o=this._unchangedRegion.visibleLineCountTop.get();this._unchangedRegion.isDragged.set("top",void 0);const s=(0,n.zk)(this._nodes.top),r=(0,n.ko)(s,"mousemove",e=>{const n=e.clientY-i;t=t||Math.abs(n)>2;const s=Math.round(n/g.getOption(67)),r=Math.max(0,Math.min(o+s,this._unchangedRegion.getMaxVisibleLineCountTop()));this._unchangedRegion.visibleLineCountTop.set(r,void 0)}),d=(0,n.ko)(s,"mouseup",e=>{t||this._unchangedRegion.showMoreAbove(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0),this._nodes.top.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),this._unchangedRegion.isDragged.set(void 0,void 0),r.dispose(),d.dispose()})})),this._register((0,n.ko)(this._nodes.bottom,"mousedown",e=>{if(0!==e.button)return;this._nodes.bottom.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),e.preventDefault();const i=e.clientY;let t=!1;const o=this._unchangedRegion.visibleLineCountBottom.get();this._unchangedRegion.isDragged.set("bottom",void 0);const s=(0,n.zk)(this._nodes.bottom),r=(0,n.ko)(s,"mousemove",e=>{const n=e.clientY-i;t=t||Math.abs(n)>2;const s=Math.round(n/g.getOption(67)),r=Math.max(0,Math.min(o-s,this._unchangedRegion.getMaxVisibleLineCountBottom())),d=this._unchangedRegionRange.endLineNumberExclusive>g.getModel().getLineCount()?g.getContentHeight():g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.visibleLineCountBottom.set(r,void 0);const a=this._unchangedRegionRange.endLineNumberExclusive>g.getModel().getLineCount()?g.getContentHeight():g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);g.setScrollTop(g.getScrollTop()+(a-d))}),d=(0,n.ko)(s,"mouseup",e=>{if(this._unchangedRegion.isDragged.set(void 0,void 0),!t){const e=g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.showMoreBelow(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0);const i=g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);g.setScrollTop(g.getScrollTop()+(i-e))}this._nodes.bottom.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),r.dispose(),d.dispose()})})),this._register((0,a.fm)(e=>{const i=[];if(!this._hide){const o=t.getHiddenModifiedRange(e).length,s=(0,O.kg)("hiddenLines","{0} hidden lines",o),r=(0,n.$)("span",{title:(0,O.kg)("diff.hiddenLines.expandAll","Double click to unfold")},s);r.addEventListener("dblclick",e=>{0===e.button&&(e.preventDefault(),this._unchangedRegion.showAll(void 0))}),i.push(r);const d=this._unchangedRegion.getHiddenModifiedRange(e),a=this._modifiedOutlineSource.getBreadcrumbItems(d,e);if(a.length>0){i.push((0,n.$)("span",void 0,"  |  "));for(let e=0;e<a.length;e++){const t=a[e],o=Ni.gP.toIcon(t.kind),s=(0,n.h)("div.breadcrumb-item",{style:{display:"flex",alignItems:"center"}},[(0,Si.s)(o)," ",t.name,...e===a.length-1?[]:[(0,Si.s)(b.W.chevronRight)]]).root;i.push(s),s.onclick=()=>{this._revealModifiedHiddenLine(t.startLineNumber)}}}}(0,n.Ln)(this._nodes.others,...i)}))}}var xi,Ti=t(43618),Oi=t(91371),Vi=t(46848),Ai=t(19729);let Pi=class extends d.jG{static{xi=this}static{this.ONE_OVERVIEW_WIDTH=15}static{this.ENTIRE_DIFF_OVERVIEW_WIDTH=2*this.ONE_OVERVIEW_WIDTH}constructor(e,i,t,o,s,r,d){super(),this._editors=e,this._rootElement=i,this._diffModel=t,this._rootWidth=o,this._rootHeight=s,this._modifiedEditorLayoutInfo=r,this._themeService=d,this.width=xi.ENTIRE_DIFF_OVERVIEW_WIDTH;const h=(0,a.y0)(this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme()),l=(0,a.un)(e=>{const i=h.read(e);return{insertColor:i.getColor(te.ld8)||(i.getColor(te.Gj6)||te.EY1).transparent(2),removeColor:i.getColor(te.$BZ)||(i.getColor(te.GNm)||te.ZEf).transparent(2)}}),g=(0,Ti.Z)(document.createElement("div"));g.setClassName("diffViewport"),g.setPosition("absolute");const c=(0,n.h)("div.diffOverview",{style:{position:"absolute",top:"0px",width:xi.ENTIRE_DIFF_OVERVIEW_WIDTH+"px"}}).root;this._register((0,w.rX)(c,g.domNode)),this._register((0,n.b2)(c,n.Bx.POINTER_DOWN,e=>{this._editors.modified.delegateVerticalScrollbarPointerDown(e)})),this._register((0,n.ko)(c,n.Bx.MOUSE_WHEEL,e=>{this._editors.modified.delegateScrollFromMouseWheelEvent(e)},{passive:!1})),this._register((0,w.rX)(this._rootElement,c)),this._register((0,a.yC)((e,i)=>{const t=this._diffModel.read(e),n=this._editors.original.createOverviewRuler("original diffOverviewRuler");n&&(i.add(n),i.add((0,w.rX)(c,n.getDomNode())));const o=this._editors.modified.createOverviewRuler("modified diffOverviewRuler");if(o&&(i.add(o),i.add((0,w.rX)(c,o.getDomNode()))),!n||!o)return;const s=(0,a.yQ)("viewZoneChanged",this._editors.original.onDidChangeViewZones),r=(0,a.yQ)("viewZoneChanged",this._editors.modified.onDidChangeViewZones),d=(0,a.yQ)("hiddenRangesChanged",this._editors.original.onDidChangeHiddenAreas),h=(0,a.yQ)("hiddenRangesChanged",this._editors.modified.onDidChangeHiddenAreas);i.add((0,a.fm)(e=>{s.read(e),r.read(e),d.read(e),h.read(e);const i=l.read(e),a=t?.diff.read(e)?.mappings;function g(e,i,t){const n=t._getViewModel();return n?e.filter(e=>e.length>0).map(e=>{const t=n.coordinatesConverter.convertModelPositionToViewPosition(new y.y(e.startLineNumber,1)),o=n.coordinatesConverter.convertModelPositionToViewPosition(new y.y(e.endLineNumberExclusive,1)),s=o.lineNumber-t.lineNumber;return new Vi.iE(t.lineNumber,o.lineNumber,s,i.toString())}):[]}const c=g((a||[]).map(e=>e.lineRangeMapping.original),i.removeColor,this._editors.original),f=g((a||[]).map(e=>e.lineRangeMapping.modified),i.insertColor,this._editors.modified);n?.setZones(c),o?.setZones(f)})),i.add((0,a.fm)(e=>{const i=this._rootHeight.read(e),t=this._rootWidth.read(e),s=this._modifiedEditorLayoutInfo.read(e);if(s){const t=xi.ENTIRE_DIFF_OVERVIEW_WIDTH-2*xi.ONE_OVERVIEW_WIDTH;n.setLayout({top:0,height:i,right:t+xi.ONE_OVERVIEW_WIDTH,width:xi.ONE_OVERVIEW_WIDTH}),o.setLayout({top:0,height:i,right:0,width:xi.ONE_OVERVIEW_WIDTH});const r=this._editors.modifiedScrollTop.read(e),d=this._editors.modifiedScrollHeight.read(e),a=this._editors.modified.getOption(104),h=new Oi.m(a.verticalHasArrows?a.arrowSize:0,a.verticalScrollbarSize,0,s.height,d,r);g.setTop(h.getSliderPosition()),g.setHeight(h.getSliderSize())}else g.setTop(0),g.setHeight(0);c.style.height=i+"px",c.style.left=t-xi.ENTIRE_DIFF_OVERVIEW_WIDTH+"px",g.setWidth(xi.ENTIRE_DIFF_OVERVIEW_WIDTH)}))}))}};Pi=xi=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r}([function(e,i){return function(t,n){i(t,n,e)}}(6,Ai.Gy)],Pi);var Wi=t(92692);const ki=[];class Hi extends d.jG{constructor(e,i,t,n){super(),this._editors=e,this._diffModel=i,this._options=t,this._widget=n,this._selectedDiffs=(0,a.un)(this,e=>{const i=this._diffModel.read(e),t=i?.diff.read(e);if(!t)return ki;const n=this._editors.modifiedSelections.read(e);if(n.every(e=>e.isEmpty()))return ki;const o=new S.S(n.map(e=>S.M.fromRangeInclusive(e))),s=t.mappings.filter(e=>e.lineRangeMapping.innerChanges&&o.intersects(e.lineRangeMapping.modified)).map(e=>({mapping:e,rangeMappings:e.lineRangeMapping.innerChanges.filter(e=>n.some(i=>N.Q.areIntersecting(e.modifiedRange,i)))}));return 0===s.length||s.every(e=>0===e.rangeMappings.length)?ki:s}),this._register((0,a.yC)((e,i)=>{if(!this._options.shouldRenderOldRevertArrows.read(e))return;const t=this._diffModel.read(e),n=t?.diff.read(e);if(!t||!n)return;if(t.movedTextToCompare.read(e))return;const o=[],s=this._selectedDiffs.read(e),r=new Set(s.map(e=>e.mapping));if(s.length>0){const t=this._editors.modifiedSelections.read(e),n=i.add(new Bi(t[t.length-1].positionLineNumber,this._widget,s.flatMap(e=>e.rangeMappings),!0));this._editors.modified.addGlyphMarginWidget(n),o.push(n)}for(const e of n.mappings)if(!r.has(e)&&!e.lineRangeMapping.modified.isEmpty&&e.lineRangeMapping.innerChanges){const t=i.add(new Bi(e.lineRangeMapping.modified.startLineNumber,this._widget,e.lineRangeMapping,!1));this._editors.modified.addGlyphMarginWidget(t),o.push(t)}i.add((0,d.s)(()=>{for(const e of o)this._editors.modified.removeGlyphMarginWidget(e)}))}))}}class Bi extends d.jG{static{this.counter=0}getId(){return this._id}constructor(e,i,t,o){super(),this._lineNumber=e,this._widget=i,this._diffs=t,this._revertSelection=o,this._id="revertButton"+Bi.counter++,this._domNode=(0,n.h)("div.revertButton",{title:this._revertSelection?(0,O.kg)("revertSelectedChanges","Revert Selected Changes"):(0,O.kg)("revertChange","Revert Change")},[(0,Si.s)(b.W.arrowRight)]).root,this._register((0,n.ko)(this._domNode,n.Bx.MOUSE_DOWN,e=>{2!==e.button&&(e.stopPropagation(),e.preventDefault())})),this._register((0,n.ko)(this._domNode,n.Bx.MOUSE_UP,e=>{e.stopPropagation(),e.preventDefault()})),this._register((0,n.ko)(this._domNode,n.Bx.CLICK,e=>{this._diffs instanceof E.WL?this._widget.revert(this._diffs):this._widget.revertRangeMappings(this._diffs),e.stopPropagation(),e.preventDefault()}))}getDomNode(){return this._domNode}getPosition(){return{lane:Wi.ZS.Right,range:{startColumn:1,startLineNumber:this._lineNumber,endColumn:1,endLineNumber:this._lineNumber},zIndex:10001}}}var Fi=t(52842),zi=t(67157),Ui=t(85409),ji=t(10026),Zi=t(29764),Gi=t(34252),Yi=function(e,i){return function(t,n){i(t,n,e)}};let qi=class extends d.jG{get onDidContentSizeChange(){return this._onDidContentSizeChange.event}constructor(e,i,t,n,o,s,d){super(),this.originalEditorElement=e,this.modifiedEditorElement=i,this._options=t,this._argCodeEditorWidgetOptions=n,this._createInnerEditor=o,this._instantiationService=s,this._keybindingService=d,this.original=this._register(this._createLeftHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.originalEditor||{})),this.modified=this._register(this._createRightHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.modifiedEditor||{})),this._onDidContentSizeChange=this._register(new r.vl),this.modifiedScrollTop=(0,a.y0)(this,this.modified.onDidScrollChange,()=>this.modified.getScrollTop()),this.modifiedScrollHeight=(0,a.y0)(this,this.modified.onDidScrollChange,()=>this.modified.getScrollHeight()),this.modifiedObs=(0,yi.Ud)(this.modified),this.originalObs=(0,yi.Ud)(this.original),this.modifiedModel=this.modifiedObs.model,this.modifiedSelections=(0,a.y0)(this,this.modified.onDidChangeCursorSelection,()=>this.modified.getSelections()??[]),this.modifiedCursor=(0,a.C)({owner:this,equalsFn:y.y.equals},e=>this.modifiedSelections.read(e)[0]?.getPosition()??new y.y(1,1)),this.originalCursor=(0,a.y0)(this,this.original.onDidChangeCursorPosition,()=>this.original.getPosition()??new y.y(1,1)),this._argCodeEditorWidgetOptions=null,this._register((0,a.Y)({createEmptyChangeSummary:()=>({}),handleChange:(e,i)=>(e.didChange(t.editorOptions)&&Object.assign(i,e.change.changedOptions),!0)},(e,i)=>{t.editorOptions.read(e),this._options.renderSideBySide.read(e),this.modified.updateOptions(this._adjustOptionsForRightHandSide(e,i)),this.original.updateOptions(this._adjustOptionsForLeftHandSide(e,i))}))}_createLeftHandSideEditor(e,i){const t=this._adjustOptionsForLeftHandSide(void 0,e),n=this._constructInnerEditor(this._instantiationService,this.originalEditorElement,t,i);return n.setContextValue("isInDiffLeftEditor",!0),n}_createRightHandSideEditor(e,i){const t=this._adjustOptionsForRightHandSide(void 0,e),n=this._constructInnerEditor(this._instantiationService,this.modifiedEditorElement,t,i);return n.setContextValue("isInDiffRightEditor",!0),n}_constructInnerEditor(e,i,t,n){const o=this._createInnerEditor(e,i,t,n);return this._register(o.onDidContentSizeChange(e=>{const i=this.original.getContentWidth()+this.modified.getContentWidth()+Pi.ENTIRE_DIFF_OVERVIEW_WIDTH,t=Math.max(this.modified.getContentHeight(),this.original.getContentHeight());this._onDidContentSizeChange.fire({contentHeight:t,contentWidth:i,contentHeightChanged:e.contentHeightChanged,contentWidthChanged:e.contentWidthChanged})})),o}_adjustOptionsForLeftHandSide(e,i){const t=this._adjustOptionsForSubEditor(i);return this._options.renderSideBySide.get()?(t.unicodeHighlight=this._options.editorOptions.get().unicodeHighlight||{},t.wordWrapOverride1=this._options.diffWordWrap.get()):(t.wordWrapOverride1="off",t.wordWrapOverride2="off",t.stickyScroll={enabled:!1},t.unicodeHighlight={nonBasicASCII:!1,ambiguousCharacters:!1,invisibleCharacters:!1}),t.glyphMargin=this._options.renderSideBySide.get(),i.originalAriaLabel&&(t.ariaLabel=i.originalAriaLabel),t.ariaLabel=this._updateAriaLabel(t.ariaLabel),t.readOnly=!this._options.originalEditable.get(),t.dropIntoEditor={enabled:!t.readOnly},t.extraEditorClassName="original-in-monaco-diff-editor",t}_adjustOptionsForRightHandSide(e,i){const t=this._adjustOptionsForSubEditor(i);return i.modifiedAriaLabel&&(t.ariaLabel=i.modifiedAriaLabel),t.ariaLabel=this._updateAriaLabel(t.ariaLabel),t.wordWrapOverride1=this._options.diffWordWrap.get(),t.revealHorizontalRightPadding=R.qB.revealHorizontalRightPadding.defaultValue+Pi.ENTIRE_DIFF_OVERVIEW_WIDTH,t.scrollbar.verticalHasArrows=!1,t.extraEditorClassName="modified-in-monaco-diff-editor",t}_adjustOptionsForSubEditor(e){const i={...e,dimension:{height:0,width:0}};return i.inDiffEditor=!0,i.automaticLayout=!1,i.scrollbar={...i.scrollbar||{}},i.folding=!1,i.codeLens=this._options.diffCodeLens.get(),i.fixedOverflowWidgets=!0,i.minimap={...i.minimap||{}},i.minimap.enabled=!1,this._options.hideUnchangedRegions.get()?i.stickyScroll={enabled:!1}:i.stickyScroll=this._options.editorOptions.get().stickyScroll,i}_updateAriaLabel(e){e||(e="");const i=(0,O.kg)("diff-aria-navigation-tip"," use {0} to open the accessibility help.",this._keybindingService.lookupKeybinding("editor.action.accessibilityHelp")?.getAriaLabel());return this._options.accessibilityVerbose.get()?e+i:e?e.replaceAll(i,""):""}};qi=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r}([Yi(5,A._Y),Yi(6,Gi.b)],qi);class $i extends d.jG{constructor(){super(...arguments),this._id=++$i.idCounter,this._onDidDispose=this._register(new r.vl),this.onDidDispose=this._onDidDispose.event}static{this.idCounter=0}getId(){return this.getEditorType()+":v2:"+this._id}getVisibleColumnFromPosition(e){return this._targetEditor.getVisibleColumnFromPosition(e)}getPosition(){return this._targetEditor.getPosition()}setPosition(e,i="api"){this._targetEditor.setPosition(e,i)}revealLine(e,i=0){this._targetEditor.revealLine(e,i)}revealLineInCenter(e,i=0){this._targetEditor.revealLineInCenter(e,i)}revealLineInCenterIfOutsideViewport(e,i=0){this._targetEditor.revealLineInCenterIfOutsideViewport(e,i)}revealLineNearTop(e,i=0){this._targetEditor.revealLineNearTop(e,i)}revealPosition(e,i=0){this._targetEditor.revealPosition(e,i)}revealPositionInCenter(e,i=0){this._targetEditor.revealPositionInCenter(e,i)}revealPositionInCenterIfOutsideViewport(e,i=0){this._targetEditor.revealPositionInCenterIfOutsideViewport(e,i)}revealPositionNearTop(e,i=0){this._targetEditor.revealPositionNearTop(e,i)}getSelection(){return this._targetEditor.getSelection()}getSelections(){return this._targetEditor.getSelections()}setSelection(e,i="api"){this._targetEditor.setSelection(e,i)}setSelections(e,i="api"){this._targetEditor.setSelections(e,i)}revealLines(e,i,t=0){this._targetEditor.revealLines(e,i,t)}revealLinesInCenter(e,i,t=0){this._targetEditor.revealLinesInCenter(e,i,t)}revealLinesInCenterIfOutsideViewport(e,i,t=0){this._targetEditor.revealLinesInCenterIfOutsideViewport(e,i,t)}revealLinesNearTop(e,i,t=0){this._targetEditor.revealLinesNearTop(e,i,t)}revealRange(e,i=0,t=!1,n=!0){this._targetEditor.revealRange(e,i,t,n)}revealRangeInCenter(e,i=0){this._targetEditor.revealRangeInCenter(e,i)}revealRangeInCenterIfOutsideViewport(e,i=0){this._targetEditor.revealRangeInCenterIfOutsideViewport(e,i)}revealRangeNearTop(e,i=0){this._targetEditor.revealRangeNearTop(e,i)}revealRangeNearTopIfOutsideViewport(e,i=0){this._targetEditor.revealRangeNearTopIfOutsideViewport(e,i)}revealRangeAtTop(e,i=0){this._targetEditor.revealRangeAtTop(e,i)}getSupportedActions(){return this._targetEditor.getSupportedActions()}focus(){this._targetEditor.focus()}trigger(e,i,t){this._targetEditor.trigger(e,i,t)}createDecorationsCollection(e){return this._targetEditor.createDecorationsCollection(e)}changeDecorations(e){return this._targetEditor.changeDecorations(e)}}var Qi=t(4923),Ki=t(47284),Xi=t(82962);let Ji=class{get editorOptions(){return this._options}constructor(e,i){this._accessibilityService=i,this._diffEditorWidth=(0,a.FY)(this,0),this._screenReaderMode=(0,a.y0)(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this.couldShowInlineViewBecauseOfSize=(0,a.un)(this,e=>this._options.read(e).renderSideBySide&&this._diffEditorWidth.read(e)<=this._options.read(e).renderSideBySideInlineBreakpoint),this.renderOverviewRuler=(0,a.un)(this,e=>this._options.read(e).renderOverviewRuler),this.renderSideBySide=(0,a.un)(this,e=>(!this.compactMode.read(e)||!this.shouldRenderInlineViewInSmartMode.read(e))&&this._options.read(e).renderSideBySide&&!(this._options.read(e).useInlineViewWhenSpaceIsLimited&&this.couldShowInlineViewBecauseOfSize.read(e)&&!this._screenReaderMode.read(e))),this.readOnly=(0,a.un)(this,e=>this._options.read(e).readOnly),this.shouldRenderOldRevertArrows=(0,a.un)(this,e=>!(!this._options.read(e).renderMarginRevertIcon||!this.renderSideBySide.read(e)||this.readOnly.read(e)||this.shouldRenderGutterMenu.read(e))),this.shouldRenderGutterMenu=(0,a.un)(this,e=>this._options.read(e).renderGutterMenu),this.renderIndicators=(0,a.un)(this,e=>this._options.read(e).renderIndicators),this.enableSplitViewResizing=(0,a.un)(this,e=>this._options.read(e).enableSplitViewResizing),this.splitViewDefaultRatio=(0,a.un)(this,e=>this._options.read(e).splitViewDefaultRatio),this.ignoreTrimWhitespace=(0,a.un)(this,e=>this._options.read(e).ignoreTrimWhitespace),this.maxComputationTimeMs=(0,a.un)(this,e=>this._options.read(e).maxComputationTime),this.showMoves=(0,a.un)(this,e=>this._options.read(e).experimental.showMoves&&this.renderSideBySide.read(e)),this.isInEmbeddedEditor=(0,a.un)(this,e=>this._options.read(e).isInEmbeddedEditor),this.diffWordWrap=(0,a.un)(this,e=>this._options.read(e).diffWordWrap),this.originalEditable=(0,a.un)(this,e=>this._options.read(e).originalEditable),this.diffCodeLens=(0,a.un)(this,e=>this._options.read(e).diffCodeLens),this.accessibilityVerbose=(0,a.un)(this,e=>this._options.read(e).accessibilityVerbose),this.diffAlgorithm=(0,a.un)(this,e=>this._options.read(e).diffAlgorithm),this.showEmptyDecorations=(0,a.un)(this,e=>this._options.read(e).experimental.showEmptyDecorations),this.onlyShowAccessibleDiffViewer=(0,a.un)(this,e=>this._options.read(e).onlyShowAccessibleDiffViewer),this.compactMode=(0,a.un)(this,e=>this._options.read(e).compactMode),this.trueInlineDiffRenderingEnabled=(0,a.un)(this,e=>this._options.read(e).experimental.useTrueInlineView),this.useTrueInlineDiffRendering=(0,a.un)(this,e=>!this.renderSideBySide.read(e)&&this.trueInlineDiffRenderingEnabled.read(e)),this.hideUnchangedRegions=(0,a.un)(this,e=>this._options.read(e).hideUnchangedRegions.enabled),this.hideUnchangedRegionsRevealLineCount=(0,a.un)(this,e=>this._options.read(e).hideUnchangedRegions.revealLineCount),this.hideUnchangedRegionsContextLineCount=(0,a.un)(this,e=>this._options.read(e).hideUnchangedRegions.contextLineCount),this.hideUnchangedRegionsMinimumLineCount=(0,a.un)(this,e=>this._options.read(e).hideUnchangedRegions.minimumLineCount),this._model=(0,a.FY)(this,void 0),this.shouldRenderInlineViewInSmartMode=this._model.map(this,e=>(0,Qi.t)(this,i=>{const t=e?.diff.read(i);return t?(n=t,o=this.trueInlineDiffRenderingEnabled.read(i),n.mappings.every(e=>0===e.lineRangeMapping.original.length||0===e.lineRangeMapping.modified.length||o&&Je(e.lineRangeMapping))):void 0;var n,o})).flatten().map(this,e=>!!e),this.inlineViewHideOriginalLineNumbers=this.compactMode;const t={...e,...et(e,Ki.q)};this._options=(0,a.FY)(this,t)}updateOptions(e){const i=et(e,this._options.get()),t={...this._options.get(),...e,...i};this._options.set(t,void 0,{changedOptions:e})}setWidth(e){this._diffEditorWidth.set(e,void 0)}setModel(e){this._model.set(e,void 0)}};function et(e,i){return{enableSplitViewResizing:(0,R.zM)(e.enableSplitViewResizing,i.enableSplitViewResizing),splitViewDefaultRatio:(0,R.ls)(e.splitViewDefaultRatio,.5,.1,.9),renderSideBySide:(0,R.zM)(e.renderSideBySide,i.renderSideBySide),renderMarginRevertIcon:(0,R.zM)(e.renderMarginRevertIcon,i.renderMarginRevertIcon),maxComputationTime:(0,R.wA)(e.maxComputationTime,i.maxComputationTime,0,1073741824),maxFileSize:(0,R.wA)(e.maxFileSize,i.maxFileSize,0,1073741824),ignoreTrimWhitespace:(0,R.zM)(e.ignoreTrimWhitespace,i.ignoreTrimWhitespace),renderIndicators:(0,R.zM)(e.renderIndicators,i.renderIndicators),originalEditable:(0,R.zM)(e.originalEditable,i.originalEditable),diffCodeLens:(0,R.zM)(e.diffCodeLens,i.diffCodeLens),renderOverviewRuler:(0,R.zM)(e.renderOverviewRuler,i.renderOverviewRuler),diffWordWrap:(0,R.O4)(e.diffWordWrap,i.diffWordWrap,["off","on","inherit"]),diffAlgorithm:(0,R.O4)(e.diffAlgorithm,i.diffAlgorithm,["legacy","advanced"],{smart:"legacy",experimental:"advanced"}),accessibilityVerbose:(0,R.zM)(e.accessibilityVerbose,i.accessibilityVerbose),experimental:{showMoves:(0,R.zM)(e.experimental?.showMoves,i.experimental.showMoves),showEmptyDecorations:(0,R.zM)(e.experimental?.showEmptyDecorations,i.experimental.showEmptyDecorations),useTrueInlineView:(0,R.zM)(e.experimental?.useTrueInlineView,i.experimental.useTrueInlineView)},hideUnchangedRegions:{enabled:(0,R.zM)(e.hideUnchangedRegions?.enabled??e.experimental?.collapseUnchangedRegions,i.hideUnchangedRegions.enabled),contextLineCount:(0,R.wA)(e.hideUnchangedRegions?.contextLineCount,i.hideUnchangedRegions.contextLineCount,0,1073741824),minimumLineCount:(0,R.wA)(e.hideUnchangedRegions?.minimumLineCount,i.hideUnchangedRegions.minimumLineCount,0,1073741824),revealLineCount:(0,R.wA)(e.hideUnchangedRegions?.revealLineCount,i.hideUnchangedRegions.revealLineCount,0,1073741824)},isInEmbeddedEditor:(0,R.zM)(e.isInEmbeddedEditor,i.isInEmbeddedEditor),onlyShowAccessibleDiffViewer:(0,R.zM)(e.onlyShowAccessibleDiffViewer,i.onlyShowAccessibleDiffViewer),renderSideBySideInlineBreakpoint:(0,R.wA)(e.renderSideBySideInlineBreakpoint,i.renderSideBySideInlineBreakpoint,0,1073741824),useInlineViewWhenSpaceIsLimited:(0,R.zM)(e.useInlineViewWhenSpaceIsLimited,i.useInlineViewWhenSpaceIsLimited),renderGutterMenu:(0,R.zM)(e.renderGutterMenu,i.renderGutterMenu),compactMode:(0,R.zM)(e.compactMode,i.compactMode)}}Ji=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r}([function(e,i){return function(t,n){i(t,n,e)}}(1,Xi.j)],Ji);var it=function(e,i){return function(t,n){i(t,n,e)}};let tt=class extends $i{get onDidContentSizeChange(){return this._editors.onDidContentSizeChange}constructor(e,i,t,o,l,g,f,u){super(),this._domElement=e,this._parentContextKeyService=o,this._parentInstantiationService=l,this._accessibilitySignalService=f,this._editorProgressService=u,this.elements=(0,n.h)("div.monaco-diff-editor.side-by-side",{style:{position:"relative",height:"100%"}},[(0,n.h)("div.editor.original@original",{style:{position:"absolute",height:"100%"}}),(0,n.h)("div.editor.modified@modified",{style:{position:"absolute",height:"100%"}}),(0,n.h)("div.accessibleDiffViewer@accessibleDiffViewer",{style:{position:"absolute",height:"100%"}})]),this._diffModelSrc=this._register((0,a.X2)(this,void 0)),this._diffModel=(0,a.un)(this,e=>this._diffModelSrc.read(e)?.object),this.onDidChangeModel=r.Jh.fromObservableLight(this._diffModel),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._domElement)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new ji.a([mi.fN,this._contextKeyService]))),this._boundarySashes=(0,a.FY)(this,void 0),this._accessibleDiffViewerShouldBeVisible=(0,a.FY)(this,!1),this._accessibleDiffViewerVisible=(0,a.un)(this,e=>!!this._options.onlyShowAccessibleDiffViewer.read(e)||this._accessibleDiffViewerShouldBeVisible.read(e)),this._movedBlocksLinesPart=(0,a.FY)(this,void 0),this._layoutInfo=(0,a.un)(this,e=>{const i=this._rootSizeObserver.width.read(e),t=this._rootSizeObserver.height.read(e);this._rootSizeObserver.automaticLayout?this.elements.root.style.height="100%":this.elements.root.style.height=t+"px";const n=this._sash.read(e),o=this._gutter.read(e),s=o?.width.read(e)??0,r=this._overviewRulerPart.read(e)?.width??0;let d,a,h,l,g;if(n){const t=n.sashLeft.read(e);d=0,a=t-s-(this._movedBlocksLinesPart.read(e)?.width.read(e)??0),g=t-s,h=t,l=i-h-r}else g=0,d=s,a=this._options.inlineViewHideOriginalLineNumbers.read(e)?0:Math.max(5,this._editors.originalObs.layoutInfoDecorationsLeft.read(e)),h=s+a,l=i-h-r;return this.elements.original.style.left=d+"px",this.elements.original.style.width=a+"px",this._editors.original.layout({width:a,height:t},!0),o?.layout(g),this.elements.modified.style.left=h+"px",this.elements.modified.style.width=l+"px",this._editors.modified.layout({width:l,height:t},!0),{modifiedEditor:this._editors.modified.getLayoutInfo(),originalEditor:this._editors.original.getLayoutInfo()}}),this._diffValue=this._diffModel.map((e,i)=>e?.diff.read(i)),this.onDidUpdateDiff=r.Jh.fromObservableLight(this._diffValue),g.willCreateDiffEditor(),this._contextKeyService.createKey("isInDiffEditor",!0),this._domElement.appendChild(this.elements.root),this._register((0,d.s)(()=>this.elements.root.remove())),this._rootSizeObserver=this._register(new w.pN(this.elements.root,i.dimension)),this._rootSizeObserver.setAutomaticLayout(i.automaticLayout??!1),this._options=this._instantiationService.createInstance(Ji,i),this._register((0,a.fm)(e=>{this._options.setWidth(this._rootSizeObserver.width.read(e))})),this._contextKeyService.createKey(Ui.R.isEmbeddedDiffEditor.key,!1),this._register((0,Fi.w)(Ui.R.isEmbeddedDiffEditor,this._contextKeyService,e=>this._options.isInEmbeddedEditor.read(e))),this._register((0,Fi.w)(Ui.R.comparingMovedCode,this._contextKeyService,e=>!!this._diffModel.read(e)?.movedTextToCompare.read(e))),this._register((0,Fi.w)(Ui.R.diffEditorRenderSideBySideInlineBreakpointReached,this._contextKeyService,e=>this._options.couldShowInlineViewBecauseOfSize.read(e))),this._register((0,Fi.w)(Ui.R.diffEditorInlineMode,this._contextKeyService,e=>!this._options.renderSideBySide.read(e))),this._register((0,Fi.w)(Ui.R.hasChanges,this._contextKeyService,e=>(this._diffModel.read(e)?.diff.read(e)?.mappings.length??0)>0)),this._editors=this._register(this._instantiationService.createInstance(qi,this.elements.original,this.elements.modified,this._options,t,(e,i,t,n)=>this._createInnerEditor(e,i,t,n))),this._register((0,Fi.w)(Ui.R.diffEditorOriginalWritable,this._contextKeyService,e=>this._options.originalEditable.read(e))),this._register((0,Fi.w)(Ui.R.diffEditorModifiedWritable,this._contextKeyService,e=>!this._options.readOnly.read(e))),this._register((0,Fi.w)(Ui.R.diffEditorOriginalUri,this._contextKeyService,e=>this._diffModel.read(e)?.model.original.uri.toString()??"")),this._register((0,Fi.w)(Ui.R.diffEditorModifiedUri,this._contextKeyService,e=>this._diffModel.read(e)?.model.modified.uri.toString()??"")),this._overviewRulerPart=(0,h.a0)(this,e=>this._options.renderOverviewRuler.read(e)?this._instantiationService.createInstance((0,ye.b)(Pi,e),this._editors,this.elements.root,this._diffModel,this._rootSizeObserver.width,this._rootSizeObserver.height,this._layoutInfo.map(e=>e.modifiedEditor)):void 0).recomputeInitiallyAndOnChange(this._store);const m={height:this._rootSizeObserver.height,width:this._rootSizeObserver.width.map((e,i)=>e-(this._overviewRulerPart.read(i)?.width??0))};this._sashLayout=new ri(this._options,m),this._sash=(0,h.a0)(this,e=>{const i=this._options.renderSideBySide.read(e);return this.elements.root.classList.toggle("side-by-side",i),i?new di(this.elements.root,m,this._options.enableSplitViewResizing,this._boundarySashes,this._sashLayout.sashLeft,()=>this._sashLayout.resetSash()):void 0}).recomputeInitiallyAndOnChange(this._store);const p=(0,h.a0)(this,e=>this._instantiationService.createInstance((0,ye.b)(Ei,e),this._editors,this._diffModel,this._options)).recomputeInitiallyAndOnChange(this._store);(0,h.a0)(this,e=>this._instantiationService.createInstance((0,ye.b)(oi,e),this._editors,this._diffModel,this._options,this)).recomputeInitiallyAndOnChange(this._store);const _=new Set,v=new Set;let b=!1;const L=(0,h.a0)(this,e=>this._instantiationService.createInstance((0,ye.b)(Qe,e),(0,n.zk)(this._domElement),this._editors,this._diffModel,this._options,this,()=>b||p.get().isUpdatingHiddenAreas,_,v)).recomputeInitiallyAndOnChange(this._store),C=(0,a.un)(this,e=>{const i=L.read(e).viewZones.read(e).orig,t=p.read(e).viewZones.read(e).origViewZones;return i.concat(t)}),R=(0,a.un)(this,e=>{const i=L.read(e).viewZones.read(e).mod,t=p.read(e).viewZones.read(e).modViewZones;return i.concat(t)});let S;this._register((0,w.Vs)(this._editors.original,C,e=>{b=e},_)),this._register((0,w.Vs)(this._editors.modified,R,e=>{b=e,b?S=c.D.capture(this._editors.modified):(S?.restore(this._editors.modified),S=void 0)},v)),this._accessibleDiffViewer=(0,h.a0)(this,e=>this._instantiationService.createInstance((0,ye.b)(z,e),this.elements.accessibleDiffViewer,this._accessibleDiffViewerVisible,(e,i)=>this._accessibleDiffViewerShouldBeVisible.set(e,i),this._options.onlyShowAccessibleDiffViewer.map(e=>!e),this._rootSizeObserver.width,this._rootSizeObserver.height,this._diffModel.map((e,i)=>e?.diff.read(i)?.mappings.map(e=>e.lineRangeMapping)),new X(this._editors))).recomputeInitiallyAndOnChange(this._store);const M=this._accessibleDiffViewerVisible.map(e=>e?"hidden":"visible");this._register((0,w.AV)(this.elements.modified,{visibility:M})),this._register((0,w.AV)(this.elements.original,{visibility:M})),this._createDiffEditorContributions(),g.addDiffEditor(this),this._gutter=(0,h.a0)(this,e=>this._options.shouldRenderGutterMenu.read(e)?this._instantiationService.createInstance((0,ye.b)(Li,e),this.elements.root,this._diffModel,this._editors,this._options,this._sashLayout,this._boundarySashes):void 0),this._register((0,a.OI)(this._layoutInfo)),(0,h.a0)(this,e=>new((0,ye.b)(ii,e))(this.elements.root,this._diffModel,this._layoutInfo.map(e=>e.originalEditor),this._layoutInfo.map(e=>e.modifiedEditor),this._editors)).recomputeInitiallyAndOnChange(this._store,e=>{this._movedBlocksLinesPart.set(e,void 0)}),this._register(r.Jh.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition,e=>this._handleCursorPositionChange(e,!0))),this._register(r.Jh.runAndSubscribe(this._editors.original.onDidChangeCursorPosition,e=>this._handleCursorPositionChange(e,!1)));const y=this._diffModel.map(this,(e,i)=>{if(e)return void 0===e.diff.read(i)&&!e.isDiffUpToDate.read(i)});this._register((0,a.yC)((e,i)=>{if(!0===y.read(e)){const e=this._editorProgressService.show(!0,1e3);i.add((0,d.s)(()=>e.done()))}})),this._register((0,a.yC)((e,i)=>{i.add(new((0,ye.b)(Hi,e))(this._editors,this._diffModel,this._options,this))})),this._register((0,a.yC)((e,i)=>{const t=this._diffModel.read(e);if(t)for(const e of[t.model.original,t.model.modified])i.add(e.onWillDispose(e=>{(0,s.dz)(new s.D7("TextModel got disposed before DiffEditorWidget model got reset")),this.setModel(null)}))})),this._register((0,a.fm)(e=>{this._options.setModel(this._diffModel.read(e))}))}_createInnerEditor(e,i,t,n){return e.createInstance(f.x,i,t,n)}_createDiffEditorContributions(){const e=l.dS.getDiffEditorContributions();for(const i of e)try{this._register(this._instantiationService.createInstance(i.ctor,this))}catch(e){(0,s.dz)(e)}}get _targetEditor(){return this._editors.modified}getEditorType(){return zi._.IDiffEditor}layout(e){this._rootSizeObserver.observe(e)}hasTextFocus(){return this._editors.original.hasTextFocus()||this._editors.modified.hasTextFocus()}saveViewState(){return{original:this._editors.original.saveViewState(),modified:this._editors.modified.saveViewState(),modelState:this._diffModel.get()?.serializeState()}}restoreViewState(e){if(e&&e.original&&e.modified){const i=e;this._editors.original.restoreViewState(i.original),this._editors.modified.restoreViewState(i.modified),i.modelState&&this._diffModel.get()?.restoreSerializedState(i.modelState)}}handleInitialized(){this._editors.original.handleInitialized(),this._editors.modified.handleInitialized()}createViewModel(e){return this._instantiationService.createInstance(Te,e,this._options)}getModel(){return this._diffModel.get()?.model??null}setModel(e){const i=e?"model"in e?w.O8.create(e).createNewRef(this):w.O8.create(this.createViewModel(e),this):null;this.setDiffModel(i)}setDiffModel(e,i){const t=this._diffModel.get();!e&&t&&this._accessibleDiffViewer.get().close(),this._diffModel.get()!==e?.object&&(0,a.PO)(i,i=>{const t=e?.object;a.y0.batchEventsGlobally(i,()=>{this._editors.original.setModel(t?t.model.original:null),this._editors.modified.setModel(t?t.model.modified:null)});const n=this._diffModelSrc.get()?.createNewRef(this);this._diffModelSrc.set(e?.createNewRef(this),i),setTimeout(()=>{n?.dispose()},0)})}updateOptions(e){this._options.updateOptions(e)}getContainerDomNode(){return this._domElement}getOriginalEditor(){return this._editors.original}getModifiedEditor(){return this._editors.modified}getLineChanges(){const e=this._diffModel.get()?.diff.get();return e?e.mappings.map(e=>{const i=e.lineRangeMapping;let t,n,o,s,r=i.innerChanges;return i.original.isEmpty?(t=i.original.startLineNumber-1,n=0,r=void 0):(t=i.original.startLineNumber,n=i.original.endLineNumberExclusive-1),i.modified.isEmpty?(o=i.modified.startLineNumber-1,s=0,r=void 0):(o=i.modified.startLineNumber,s=i.modified.endLineNumberExclusive-1),{originalStartLineNumber:t,originalEndLineNumber:n,modifiedStartLineNumber:o,modifiedEndLineNumber:s,charChanges:r?.map(e=>({originalStartLineNumber:e.originalRange.startLineNumber,originalStartColumn:e.originalRange.startColumn,originalEndLineNumber:e.originalRange.endLineNumber,originalEndColumn:e.originalRange.endColumn,modifiedStartLineNumber:e.modifiedRange.startLineNumber,modifiedStartColumn:e.modifiedRange.startColumn,modifiedEndLineNumber:e.modifiedRange.endLineNumber,modifiedEndColumn:e.modifiedRange.endColumn}))}}):null}revert(e){const i=this._diffModel.get();i&&i.isDiffUpToDate.get()&&this._editors.modified.executeEdits("diffEditor",[{range:e.modified.toExclusiveRange(),text:i.model.original.getValueInRange(e.original.toExclusiveRange())}])}revertRangeMappings(e){const i=this._diffModel.get();if(!i||!i.isDiffUpToDate.get())return;const t=e.map(e=>({range:e.modifiedRange,text:i.model.original.getValueInRange(e.originalRange)}));this._editors.modified.executeEdits("diffEditor",t)}_goTo(e){this._editors.modified.setPosition(new y.y(e.lineRangeMapping.modified.startLineNumber,1)),this._editors.modified.revealRangeInCenter(e.lineRangeMapping.modified.toExclusiveRange())}goToDiff(e){const i=this._diffModel.get()?.diff.get()?.mappings;if(!i||0===i.length)return;const t=this._editors.modified.getPosition().lineNumber;let n;n="next"===e?i.find(e=>e.lineRangeMapping.modified.startLineNumber>t)??i[0]:(0,o.Uk)(i,e=>e.lineRangeMapping.modified.startLineNumber<t)??i[i.length-1],this._goTo(n),n.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(V.Rh.diffLineDeleted,{source:"diffEditor.goToDiff"}):n.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(V.Rh.diffLineInserted,{source:"diffEditor.goToDiff"}):n&&this._accessibilitySignalService.playSignal(V.Rh.diffLineModified,{source:"diffEditor.goToDiff"})}revealFirstDiff(){const e=this._diffModel.get();e&&this.waitForDiff().then(()=>{const i=e.diff.get()?.mappings;i&&0!==i.length&&this._goTo(i[0])})}accessibleDiffViewerNext(){this._accessibleDiffViewer.get().next()}accessibleDiffViewerPrev(){this._accessibleDiffViewer.get().prev()}async waitForDiff(){const e=this._diffModel.get();e&&await e.waitForDiff()}mapToOtherSide(){const e=this._editors.modified.hasWidgetFocus(),i=e?this._editors.modified:this._editors.original,t=e?this._editors.original:this._editors.modified;let n;const o=i.getSelection();if(o){const i=this._diffModel.get()?.diff.get()?.mappings.map(i=>e?i.lineRangeMapping.flip():i.lineRangeMapping);if(i){const e=(0,w.Mu)(o.getStartPosition(),i),t=(0,w.Mu)(o.getEndPosition(),i);n=N.Q.plusRange(e,t)}}return{destination:t,destinationSelection:n}}switchSide(){const{destination:e,destinationSelection:i}=this.mapToOtherSide();e.focus(),i&&e.setSelection(i)}exitCompareMove(){const e=this._diffModel.get();e&&e.movedTextToCompare.set(void 0,void 0)}collapseAllUnchangedRegions(){const e=this._diffModel.get()?.unchangedRegions.get();e&&(0,a.Rn)(i=>{for(const t of e)t.collapseAll(i)})}showAllUnchangedRegions(){const e=this._diffModel.get()?.unchangedRegions.get();e&&(0,a.Rn)(i=>{for(const t of e)t.showAll(i)})}_handleCursorPositionChange(e,i){if(3===e?.reason){const t=this._diffModel.get()?.diff.get()?.mappings.find(t=>i?t.lineRangeMapping.modified.contains(e.position.lineNumber):t.lineRangeMapping.original.contains(e.position.lineNumber));t?.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(V.Rh.diffLineDeleted,{source:"diffEditor.cursorPositionChanged"}):t?.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(V.Rh.diffLineInserted,{source:"diffEditor.cursorPositionChanged"}):t&&this._accessibilitySignalService.playSignal(V.Rh.diffLineModified,{source:"diffEditor.cursorPositionChanged"})}}};tt=function(e,i,t,n){var o,s=arguments.length,r=s<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,i,t,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(r=(s<3?o(r):s>3?o(i,t,r):o(i,t))||r);return s>3&&r&&Object.defineProperty(i,t,r),r}([it(3,mi.fN),it(4,A._Y),it(5,g.T),it(6,V.Nt),it(7,Zi.N8)],tt)}}]);