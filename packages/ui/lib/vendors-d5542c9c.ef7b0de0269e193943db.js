"use strict";(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[386],{5839:(t,e,s)=>{s.d(e,{I:()=>m,r:()=>u});var r=s(60942),i=s(69958);const n=/^\w[\w\d+.-]*$/,h=/^\//,o=/^\/\//,a="",l="/",c=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class u{static isUri(t){return t instanceof u||!!t&&"string"==typeof t.authority&&"string"==typeof t.fragment&&"string"==typeof t.path&&"string"==typeof t.query&&"string"==typeof t.scheme&&"string"==typeof t.fsPath&&"function"==typeof t.with&&"function"==typeof t.toString}constructor(t,e,s,r,i,c=!1){"object"==typeof t?(this.scheme=t.scheme||a,this.authority=t.authority||a,this.path=t.path||a,this.query=t.query||a,this.fragment=t.fragment||a):(this.scheme=function(t,e){return t||e?t:"file"}(t,c),this.authority=e||a,this.path=function(t,e){switch(t){case"https":case"http":case"file":e?e[0]!==l&&(e=l+e):e=l}return e}(this.scheme,s||a),this.query=r||a,this.fragment=i||a,function(t,e){if(!t.scheme&&e)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${t.authority}", path: "${t.path}", query: "${t.query}", fragment: "${t.fragment}"}`);if(t.scheme&&!n.test(t.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(t.path)if(t.authority){if(!h.test(t.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(o.test(t.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}(this,c))}get fsPath(){return m(this,!1)}with(t){if(!t)return this;let{scheme:e,authority:s,path:r,query:i,fragment:n}=t;return void 0===e?e=this.scheme:null===e&&(e=a),void 0===s?s=this.authority:null===s&&(s=a),void 0===r?r=this.path:null===r&&(r=a),void 0===i?i=this.query:null===i&&(i=a),void 0===n?n=this.fragment:null===n&&(n=a),e===this.scheme&&s===this.authority&&r===this.path&&i===this.query&&n===this.fragment?this:new f(e,s,r,i,n)}static parse(t,e=!1){const s=c.exec(t);return s?new f(s[2]||a,E(s[4]||a),E(s[5]||a),E(s[7]||a),E(s[9]||a),e):new f(a,a,a,a,a)}static file(t){let e=a;if(i.uF&&(t=t.replace(/\\/g,l)),t[0]===l&&t[1]===l){const s=t.indexOf(l,2);-1===s?(e=t.substring(2),t=l):(e=t.substring(2,s),t=t.substring(s)||l)}return new f("file",e,t,a,a)}static from(t,e){return new f(t.scheme,t.authority,t.path,t.query,t.fragment,e)}static joinPath(t,...e){if(!t.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let s;return s=i.uF&&"file"===t.scheme?u.file(r.IN.join(m(t,!0),...e)).path:r.SA.join(t.path,...e),t.with({path:s})}toString(t=!1){return v(this,t)}toJSON(){return this}static revive(t){if(t){if(t instanceof u)return t;{const e=new f(t);return e._formatted=t.external??null,e._fsPath=t._sep===d?t.fsPath??null:null,e}}return t}}const d=i.uF?1:void 0;class f extends u{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=m(this,!1)),this._fsPath}toString(t=!1){return t?v(this,!0):(this._formatted||(this._formatted=v(this,!1)),this._formatted)}toJSON(){const t={$mid:1};return this._fsPath&&(t.fsPath=this._fsPath,t._sep=d),this._formatted&&(t.external=this._formatted),this.path&&(t.path=this.path),this.scheme&&(t.scheme=this.scheme),this.authority&&(t.authority=this.authority),this.query&&(t.query=this.query),this.fragment&&(t.fragment=this.fragment),t}}const g={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function _(t,e,s){let r,i=-1;for(let n=0;n<t.length;n++){const h=t.charCodeAt(n);if(h>=97&&h<=122||h>=65&&h<=90||h>=48&&h<=57||45===h||46===h||95===h||126===h||e&&47===h||s&&91===h||s&&93===h||s&&58===h)-1!==i&&(r+=encodeURIComponent(t.substring(i,n)),i=-1),void 0!==r&&(r+=t.charAt(n));else{void 0===r&&(r=t.substr(0,n));const e=g[h];void 0!==e?(-1!==i&&(r+=encodeURIComponent(t.substring(i,n)),i=-1),r+=e):-1===i&&(i=n)}}return-1!==i&&(r+=encodeURIComponent(t.substring(i))),void 0!==r?r:t}function p(t){let e;for(let s=0;s<t.length;s++){const r=t.charCodeAt(s);35===r||63===r?(void 0===e&&(e=t.substr(0,s)),e+=g[r]):void 0!==e&&(e+=t[s])}return void 0!==e?e:t}function m(t,e){let s;return s=t.authority&&t.path.length>1&&"file"===t.scheme?`//${t.authority}${t.path}`:47===t.path.charCodeAt(0)&&(t.path.charCodeAt(1)>=65&&t.path.charCodeAt(1)<=90||t.path.charCodeAt(1)>=97&&t.path.charCodeAt(1)<=122)&&58===t.path.charCodeAt(2)?e?t.path.substr(1):t.path[1].toLowerCase()+t.path.substr(2):t.path,i.uF&&(s=s.replace(/\//g,"\\")),s}function v(t,e){const s=e?p:_;let r="",{scheme:i,authority:n,path:h,query:o,fragment:a}=t;if(i&&(r+=i,r+=":"),(n||"file"===i)&&(r+=l,r+=l),n){let t=n.indexOf("@");if(-1!==t){const e=n.substr(0,t);n=n.substr(t+1),t=e.lastIndexOf(":"),-1===t?r+=s(e,!1,!1):(r+=s(e.substr(0,t),!1,!1),r+=":",r+=s(e.substr(t+1),!1,!0)),r+="@"}n=n.toLowerCase(),t=n.lastIndexOf(":"),-1===t?r+=s(n,!1,!0):(r+=s(n.substr(0,t),!1,!0),r+=n.substr(t))}if(h){if(h.length>=3&&47===h.charCodeAt(0)&&58===h.charCodeAt(2)){const t=h.charCodeAt(1);t>=65&&t<=90&&(h=`/${String.fromCharCode(t+32)}:${h.substr(3)}`)}else if(h.length>=2&&58===h.charCodeAt(1)){const t=h.charCodeAt(0);t>=65&&t<=90&&(h=`${String.fromCharCode(t+32)}:${h.substr(2)}`)}r+=s(h,!0,!1)}return o&&(r+="?",r+=s(o,!1,!1)),a&&(r+="#",r+=e?a:_(a,!1,!1)),r}function w(t){try{return decodeURIComponent(t)}catch{return t.length>3?t.substr(0,3)+w(t.substr(3)):t}}const y=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function E(t){return t.match(y)?t.replace(y,t=>w(t)):t}},58374:(t,e,s)=>{s.d(e,{cB:()=>l});var r=s(60891);class i{constructor(){this._value="",this._pos=0}reset(t){return this._value=t,this._pos=0,this}next(){return this._pos+=1,this}hasNext(){return this._pos<this._value.length-1}cmp(t){return t.charCodeAt(0)-this._value.charCodeAt(this._pos)}value(){return this._value[this._pos]}}class n{constructor(t=!0){this._caseSensitive=t}reset(t){return this._value=t,this._from=0,this._to=0,this.next()}hasNext(){return this._to<this._value.length}next(){this._from=this._to;let t=!0;for(;this._to<this._value.length;this._to++)if(46===this._value.charCodeAt(this._to)){if(!t)break;this._from++}else t=!1;return this}cmp(t){return this._caseSensitive?(0,r.lF)(t,this._value,0,t.length,this._from,this._to):(0,r.zd)(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}}class h{constructor(t=!0,e=!0){this._splitOnBackslash=t,this._caseSensitive=e}reset(t){this._from=0,this._to=0,this._value=t,this._valueLen=t.length;for(let e=t.length-1;e>=0;e--,this._valueLen--){const t=this._value.charCodeAt(e);if(!(47===t||this._splitOnBackslash&&92===t))break}return this.next()}hasNext(){return this._to<this._valueLen}next(){this._from=this._to;let t=!0;for(;this._to<this._valueLen;this._to++){const e=this._value.charCodeAt(this._to);if(47===e||this._splitOnBackslash&&92===e){if(!t)break;this._from++}else t=!1}return this}cmp(t){return this._caseSensitive?(0,r.lF)(t,this._value,0,t.length,this._from,this._to):(0,r.zd)(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}}class o{constructor(t,e){this._ignorePathCasing=t,this._ignoreQueryAndFragment=e,this._states=[],this._stateIdx=0}reset(t){return this._value=t,this._states=[],this._value.scheme&&this._states.push(1),this._value.authority&&this._states.push(2),this._value.path&&(this._pathIterator=new h(!1,!this._ignorePathCasing(t)),this._pathIterator.reset(t.path),this._pathIterator.value()&&this._states.push(3)),this._ignoreQueryAndFragment(t)||(this._value.query&&this._states.push(4),this._value.fragment&&this._states.push(5)),this._stateIdx=0,this}next(){return 3===this._states[this._stateIdx]&&this._pathIterator.hasNext()?this._pathIterator.next():this._stateIdx+=1,this}hasNext(){return 3===this._states[this._stateIdx]&&this._pathIterator.hasNext()||this._stateIdx<this._states.length-1}cmp(t){if(1===this._states[this._stateIdx])return(0,r.W1)(t,this._value.scheme);if(2===this._states[this._stateIdx])return(0,r.W1)(t,this._value.authority);if(3===this._states[this._stateIdx])return this._pathIterator.cmp(t);if(4===this._states[this._stateIdx])return(0,r.UD)(t,this._value.query);if(5===this._states[this._stateIdx])return(0,r.UD)(t,this._value.fragment);throw new Error}value(){if(1===this._states[this._stateIdx])return this._value.scheme;if(2===this._states[this._stateIdx])return this._value.authority;if(3===this._states[this._stateIdx])return this._pathIterator.value();if(4===this._states[this._stateIdx])return this._value.query;if(5===this._states[this._stateIdx])return this._value.fragment;throw new Error}}class a{constructor(){this.height=1}rotateLeft(){const t=this.right;return this.right=t.left,t.left=this,this.updateHeight(),t.updateHeight(),t}rotateRight(){const t=this.left;return this.left=t.right,t.right=this,this.updateHeight(),t.updateHeight(),t}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){return this.left?.height??0}get heightRight(){return this.right?.height??0}}class l{static forUris(t=()=>!1,e=()=>!1){return new l(new o(t,e))}static forStrings(){return new l(new i)}static forConfigKeys(){return new l(new n)}constructor(t){this._iter=t}clear(){this._root=void 0}set(t,e){const s=this._iter.reset(t);let r;this._root||(this._root=new a,this._root.segment=s.value());const i=[];for(r=this._root;;){const t=s.cmp(r.segment);if(t>0)r.left||(r.left=new a,r.left.segment=s.value()),i.push([-1,r]),r=r.left;else if(t<0)r.right||(r.right=new a,r.right.segment=s.value()),i.push([1,r]),r=r.right;else{if(!s.hasNext())break;s.next(),r.mid||(r.mid=new a,r.mid.segment=s.value()),i.push([0,r]),r=r.mid}}const n=r.value;r.value=e,r.key=t;for(let t=i.length-1;t>=0;t--){const e=i[t][1];e.updateHeight();const s=e.balanceFactor();if(s<-1||s>1){const s=i[t][0],r=i[t+1][0];if(1===s&&1===r)i[t][1]=e.rotateLeft();else if(-1===s&&-1===r)i[t][1]=e.rotateRight();else if(1===s&&-1===r)e.right=i[t+1][1]=i[t+1][1].rotateRight(),i[t][1]=e.rotateLeft();else{if(-1!==s||1!==r)throw new Error;e.left=i[t+1][1]=i[t+1][1].rotateLeft(),i[t][1]=e.rotateRight()}if(t>0)switch(i[t-1][0]){case-1:i[t-1][1].left=i[t][1];break;case 1:i[t-1][1].right=i[t][1];break;case 0:i[t-1][1].mid=i[t][1]}else this._root=i[0][1]}}return n}get(t){return this._getNode(t)?.value}_getNode(t){const e=this._iter.reset(t);let s=this._root;for(;s;){const t=e.cmp(s.segment);if(t>0)s=s.left;else if(t<0)s=s.right;else{if(!e.hasNext())break;e.next(),s=s.mid}}return s}has(t){const e=this._getNode(t);return!(void 0===e?.value&&void 0===e?.mid)}delete(t){return this._delete(t,!1)}deleteSuperstr(t){return this._delete(t,!0)}_delete(t,e){const s=this._iter.reset(t),r=[];let i=this._root;for(;i;){const t=s.cmp(i.segment);if(t>0)r.push([-1,i]),i=i.left;else if(t<0)r.push([1,i]),i=i.right;else{if(!s.hasNext())break;s.next(),r.push([0,i]),i=i.mid}}if(i){if(e?(i.left=void 0,i.mid=void 0,i.right=void 0,i.height=1):(i.key=void 0,i.value=void 0),!i.mid&&!i.value)if(i.left&&i.right){const t=this._min(i.right);if(t.key){const{key:e,value:s,segment:r}=t;this._delete(t.key,!1),i.key=e,i.value=s,i.segment=r}}else{const t=i.left??i.right;if(r.length>0){const[e,s]=r[r.length-1];switch(e){case-1:s.left=t;break;case 0:s.mid=t;break;case 1:s.right=t}}else this._root=t}for(let t=r.length-1;t>=0;t--){const e=r[t][1];e.updateHeight();const s=e.balanceFactor();if(s>1?(e.right.balanceFactor()>=0||(e.right=e.right.rotateRight()),r[t][1]=e.rotateLeft()):s<-1&&(e.left.balanceFactor()<=0||(e.left=e.left.rotateLeft()),r[t][1]=e.rotateRight()),t>0)switch(r[t-1][0]){case-1:r[t-1][1].left=r[t][1];break;case 1:r[t-1][1].right=r[t][1];break;case 0:r[t-1][1].mid=r[t][1]}else this._root=r[0][1]}}}_min(t){for(;t.left;)t=t.left;return t}findSubstr(t){const e=this._iter.reset(t);let s,r=this._root;for(;r;){const t=e.cmp(r.segment);if(t>0)r=r.left;else if(t<0)r=r.right;else{if(!e.hasNext())break;e.next(),s=r.value||s,r=r.mid}}return r&&r.value||s}findSuperstr(t){return this._findSuperstrOrElement(t,!1)}_findSuperstrOrElement(t,e){const s=this._iter.reset(t);let r=this._root;for(;r;){const t=s.cmp(r.segment);if(t>0)r=r.left;else if(t<0)r=r.right;else{if(!s.hasNext())return r.mid?this._entries(r.mid):e?r.value:void 0;s.next(),r=r.mid}}}forEach(t){for(const[e,s]of this)t(s,e)}*[Symbol.iterator](){yield*this._entries(this._root)}_entries(t){const e=[];return this._dfsEntries(t,e),e[Symbol.iterator]()}_dfsEntries(t,e){t&&(t.left&&this._dfsEntries(t.left,e),t.value&&e.push([t.key,t.value]),t.mid&&this._dfsEntries(t.mid,e),t.right&&this._dfsEntries(t.right,e))}}},69708:(t,e,s)=>{function r(t){return"string"==typeof t}function i(t){return!("object"!=typeof t||null===t||Array.isArray(t)||t instanceof RegExp||t instanceof Date)}function n(t){const e=Object.getPrototypeOf(Uint8Array);return"object"==typeof t&&t instanceof e}function h(t){return"number"==typeof t&&!isNaN(t)}function o(t){return!!t&&"function"==typeof t[Symbol.iterator]}function a(t){return!0===t||!1===t}function l(t){return void 0===t}function c(t){return!u(t)}function u(t){return l(t)||null===t}function d(t,e){if(!t)throw new Error(e?`Unexpected type, expected '${e}'`:"Unexpected type")}function f(t){if(u(t))throw new Error("Assertion Failed: argument is undefined or null");return t}function g(t){return"function"==typeof t}function _(t,e){const s=Math.min(t.length,e.length);for(let r=0;r<s;r++)p(t[r],e[r])}function p(t,e){if(r(e)){if(typeof t!==e)throw new Error(`argument does not match constraint: typeof ${e}`)}else if(g(e)){try{if(t instanceof e)return}catch{}if(!u(t)&&t.constructor===e)return;if(1===e.length&&!0===e.call(void 0,t))return;throw new Error("argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true")}}s.d(e,{Et:()=>h,Gv:()=>i,Kg:()=>r,Lm:()=>a,O9:()=>c,Tn:()=>g,b0:()=>l,eU:()=>f,iu:()=>n,j:()=>d,jx:()=>_,xZ:()=>o,z:()=>u})},71277:(t,e,s)=>{s.d(e,{Fx:()=>r,f8:()=>u,wc:()=>c});var r,i,n=s(30325),h=s(22573),o=s(32293),a=s(36115),l=s(69708);!function(t){t[t.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",t[t.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"}(r||(r={})),function(t){t[t.None=0]="None",t[t.Initialized=1]="Initialized",t[t.Closed=2]="Closed"}(i||(i={}));class c extends o.jG{static{this.DEFAULT_FLUSH_DELAY=100}constructor(t,e=Object.create(null)){super(),this.database=t,this.options=e,this._onDidChangeStorage=this._register(new h.fV),this.onDidChangeStorage=this._onDidChangeStorage.event,this.state=i.None,this.cache=new Map,this.flushDelayer=this._register(new n.Th(c.DEFAULT_FLUSH_DELAY)),this.pendingDeletes=new Set,this.pendingInserts=new Map,this.whenFlushedCallbacks=[],this.registerListeners()}registerListeners(){this._register(this.database.onDidChangeItemsExternal(t=>this.onDidChangeItemsExternal(t)))}onDidChangeItemsExternal(t){this._onDidChangeStorage.pause();try{t.changed?.forEach((t,e)=>this.acceptExternal(e,t)),t.deleted?.forEach(t=>this.acceptExternal(t,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(t,e){if(this.state===i.Closed)return;let s=!1;(0,l.z)(e)?s=this.cache.delete(t):this.cache.get(t)!==e&&(this.cache.set(t,e),s=!0),s&&this._onDidChangeStorage.fire({key:t,external:!0})}get(t,e){const s=this.cache.get(t);return(0,l.z)(s)?e:s}getBoolean(t,e){const s=this.get(t);return(0,l.z)(s)?e:"true"===s}getNumber(t,e){const s=this.get(t);return(0,l.z)(s)?e:parseInt(s,10)}async set(t,e,s=!1){if(this.state===i.Closed)return;if((0,l.z)(e))return this.delete(t,s);const r=(0,l.Gv)(e)||Array.isArray(e)?(0,a.As)(e):String(e);return this.cache.get(t)!==r?(this.cache.set(t,r),this.pendingInserts.set(t,r),this.pendingDeletes.delete(t),this._onDidChangeStorage.fire({key:t,external:s}),this.doFlush()):void 0}async delete(t,e=!1){if(this.state!==i.Closed)return this.cache.delete(t)?(this.pendingDeletes.has(t)||this.pendingDeletes.add(t),this.pendingInserts.delete(t),this._onDidChangeStorage.fire({key:t,external:e}),this.doFlush()):void 0}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;const t={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(t).finally(()=>{if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)this.whenFlushedCallbacks.pop()?.()})}async doFlush(t){return this.options.hint===r.STORAGE_IN_MEMORY?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),t)}}class u{constructor(){this.onDidChangeItemsExternal=h.Jh.None,this.items=new Map}async updateItems(t){t.insert?.forEach((t,e)=>this.items.set(e,t)),t.delete?.forEach(t=>this.items.delete(t))}}},88477:(t,e,s)=>{function r(t){return t<0?0:t>255?255:0|t}function i(t){return t<0?0:t>4294967295?4294967295:0|t}s.d(e,{W:()=>r,j:()=>i})},94850:(t,e,s)=>{s.d(e,{L:()=>i});var r,i,n=s(36972);!function(t){t.isThemeColor=function(t){return t&&"object"==typeof t&&"string"==typeof t.id}}(r||(r={})),function(t){t.iconNameSegment="[A-Za-z0-9]+",t.iconNameExpression="[A-Za-z0-9-]+",t.iconModifierExpression="~[A-Za-z]+",t.iconNameCharacter="[A-Za-z0-9~-]";const e=new RegExp(`^(${t.iconNameExpression})(${t.iconModifierExpression})?$`);function s(t){const r=e.exec(t.id);if(!r)return s(n.W.error);const[,i,h]=r,o=["codicon","codicon-"+i];return h&&o.push("codicon-modifier-"+h.substring(1)),o}t.asClassNameArray=s,t.asClassName=function(t){return s(t).join(" ")},t.asCSSSelector=function(t){return"."+s(t).join(".")},t.isThemeIcon=function(t){return t&&"object"==typeof t&&"string"==typeof t.id&&(void 0===t.color||r.isThemeColor(t.color))};const i=new RegExp(`^\\$\\((${t.iconNameExpression}(?:${t.iconModifierExpression})?)\\)$`);t.fromString=function(t){const e=i.exec(t);if(!e)return;const[,s]=e;return{id:s}},t.fromId=function(t){return{id:t}},t.modify=function(t,e){let s=t.id;const r=s.lastIndexOf("~");return-1!==r&&(s=s.substring(0,r)),e&&(s=`${s}~${e}`),{id:s}},t.getModifier=function(t){const e=t.id.lastIndexOf("~");if(-1!==e)return t.id.substring(e+1)},t.isEqual=function(t,e){return t.id===e.id&&t.color?.id===e.color?.id}}(i||(i={}))},99246:(t,e,s)=>{s.r(e),s.d(e,{SimpleWorkerClient:()=>w,SimpleWorkerServer:()=>b,create:()=>x,logOnceWebWorkerWarning:()=>d});var r=s(73226),i=s(22573),n=s(32293),h=s(54835),o=s(69958),a=s(60891);const l="default",c="$initialize";let u=!1;function d(t){o.HZ&&(u||(u=!0,console.warn("Could not create web worker(s). Falling back to loading web worker code in main thread, which might cause UI freezes. Please see https://github.com/microsoft/monaco-editor#faq")),console.warn(t.message))}class f{constructor(t,e,s,r,i){this.vsWorker=t,this.req=e,this.channel=s,this.method=r,this.args=i,this.type=0}}class g{constructor(t,e,s,r){this.vsWorker=t,this.seq=e,this.res=s,this.err=r,this.type=1}}class _{constructor(t,e,s,r,i){this.vsWorker=t,this.req=e,this.channel=s,this.eventName=r,this.arg=i,this.type=2}}class p{constructor(t,e,s){this.vsWorker=t,this.req=e,this.event=s,this.type=3}}class m{constructor(t,e){this.vsWorker=t,this.req=e,this.type=4}}class v{constructor(t){this._workerId=-1,this._handler=t,this._lastSentReq=0,this._pendingReplies=Object.create(null),this._pendingEmitters=new Map,this._pendingEvents=new Map}setWorkerId(t){this._workerId=t}sendMessage(t,e,s){const r=String(++this._lastSentReq);return new Promise((i,n)=>{this._pendingReplies[r]={resolve:i,reject:n},this._send(new f(this._workerId,r,t,e,s))})}listen(t,e,s){let r=null;const n=new i.vl({onWillAddFirstListener:()=>{r=String(++this._lastSentReq),this._pendingEmitters.set(r,n),this._send(new _(this._workerId,r,t,e,s))},onDidRemoveLastListener:()=>{this._pendingEmitters.delete(r),this._send(new m(this._workerId,r)),r=null}});return n.event}handleMessage(t){t&&t.vsWorker&&(-1!==this._workerId&&t.vsWorker!==this._workerId||this._handleMessage(t))}createProxyToRemoteChannel(t,e){const s={get:(s,r)=>("string"!=typeof r||s[r]||(E(r)?s[r]=e=>this.listen(t,r,e):y(r)?s[r]=this.listen(t,r,void 0):36===r.charCodeAt(0)&&(s[r]=async(...s)=>(await(e?.()),this.sendMessage(t,r,s)))),s[r])};return new Proxy(Object.create(null),s)}_handleMessage(t){switch(t.type){case 1:return this._handleReplyMessage(t);case 0:return this._handleRequestMessage(t);case 2:return this._handleSubscribeEventMessage(t);case 3:return this._handleEventMessage(t);case 4:return this._handleUnsubscribeEventMessage(t)}}_handleReplyMessage(t){if(!this._pendingReplies[t.seq])return void console.warn("Got reply to unknown seq");const e=this._pendingReplies[t.seq];if(delete this._pendingReplies[t.seq],t.err){let s=t.err;return t.err.$isError&&(s=new Error,s.name=t.err.name,s.message=t.err.message,s.stack=t.err.stack),void e.reject(s)}e.resolve(t.res)}_handleRequestMessage(t){const e=t.req;this._handler.handleMessage(t.channel,t.method,t.args).then(t=>{this._send(new g(this._workerId,e,t,void 0))},t=>{t.detail instanceof Error&&(t.detail=(0,r.cU)(t.detail)),this._send(new g(this._workerId,e,void 0,(0,r.cU)(t)))})}_handleSubscribeEventMessage(t){const e=t.req,s=this._handler.handleEvent(t.channel,t.eventName,t.arg)(t=>{this._send(new p(this._workerId,e,t))});this._pendingEvents.set(e,s)}_handleEventMessage(t){this._pendingEmitters.has(t.req)?this._pendingEmitters.get(t.req).fire(t.event):console.warn("Got event for unknown req")}_handleUnsubscribeEventMessage(t){this._pendingEvents.has(t.req)?(this._pendingEvents.get(t.req).dispose(),this._pendingEvents.delete(t.req)):console.warn("Got unsubscribe for unknown req")}_send(t){const e=[];if(0===t.type)for(let s=0;s<t.args.length;s++)t.args[s]instanceof ArrayBuffer&&e.push(t.args[s]);else 1===t.type&&t.res instanceof ArrayBuffer&&e.push(t.res);this._handler.sendMessage(t,e)}}class w extends n.jG{constructor(t,e){super(),this._localChannels=new Map,this._worker=this._register(t.create({amdModuleId:"vs/base/common/worker/simpleWorker",esmModuleLocation:e.esmModuleLocation,label:e.label},t=>{this._protocol.handleMessage(t)},t=>{(0,r.dz)(t)})),this._protocol=new v({sendMessage:(t,e)=>{this._worker.postMessage(t,e)},handleMessage:(t,e,s)=>this._handleMessage(t,e,s),handleEvent:(t,e,s)=>this._handleEvent(t,e,s)}),this._protocol.setWorkerId(this._worker.getId());let s=null;const i=globalThis.require;void 0!==i&&"function"==typeof i.getConfig?s=i.getConfig():void 0!==globalThis.requirejs&&(s=globalThis.requirejs.s.contexts._.config),this._onModuleLoaded=this._protocol.sendMessage(l,c,[this._worker.getId(),JSON.parse(JSON.stringify(s)),e.amdModuleId]),this.proxy=this._protocol.createProxyToRemoteChannel(l,async()=>{await this._onModuleLoaded}),this._onModuleLoaded.catch(t=>{this._onError("Worker failed to load "+e.amdModuleId,t)})}_handleMessage(t,e,s){const r=this._localChannels.get(t);if(!r)return Promise.reject(new Error(`Missing channel ${t} on main thread`));if("function"!=typeof r[e])return Promise.reject(new Error(`Missing method ${e} on main thread channel ${t}`));try{return Promise.resolve(r[e].apply(r,s))}catch(t){return Promise.reject(t)}}_handleEvent(t,e,s){const r=this._localChannels.get(t);if(!r)throw new Error(`Missing channel ${t} on main thread`);if(E(e)){const i=r[e].call(r,s);if("function"!=typeof i)throw new Error(`Missing dynamic event ${e} on main thread channel ${t}.`);return i}if(y(e)){const s=r[e];if("function"!=typeof s)throw new Error(`Missing event ${e} on main thread channel ${t}.`);return s}throw new Error(`Malformed event name ${e}`)}setChannel(t,e){this._localChannels.set(t,e)}_onError(t,e){console.error(t),console.info(e)}}function y(t){return"o"===t[0]&&"n"===t[1]&&a.Wv(t.charCodeAt(2))}function E(t){return/^onDynamic/.test(t)&&a.Wv(t.charCodeAt(9))}class b{constructor(t,e){this._localChannels=new Map,this._remoteChannels=new Map,this._requestHandlerFactory=e,this._requestHandler=null,this._protocol=new v({sendMessage:(e,s)=>{t(e,s)},handleMessage:(t,e,s)=>this._handleMessage(t,e,s),handleEvent:(t,e,s)=>this._handleEvent(t,e,s)})}onmessage(t){this._protocol.handleMessage(t)}_handleMessage(t,e,s){if(t===l&&e===c)return this.initialize(s[0],s[1],s[2]);const r=t===l?this._requestHandler:this._localChannels.get(t);if(!r)return Promise.reject(new Error(`Missing channel ${t} on worker thread`));if("function"!=typeof r[e])return Promise.reject(new Error(`Missing method ${e} on worker thread channel ${t}`));try{return Promise.resolve(r[e].apply(r,s))}catch(t){return Promise.reject(t)}}_handleEvent(t,e,s){const r=t===l?this._requestHandler:this._localChannels.get(t);if(!r)throw new Error(`Missing channel ${t} on worker thread`);if(E(e)){const t=r[e].call(r,s);if("function"!=typeof t)throw new Error(`Missing dynamic event ${e} on request handler.`);return t}if(y(e)){const t=r[e];if("function"!=typeof t)throw new Error(`Missing event ${e} on request handler.`);return t}throw new Error(`Malformed event name ${e}`)}getChannel(t){if(!this._remoteChannels.has(t)){const e=this._protocol.createProxyToRemoteChannel(t);this._remoteChannels.set(t,e)}return this._remoteChannels.get(t)}async initialize(t,e,r){if(this._protocol.setWorkerId(t),!this._requestHandlerFactory){e&&(void 0!==e.baseUrl&&delete e.baseUrl,void 0!==e.paths&&void 0!==e.paths.vs&&delete e.paths.vs,void 0!==e.trustedTypesPolicy&&delete e.trustedTypesPolicy,e.catchError=!0,globalThis.require.config(e));{const t=h.zl.asBrowserUri(`${r}.js`).toString(!0);return s(98933)(`${t}`).then(t=>{if(this._requestHandler=t.create(this),!this._requestHandler)throw new Error("No RequestHandler!")})}}this._requestHandler=this._requestHandlerFactory(this)}}function x(t){return new b(t,null)}}}]);