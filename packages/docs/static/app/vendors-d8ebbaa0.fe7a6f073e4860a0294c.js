"use strict";(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[6748],{69501:e=>{e.exports=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]},96676:(e,n,t)=>{t.d(n,{$n:()=>a,Zc:()=>s,d0:()=>f,l5:()=>u});var r=-324,i=3,o="";function s(e,n){if(e===n)return 0;e=u(e),n=u(n);var t=l(e),r=l(n);if(t-r!=0)return t-r;switch(typeof e){case"number":return e-n;case"boolean":return e<n?-1:1;case"string":return function(e,n){return e===n?0:e>n?1:-1}(e,n)}return Array.isArray(e)?function(e,n){for(var t=Math.min(e.length,n.length),r=0;r<t;r++){var i=s(e[r],n[r]);if(0!==i)return i}return e.length===n.length?0:e.length>n.length?1:-1}(e,n):function(e,n){for(var t=Object.keys(e),r=Object.keys(n),i=Math.min(t.length,r.length),o=0;o<i;o++){var u=s(t[o],r[o]);if(0!==u)return u;if(0!==(u=s(e[t[o]],n[r[o]])))return u}return t.length===r.length?0:t.length>r.length?1:-1}(e,n)}function u(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var n=e;if(Array.isArray(e)){var t=e.length;e=new Array(t);for(var r=0;r<t;r++)e[r]=u(n[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},n)if(Object.prototype.hasOwnProperty.call(n,i)){var o=n[i];void 0!==o&&(e[i]=u(o))}}}return e}function a(e){return l(e=u(e))+o+function(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var n,t=e.toExponential().split(/e\+?/),s=parseInt(t[1],10),u=e<0,a=u?"0":"2",c=function(e,n,t){for(var r="",i=t-e.length;r.length<i;)r+=n;return r}(n=((u?-s:s)-r).toString(),"0",i)+n;a+=o+c;var d=Math.abs(parseFloat(t[0]));u&&(d=10-d);var f=d.toFixed(20);return f=f.replace(/\.?0+$/,""),a+(o+f)}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(e),t=n?e:Object.keys(e),s=-1,u=t.length,c="";if(n)for(;++s<u;)c+=a(t[s]);else for(;++s<u;){var d=t[s];c+=a(d)+a(e[d])}return c}return""}(e)+"\0"}function c(e,n){var t,o=n;if("1"===e[n])t=0,n++;else{var s="0"===e[n];n++;var u="",a=e.substring(n,n+i),c=parseInt(a,10)+r;for(s&&(c=-c),n+=i;;){var d=e[n];if("\0"===d)break;u+=d,n++}t=1===(u=u.split(".")).length?parseInt(u,10):parseFloat(u[0]+"."+u[1]),s&&(t-=10),0!==c&&(t=parseFloat(t+"e"+c))}return{num:t,length:n-o}}function d(e,n){var t=e.pop();if(n.length){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;Array.isArray(i)?i.push(t):o===e.length-2?i[e.pop()]=t:e.push(t)}}function f(e){for(var n=[],t=[],r=0;;){var i=e[r++];if("\0"!==i)switch(i){case"1":n.push(null);break;case"2":n.push("1"===e[r]),r++;break;case"3":var o=c(e,r);n.push(o.num),r+=o.length;break;case"4":for(var s="";;){var u=e[r];if("\0"===u)break;s+=u,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),n.push(s);break;case"5":var a={element:[],index:n.length};n.push(a.element),t.push(a);break;case"6":var f={element:{},index:n.length};n.push(f.element),t.push(f);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===n.length)return n.pop();d(n,t)}}}function l(e){var n=["boolean","number","string","object"].indexOf(typeof e);return~n?null===e?1:Array.isArray(e)?5:n<3?n+2:n+3:Array.isArray(e)?5:void 0}},37709:(e,n,t)=>{function r(e){return"$"+e}function i(e){return e.substring(1)}function o(){this._store={}}function s(e){if(this._store=new o,e&&Array.isArray(e))for(var n=0,t=e.length;n<t;n++)this.add(e[n])}var u,a;t.d(n,{N:()=>u,T:()=>a}),o.prototype.get=function(e){var n=r(e);return this._store[n]},o.prototype.set=function(e,n){var t=r(e);return this._store[t]=n,!0},o.prototype.has=function(e){return r(e)in this._store},o.prototype.keys=function(){return Object.keys(this._store).map((e=>i(e)))},o.prototype.delete=function(e){var n=r(e),t=n in this._store;return delete this._store[n],t},o.prototype.forEach=function(e){for(var n=Object.keys(this._store),t=0,r=n.length;t<r;t++){var o=n[t];e(this._store[o],o=i(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),s.prototype.add=function(e){return this._store.set(e,!0)},s.prototype.has=function(e){return this._store.has(e)},s.prototype.forEach=function(e){this._store.forEach((function(n,t){e(t)}))},Object.defineProperty(s.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(u=Set,a=Map):(u=s,a=o)},36791:(e,n,t)=>{t.d(n,{hp:()=>o});class r extends Error{constructor(e,n,t){super(),this.status=e,this.name=n,this.message=t,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new r(401,"unauthorized","Name or password is incorrect."),new r(400,"bad_request","Missing JSON list of 'docs'"),new r(404,"not_found","missing"),new r(409,"conflict","Document update conflict"),new r(400,"bad_request","_id field must contain a string"),new r(412,"missing_id","_id is required for puts"),new r(400,"bad_request","Only reserved document ids may start with underscore."),new r(412,"precondition_failed","Database not open");var i=new r(500,"unknown_error","Database encountered an unknown error");function o(e){if("object"!=typeof e){var n=e;(e=i).data=n}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=(new Error).stack),e}new r(500,"badarg","Some query argument is invalid"),new r(400,"invalid_request","Request was invalid"),new r(400,"query_parse_error","Some query parameter is invalid"),new r(500,"doc_validation","Bad special document member"),new r(400,"bad_request","Something wrong with the request"),new r(400,"bad_request","Document must be a JSON object"),new r(404,"not_found","Database not found"),new r(500,"indexed_db_went_bad","unknown"),new r(500,"web_sql_went_bad","unknown"),new r(500,"levelDB_went_went_bad","unknown"),new r(403,"forbidden","Forbidden by design doc validate_doc_update function"),new r(400,"bad_request","Invalid rev format"),new r(412,"file_exists","The database could not be created, the file already exists."),new r(412,"missing_stub","A pre-existing attachment stub wasn't found"),new r(413,"invalid_url","Provided URL is invalid")},60273:(e,n,t)=>{t.r(n),t.d(n,{default:()=>he});var r=t(36791),i=("undefined"!=typeof AbortController&&AbortController,Headers),o=t(37709);function s(e){for(var n=e.length,t=new ArrayBuffer(n),r=new Uint8Array(t),i=0;i<n;i++)r[i]=e.charCodeAt(i);return t}function u(e,n){return function(e,n){return function(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(i){if("TypeError"!==i.name)throw i;for(var t=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)t.append(e[r]);return t.getBlob(n.type)}}([s(e)],{type:n})}(atob(e),n)}var a=t(96676),c=t(6418),d=t(87689);class f extends Error{constructor(e){super(),this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,f)}catch(e){}}}class l extends Error{constructor(e){super(),this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,l)}catch(e){}}}class y extends Error{constructor(e){super(),this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,y)}catch(e){}}}function h(e,n){return n&&e.then((function(e){(0,c.dY)((function(){n(null,e)}))}),(function(e){(0,c.dY)((function(){n(e)}))})),e}function p(e,n){return function(){var t=arguments,r=this;return e.add((function(){return n.apply(r,t)}))}}function v(e){var n=new o.N(e),t=new Array(n.size),r=-1;return n.forEach((function(e){t[++r]=e})),t}function g(e){var n=new Array(e.size),t=-1;return e.forEach((function(e,r){n[++t]=r})),n}class m{constructor(){this.promise=new Promise((function(e){e()}))}add(e){return this.promise=this.promise.catch((function(){})).then((function(){return e()})),this.promise}finish(){return this.promise}}function _(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}async function w(e,n,t,r,i,o){const s=function(e,n){return _(e)+_(n)+"undefined"}(t,r);let u;if(!i&&(u=e._cachedViews=e._cachedViews||{},u[s]))return u[s];const a=e.info().then((async function(a){const f=a.db_name+"-mrview-"+(i?"temp":(0,d.m)(s));await(0,c.el)(e,"_local/"+o,(function(e){e.views=e.views||{};let t=n;-1===t.indexOf("/")&&(t=n+"/"+n);const r=e.views[t]=e.views[t]||{};if(!r[f])return r[f]=!0,e}));const l=(await e.registerDependentDatabase(f)).db;l.auto_compaction=!0;const y={name:f,db:l,sourceDB:e,adapter:e.adapter,mapFun:t,reduceFun:r};let h;try{h=await y.db.get("_local/lastSeq")}catch(e){if(404!==e.status)throw e}return y.seq=h?h.seq:0,u&&y.db.once("destroyed",(function(){delete u[s]})),y}));return u&&(u[s]=a),a}var k={},b=new m;function x(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function O(e,n,t){try{e.emit("error",n)}catch(e){(0,c.ue)("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),(0,c.ue)("error",n,t)}}var $=t(11195);function q(e){return(e=(0,c.o8)(e)).index||(e.index={}),["type","name","ddoc"].forEach((function(n){e.index[n]&&(e[n]=e.index[n],delete e.index[n])})),e.fields&&(e.index.fields=e.fields,delete e.fields),e.type||(e.type="json"),e}function j(e,n,t){var r="",i=n,o=!0;if(-1!==["$in","$nin","$or","$and","$mod","$nor","$all"].indexOf(e)&&(Array.isArray(n)||(r="Query operator "+e+" must be an array.")),-1!==["$not","$elemMatch","$allMatch"].indexOf(e)&&(Array.isArray(n)||"object"!=typeof n||null===n)&&(r="Query operator "+e+" must be an object."),"$mod"===e&&Array.isArray(n))if(2!==n.length)r="Query operator $mod must be in the format [divisor, remainder], where divisor and remainder are both integers.";else{var s=n[0],u=n[1];0===s&&(r="Query operator $mod's divisor cannot be 0, cannot divide by zero.",o=!1),"number"==typeof s&&parseInt(s,10)===s||(r="Query operator $mod's divisor is not an integer.",i=s),parseInt(u,10)!==u&&(r="Query operator $mod's remainder is not an integer.",i=u)}if("$exists"===e&&"boolean"!=typeof n&&(r="Query operator $exists must be a boolean."),"$type"===e){var a=["null","boolean","number","string","array","object"],c='"'+a.slice(0,a.length-1).join('", "')+'", or "'+a[a.length-1]+'"';("string"!=typeof n||-1==a.indexOf(n))&&(r="Query operator $type must be a string. Supported values: "+c+".")}if("$size"===e&&parseInt(n,10)!==n&&(r="Query operator $size must be a integer."),"$regex"===e&&"string"!=typeof n&&(t?r="Query operator $regex must be a string.":n instanceof RegExp||(r="Query operator $regex must be a string or an instance of a javascript regular expression.")),r)throw o&&(r+=" Received"+(null===i?" ":Array.isArray(i)?" array":" "+typeof i)+": "+("object"==typeof i&&null!==i?JSON.stringify(i,null,"\t"):i)),new Error(r)}var A=["$all","$allMatch","$and","$elemMatch","$exists","$in","$mod","$nin","$nor","$not","$or","$regex","$size","$type"],E=["$in","$nin","$mod","$all"],S=["$eq","$gt","$gte","$lt","$lte"];function B(e,n){if(Array.isArray(e))for(var t of e)"object"==typeof t&&null!==s&&B(t,n);else for(var r=Object.keys(e),i=0;i<r.length;i++){var o=r[i],s=e[o];-1!==A.indexOf(o)&&j(o,s,n),-1===S.indexOf(o)&&-1===E.indexOf(o)&&"object"==typeof s&&null!==s&&B(s,n)}}function D(e,n,t,o){var s,u;t.headers=new i({"Content-type":"application/json"}),e.fetch(n,t).then((function(e){return s=e.status,u=e.ok,e.json()})).then((function(e){if(u)o(null,e);else{e.status=s;var n=(0,r.hp)(e);o(n)}})).catch(o)}function M(e,n,t){n=q(n),D(e,"_index",{method:"POST",body:JSON.stringify(n)},t)}function N(e,n,t){B(n.selector,!0),D(e,"_find",{method:"POST",body:JSON.stringify(n)},t)}function I(e,n,t){D(e,"_explain",{method:"POST",body:JSON.stringify(n)},t)}function T(e,n){D(e,"_index",{method:"GET"},n)}function P(e,n,t){var r=n.ddoc,i=n.type||"json",o=n.name;return r?o?void D(e,"_index/"+[r,i,o].map(encodeURIComponent).join("/"),{method:"DELETE"},t):t(new Error("you must provide an index's name")):t(new Error("you must provide an index's ddoc"))}function F(e){return function(...n){var t=n.pop(),r=e.apply(this,n);return function(e,n){e.then((function(e){(0,c.dY)((function(){n(null,e)}))}),(function(e){(0,c.dY)((function(){n(e)}))}))}(r,t),r}}var C=function(...e){for(var n=[],t=0,r=e.length;t<r;t++){var i=e[t];Array.isArray(i)?n=n.concat(C.apply(null,i)):n.push(i)}return n};function U(e){for(var n={},t=0,r=e.length;t<r;t++)n=(0,c.kp)(n,e[t]);return n}function z(e,n){for(var t=0,r=Math.min(e.length,n.length);t<r;t++)if(e[t]!==n[t])return!1;return!0}function J(e,n){if(e.length!==n.length)return!1;for(var t=0,r=e.length;t<r;t++)if(e[t]!==n[t])return!1;return!0}var V=function(e,n,t,s){function d(e,n,t){try{n(t)}catch(r){O(e,r,{fun:n,doc:t})}}function _(e,n,t,r,i){try{return{output:n(t,r,i)}}catch(o){return O(e,o,{fun:n,keys:t,values:r,rereduce:i}),{error:o}}}function $(e,n){const t=(0,a.Zc)(e.key,n.key);return 0!==t?t:(0,a.Zc)(e.value,n.value)}function q(e,n,t){return t=t||0,"number"==typeof n?e.slice(t,n+t):t>0?e.slice(t):e}function j(e){const n=e.value;return n&&"object"==typeof n&&n._id||e.id}function A(e){return function(n){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach((function(e){const n=e.doc&&e.doc._attachments;n&&Object.keys(n).forEach((function(e){const t=n[e];n[e].data=u(t.data,t.content_type)}))}))}(n),n}}function E(e,n,t,r){let i=n[e];void 0!==i&&(r&&(i=encodeURIComponent(JSON.stringify(i))),t.push(e+"="+i))}function S(e){if(void 0!==e){const n=Number(e);return isNaN(n)||n!==parseInt(e,10)?e:n}}function B(e,n){const t=e.descending?"endkey":"startkey",r=e.descending?"startkey":"endkey";if(void 0!==e[t]&&void 0!==e[r]&&(0,a.Zc)(e[t],e[r])>0)throw new f("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(n.reduce&&!1!==e.reduce){if(e.include_docs)throw new f("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new f("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach((function(n){const t=function(e){if(e){if("number"!=typeof e)return new f(`Invalid value for integer: "${e}"`);if(e<0)return new f(`Invalid value for positive integer: "${e}"`)}}(e[n]);if(t)throw t}))}function D(e){return function(n){if(404===n.status)return e;throw n}}function M(e){const n="string"==typeof e?e:e.name;let t=k[n];return t||(t=k[n]=new m),t}async function N(e,t){return p(M(e),(function(){return async function(e,t){let r,i,s;const u=n(e.mapFun,(function(e,n){const t={id:i._id,key:(0,a.l5)(e)};null!=n&&(t.value=(0,a.l5)(n)),r.push(t)}));let f=e.seq||0;function l(n,t){return function(){return function(e,n,t){var r="_local/lastSeq";return e.db.get(r).catch(D({_id:r,seq:0})).then((function(r){var i=g(n);return Promise.all(i.map((function(t){return async function(e,n,t){const r="_local/doc_"+e,i={_id:r,keys:[]},s=t.get(e),u=s[0],a=s[1],c=await(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(a)?Promise.resolve(i):n.db.get(r).catch(D(i))),d=await function(e){return e.keys.length?n.db.allDocs({keys:e.keys,include_docs:!0}):Promise.resolve({rows:[]})}(c);return function(e,n){const t=[],r=new o.N;for(let e=0,i=n.rows.length;e<i;e++){const i=n.rows[e].doc;if(i&&(t.push(i),r.add(i._id),i._deleted=!u.has(i._id),!i._deleted)){const e=u.get(i._id);"value"in e&&(i.value=e.value)}}const i=g(u);return i.forEach((function(e){if(!r.has(e)){const n={_id:e},r=u.get(e);"value"in r&&(n.value=r.value),t.push(n)}})),e.keys=v(i.concat(e.keys)),t.push(e),t}(c,d)}(t,e,n)}))).then((function(n){var i=(0,c.Bq)(n);return r.seq=t,i.push(r),e.db.bulkDocs({docs:i})})).then((()=>function(e){return e.sourceDB.get("_local/purges").then((function(n){const t=n.purgeSeq;return e.db.get("_local/purgeSeq").then((function(e){return e._rev})).catch((function(e){if(404!==e.status)throw e})).then((function(n){return e.db.put({_id:"_local/purgeSeq",_rev:n,purgeSeq:t})}))})).catch((function(e){if(404!==e.status)throw e}))}(e)))}))}(e,n,t)}}let y=0;const h={view:e.name,indexed_docs:y};e.sourceDB.emit("indexing",h);const p=new m;async function _(){return function(n,a){var c=n.results;if(!c.length&&!a.length)return;for(let e of a)if(c.findIndex((function(n){return n.id===e.docId}))<0){const n={_id:e.docId,doc:{_id:e.docId,_deleted:1},changes:[]};e.doc&&(n.doc=e.doc,n.changes.push({rev:e.doc._rev})),c.push(n)}var h=function(n){const t=new o.T;for(let o=0,s=n.length;o<s;o++){const s=n[o];if("_"!==s.doc._id[0]){r=[],i=s.doc,i._deleted||d(e.sourceDB,u,i),r.sort($);const n=w(r);t.set(s.doc._id,[n,s.changes])}f=s.seq}return t}(c);p.add(l(h,f)),y+=c.length;const v={view:e.name,last_seq:n.last_seq,results_count:c.length,indexed_docs:y};return e.sourceDB.emit("indexing",v),e.sourceDB.activeTasks.update(s,{completed_items:y}),c.length<t.changes_batch_size?void 0:_()}(await e.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:f,limit:t.changes_batch_size}),await e.db.get("_local/purgeSeq").then((function(e){return e.purgeSeq})).catch((function(e){if(e&&404!==e.status)throw e;return-1})).then((function(n){return e.sourceDB.get("_local/purges").then((function(t){const r=t.purges.filter((function(e,t){return t>n})).map((e=>e.docId)),i=r.filter((function(e,n){return r.indexOf(e)===n}));return Promise.all(i.map((function(n){return e.sourceDB.get(n).then((function(e){return{docId:n,doc:e}})).catch((function(e){if(404!==e.status)throw e;return{docId:n}}))})))})).catch((function(e){if(e&&404!==e.status)throw e;return[]}))})))}function w(e){const n=new o.T;let t;for(let r=0,i=e.length;r<i;r++){const i=e[r],o=[i.key,i.id];r>0&&0===(0,a.Zc)(i.key,t)&&o.push(r),n.set((0,a.$n)(o),i),t=i.key}return n}try{await e.sourceDB.info().then((function(n){s=e.sourceDB.activeTasks.add({name:"view_indexing",total_items:n.update_seq-f})})),await _(),await p.finish(),e.seq=f,e.sourceDB.activeTasks.remove(s)}catch(n){e.sourceDB.activeTasks.remove(s,n)}}(e,t)}))()}function I(e,n){return p(M(e),(function(){return async function(e,n){let r;const i=e.reduceFun&&!1!==n.reduce,s=n.skip||0;async function u(n){n.include_docs=!0;const t=await e.db.allDocs(n);return r=t.total_rows,t.rows.map((function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){const n=Object.keys(e.doc.value).sort(),t=["id","key","value"];if(!(n<t||n>t))return e.doc.value}const n=(0,a.d0)(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}}))}async function d(u){let c;if(c=i?function(e,n,r){0===r.group_level&&delete r.group_level;const i=r.group||r.group_level,o=t(e.reduceFun),s=[],u=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;n.forEach((function(e){const n=s[s.length-1];let t=i?e.key:null;if(i&&Array.isArray(t)&&(t=t.slice(0,u)),n&&0===(0,a.Zc)(n.groupKey,t))return n.keys.push([e.key,e.id]),void n.values.push(e.value);s.push({keys:[[e.key,e.id]],values:[e.value],groupKey:t})})),n=[];for(let t=0,r=s.length;t<r;t++){const r=s[t],i=_(e.sourceDB,o,r.keys,r.values,!1);if(i.error&&i.error instanceof y)throw i.error;n.push({value:i.error?null:i.output,key:r.groupKey})}return{rows:q(n,r.limit,r.skip)}}(e,u,n):void 0===n.keys?{total_rows:r,offset:s,rows:u}:{total_rows:r,offset:s,rows:q(u,n.limit,n.skip)},n.update_seq&&(c.update_seq=e.seq),n.include_docs){const t=v(u.map(j)),r=await e.sourceDB.allDocs({keys:t,include_docs:!0,conflicts:n.conflicts,attachments:n.attachments,binary:n.binary});var d=new o.T;return r.rows.forEach((function(e){d.set(e.id,e.doc)})),u.forEach((function(e){var n=j(e),t=d.get(n);t&&(e.doc=t)})),c}return c}if(void 0===n.keys||n.keys.length||(n.limit=0,delete n.keys),void 0!==n.keys){const e=n.keys.map((function(e){const t={startkey:(0,a.$n)([e]),endkey:(0,a.$n)([e,{}])};return n.update_seq&&(t.update_seq=!0),u(t)})),t=await Promise.all(e);return d((0,c.Bq)(t))}{const e={descending:n.descending};let t,r;if(n.update_seq&&(e.update_seq=!0),"start_key"in n&&(t=n.start_key),"startkey"in n&&(t=n.startkey),"end_key"in n&&(r=n.end_key),"endkey"in n&&(r=n.endkey),void 0!==t&&(e.startkey=n.descending?(0,a.$n)([t,{}]):(0,a.$n)([t])),void 0!==r){let t=!1!==n.inclusive_end;n.descending&&(t=!t),e.endkey=(0,a.$n)(t?[r,{}]:[r])}if(void 0!==n.key){const t=(0,a.$n)([n.key]),r=(0,a.$n)([n.key,{}]);e.descending?(e.endkey=t,e.startkey=r):(e.startkey=t,e.endkey=r)}return i||("number"==typeof n.limit&&(e.limit=n.limit),e.skip=s),d(await u(e))}}(e,n)}))()}var T;return{query:function(n,t,o){const u=this;"function"==typeof t&&(o=t,t={}),t=t?function(e){return e.group_level=S(e.group_level),e.limit=S(e.limit),e.skip=S(e.skip),e}(t):{},"function"==typeof n&&(n={map:n});const a=Promise.resolve().then((function(){return async function(n,t,o){if("function"==typeof n._query)return function(e,n,t){return new Promise((function(r,i){e._query(n,t,(function(e,n){if(e)return i(e);r(n)}))}))}(n,t,o);if((0,c.Vx)(n))return async function(e,n,t){let o,s,u=[],a="GET";if(E("reduce",t,u),E("include_docs",t,u),E("attachments",t,u),E("limit",t,u),E("descending",t,u),E("group",t,u),E("group_level",t,u),E("skip",t,u),E("stale",t,u),E("conflicts",t,u),E("startkey",t,u,!0),E("start_key",t,u,!0),E("endkey",t,u,!0),E("end_key",t,u,!0),E("inclusive_end",t,u),E("key",t,u,!0),E("update_seq",t,u),u=u.join("&"),u=""===u?"":"?"+u,void 0!==t.keys){const e=2e3,r=`keys=${encodeURIComponent(JSON.stringify(t.keys))}`;r.length+u.length+1<=e?u+=("?"===u[0]?"&":"?")+r:(a="POST","string"==typeof n?o={keys:t.keys}:n.keys=t.keys)}if("string"==typeof n){const c=x(n),d=await e.fetch("_design/"+c[0]+"/_view/"+c[1]+u,{headers:new i({"Content-Type":"application/json"}),method:a,body:JSON.stringify(o)});s=d.ok;const f=await d.json();if(!s)throw f.status=d.status,(0,r.hp)(f);return f.rows.forEach((function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)})),new Promise((function(e){e(f)})).then(A(t))}o=o||{},Object.keys(n).forEach((function(e){Array.isArray(n[e])?o[e]=n[e]:o[e]=n[e].toString()}));const c=await e.fetch("_temp_view"+u,{headers:new i({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(o)});s=c.ok;const d=await c.json();if(!s)throw d.status=c.status,(0,r.hp)(d);return new Promise((function(e){e(d)})).then(A(t))}(n,t,o);const u={changes_batch_size:n.__opts.view_update_changes_batch_size||50};if("string"!=typeof t)return B(o,t),b.add((async function(){const r=await w(n,"temp_view/temp_view",t.map,t.reduce,!0,e);return i=N(r,u).then((function(){return I(r,o)})),s=function(){return r.db.destroy()},i.then((function(e){return s().then((function(){return e}))}),(function(e){return s().then((function(){throw e}))}));var i,s})),b.finish();{const r=t,i=x(r),a=i[0],d=i[1],f=await n.get("_design/"+a);if(!(t=f.views&&f.views[d]))throw new l(`ddoc ${f._id} has no view named ${d}`);s(f,d),B(o,t);const y=await w(n,r,t.map,t.reduce,!1,e);return"ok"===o.stale||"update_after"===o.stale?("update_after"===o.stale&&(0,c.dY)((function(){N(y,u)})),I(y,o)):(await N(y,u),I(y,o))}}(u,n,t)}));return h(a,o),a},viewCleanup:(T=function(){const n=this;return"function"==typeof n._viewCleanup?function(e){return new Promise((function(n,t){e._viewCleanup((function(e,r){if(e)return t(e);n(r)}))}))}(n):(0,c.Vx)(n)?async function(e){return(await e.fetch("_view_cleanup",{headers:new i({"Content-Type":"application/json"}),method:"POST"})).json()}(n):async function(n){try{const t=await n.get("_local/"+e),r=new o.T;Object.keys(t.views).forEach((function(e){const n=x(e),t="_design/"+n[0],i=n[1];let s=r.get(t);s||(s=new o.N,r.set(t,s)),s.add(i)}));const i={keys:g(r),include_docs:!0},s=await n.allDocs(i),u={};s.rows.forEach((function(e){const n=e.key.substring(8);r.get(e.key).forEach((function(r){let i=n+"/"+r;t.views[i]||(i=r);const o=Object.keys(t.views[i]),s=e.doc&&e.doc.views&&e.doc.views[r];o.forEach((function(e){u[e]=u[e]||s}))}))}));const a=Object.keys(u).filter((function(e){return!u[e]})).map((function(e){return p(M(e),(function(){return new n.constructor(e,n.__opts).destroy()}))()}));return Promise.all(a).then((function(){return{ok:!0}}))}catch(e){if(404===e.status)return{ok:!0};throw e}}(n)},function(...e){var n=e.pop(),t=T.apply(this,e);return"function"==typeof n&&h(t,n),t})}}("indexes",(function(e,n){return function(e,n,t){var r=function(e){for(var n=0,t=e.length;n<t;n++)if(-1!==e[n].indexOf("."))return!1;return!0}(e),i=1===e.length;return r?i?function(e,n,t){return function(r){t&&!(0,$.B5)(r,t)||n(r[e])}}(e[0],n,t):function(e,n,t){return function(r){if(!t||(0,$.B5)(r,t)){for(var i=[],o=0,s=e.length;o<s;o++)i.push(r[e[o]]);n(i)}}}(e,n,t):i?function(e,n,t){var r=(0,$.cn)(e);return function(e){if(!t||(0,$.B5)(e,t)){for(var i=e,o=0,s=r.length;o<s;o++)if(void 0===(i=i[r[o]]))return;n(i)}}}(e[0],n,t):function(e,n,t){return function(r){if(!t||(0,$.B5)(r,t)){for(var i=[],o=0,s=e.length;o<s;o++){for(var u=(0,$.cn)(e[o]),a=r,c=0,d=u.length;c<d;c++)if(void 0===(a=a[u[c]]))return;i.push(a)}n(i)}}}(e,n,t)}(Object.keys(e.fields),n,e.partial_filter_selector)}),(function(){throw new Error("reduce not supported")}),(function(e,n){var t=e.views[n];if(!t.map||!t.map.fields)throw new Error("ddoc "+e._id+" with view "+n+" doesn't have map.fields defined. maybe it wasn't created by this plugin?")}));function Q(e){return e._customFindAbstractMapper?{query:function(n,t){var r=V.query.bind(this);return e._customFindAbstractMapper.query.call(this,n,t,r)},viewCleanup:function(){var n=V.viewCleanup.bind(this);return e._customFindAbstractMapper.viewCleanup.call(this,n)}}:V}function Z(e){return e.fields=e.fields.map((function(e){if("string"==typeof e){var n={};return n[e]="asc",n}return e})),e.partial_filter_selector&&(e.partial_filter_selector=(0,$.DB)(e.partial_filter_selector)),e}function R(e,n){for(var t=[],r=0;r<n.def.fields.length;r++){var i=(0,$.i7)(n.def.fields[r]);t.push((0,$.JK)(e,(0,$.cn)(i)))}return t}function Y(e){return e.allDocs({startkey:"_design/",endkey:"_design/￿",include_docs:!0}).then((function(e){var n={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};return n.indexes=C(n.indexes,e.rows.filter((function(e){return"query"===e.doc.language})).map((function(e){return(void 0!==e.doc.views?Object.keys(e.doc.views):[]).map((function(n){var t=e.doc.views[n];return{ddoc:e.id,name:n,type:"json",def:Z(t.options.def)}}))}))),n.indexes.sort((function(e,n){return(0,$.UD)(e.name,n.name)})),n.total_rows=n.indexes.length,n}))}var K=null,L={"￿":{}};const X={queryOpts:{limit:0,startkey:L,endkey:K},inMemoryFields:[]};function G(e,n){for(var t=e.def.fields.map($.i7),r=0,i=t.length;r<i;r++)if(n===t[r])return!0;return!1}function W(e,n){var t=e[n];return"$eq"!==(0,$.i7)(t)}function H(e,n){var t=n.def.fields.map($.i7);return e.slice().sort((function(e,n){var r=t.indexOf(e),i=t.indexOf(n);return-1===r&&(r=Number.MAX_VALUE),-1===i&&(i=Number.MAX_VALUE),(0,$.UD)(r,i)}))}function ee(e,n,t,r){var i=C(e,function(e,n,t){for(var r=!1,i=0,o=(t=H(t,e)).length;i<o;i++){var s=t[i];if(r||!G(e,s))return t.slice(i);i<o-1&&W(n,s)&&(r=!0)}return[]}(n,t,r),function(e){var n=[];return Object.keys(e).forEach((function(t){var r=e[t];Object.keys(r).forEach((function(e){"$ne"===e&&n.push(t)}))})),n}(t));return H(function(e){for(var n={},t=0;t<e.length;t++)n["$"+e[t]]=!0;return Object.keys(n).map((function(e){return e.substring(1)}))}(i),n)}var ne=["$eq","$gt","$gte","$lt","$lte"];function te(e){return-1===ne.indexOf(e)}function re(e,n,t,r){var i=e.def.fields.map($.i7);return!!function(e,n,t){if(n){var r=(s=e,!((o=n).length>s.length)&&z(o,s)),i=z(t,e);return r&&i}var o,s;return function(e,n){e=e.slice();for(var t=0,r=n.length;t<r;t++){var i=n[t];if(!e.length)break;var o=e.indexOf(i);if(-1===o)return!1;e.splice(o,1)}return!0}(t,e)}(i,n,t)&&function(e,n){var t=n[e[0]];return void 0===t||!(1===Object.keys(t).length&&"$ne"===(0,$.i7)(t))}(i,r)}function ie(e,n){switch(e){case"$eq":return{startkey:n,endkey:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}}function oe(e,n){return n.defaultUsed?function(e){return{queryOpts:{startkey:null},inMemoryFields:[Object.keys(e)]}}(e):1===n.def.fields.length?function(e,n){var t,r=(0,$.i7)(n.def.fields[0]),i=e[r]||{},o=[];return Object.keys(i).forEach((function(e){te(e)&&o.push(r);var n=function(e,n){switch(e){case"$eq":return{key:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}return{startkey:K}}(e,i[e]);t=t?U([t,n]):n})),{queryOpts:t,inMemoryFields:o}}(e,n):function(e,n){var t,r,i=n.def.fields.map($.i7),o=[],s=[],u=[];function a(e){!1!==t&&s.push(K),!1!==r&&u.push(L),o=i.slice(e)}for(var c=0,d=i.length;c<d;c++){var f=e[i[c]];if(!f||!Object.keys(f).length){a(c);break}if(Object.keys(f).some(te)){a(c);break}if(c>0){var l="$gt"in f||"$gte"in f||"$lt"in f||"$lte"in f,y=Object.keys(e[i[c-1]]),h=J(y,["$eq"]),p=J(y,Object.keys(f));if(l&&!h&&!p){a(c);break}}for(var v=Object.keys(f),g=null,m=0;m<v.length;m++){var _=v[m],w=ie(_,f[_]);g=g?U([g,w]):w}s.push("startkey"in g?g.startkey:K),u.push("endkey"in g?g.endkey:L),"inclusive_start"in g&&(t=g.inclusive_start),"inclusive_end"in g&&(r=g.inclusive_end)}var k={startkey:s,endkey:u};return void 0!==t&&(k.inclusive_start=t),void 0!==r&&(k.inclusive_end=r),{queryOpts:k,inMemoryFields:o}}(e,n)}function se(e,n){var t=e.selector,r=e.sort;if(function(e){return Object.keys(e).map((function(n){return e[n]})).some((function(e){return"object"==typeof e&&0===Object.keys(e).length}))}(t))return(0,c.kp)({},X,{index:n[0]});var i=function(e,n){var t,r=Object.keys(e),i=n?n.map($.i7):[];return t=r.length>=i.length?r:i,0===i.length?{fields:t}:{fields:t=t.sort((function(e,n){var t=i.indexOf(e);-1===t&&(t=Number.MAX_VALUE);var r=i.indexOf(n);return-1===r&&(r=Number.MAX_VALUE),t<r?-1:t>r?1:0})),sortOrder:n.map($.i7)}}(t,r),o=i.fields,s=function(e,n,t,r,i){var o=function(e,n,t,r){return r.filter((function(r){return re(r,t,n,e)}))}(e,n,t,r);if(0===o.length){if(i)throw{error:"no_usable_index",message:"There is no index available for this selector."};var s=r[0];return s.defaultUsed=!0,s}if(1===o.length&&!i)return o[0];var u=function(e){for(var n={},t=0,r=e.length;t<r;t++)n[e[t]]=!0;return n}(n);if(i){var a="_design/"+i[0],c=2===i.length&&i[1],d=o.find((function(e){return!(!c||e.ddoc!==a||c!==e.name)||e.ddoc===a}));if(!d)throw{error:"unknown_error",message:"Could not find that index or could not use that index for the query"};return d}return function(e,n){for(var t=null,r=-1,i=0,o=e.length;i<o;i++){var s=e[i],u=n(s);u>r&&(r=u,t=s)}return t}(o,(function(e){for(var n=e.def.fields.map($.i7),t=0,r=0,i=n.length;r<i;r++){var o=n[r];u[o]&&t++}return t}))}(t,o,i.sortOrder,n,e.use_index),u=oe(t,s);return{queryOpts:u.queryOpts,index:s,inMemoryFields:ee(u.inMemoryFields,s,t,o)}}function ue(e,n,t){var r,i;return n.selector&&(B(n.selector,!1),n.selector=(0,$.DB)(n.selector)),n.sort&&(n.sort=function(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map((function(e){if("string"==typeof e){var n={};return n[e]="asc",n}return e}))}(n.sort)),n.use_index&&(n.use_index=(i=[],"string"==typeof(r=n.use_index)?i.push(r):i=r,i.map((function(e){return e.replace("_design/","")})))),function(e){if("object"!=typeof e.selector)throw new Error("you must provide a selector when you find()")}(n),Y(e).then((function(r){e.constructor.emit("debug",["find","planning query",n]);var i=se(n,r.indexes);e.constructor.emit("debug",["find","query plan",i]);var o=i.index;!function(e,n){if(n.defaultUsed&&e.sort){var t=e.sort.filter((function(e){return"_id"!==Object.keys(e)[0]})).map((function(e){return Object.keys(e)[0]}));if(t.length>0)throw new Error('Cannot sort on field(s) "'+t.join(",")+'" when using the default index')}n.defaultUsed}(n,o);var s=(0,c.kp)({include_docs:!0,reduce:!1,indexes_count:r.total_rows},i.queryOpts);return"startkey"in s&&"endkey"in s&&(0,a.Zc)(s.startkey,s.endkey)>0?{docs:[]}:(n.sort&&"string"!=typeof n.sort[0]&&"desc"===(0,$._W)(n.sort[0])&&(s.descending=!0,s=function(e){var n=(0,c.o8)(e);return delete n.startkey,delete n.endkey,delete n.inclusive_start,delete n.inclusive_end,"endkey"in e&&(n.startkey=e.endkey),"startkey"in e&&(n.endkey=e.startkey),"inclusive_start"in e&&(n.inclusive_end=e.inclusive_start),"inclusive_end"in e&&(n.inclusive_start=e.inclusive_end),n}(s)),i.inMemoryFields.length||("limit"in n&&(s.limit=n.limit),"skip"in n&&(s.skip=n.skip)),t?Promise.resolve(i,s):Promise.resolve().then((function(){if("_all_docs"===o.name)return function(e,n){var t=(0,c.o8)(n);return t.descending?("endkey"in t&&"string"!=typeof t.endkey&&(t.endkey=""),"startkey"in t&&"string"!=typeof t.startkey&&(t.limit=0)):("startkey"in t&&"string"!=typeof t.startkey&&(t.startkey=""),"endkey"in t&&"string"!=typeof t.endkey&&(t.limit=0)),"key"in t&&"string"!=typeof t.key&&(t.limit=0),t.limit>0&&t.indexes_count&&(t.original_limit=t.limit,t.limit+=t.indexes_count),e.allDocs(t).then((function(e){return e.rows=e.rows.filter((function(e){return!/^_design\//.test(e.id)})),t.original_limit&&(t.limit=t.original_limit),e.rows=e.rows.slice(0,t.limit),e}))}(e,s);var n,t=(n=o).ddoc.substring(8)+"/"+n.name;return Q(e).query.call(e,t,s)})).then((function(e){!1===s.inclusive_start&&(e.rows=function(e,n,t){for(var r=t.def.fields,i=0,o=e.length;i<o;i++){var s=R(e[i].doc,t);if(1===r.length)s=s[0];else for(;s.length>n.length;)s.pop();if(Math.abs((0,a.Zc)(s,n))>0)break}return i>0?e.slice(i):e}(e.rows,s.startkey,o)),i.inMemoryFields.length&&(e.rows=(0,$._9)(e.rows,n,i.inMemoryFields));var t={docs:e.rows.map((function(e){var t=e.doc;return n.fields?function(e,n){for(var t={},r=0,i=n.length;r<i;r++){var o=(0,$.cn)(n[r]),s=(0,$.JK)(e,o);void 0!==s&&(0,$.Gm)(t,o,s)}return t}(t,n.fields):t}))};return o.defaultUsed&&(t.warning="No matching index found, create an index to optimize query time."),t})))}))}var ae=F((function(e,n){n=q(n);var t,r=(0,c.o8)(n.index);function i(){return t||(t=(0,d.m)(JSON.stringify(n)))}n.index=Z(n.index),function(e){var n=e.fields.filter((function(e){return"asc"===(0,$._W)(e)}));if(0!==n.length&&n.length!==e.fields.length)throw new Error("unsupported mixed sorting")}(n.index);var o=n.name||"idx-"+i(),s=n.ddoc||"idx-"+i(),u="_design/"+s,a=!1,f=!1;return e.constructor.emit("debug",["find","creating index",u]),(0,c.el)(e,u,(function(e){return e._rev&&"query"!==e.language&&(a=!0),e.language="query",e.views=e.views||{},!(f=!!e.views[o])&&(e.views[o]={map:{fields:U(n.index.fields),partial_filter_selector:n.index.partial_filter_selector},reduce:"_count",options:{def:r}},e)})).then((function(){if(a)throw new Error('invalid language for ddoc with id "'+u+'" (should be "query")')})).then((function(){var n=s+"/"+o;return Q(e).query.call(e,n,{limit:0,reduce:!1}).then((function(){return{id:u,name:o,result:f?"exists":"created"}}))}))})),ce=F(ue),de=F((function(e,n){return ue(e,n,!0).then((function(t){return{dbname:e.name,index:t.index,selector:n.selector,range:{start_key:t.queryOpts.startkey,end_key:t.queryOpts.endkey},opts:{use_index:n.use_index||[],bookmark:"nil",limit:n.limit,skip:n.skip,sort:n.sort||{},fields:n.fields,conflicts:!1,r:[49]},limit:n.limit,skip:n.skip||0,fields:n.fields}}))})),fe=F(Y),le=F((function(e,n){if(!n.ddoc)throw new Error("you must supply an index.ddoc when deleting");if(!n.name)throw new Error("you must supply an index.name when deleting");var t=n.ddoc,r=n.name;return(0,c.el)(e,t,(function(e){return 1===Object.keys(e.views).length&&e.views[r]?{_id:t,_deleted:!0}:(delete e.views[r],e)})).then((function(){return Q(e).viewCleanup.apply(e)})).then((function(){return{ok:!0}}))})),ye={};ye.createIndex=(0,c.hq)((function(e,n){if("object"!=typeof e)return n(new Error("you must provide an index to create"));((0,c.Vx)(this)?M:ae)(this,e,n)})),ye.find=(0,c.hq)((function(e,n){if(void 0===n&&(n=e,e=void 0),"object"!=typeof e)return n(new Error("you must provide search parameters to find()"));((0,c.Vx)(this)?N:ce)(this,e,n)})),ye.explain=(0,c.hq)((function(e,n){if(void 0===n&&(n=e,e=void 0),"object"!=typeof e)return n(new Error("you must provide search parameters to explain()"));((0,c.Vx)(this)?I:de)(this,e,n)})),ye.getIndexes=(0,c.hq)((function(e){((0,c.Vx)(this)?T:fe)(this,e)})),ye.deleteIndex=(0,c.hq)((function(e,n){if("object"!=typeof e)return n(new Error("you must provide an index to delete"));((0,c.Vx)(this)?P:le)(this,e,n)}));const he=ye},87689:(e,n,t)=>{t.d(n,{m:()=>o});var r=t(88110),i=t.n(r);function o(e){return i().hash(e)}self.setImmediate||self.setTimeout}}]);