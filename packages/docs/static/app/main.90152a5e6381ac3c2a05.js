(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[8792],{4002:(e,t,s)=>{"use strict";s.a(e,async(e,i)=>{try{s.d(t,{M:()=>l});var a=s(50523),r=s(85288),n=s(43820),o=s(27768),c=s(19928);const e=await(0,c.C7)(),l=(0,a.U1)({reducer:{ui:r.A,auth:n.Ay,stack:o.A},middleware:e=>e().concat(c.Q4),preloadedState:e});i()}catch(e){i(e)}},1)},10881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{countPatches:()=>i,importJsonFile:()=>a});const i=()=>{let e=0;try{const t=s(81463);console.log("getPatchCount - Browser: counting files via require.context"),e=t.keys().length,console.log(`countPatches - total number of patches: ${e}`)}catch(e){console.log("countPatches - problem while reading patch folder",e)}return e},a=async e=>{try{return console.log("importJsonFile - Browser: importing file via require"),s(97174)(`./${e}`)}catch(e){throw console.error("Error reading JSON file:",e),e}}},11580:()=>{},14168:()=>{},19928:(e,t,s)=>{"use strict";s.d(t,{C7:()=>o,LZ:()=>n,Q4:()=>c});var i=s(57822),a=s(87271);const r=new i.A("redux_state"),n=async e=>{try{const e=new a.jg({name:"client-test"});let t;e.addEventListener("ready",async s=>{if(t=e.getStack("client-test")){const e=await a.Xs.create(t,"Test","class","A test",{});var i=new a.nW(e,"text","string","A test attribute",{maxLength:50,primaryKey:!0,mandatory:!0});await a.nW.build(i),await e.addCard({text:"Hello"})}})}catch(e){console.error(e)}},o=async()=>{try{const e=await r.get("state");return console.log("loadState - loaded doc",e),e.state}catch(e){return 404===e.status?void 0:void console.error(e)}},c=e=>e=>async t=>e(t)},21592:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA5NiA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CiAgICA8IS0tIGJhY2tncm91bmQgLS0+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImJnIiBjeD0iNTAlIiBjeT0iNTAlIiByPSI3MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMWExYTFhIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIvPgogICAgPC9yYWRpYWxHcmFkaWVudD4KCiAgICA8IS0tIE5ldyBncmFkaWVudCAtLT4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0ibmVvbiIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM2MjAwRUUiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0b3AtY29sb3I9IiMwMDY3NEYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjODhFNzg4Ii8+CiAgICA8L2xpbmVhckdyYWRpZW50PgoKICAgIDwhLS0gR2xvdyBmaWx0ZXIgLS0+CiAgICA8ZmlsdGVyIGlkPSJnbG93IiB4PSItNTAlIiB5PSItNTAlIiB3aWR0aD0iMjAwJSIgaGVpZ2h0PSIyMDAlIj4KICAgICAgPGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjAiIHN0ZERldmlhdGlvbj0iMS41IiBmbG9vZC1jb2xvcj0iIzYyMDBFRSIgZmxvb2Qtb3BhY2l0eT0iMC42Ii8+CiAgICAgIDxmZURyb3BTaGFkb3cgZHg9IjAiIGR5PSIwIiBzdGREZXZpYXRpb249IjIuNSIgZmxvb2QtY29sb3I9IiMwMDY3NEYiIGZsb29kLW9wYWNpdHk9IjAuNSIvPgogICAgICA8ZmVEcm9wU2hhZG93IGR4PSIwIiBkeT0iMCIgc3RkRGV2aWF0aW9uPSIzLjUiIGZsb29kLWNvbG9yPSIjODhFNzg4IiBmbG9vZC1vcGFjaXR5PSIwLjQiLz4KICAgIDwvZmlsdGVyPgogIDwvZGVmcz4KCjxwYXRoIGQ9Ik04Ny4zNiAxNy4yOEM4Ny4zNiAxMi41MDgzIDgzLjQ5MTcgOC42NCA3OC43MiA4LjY0SDE3LjI4QzEyLjUwODMgOC42NCA4LjY0IDEyLjUwODMgOC42NCAxNy4yOFY3OC43MkM4LjY0IDgzLjQ5MTcgMTIuNTA4MyA4Ny4zNiAxNy4yOCA4Ny4zNkg3OC43MkM4My40OTE3IDg3LjM2IDg3LjM2IDgzLjQ5MTcgODcuMzYgNzguNzJWMTcuMjhaTTkzLjEyIDc4LjcyQzkzLjEyIDg2LjY3MjkgODYuNjcyOSA5My4xMiA3OC43MiA5My4xMkgxNy4yOEM5LjMyNzEgOTMuMTIgMi44OCA4Ni42NzI5IDIuODggNzguNzJWMTcuMjhDMi44OCA5LjMyNzEgOS4zMjcxIDIuODggMTcuMjggMi44OEg3OC43MkM4Ni42NzI5IDIuODggOTMuMTIgOS4zMjcxIDkzLjEyIDE3LjI4Vjc4LjcyWiIgZmlsbD0iI0ZGRiIvPgoKPHBhdGggZD0iTTgzLjUzMyAyOC45MjA0Qzg0LjE3NzQgMjUuMjY1NCA4MS43MzY5IDIxLjc4IDc4LjA4MiAyMS4xMzU1TDI4LjkyMDQgMTIuNDY3QzI1LjI2NTQgMTEuODIyNiAyMS43OCAxNC4yNjMxIDIxLjEzNTYgMTcuOTE4TDEyLjQ2NyA2Ny4wNzk2QzExLjgyMjYgNzAuNzM0NiAxNC4yNjMxIDc0LjIyIDE3LjkxOCA3NC44NjQ0TDY3LjA3OTYgODMuNTMzQzcwLjczNDYgODQuMTc3NCA3NC4yMiA4MS43MzY5IDc0Ljg2NDQgNzguMDgyTDgzLjUzMyAyOC45MjA0Wk04MC41MzY5IDc5LjA4MjJDNzkuMzQwMSA4NS44NyA3Mi44NjcyIDkwLjQwMjMgNjYuMDc5NCA4OS4yMDU1TDE2LjkxNzggODAuNTM2OUMxMC4xMyA3OS4zNDAxIDUuNTk3NjcgNzIuODY3MiA2Ljc5NDU0IDY2LjA3OTRMMTUuNDYzMSAxNi45MTc4QzE2LjY1OTkgMTAuMTMgMjMuMTMyOCA1LjU5NzY3IDI5LjkyMDYgNi43OTQ1NEw3OS4wODIyIDE1LjQ2MzFDODUuODcgMTYuNjU5OSA5MC40MDIzIDIzLjEzMjggODkuMjA1NSAyOS45MjA2TDgwLjUzNjkgNzkuMDgyMloiIGZpbGw9IiNGRkYiLz4KCjxwYXRoIGQ9Ik03Ny4xMTk0IDM4LjE2NjRDNzguMDI2MSAzNS42NzUzIDc2Ljc0MTcgMzIuOTIwOSA3NC4yNTA2IDMyLjAxNDJMMzguMTY2NCAxOC44ODA2QzM1LjY3NTMgMTcuOTczOSAzMi45MjA4IDE5LjI1ODMgMzIuMDE0MiAyMS43NDk0TDE4Ljg4MDYgNTcuODMzNkMxNy45NzM5IDYwLjMyNDcgMTkuMjU4MyA2My4wNzkyIDIxLjc0OTQgNjMuOTg1OEw1Ny44MzM2IDc3LjExOTRDNjAuMzI0NyA3OC4wMjYxIDYzLjA3OTEgNzYuNzQxNyA2My45ODU4IDc0LjI1MDZMNzcuMTE5NCAzOC4xNjY0Wk02OS4zOTg1IDc2LjIyMDZDNjcuNDAzOCA4MS43MDEgNjEuMzQ0IDg0LjUyNjcgNTUuODYzNiA4Mi41MzJMMTkuNzc5NCA2OS4zOTg1QzE0LjI5OSA2Ny40MDM4IDExLjQ3MzIgNjEuMzQ0IDEzLjQ2OCA1NS44NjM2TDI2LjYwMTUgMTkuNzc5NEMyOC41OTYyIDE0LjI5OSAzNC42NTYgMTEuNDczMyA0MC4xMzY0IDEzLjQ2OEw3Ni4yMjA2IDI2LjYwMTVDODEuNzAxIDI4LjU5NjIgODQuNTI2NyAzNC42NTYgODIuNTMyIDQwLjEzNjRMNjkuMzk4NSA3Ni4yMjA2WiIgZmlsbD0iI0ZGRiIvPgoKPHBhdGggZD0iTTY4Ljg1MzUgNDQuNTIwNkM2OS42NDg4IDQzLjE0MzEgNjkuMTc2OSA0MS4zODE4IDY3Ljc5OTQgNDAuNTg2NUw0NC41MjA2IDI3LjE0NjVDNDMuMTQzMSAyNi4zNTEyIDQxLjM4MTcgMjYuODIzMSA0MC41ODY1IDI4LjIwMDZMMjcuMTQ2NSA1MS40Nzk0QzI2LjM1MTIgNTIuODU2OSAyNi44MjMxIDU0LjYxODIgMjguMjAwNiA1NS40MTM1TDUxLjQ3OTQgNjguODUzNUM1Mi44NTY5IDY5LjY0ODggNTQuNjE4MiA2OS4xNzY5IDU1LjQxMzUgNjcuNzk5NEw2OC44NTM1IDQ0LjUyMDZaTTYwLjQwMTggNzAuNjc5NEM1OC4wMTYgNzQuODExOCA1Mi43MzE4IDc2LjIyNzcgNDguNTk5NCA3My44NDE4TDI1LjMyMDYgNjAuNDAxOEMyMS4xODgyIDU4LjAxNiAxOS43NzIzIDUyLjczMTggMjIuMTU4MiA0OC41OTk0TDM1LjU5ODIgMjUuMzIwNkMzNy45ODQgMjEuMTg4MiA0My4yNjgyIDE5Ljc3MjMgNDcuNDAwNiAyMi4xNTgyTDcwLjY3OTQgMzUuNTk4MkM3NC44MTE4IDM3Ljk4NCA3Ni4yMjc3IDQzLjI2ODIgNzMuODQxOCA0Ny40MDA2TDYwLjQwMTggNzAuNjc5NFoiIGZpbGw9IiNGRkYiLz4KCjwvc3ZnPgo="},27768:(e,t,s)=>{"use strict";s.d(t,{A:()=>r,S:()=>a});var i=s(50523);const a=(0,i.VP)("stack/setName"),r=(0,i.vy)({name:""},e=>e.addCase(a,(e,t)=>{e.name=t.payload}))},28431:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(56563),a=s(86155),r=s.n(a),n=s(57822);s(50766);class o extends(r()){constructor(e){super(e),this.db=new n.A(e.dbName)}async log(e,t){queueMicrotask(()=>{this.emit("logged",e)});const s=await this.db.post({type:"log",log:e});s.ok||console.log("pouchdb-transport - failed to push to pouchdb",s),t()}}const c=o,l=(e="log")=>(0,i.createLogger)({transports:[new c({dbName:e}),new i.transports.Console]})},31297:(e,t,s)=>{"use strict";e.exports=s.p+"4f59e8c4dca34ac26cc2.jpg"},35295:()=>{},38913:(e,t,s)=>{"use strict";s.d(t,{A:()=>H});var i=s(31085),a=s(43705);const r=()=>(0,a.wA)(),n=a.d4;var o=s(18690),c=s(98870),l=s(14041),d=s(43820),u=s(50523),g=s(19928);const M=(0,u.zD)("testRequest",async(e,t)=>await(async()=>{var e="same-origin";return console.log("doTestRequest - credentialsConfig",e),(await fetch("http://localhost:5000/api/test",{method:"GET",mode:"cors",credentials:e,headers:{"Content-Type":"application/json"}})).json()})()),h=(0,u.zD)("saveState",async(e,t)=>{const s=t.getState();console.log("saveStateAction - Got state",s),await(0,g.LZ)(s)});(0,u.vy)({test:"test"},e=>{e.addCase(M.fulfilled,(e,t)=>{console.log(t.payload)}).addCase(h.fulfilled,(e,t)=>{})});var y=s(27768);const m=()=>{const e=r(),[t,a]=l.useState("browser"),n=(0,l.useCallback)(s=>{if("server"!=t)throw new Error("Unexpected form data for anonymous login");e((0,d.iD)(s)),e((0,y.S)("client-test"))},[e,t]),o=l.useCallback(s=>{if("browser"!=t||!s.stackName)throw new Error("should have run credentials form submit");e((0,y.S)(s.stackName)),e((0,d.lp)())},[e,t]),u=((0,l.useCallback)(()=>{e(h(!0))},[e]),l.useCallback(e=>{a("browser"!=e&&e?"server":"browser")},[a])),g=l.useMemo(()=>"server"===t?(0,i.jsxs)(c.Form,{name:"login-form",submit:(0,i.jsx)(c.Button,{type:"primary",children:"Login"}),onSubmit:n,children:[(0,i.jsx)(c.TextInput,{htmlType:"text",name:"username",label:"Username",placeholder:"a.username"}),(0,i.jsx)(c.TextInput,{htmlType:"password",name:"password",label:"Password",placeholder:"a.password"}),(0,i.jsx)(c.TextInput,{htmlType:"text",name:"serverURL",label:"Server URL",placeholder:"http://localhost:5000"})]}):(0,i.jsx)(c.Form,{name:"login-form",submit:(0,i.jsx)(c.Button,{type:"primary",children:"Login"}),onSubmit:o,children:(0,i.jsx)(c.TextInput,{htmlType:"text",name:"stackName",label:"Stack",value:"client-test",placeholder:"a.k.a. database name"})}),[t,n]);return(0,i.jsxs)("div",{className:"view-auth",children:[(0,i.jsx)("div",{className:"view-auth-hero",children:(0,i.jsx)("div",{className:"view-auth-hero-fill",style:{backgroundImage:`url("${s(31297)}")`},children:(0,i.jsx)(c.ActionBar,{items:[{item:(0,i.jsx)("div",{style:{height:"40px",width:"40px",background:`url("${s(21592)}")`,backgroundSize:"contain"}}),key:"nav-logo",position:"left"}]})})}),(0,i.jsx)("div",{className:"view-auth-content",children:(0,i.jsx)(c.Card,{style:{width:"fit-content",height:"fit-content"},orientation:"vertical",padding:"m",borderRadius:"md",headerClass:"view-auth-content-head",header:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.ActionBar,{items:[{item:(0,i.jsx)("div",{className:"app-title",style:{height:"40px",width:"150px",background:`url("${s(43223)}")`,backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}}),position:"center",key:"logo-type"}]}),(0,i.jsx)(c.ActionBar,{items:[{item:(0,i.jsx)("h1",{children:"Login"}),key:"login",position:"center"}]})]}),footer:(0,i.jsx)(c.ActionBar,{items:[{position:"left",key:"target-selector",item:(0,i.jsx)(c.Select,{placeholder:"Target",options:[{value:"server",element:"Server",selected:"server"==t},{value:"browser",element:"Browser",selected:"browser"==t}],onChange:e=>u(e),multiple:!1})}]}),children:g})})]})};var N=s(87271);const j=(0,l.createContext)(null),D=e=>{const{config:t,children:s}=e,a=l.useRef(null),[r,n]=(0,l.useState)(null),o=l.useCallback(()=>{n(a.current)},[]);return(0,l.useEffect)(()=>{if(null===a.current&&t.length){console.log("DocStack provider - init instance",{config:t});const e=new N.jg(...t);a.current=e,a.current.addEventListener("ready",o)}return()=>{a.current}},[t,o]),(0,i.jsx)(j.Provider,{value:r,children:s})},I=(e,t)=>{const s=l.useContext(j),[i,a]=l.useState(!1),[r,n]=l.useState(),[o,c]=l.useState(),d=l.useRef(!1);return l.useEffect(()=>s?(d.current||(d.current=!0,a(!0),(async()=>{try{const i=s.getStack(e);if(i){const e=await i.getClass(t);e&&c(e)}}catch(e){n(e)}finally{a(!1)}})()),()=>{}):(console.error("useClass must be used within a DocStackProvider."),void a(!1)),[s,e,t]),{loading:i,error:r,classObj:o}};var p=s(73657);const A={none:"chip-radius-none",xs:"chip-radius-xs",sm:"chip-radius-sm",md:"chip-radius-md",lg:"chip-radius-lg",xl:"chip-radius-xl",full:"chip-radius-full"},f=e=>{const{borderRadius:t="md",variant:s="default",onClick:a,icon:r,children:n}=e,o=A[t]||A.md;return(0,i.jsxs)("span",{className:`chip chip-${s} ${o}`,onClick:a,role:"button",children:[r&&(0,i.jsx)("span",{className:"chip-icon",children:r}),n]})},z=e=>{const{conf:t}=e;return(0,i.jsx)("div",{className:"attr-conf-chips",children:Object.entries(t).map(e=>(0,i.jsx)(f,{children:`${e[0]}: ${e[1]}`}))})},w=e=>{const{name:t,description:s,attributes:a}=e,r=l.useMemo(()=>{let e={};return null==a||a.forEach(t=>{console.log("attribute model",{model:t.model});let s=Object.assign({},t.model);s.config=(0,i.jsx)(z,{conf:t.model.config}),e[t.name]=s}),e},[a]);return(0,i.jsx)(c.Card,{className:"class-card",children:(0,i.jsxs)(c.Accordion,{className:"class-card",header:(0,i.jsx)(c.ActionBar,{className:"dashboard-class-header",items:[{position:"left",key:"class-title",item:(0,i.jsx)("h3",{children:t})},{position:"right",key:"class-link",item:(0,i.jsx)(p.N_,{to:`/class/${t}`,children:(0,i.jsx)(c.Button,{type:"primary",iconName:"chevron-right"})})}]}),children:[s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h4",{children:"Description"}),(0,i.jsx)("span",{children:s})]}):null,(0,i.jsx)("h4",{children:"Attributes"}),(0,i.jsx)(c.Table,{data:r})]})})},T=e=>{const{onComplete:t}=e,s=n(e=>e.stack.name),a=(e=>{const t=l.useContext(j);return l.useCallback(async(s,i)=>{try{if(!t)return console.error("useClassCreate must be used within a DocStackProvider."),Promise.resolve(null);const a=t.getStack(e);if(a){const e=await N.Xs.create(a,s,"class",i);return await a.addClass(e),e}return null}catch(e){return console.error(e),null}},[t,e])})(s),r=l.useCallback(e=>{a(e["class-name"],e["class-desc"]).then(e=>{console.log("ClassForm.onSubmit - result",e),e&&t&&t()})},[s,t]);return(0,i.jsxs)(c.Form,{onSubmit:r,children:[(0,i.jsx)(c.TextInput,{name:"class-name",id:"class-name",placeholder:"Movies",label:"Name"},"class-name"),(0,i.jsx)(c.TextInput,{name:"class-desc",id:"class-desc",placeholder:"A collection of 90's movies",label:"Description"},"class-desc")]})},x=()=>{const e=r(),t=n(e=>e.stack.name),{loading:s,error:a,classList:o}=((0,l.useCallback)(()=>{e((0,d.ri)(!0))},[e]),(0,l.useCallback)(()=>{e(h(!0))},[e]),(e=>{const t=l.useContext(j),[s,i]=l.useState(!1),[a,r]=l.useState(),[n,o]=l.useState([]),c=l.useRef(!1);return l.useEffect(()=>t?(c.current?console.log("Already performing query"):(c.current=!0,i(!0),(async()=>{try{const s=t.getStack(e);if(s){const e=await s.getAllClasses();e.length&&o(e)}}catch(e){r(e)}finally{i(!1)}})()),()=>{o([])}):(console.error("useClassList must be used within a DocStackProvider."),void i(!1)),[t,e]),{loading:s,classList:n,error:a}})(t)),{Modal:u,open:g,close:M}=(0,c.useModal)({areaId:"root"}),y=l.useMemo(()=>o.length?(0,i.jsx)(c.List,{header:(0,i.jsx)(c.ActionBar,{items:[{position:"right",key:"btn-class-creation-open",item:(0,i.jsx)(c.Button,{onClick:g,type:"primary",iconName:"plus",children:"New class"})}]}),view:"list",pageSize:5,showPageCtrl:!0,type:"raw",children:o.map(e=>(0,i.jsx)(w,{name:e.name,description:e.description,attributes:Object.values(e.getAttributes())}))}):(0,i.jsx)("span",{children:"Loading"}),[s,o,a,g]);return(0,i.jsxs)("main",{className:"view-dashboard",children:[(0,i.jsx)(u,{title:"Create new class",footer:(0,i.jsx)(c.ActionBar,{items:[{position:"right",key:"btn-class-creation-close",item:(0,i.jsx)(c.Button,{type:"default",onClick:M,iconName:"close",children:"Cancel"})}]}),children:(0,i.jsx)(T,{onComplete:M})}),(0,i.jsx)(c.ActionBar,{items:[{item:(0,i.jsx)("h2",{children:"Classes"}),key:"body-title",position:"left"}]}),(0,i.jsx)("div",{className:"view-dash-classes-container",children:y})]})},k=e=>{const{classObj:t,closeModal:s,model:a,mode:r="read"}=e,{name:n,type:o,description:d,config:u}=a,g=l.useMemo(()=>{const e=[(0,i.jsx)(c.TextInput,{disabled:"read"===r,value:d,name:"description",label:"Description"},"description")],t=Object.entries(u).map((e,t)=>{switch(e[0]){case"encrypted":return(0,i.jsx)(c.Toggle,{disabled:"read"==r,name:"encrypted",checked:e[1],label:"Encrypted"},"encrypted");case"mandatory":return(0,i.jsx)(c.Toggle,{disabled:"read"==r,name:"mandatory",checked:e[1],label:"Mandatory"},"mandatory");case"primaryKey":return(0,i.jsx)(c.Toggle,{disabled:"read"==r,name:"primaryKey",checked:e[1],label:"Primary key"},"primaryKey");case"maxLength":return(0,i.jsx)(c.NumberInput,{disabled:"read"==r,name:"maxLength",value:e[1],label:"Max length"},"maxLength");case"max":return(0,i.jsx)(c.NumberInput,{disabled:"read"==r,name:"max",value:e[1],label:"Max"},"max");case"min":return(0,i.jsx)(c.NumberInput,{disabled:"read"==r,name:"min",value:e[1],label:"Min"},"min");case"precision":return(0,i.jsx)(c.NumberInput,{disabled:"read"==r,name:"min",value:e[1],label:"Precision"},"precision");default:return(0,i.jsx)(i.Fragment,{})}});return e.push(...t),e},[u,r]),M=l.useCallback(e=>{if(t){console.log("updateAttr",e);const i=e.description;delete e.description;const a=new N.nW(t,n,o,i,Object.assign({},e));t.modifyAttribute(n,a).then(e=>{}).finally(()=>{s&&s()})}},[s,r,n,o,t]);return(0,i.jsx)(c.Form,{style:{flex:1},onSubmit:"write"===r?M:void 0,children:g})},b=e=>{const{classObj:t,closeModal:s}=e,[a,r]=l.useState(!1),n=(()=>{const[e,t]=l.useState(),s=l.useCallback(e=>{t(e||void 0)},[]),a=l.useMemo(()=>(e=>{const t=[];switch(t.push((0,i.jsx)(c.TextInput,{gridPlacement:"1",id:"name",name:"name",label:"Name",required:!0,placeholder:"Attribute name"},"name")),t.push((0,i.jsx)(c.TextInput,{gridPlacement:"1",id:"description",name:"description",label:"Description",required:!0,placeholder:"Explain what it represent"},"description")),t.push((0,i.jsx)(c.Toggle,{gridPlacement:"2",id:"mandatory",name:"mandatory",checked:!1,label:"Mandatory"},"mandatory")),t.push((0,i.jsx)(c.Toggle,{gridPlacement:"2",id:"primaryKey",name:"primaryKey",checked:!1,label:"Primary key"},"primaryKey")),t.push((0,i.jsx)(c.Toggle,{gridPlacement:"2",id:"isArray",name:"isArray",checked:!1,label:"Array"},"isArray")),e){case"string":t.push((0,i.jsx)(c.NumberInput,{gridPlacement:"3",name:"maxLength",id:"maxLength",value:50,label:"Max length."},"maxLength")),t.push((0,i.jsx)(c.NumberInput,{gridPlacement:"3",name:"encrypted",id:"encrypted",value:50,label:"Encrypted"},"encrypted")),t.push((0,i.jsx)(c.TextInput,{gridPlacement:"3",name:"defaultValue",id:"defaultValue",placeholder:"",label:"Default value"},"defaultValue"));break;case"boolean":t.push((0,i.jsx)(c.Toggle,{gridPlacement:"3",name:"defaultValue",id:"defaultValue",checked:!1,label:"Default value"},"defaultValue"));break;case"integer":case"decimal":t.push((0,i.jsx)(c.NumberInput,{gridPlacement:"3",name:"max",id:"max",label:"Max value"},"max")),t.push((0,i.jsx)(c.NumberInput,{gridPlacement:"3",name:"min",id:"maxLength",label:"Min value"},"min")),t.push((0,i.jsx)(c.NumberInput,{gridPlacement:"3",name:"defaultValue",id:"defaultValue",label:"Default value"},"defaultValue"));break;default:(0,i.jsx)(i.Fragment,{})}return t})(e),[e]);return[(0,i.jsx)(c.Select,{gridPlacement:"1",required:!0,name:"type",id:"type",options:[{value:"string",element:"String"},{value:"boolean",element:"Boolean"},{value:"integer",element:"Integer"},{value:"decimal",element:"Decimal"},{value:"foreign_key",element:"Foreign key"}],placeholder:"Choose",label:"Attribute type",onChange:s}),...a]})(),o=l.useCallback(e=>{const i={};e.mandatory&&(i.mandatory=e.mandatory),e.primaryKey&&(i.primaryKey=e.primaryKey),e.isArray&&(i.isArray=e.isArray),e.defaultValue&&(i.defaultValue=e.defaultValue),e.encrypted&&(i.encrypted=e.encrypted),e.format&&(i.format=e.format),e.maxLength&&(i.maxLength=e.maxLength),e.max&&(i.max=e.max),e.min&&(i.min=e.min),e.precision&&(i.precision=e.precision),e.targetClass&&(i.targetClass=e.targetClass);const a=new N.nW(t,e.name,e.type,e.description,i);t.addAttribute(a).then(e=>{console.log("createAttribute - Result",{result:e})}).finally(()=>{r(!1),s&&s()}),r(!0)},[s,t]);return(0,i.jsx)(c.Form,{gridGap:"1rem 0.5rem",gridTemplate:{cols:"1fr 1fr 1fr"},onSubmit:o,children:n})},O=e=>{const{classObj:t,model:s}=e,{name:a,type:r,config:n}=l.useMemo(()=>s,[s]),[o,d]=l.useState("read"),u=l.useCallback(e=>{["read","write"].includes(e)&&d(e)},[d]),{Modal:g,open:M,close:h}=(0,c.useModal)({areaId:"root"}),{Modal:y,open:m,close:N}=(0,c.useModal)({areaId:"root"}),j=l.useCallback(()=>{console.log(`Deleting attribute '${a}'`),t.removeAttribute(a).then(e=>{console.log("delete attribute result in new classObj",{classObj:t}),N()})},[t,a]);return(0,i.jsxs)(c.Card,{className:"list-item-attribute",children:[(0,i.jsx)(g,{title:`Attribute: ${a}`,footer:(0,i.jsx)(c.ActionBar,{items:[{position:"right",key:"btn-del-attr",item:(0,i.jsx)(c.Button,{type:"default",onClick:h,iconName:"close",children:"Cancel"})},{item:(0,i.jsx)(c.Select,{placeholder:"Mode",options:[{value:"read",element:"View",selected:"read"==o},{value:"write",element:"Edit",selected:"read"!=o}],onChange:e=>u(e)}),position:"left",key:"mode-selector"},{position:"left",key:"btn-cancel-edit-attr",item:(0,i.jsx)(c.Button,{type:"primary",onClick:m,accent:"#f5474c",iconName:"trash",children:"Delete"})}]}),children:(0,i.jsx)(k,{classObj:t,closeModal:h,mode:o,model:s})}),(0,i.jsx)(y,{title:"Confirmation",footer:(0,i.jsx)(c.ActionBar,{items:[{position:"right",key:"btn-cancel-del",item:(0,i.jsx)(c.Button,{onClick:N,type:"primary",iconName:"close",children:"Cancel"})},{position:"right",key:"btn-confirm-del",item:(0,i.jsx)(c.Button,{onClick:j,iconName:"check",children:"Confirm"})}]}),children:"Do you wish to delete this attribute?"}),(0,i.jsxs)(c.Accordion,{header:(0,i.jsx)(c.ActionBar,{items:[{position:"left",key:"label-attr",item:(0,i.jsx)("span",{children:a})},{position:"right",key:"btn-edit-attr",item:(0,i.jsx)(c.Button,{onClick:M,className:"btn-edit-attr",iconName:"external-link",type:"primary"})},{position:"right",key:"btn-del-attr",item:(0,i.jsx)(c.Button,{onClick:m,accent:"#f5474c",className:"btn-del-attr",iconName:"trash",type:"text"})}]}),children:[(0,i.jsx)("span",{children:r}),(0,i.jsx)(k,{model:s})]})]})};var C=s(44358);s(45649),s(35921),s(54193),s(36121),s(99885),s(49745),s(34878);const L=e=>{const{closeModal:t}=e,[s,a]=l.useState(!1),r=l.useRef(),n=l.useRef(),o=l.useCallback(e=>{r.current||e&&(r.current=e,a(!0))},[]),d=l.useCallback(e=>{var s;const i=null===(s=n.current)||void 0===s?void 0:s.getValue();console.log("Create trigger",{data:e,content:i}),t&&t()},[]),u=l.useCallback(e=>!!new RegExp(/^[A-Za-z]*$/gm).test(e)||"Must be without spaces, no special characters and cannot start with a number.",[]);return l.useEffect(()=>{s&&r.current&&(n.current=C.editor.create(r.current,{value:'document["startDate"] = Date.now();\nreturn document;',language:"javascript",automaticLayout:!0}))},[s]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(c.Form,{gridGap:"1rem 0.5rem",gridTemplate:{cols:"1fr"},onSubmit:d,children:[(0,i.jsx)(c.TextInput,{gridPlacement:{row:"1"},required:!0,name:"name",id:"name",validator:u,placeholder:"AutoProperty",label:"Name"}),(0,i.jsx)(c.Select,{gridPlacement:{row:"2"},required:!0,name:"order",id:"order",options:[{value:"before",element:"BEFORE",selected:!0},{value:"after",element:"AFTER"}],label:"Execution order"})]}),(0,i.jsx)("div",{style:{minWidth:"30rem",minHeight:"10rem"},ref:o})]})};var S=s(76352),E=s(93558),v=s(15979),Y=s(835),Q=s(70801),U=s(26026);const P=({diagramCode:e})=>{const t=`\n\`\`\`mermaid\n${e}\n\`\`\`\n`,[s,a]=(0,l.useState)(null);return l.useEffect(()=>{(0,S.a)({children:t,remarkPlugins:[E.A,v.A],rehypePlugins:[Y.A,Q.A,U.A]}).then(e=>{a(e)})},[t]),(0,i.jsx)("div",{style:{padding:"20px",textAlign:"center"},children:s})},Z=e=>{const{classModel:t}=e,s=(0,l.useMemo)(()=>((...e)=>{let t="erDiagram\n\n";const s=[];return e.forEach(e=>{const i=e.name;t+=`    ${i} {\n`,Object.values(e.schema).forEach(e=>{if(["active","_id","type","createTimestamp","updateTimestamp","description"].includes(e.name))return;let a=e.type;e.config.isArray&&(a+="[]");let r="";if(e.config.primaryKey&&(r="PK"),t+=`        ${a} ${e.name} ${r}\n`,"foreign_key"===e.type){const t=e.config.targetClass||i+"Target",a=`    ${i} }|--|| ${t} : "${e.name}"\n`;i!==t&&s.push(a)}}),t+="    }\n\n"}),t+=s.join(""),t})(t),[t]);return(0,i.jsx)("div",{className:"erp-container",children:(0,i.jsx)(P,{diagramCode:s})})},$=e=>{const{classObj:t}=e,{name:s,description:a,type:r}=t,n=l.useMemo(()=>t.buildSchema(),[t]),o=l.useMemo(()=>n?(console.log("attributePanels",{schema:n}),Object.values(n).map((e,s)=>(0,i.jsx)(O,{classObj:t,model:e},s))):[],[t,n]),{Modal:d,open:u,close:g}=(0,c.useModal)({areaId:"root"}),{Modal:M,open:h,close:y}=(0,c.useModal)({areaId:"root"}),m=l.useCallback(()=>{window.open("https://onyx-og.github.io/docstack/docs","_blank")},[]);return(0,i.jsxs)("section",{style:{padding:"2rem 1rem"},className:"panel-class-model",children:[(0,i.jsx)(d,{title:"New attribute",footer:(0,i.jsx)(c.ActionBar,{items:[{position:"left",key:"btn-attr-creation-close",item:(0,i.jsx)(c.Button,{type:"default",onClick:g,iconName:"close",children:"Cancel"})}]}),children:(0,i.jsx)(b,{classObj:t,closeModal:g})}),(0,i.jsx)(M,{title:"New trigger",footer:(0,i.jsx)(c.ActionBar,{items:[{position:"left",key:"btn-trigg-creation-close",item:(0,i.jsx)(c.Button,{type:"default",onClick:y,iconName:"close",children:"Cancel"})},{position:"right",key:"btn-trigg-creation-help",item:(0,i.jsx)(c.Button,{type:"primary",onClick:m,iconName:"question"})}]}),children:(0,i.jsx)(L,{closeModal:y})}),(0,i.jsxs)("div",{className:"panel-class-model-info",children:[(0,i.jsx)(c.Text,{type:"heading",level:2,children:s}),(0,i.jsx)(c.Text,{type:"body",children:a}),(0,i.jsx)(c.Text,{type:"body",children:r}),(0,i.jsx)(Z,{classModel:t.model})]}),(0,i.jsxs)("div",{className:"panel-class-model-list",children:[(0,i.jsx)(c.List,{header:(0,i.jsx)(c.ActionBar,{items:[{position:"left",key:"list-title-attr",item:(0,i.jsx)("h3",{children:"Attributes"})},{position:"right",key:"btn-add-attr",item:(0,i.jsx)(c.Button,{type:"primary",onClick:u,iconName:"plus",children:"New attribute"})}]}),type:"raw",view:"list",children:o}),(0,i.jsxs)(c.List,{header:(0,i.jsx)(c.ActionBar,{items:[{position:"left",key:"list-title-trigg",item:(0,i.jsx)("h3",{children:"Triggers"})},{position:"right",key:"btn-add-trigg",item:(0,i.jsx)(c.Button,{type:"primary",onClick:h,iconName:"plus",children:"New trigger"})}]}),type:"raw",view:"list",children:[(0,i.jsx)("div",{children:"Placeholder"}),(0,i.jsx)("div",{children:"Such empty"})]})]})]})},B=l.forwardRef((e,t)=>{const{name:s,type:a,config:r,value:n,defaultMode:o="read",allowToggleMode:d=!1}=e,[u,g]=l.useState(o),M=l.useCallback(()=>{g("read"==u?"write":"read")},[u]),h=l.useMemo(()=>{if(d)return(0,i.jsx)(c.Button,{onClick:M,iconName:"write"==u?"eye":"pencil",type:"text"})},[u,d]);switch(a){case"string":return(0,i.jsx)(c.TextInput,{required:r.mandatory,ref:t,after:h,type:"default",htmlType:"text",disabled:"read"==u,name:s,label:s,value:n},s);case"boolean":return(0,i.jsx)(c.Toggle,{type:"switch",name:s,label:s,checked:n});default:throw new Error(`Unexpected attribute field type '${a}'`)}}),R=e=>{const{model:t,mode:s="read",doc:a,onSubmission:r}=e,{schema:o=[],name:d}=t,[u,g]=l.useState(s),M=n(e=>e.stack.name),h=l.useCallback(e=>{["read","read/write"].includes(e)&&g(e)},[]),{Modal:y,open:m,close:N}=(0,c.useModal)({areaId:"root"}),{loading:j,error:D,classObj:p}=I(M,t.name),A=l.useCallback(e=>{p&&(console.log(`submitDoc - id: ${null==a?void 0:a._id}`),p.addOrUpdateCard(e,null==a?void 0:a._id)),r&&r(e)},[a,p,r]),f=l.useMemo(()=>{let e=[];for(const t of Object.values(o))e.push((0,l.createElement)(B,Object.assign({defaultMode:"read/write"!=u?u:"write",allowToggleMode:"read/write"==u},t,{value:null==a?void 0:a[t.name],key:t.name})));return e},[o,a,u]),z=l.useCallback(()=>{if(!p||!a)throw p?new Error("Missing document to delete"):new Error("Missing class instance. Check logs");p.deleteCard(a._id).then(e=>{e&&r&&r({deleted:!0})})},[a,p,r]),w=l.useMemo(()=>{const e=[];return a&&e.push({position:"left",key:"btn-doc-del",item:(0,i.jsx)(c.Button,{iconName:"trash",type:"primary",onClick:m})}),e.push({item:(0,i.jsx)(c.Select,{placeholder:"Mode",options:[{value:"read",element:"View",selected:"read"==u},{value:"read/write",element:"Edit",selected:"read"!=u}],onChange:e=>h(e)}),position:"left",key:"mode-selector"}),e},[a,u,m]);return(0,i.jsxs)("div",{children:[(0,i.jsx)(y,{title:"Confirmation",footer:(0,i.jsx)(c.ActionBar,{items:[{position:"right",key:"btn-cancel-del",item:(0,i.jsx)(c.Button,{onClick:N,type:"primary",iconName:"close",children:"Cancel"})},{position:"right",key:"btn-confirm-del",item:(0,i.jsx)(c.Button,{onClick:z,iconName:"check",children:"Confirm"})}]}),children:"Do you wish to delete this document?"}),(0,i.jsx)(c.Form,{className:"form-class-doc",onSubmit:A,children:f}),(0,i.jsx)(c.ActionBar,{items:w})]})},G=e=>{const{className:t,model:s}=e,a=n(e=>e.stack.name),{loading:r,error:o,docs:d}=((e,t,s={})=>{const i=l.useContext(j),[a,r]=l.useState(),[n,o]=l.useState([]),c=l.useRef([]),[d,u]=l.useState(!0),[g,M]=l.useState(null);return l.useEffect(()=>{if(i&&t)return(async()=>{u(!0),M(null);try{const s=i.getStack(e);if(s){const e=await s.getClass(t);e&&r(e)}}catch(e){M(e),u(!1)}})(),()=>{};u(!1)},[i,e,t]),l.useEffect(()=>{a&&(async()=>{u(!0);try{const e=await a.getCards(s);c.current=e,o(c.current)}catch(e){M(e)}finally{u(!1)}a.addEventListener("doc",e=>{const t=e.detail.doc;if(console.log("useClassDocs - detail",{detail:e.detail}),t.active){console.log("useClassDocs - a doc was changed or added",{doc:t});const e=c.current.findIndex(e=>e._id==t._id);-1!=e?(console.log("useClassDocs - a doc was changed",{doc:t}),c.current=[...c.current.slice(0,e),t,...c.current.slice(e+1,c.current.length)]):(console.log("useClassDocs - a doc was added",{doc:t}),c.current.push(t))}else{console.log("useClassDocs - a doc was deleted",{doc:t});const e=c.current.findIndex(e=>e._id==t._id);-1!=e&&(c.current=[...c.current.slice(0,e),...c.current.slice(e+1,c.current.length)])}o([...c.current])})})()},[a,JSON.stringify(s)]),{docs:n,loading:d,error:g}})(a,t),[u,g]=l.useState("view"),{Modal:M,open:h,close:y}=(0,c.useModal)({areaId:"root"}),[m,N]=l.useState(),D=l.useCallback(e=>{["view","edit"].includes(e)&&g(e)},[]),I=l.useMemo(()=>{let e=[],t={};return d.length?e.push(...d):s&&(Object.values(s.schema).forEach(e=>{t[e.name]=void 0}),e.push(t)),e},[s,d]),p=l.useCallback(e=>{const t=I[e];N(t),h()},[I]),A=l.useCallback(()=>{N(void 0),h()},[I]),f=l.useCallback(e=>{const{data:t,coords:s,mode:a}=e,r=`${s?s.concat():null}`,n=`doc-cell mode-${u}`;return(0,i.jsx)("td",{onClick:()=>{"edit"==u&&p(Number(s[0]))},className:n,onDoubleClick:()=>{"view"==u&&p(Number(s[0]))},children:null==t?void 0:t.toString()},r)},[u,p]),z=l.useMemo(()=>{if(I&&I.length)return(0,i.jsx)(c.Table,{cellRenderer:f,data:[...I]})},[I,f]);return(0,i.jsxs)("section",{style:{padding:"2rem 1rem"},children:[(0,i.jsx)(c.ActionBar,{items:[{position:"left",key:"target-selector",item:(0,i.jsx)(c.Select,{placeholder:"Mode",options:[{value:"view",element:"View",selected:"view"==u},{value:"edit",element:"Edit",selected:"edit"==u}],onChange:e=>D(e)})},{position:"right",key:"btn-add-doc",item:(0,i.jsx)(c.Button,{type:"primary",onClick:A,iconName:"plus-square"})}]}),(0,i.jsx)(M,{title:"Document",children:(null==s?void 0:s.schema)?(0,i.jsx)(R,{doc:m,mode:"edit"==u?"read/write":"read",model:s,onSubmission:y}):(0,i.jsx)("span",{children:"Check logs"})}),z]})},V=()=>{const{className:e}=(0,o.g)(),t=n(e=>e.stack.name),{loading:s,error:a,classObj:r}=I(t,e),d=l.useCallback(async()=>{if(r&&"User"==r.name){const e=await r.validate({username:"test",password:"test"});console.log("validationTest - result",e)}},[s,a]);l.useEffect(()=>{r&&d()},[d]);const[u,g]=l.useState("model"),M=l.useMemo(()=>{if("model"!=u){if("docs"==u)return(0,i.jsx)(G,{className:e,model:null==r?void 0:r.getModel()});throw new Error(`Unexpected panel value "${u}"`)}return r?(0,i.jsx)($,{classObj:r}):s?(0,i.jsx)("span",{children:"Loading"}):a?(0,i.jsx)("span",{children:a}):void 0},[s,a,r,u]);return(0,i.jsxs)("main",{className:"view-class",children:[(0,i.jsx)(c.Tabs,{onChange:g,tabsClass:"view-class-tabs-header",data:[{name:"model",label:"Model"},{name:"docs",label:"Documents"}]}),M]})},W=({jsonData:e,fileName:t,buttonLabel:s})=>{const[a,r]=(0,l.useState)(null),[n,o]=(0,l.useState)(!0),d=(0,l.useCallback)(()=>{o(!0);try{const t=JSON.stringify(e,null,2),s=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(s);r(i)}catch(e){console.error("Error generating JSON Blob:",e),r(null)}finally{o(!1)}},[e]);return(0,l.useEffect)(()=>(e&&d(),()=>{a&&(URL.revokeObjectURL(a),r(null))}),[e,d]),(0,i.jsx)(c.Button,{disabled:n||!a,onClick:e=>{a||e.preventDefault()},children:(0,i.jsxs)("a",{href:a||"#",download:`${t}-${(new Date).getUTCMilliseconds()}`,role:"button",style:{textDecoration:"none"},children:[n?"Preparing File...":s," "]})})},F=()=>{const e=(0,l.useContext)(j),t=(0,o.Zp)(),s=n(e=>e.stack.name),a=(0,l.useCallback)(()=>{if(!e)throw new Error("reset must be used whithin DockStackProvider");e.reset(),t("/"),t(0)},[]),[r,d]=(0,l.useState)(null),u=(0,l.useCallback)(async()=>{if(!e)throw new Error("Create dump must be used whithin DockStackProvider");const t=await e.export(s);d(t)},[s]),g=(0,l.useCallback)(async()=>{if(!e)throw new Error("Restore dump must be used whithin DockStackProvider")},[s]);return(0,i.jsx)("div",{children:(0,i.jsx)(c.ActionBar,{items:[{item:(0,i.jsx)(c.Button,{type:"primary",onClick:g,children:"Restore"}),key:"restore",position:"left"},{item:(0,i.jsx)(c.Button,{type:"primary",onClick:a,children:"Reset"}),key:"reset",position:"left"},{item:(0,i.jsx)(c.Button,{type:"primary",onClick:u,children:"Create Dump"}),key:"dump",position:"left"},{item:(0,i.jsx)(W,{fileName:"dump",buttonLabel:"Download",jsonData:r}),key:"export",position:"left"}]})})},K=e=>{const{children:t}=e;return(0,i.jsx)("div",{className:"status-bar",children:t})};s(94093);const _=()=>{const e=n(e=>e.auth.isAuthenticated),t=(n(e=>e.auth.isAnonymous),(0,o.Zp)()),a=r(),u=(0,o.zy)(),{Modal:g,state:M,open:h}=(0,c.useModal)({areaId:"root"}),y=l.useCallback(()=>{if(!e)throw new Error("Must be authenticated to logout");a((0,d.ri)(!0))},[a]),m=l.useCallback(()=>{t(-1)},[t]),N=l.useMemo(()=>{let e=[];return"/"==u.pathname?e.push({item:(0,i.jsx)("div",{style:{height:"40px",width:"40px",background:`url("${s(79334)}")`,backgroundSize:"contain"}}),key:"nav-logo",position:"left"}):e.push({item:(0,i.jsx)(c.Button,{type:"text",onClick:m,shape:"circle",iconName:"chevron-left"}),key:"btn-back",position:"left"}),e.push({item:(0,i.jsx)("div",{className:"app-title",style:{height:"40px",width:"150px",background:`url("${s(43223)}")`,backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}}),key:"dashboard-title",position:"left"},{item:(0,i.jsx)(c.Button,{type:"text",iconName:"bug",onClick:h}),key:"btn-bug",position:"right"},{item:(0,i.jsx)(c.Button,{type:"primary",iconName:"sign-out",onClick:y}),key:"btn-logout",position:"right"}),e},[h,y,u]);return(0,i.jsxs)(c.Header,{className:"app-header",style:{borderBottom:"var(--color-primary) solid .1rem"},children:[(0,i.jsx)(g,{title:"Debug Panel",children:(0,i.jsx)(F,{})}),(0,i.jsx)(c.ActionBar,{items:N})]})},J=()=>{var e,t,s;const a=(0,l.useContext)(j),r=n(e=>e.stack.name),{Modal:o,open:d}=(0,c.useModal)({areaId:"root"});return(0,i.jsxs)(K,{children:[(0,i.jsx)(o,{title:"Changelog",children:(0,i.jsx)("p",{children:null===(e=null==a?void 0:a.getStack(r))||void 0===e?void 0:e.patches.map(e=>e.changelog)})}),(0,i.jsx)(c.Marquee,{children:`Stack: ${r}`}),(0,i.jsx)(c.Marquee,{children:`Version: ${null===(t=null==a?void 0:a.getStack(r))||void 0===t?void 0:t.appVersion}`}),(0,i.jsx)(c.Marquee,{onClick:d,children:`Schema version: ${null===(s=null==a?void 0:a.getStack(r))||void 0===s?void 0:s.schemaVersion}`}),(0,i.jsx)(c.Marquee,{speed:.7,children:"Trigger definition and storing is currently in development...         Class deletion is next step in the roadmap..."})]})},H=()=>{const e=n(e=>e.auth.isAuthenticated),t=n(e=>e.auth.isAnonymous),s=(0,o.Zp)(),a=n(e=>e.stack.name),r=(0,o.zy)();l.useEffect(()=>{s(e||t?"/":"/login")},[e,t]);const c=l.useMemo(()=>e||t?(0,i.jsx)(_,{}):null,[e,t,r]),d=l.useMemo(()=>e||t?(0,i.jsx)(J,{}):null,[e,t,r]);return(0,i.jsxs)(D,{config:a?[a]:[],children:[c,(0,i.jsxs)(o.BV,{children:[(0,i.jsx)(o.qh,{path:"/",element:(0,i.jsx)(x,{})}),(0,i.jsx)(o.qh,{path:"/login",element:(0,i.jsx)(m,{})}),(0,i.jsx)(o.qh,{path:"/class/:className",element:(0,i.jsx)(V,{})})]}),d]})}},43223:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9Ijg5IiB2aWV3Qm94PSIwIDAgNjQwIDg5IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNNjIzLjY4MSA4Ny4yOTZMNTgwLjI4MSA0Mi40MDhMNjIyLjgxMyAxLjIzOTk5SDYzNy45NDFMNTkyLjA2MSA0NS4zODRWMzguOTM2TDYzOS4xODEgODcuMjk2SDYyMy42ODFaTTU3MC40ODUgODcuMjk2VjEuMjM5OTlINTgyLjE0MVY4Ny4yOTZINTcwLjQ4NVoiIGZpbGw9IiM2MjAwRUUiLz4KPHBhdGggZD0iTTUyNC4xNzQgODguNTM2QzUxNy45NzQgODguNTM2IDUxMi4yMjkgODcuNDIgNTA2LjkzOCA4NS4xODhDNTAxLjY0NyA4Mi44NzMzIDQ5Ny4wMTggNzkuNjkwNiA0OTMuMDUgNzUuNjRDNDg5LjE2NSA3MS41ODkzIDQ4Ni4xNDcgNjYuODc3MyA0ODMuOTk4IDYxLjUwNEM0ODEuODQ5IDU2LjEzMDYgNDgwLjc3NCA1MC4zODUzIDQ4MC43NzQgNDQuMjY4QzQ4MC43NzQgMzguMDY4IDQ4MS44NDkgMzIuMjgxMyA0ODMuOTk4IDI2LjkwOEM0ODYuMTQ3IDIxLjUzNDYgNDg5LjE2NSAxNi44NjQgNDkzLjA1IDEyLjg5NkM0OTcuMDE4IDguODQ1MyA1MDEuNjA2IDUuNzAzOTcgNTA2LjgxNCAzLjQ3MTk3QzUxMi4xMDUgMS4xNTczIDUxNy44NSAtMy4wNTE3NmUtMDUgNTI0LjA1IC0zLjA1MTc2ZS0wNUM1MzAuODI5IC0zLjA1MTc2ZS0wNSA1MzYuNzgxIDEuMTU3MyA1NDEuOTA2IDMuNDcxOTdDNTQ3LjAzMSA1Ljc4NjY0IDU1MS41NzggOC45Mjc5NyA1NTUuNTQ2IDEyLjg5Nkw1NDcuNDg2IDIwLjk1NkM1NDQuNzU4IDE3Ljg5NzMgNTQxLjQxIDE1LjUgNTM3LjQ0MiAxMy43NjRDNTMzLjU1NyAxMi4wMjggNTI5LjA5MyAxMS4xNiA1MjQuMDUgMTEuMTZDNTE5LjUwMyAxMS4xNiA1MTUuMzI5IDExLjk4NjYgNTExLjUyNiAxMy42NEM1MDcuNzIzIDE1LjIxMDYgNTA0LjQxNyAxNy40ODQgNTAxLjYwNiAyMC40NkM0OTguNzk1IDIzLjQzNiA0OTYuNjA1IDI2Ljk0OTMgNDk1LjAzNCAzMUM0OTMuNTQ2IDM1LjA1MDYgNDkyLjgwMiAzOS40NzMzIDQ5Mi44MDIgNDQuMjY4QzQ5Mi44MDIgNDkuMDYyNiA0OTMuNTQ2IDUzLjQ4NTMgNDk1LjAzNCA1Ny41MzZDNDk2LjYwNSA2MS41ODY2IDQ5OC43OTUgNjUuMSA1MDEuNjA2IDY4LjA3NkM1MDQuNDE3IDcxLjA1MiA1MDcuNzIzIDczLjM2NjYgNTExLjUyNiA3NS4wMkM1MTUuMzI5IDc2LjU5MDYgNTE5LjUwMyA3Ny4zNzYgNTI0LjA1IDc3LjM3NkM1MjkuNDIzIDc3LjM3NiA1MzQuMDk0IDc2LjUwOCA1MzguMDYyIDc0Ljc3MkM1NDIuMDMgNzIuOTUzMyA1NDUuMzc4IDcwLjUxNDYgNTQ4LjEwNiA2Ny40NTZMNTU2LjE2NiA3NS4zOTJDNTUyLjE5OCA3OS41MjUzIDU0Ny41MjcgODIuNzQ5MyA1NDIuMTU0IDg1LjA2NEM1MzYuODYzIDg3LjM3ODYgNTMwLjg3IDg4LjUzNiA1MjQuMTc0IDg4LjUzNloiIGZpbGw9IiM2MjAwRUUiLz4KPHBhdGggZD0iTTM5OC44NjggODcuMjk2TDQzNC4wODQgMS4yMzk5OUg0NDIuNTE2TDQ3Ny42MDggODcuMjk2SDQ2NC45Nkw0MzYuMDY4IDE0LjUwOEg0NDAuNDA4TDQxMS4yNjggODcuMjk2SDM5OC44NjhaTTQxNS42MDggNjcuODI4VjU3LjY2SDQ2MC44NjhWNjcuODI4SDQxNS42MDhaIiBmaWxsPSIjNjIwMEVFIi8+CjxwYXRoIGQ9Ik0zNjMuMTAyIDg3LjI5NlYzLjcxOTk5SDM3NC43NThWODcuMjk2SDM2My4xMDJaTTMzMy44MzggMTEuOTA0VjEuMjM5OTlINDAzLjg5OFYxMS45MDRIMzMzLjgzOFoiIGZpbGw9IiM2MjAwRUUiLz4KPHBhdGggZD0iTTI5OS40MzMgODguNTM2QzI5Mi42NTQgODguNTM2IDI4Ni44NjcgODcuMjk2IDI4Mi4wNzMgODQuODE2QzI3Ny4yNzggODIuMzM2IDI3My4wMjEgNzguNzQgMjY5LjMwMSA3NC4wMjhMMjc3LjIzNyA2Ni4wOTJDMjc5Ljk2NSA2OS44OTQ2IDI4My4xMDYgNzIuNzg4IDI4Ni42NjEgNzQuNzcyQzI5MC4yMTUgNzYuNjczMyAyOTQuNTk3IDc3LjYyNCAyOTkuODA1IDc3LjYyNEMzMDQuOTMgNzcuNjI0IDMwOS4wMjIgNzYuNTA4IDMxMi4wODEgNzQuMjc2QzMxNS4yMjIgNzIuMDQ0IDMxNi43OTMgNjguOTg1MyAzMTYuNzkzIDY1LjFDMzE2Ljc5MyA2MS44NzYgMzE2LjA0OSA1OS4yNzIgMzE0LjU2MSA1Ny4yODhDMzEzLjA3MyA1NS4zMDQgMzExLjA0NyA1My42OTIgMzA4LjQ4NSA1Mi40NTJDMzA2LjAwNSA1MS4xMjkzIDMwMy4yNzcgNDkuOTcyIDMwMC4zMDEgNDguOThDMjk3LjMyNSA0Ny45MDUzIDI5NC4zNDkgNDYuNzg5MyAyOTEuMzczIDQ1LjYzMkMyODguMzk3IDQ0LjM5MiAyODUuNjY5IDQyLjkwNCAyODMuMTg5IDQxLjE2OEMyODAuNzA5IDM5LjM0OTMgMjc4LjY4MyAzNi45OTMzIDI3Ny4xMTMgMzQuMUMyNzUuNjI1IDMxLjIwNjYgMjc0Ljg4MSAyNy41NjkzIDI3NC44ODEgMjMuMTg4QzI3NC44ODEgMTguMzEwNiAyNzYuMDM4IDE0LjE3NzMgMjc4LjM1MyAxMC43ODhDMjgwLjc1IDcuMzE1OTcgMjgzLjk3NCA0LjY3MDY0IDI4OC4wMjUgMi44NTE5N0MyOTIuMTU4IDAuOTUwNjM2IDI5Ni43ODcgLTMuMDUxNzZlLTA1IDMwMS45MTMgLTMuMDUxNzZlLTA1QzMwNy41MzQgLTMuMDUxNzZlLTA1IDMxMi41NzcgMS4xMTU5NyAzMTcuMDQxIDMuMzQ3OTdDMzIxLjUwNSA1LjQ5NzMgMzI1LjE0MiA4LjM0OTMgMzI3Ljk1MyAxMS45MDRMMzIwLjAxNyAxOS44NEMzMTcuNDU0IDE2Ljg2NCAzMTQuNjg1IDE0LjYzMiAzMTEuNzA5IDEzLjE0NEMzMDguODE1IDExLjY1NiAzMDUuNDY3IDEwLjkxMiAzMDEuNjY1IDEwLjkxMkMyOTcuMDM1IDEwLjkxMiAyOTMuMzU3IDExLjk0NTMgMjkwLjYyOSAxNC4wMTJDMjg3LjkwMSAxNS45OTYgMjg2LjUzNyAxOC44MDY2IDI4Ni41MzcgMjIuNDQ0QzI4Ni41MzcgMjUuMzM3MyAyODcuMjgxIDI3LjY5MzMgMjg4Ljc2OSAyOS41MTJDMjkwLjMzOSAzMS4yNDggMjkyLjM2NSAzMi43MzYgMjk0Ljg0NSAzMy45NzZDMjk3LjMyNSAzNS4yMTYgMzAwLjA1MyAzNi4zNzMzIDMwMy4wMjkgMzcuNDQ4QzMwNi4wODcgMzguNDQgMzA5LjEwNSAzOS41NTYgMzEyLjA4MSA0MC43OTZDMzE1LjA1NyA0Mi4wMzYgMzE3Ljc4NSA0My42MDY2IDMyMC4yNjUgNDUuNTA4QzMyMi43NDUgNDcuNDA5MyAzMjQuNzI5IDQ5Ljg4OTMgMzI2LjIxNyA1Mi45NDhDMzI3Ljc4NyA1NS45MjQgMzI4LjU3MyA1OS42ODUzIDMyOC41NzMgNjQuMjMyQzMyOC41NzMgNzEuODM3MyAzMjUuOTI3IDc3Ljc4OTMgMzIwLjYzNyA4Mi4wODhDMzE1LjQyOSA4Ni4zODY2IDMwOC4zNjEgODguNTM2IDI5OS40MzMgODguNTM2WiIgZmlsbD0iIzYyMDBFRSIvPgo8cGF0aCBkPSJNMjMwLjY0MyA4OC41MzZDMjI0LjQ0MyA4OC41MzYgMjE4LjY5OCA4Ny40MiAyMTMuNDA3IDg1LjE4OEMyMDguMTE2IDgyLjg3MzMgMjAzLjQ4NyA3OS42OTA2IDE5OS41MTkgNzUuNjRDMTk1LjYzNCA3MS41ODkzIDE5Mi42MTYgNjYuODc3MyAxOTAuNDY3IDYxLjUwNEMxODguMzE4IDU2LjEzMDYgMTg3LjI0MyA1MC4zODUzIDE4Ny4yNDMgNDQuMjY4QzE4Ny4yNDMgMzguMDY4IDE4OC4zMTggMzIuMjgxMyAxOTAuNDY3IDI2LjkwOEMxOTIuNjE2IDIxLjUzNDYgMTk1LjYzNCAxNi44NjQgMTk5LjUxOSAxMi44OTZDMjAzLjQ4NyA4Ljg0NTMgMjA4LjA3NSA1LjcwMzk3IDIxMy4yODMgMy40NzE5N0MyMTguNTc0IDEuMTU3MyAyMjQuMzE5IC0zLjA1MTc2ZS0wNSAyMzAuNTE5IC0zLjA1MTc2ZS0wNUMyMzcuMjk4IC0zLjA1MTc2ZS0wNSAyNDMuMjUgMS4xNTczIDI0OC4zNzUgMy40NzE5N0MyNTMuNSA1Ljc4NjY0IDI1OC4wNDcgOC45Mjc5NyAyNjIuMDE1IDEyLjg5NkwyNTMuOTU1IDIwLjk1NkMyNTEuMjI3IDE3Ljg5NzMgMjQ3Ljg3OSAxNS41IDI0My45MTEgMTMuNzY0QzI0MC4wMjYgMTIuMDI4IDIzNS41NjIgMTEuMTYgMjMwLjUxOSAxMS4xNkMyMjUuOTcyIDExLjE2IDIyMS43OTggMTEuOTg2NiAyMTcuOTk1IDEzLjY0QzIxNC4xOTIgMTUuMjEwNiAyMTAuODg2IDE3LjQ4NCAyMDguMDc1IDIwLjQ2QzIwNS4yNjQgMjMuNDM2IDIwMy4wNzQgMjYuOTQ5MyAyMDEuNTAzIDMxQzIwMC4wMTUgMzUuMDUwNiAxOTkuMjcxIDM5LjQ3MzMgMTk5LjI3MSA0NC4yNjhDMTk5LjI3MSA0OS4wNjI2IDIwMC4wMTUgNTMuNDg1MyAyMDEuNTAzIDU3LjUzNkMyMDMuMDc0IDYxLjU4NjYgMjA1LjI2NCA2NS4xIDIwOC4wNzUgNjguMDc2QzIxMC44ODYgNzEuMDUyIDIxNC4xOTIgNzMuMzY2NiAyMTcuOTk1IDc1LjAyQzIyMS43OTggNzYuNTkwNiAyMjUuOTcyIDc3LjM3NiAyMzAuNTE5IDc3LjM3NkMyMzUuODkyIDc3LjM3NiAyNDAuNTYzIDc2LjUwOCAyNDQuNTMxIDc0Ljc3MkMyNDguNDk5IDcyLjk1MzMgMjUxLjg0NyA3MC41MTQ2IDI1NC41NzUgNjcuNDU2TDI2Mi42MzUgNzUuMzkyQzI1OC42NjcgNzkuNTI1MyAyNTMuOTk2IDgyLjc0OTMgMjQ4LjYyMyA4NS4wNjRDMjQzLjMzMiA4Ny4zNzg2IDIzNy4zMzkgODguNTM2IDIzMC42NDMgODguNTM2WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEzMS41OTEgODguNTM2QzEyNS40NzQgODguNTM2IDExOS43NyA4Ny40MiAxMTQuNDc5IDg1LjE4OEMxMDkuMTg4IDgyLjg3MzMgMTA0LjU1OSA3OS42OTA2IDEwMC41OTEgNzUuNjRDOTYuNjIzMSA3MS41MDY2IDkzLjUyMzEgNjYuNzUzMyA5MS4yOTExIDYxLjM4Qzg5LjE0MTggNTYuMDA2NiA4OC4wNjcxIDUwLjI2MTMgODguMDY3MSA0NC4xNDRDODguMDY3MSAzNy45NDQgODkuMTQxOCAzMi4xOTg2IDkxLjI5MTEgMjYuOTA4QzkzLjUyMzEgMjEuNTM0NiA5Ni41ODE3IDE2LjgyMjYgMTAwLjQ2NyAxMi43NzJDMTA0LjQzNSA4LjcyMTMgMTA5LjAyMyA1LjU3OTk3IDExNC4yMzEgMy4zNDc5N0MxMTkuNTIyIDEuMTE1OTcgMTI1LjIyNiAtMy4wNTE3NmUtMDUgMTMxLjM0MyAtMy4wNTE3NmUtMDVDMTM3LjQ2IC0zLjA1MTc2ZS0wNSAxNDMuMTIzIDEuMTE1OTcgMTQ4LjMzMSAzLjM0Nzk3QzE1My42MjIgNS41Nzk5NyAxNTguMjUxIDguNzIxMyAxNjIuMjE5IDEyLjc3MkMxNjYuMTg3IDE2LjgyMjYgMTY5LjI4NyAyMS41MzQ2IDE3MS41MTkgMjYuOTA4QzE3My43NTEgMzIuMjgxMyAxNzQuODY3IDM4LjA2OCAxNzQuODY3IDQ0LjI2OEMxNzQuODY3IDUwLjM4NTMgMTczLjc1MSA1Ni4xMzA2IDE3MS41MTkgNjEuNTA0QzE2OS4yODcgNjYuODc3MyAxNjYuMTg3IDcxLjU4OTMgMTYyLjIxOSA3NS42NEMxNTguMzM0IDc5LjY5MDYgMTUzLjc0NiA4Mi44NzMzIDE0OC40NTUgODUuMTg4QzE0My4yNDcgODcuNDIgMTM3LjYyNiA4OC41MzYgMTMxLjU5MSA4OC41MzZaTTEzMS4zNDMgNzcuMzc2QzEzNy41NDMgNzcuMzc2IDE0Mi45NTggNzUuOTcwNiAxNDcuNTg3IDczLjE2QzE1Mi4yOTkgNzAuMjY2NiAxNTYuMDE5IDY2LjM0IDE1OC43NDcgNjEuMzhDMTYxLjQ3NSA1Ni4zMzczIDE2Mi44MzkgNTAuNTkyIDE2Mi44MzkgNDQuMTQ0QzE2Mi44MzkgMzkuMzQ5MyAxNjIuMDU0IDM0Ljk2OCAxNjAuNDgzIDMxQzE1OC45MTIgMjYuOTQ5MyAxNTYuNzIyIDIzLjQzNiAxNTMuOTExIDIwLjQ2QzE1MS4xIDE3LjQ4NCAxNDcuNzk0IDE1LjIxMDYgMTQzLjk5MSAxMy42NEMxNDAuMTg4IDExLjk4NjYgMTM1Ljk3MiAxMS4xNiAxMzEuMzQzIDExLjE2QzEyNS4yMjYgMTEuMTYgMTE5LjgxMSAxMi41NjUzIDExNS4wOTkgMTUuMzc2QzExMC40NyAxOC4xODY2IDEwNi43OTEgMjIuMDcyIDEwNC4wNjMgMjcuMDMyQzEwMS40MTggMzEuOTkyIDEwMC4wOTUgMzcuNjk2IDEwMC4wOTUgNDQuMTQ0QzEwMC4wOTUgNDguOTM4NiAxMDAuODM5IDUzLjQwMjYgMTAyLjMyNyA1Ny41MzZDMTAzLjg5OCA2MS41ODY2IDEwNi4wNDcgNjUuMSAxMDguNzc1IDY4LjA3NkMxMTEuNTg2IDcwLjk2OTMgMTE0Ljg5MiA3My4yNDI2IDExOC42OTUgNzQuODk2QzEyMi41OCA3Ni41NDkzIDEyNi43OTYgNzcuMzc2IDEzMS4zNDMgNzcuMzc2WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTguMzA1OTggODcuMjk2Vjc2LjYzMkgzMi4yMzhDMzguNjAzMyA3Ni42MzIgNDQuMTgzMyA3NS4yNjggNDguOTc4IDcyLjU0QzUzLjc3MjYgNjkuNzI5MyA1Ny40OTI2IDY1Ljg4NTMgNjAuMTM4IDYxLjAwOEM2Mi44NjYgNTYuMTMwNyA2NC4yMyA1MC41MDkzIDY0LjIzIDQ0LjE0NEM2NC4yMyAzNy44NjEzIDYyLjg2NiAzMi4yODEzIDYwLjEzOCAyNy40MDRDNTcuNDEgMjIuNTI2NyA1My42NDg2IDE4LjcyNCA0OC44NTQgMTUuOTk2QzQ0LjA1OTMgMTMuMjY4IDM4LjUyMDYgMTEuOTA0IDMyLjIzOCAxMS45MDRIOC40Mjk5OFYxLjIzOTk5SDMyLjQ4NkMzOC43Njg2IDEuMjM5OTkgNDQuNTU1MyAyLjMxNDY2IDQ5Ljg0NiA0LjQ2Mzk5QzU1LjIxOTMgNi42MTMzMiA1OS44NDg2IDkuNjMwNjUgNjMuNzM0IDEzLjUxNkM2Ny43MDIgMTcuNDAxMyA3MC43NjA2IDIxLjk0OCA3Mi45MSAyNy4xNTZDNzUuMTQyIDMyLjM2NCA3Ni4yNTggMzguMDY4IDc2LjI1OCA0NC4yNjhDNzYuMjU4IDUwLjM4NTMgNzUuMTQyIDU2LjA4OTMgNzIuOTEgNjEuMzhDNzAuNzYwNiA2Ni41ODggNjcuNzQzMyA3MS4xMzQ3IDYzLjg1OCA3NS4wMkM1OS45NzI2IDc4LjkwNTMgNTUuMzQzMyA4MS45MjI3IDQ5Ljk3IDg0LjA3MkM0NC42NzkzIDg2LjIyMTMgMzguOTM0IDg3LjI5NiAzMi43MzQgODcuMjk2SDguMzA1OThaTTAuNjE3OTgxIDg3LjI5NlYxLjIzOTk5SDEyLjI3NFY4Ny4yOTZIMC42MTc5ODFaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},43820:(e,t,s)=>{"use strict";s.d(t,{Ay:()=>c,iD:()=>n,ri:()=>o,lp:()=>r});var i=s(50523);const a=async e=>{const t=await(async e=>{const t=e.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\n/g,""),s=(e=>{const t=new ArrayBuffer(e.length),s=new Uint8Array(t);for(let t=0,i=e.length;t<i;t++)s[t]=e.charCodeAt(t);return t})(window.atob(t));return window.crypto.subtle.importKey("spki",s,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])})('""'),s=await(async(e,t)=>{const s=new TextEncoder;return await window.crypto.subtle.encrypt({name:"RSA-OAEP"},e,s.encode(t))})(t,e);return btoa(String.fromCharCode(...new Uint8Array(s)))},r=(0,i.VP)("skipLogin"),n=(0,i.zD)("login",async(e,t)=>{let s=await(async e=>{const t=await a(e.password);return(await fetch(`${e.serverURL}/login`,{method:"POST",body:JSON.stringify({username:e.username,password:t}),mode:"cors",headers:{"Content-Type":"application/json"}})).json()})(e);return s.success?s:t.rejectWithValue(s)}),o=(0,i.zD)("logout",async(e,t)=>{}),c=(0,i.vy)({isAuthenticated:!1,isAnonymous:!1},e=>{e.addCase(n.fulfilled,(e,t)=>{e.isAuthenticated=!0}).addCase(n.rejected,(e,t)=>{console.error(t.error)}).addCase(o.fulfilled,(e,t)=>{e.isAuthenticated=!1,e.isAnonymous=!1}).addCase(o.rejected,(e,t)=>{console.error(t.error)}).addCase(r,(e,t)=>{e.isAnonymous=!0})})},47618:(e,t,s)=>{"use strict";s.r(t);const i=(0,s(28431).A)().child({module:"dataModel"});i.info("Worker successfully registered");const a=[];let r=!1;const n=async()=>{if(i.child({method:"processQueue"}).info("Started to process model worker queue"),r||0===a.length)return;r=!0;const e=a.shift();if(e){const{command:t,payload:s}=e;r=!1,n()}};self.onmessage=e=>{e.data.command&&(a.push(e.data),n())},self.onmessageerror=e=>{i.error("Got error",{event:e})}},48241:e=>{"use strict";e.exports=JSON.parse('{"version":"0.0.1","changelog":"### Schema Patch: v0.0.1\\\\\\n#### New Documents: ~User, ~UserSession","docs":[{"_id":"~User","active":true,"name":"User","description":"A user class for secure login","type":"class","schema":{"username":{"name":"username","type":"string","config":{"primaryKey":true,"maxLength":50,"mandatory":true,"isArray":false}},"password":{"name":"password","type":"string","config":{"maxLength":50,"mandatory":true,"isArray":false}},"email":{"name":"email","type":"string","config":{"maxLength":50,"isArray":false}},"firstName":{"name":"firstName","type":"string","config":{"maxLength":50,"isArray":false}},"lastName":{"name":"lastName","type":"string","config":{"maxLength":50,"isArray":false}}}},{"_id":"~UserSession","name":"UserSession","active":true,"description":"Tracks user sessions","type":"class","schema":{"username":{"name":"username","type":"string","config":{"maxLength":50,"isArray":false,"primaryKey":true,"mandatory":true}},"sessionId":{"name":"sessionId","type":"string","config":{"maxLength":200,"primaryKey":true,"isArray":false,"mandatory":true}},"sessionStart":{"name":"sessionStart","type":"string","config":{"maxLength":100,"isArray":false,"mandatory":true}},"sessionStatus":{"name":"sessionStatus","type":"string","config":{"maxLength":100,"isArray":false,"mandatory":true}},"sessionEnd":{"name":"sessionEnd","type":"string","config":{"maxLength":100,"isArray":false,"mandatory":false}}}}]}')},49914:()=>{},51027:()=>{},59135:(e,t,s)=>{var i={"./editorBaseApi":[37970],"./editorBaseApi.js":[37970],"./editorSimpleWorker":[68757],"./editorSimpleWorker.js":[68757],"./editorWorker":[22143],"./editorWorker.js":[22143],"./editorWorkerHost":[70869],"./editorWorkerHost.js":[70869],"./findSectionHeaders":[97716],"./findSectionHeaders.js":[97716],"./getIconClasses":[45555,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./getIconClasses.js":[45555,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./languageFeatureDebounce":[26973],"./languageFeatureDebounce.js":[26973],"./languageFeatures":[33653],"./languageFeatures.js":[33653],"./languageFeaturesService":[43266],"./languageFeaturesService.js":[43266],"./languageService":[22155],"./languageService.js":[22155],"./languagesAssociations":[25709],"./languagesAssociations.js":[25709],"./languagesRegistry":[35074],"./languagesRegistry.js":[35074],"./markerDecorations":[86259],"./markerDecorations.js":[86259],"./markerDecorationsService":[72524],"./markerDecorationsService.js":[72524],"./model":[16911],"./model.js":[16911],"./modelService":[91320],"./modelService.js":[91320],"./resolverService":[77768],"./resolverService.js":[77768],"./semanticTokensDto":[7029,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./semanticTokensDto.js":[7029,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./semanticTokensProviderStyling":[36913],"./semanticTokensProviderStyling.js":[36913],"./semanticTokensStyling":[74566],"./semanticTokensStyling.js":[74566],"./semanticTokensStylingService":[28843],"./semanticTokensStylingService.js":[28843],"./textModelSync/textModelSync.impl":[47177],"./textModelSync/textModelSync.impl.js":[47177],"./textModelSync/textModelSync.protocol":[37619,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./textModelSync/textModelSync.protocol.js":[37619,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./textResourceConfiguration":[93533],"./textResourceConfiguration.js":[93533],"./treeSitterParserService":[47105],"./treeSitterParserService.js":[47105],"./treeViewsDnd":[29740,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./treeViewsDnd.js":[29740,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./treeViewsDndService":[95621,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./treeViewsDndService.js":[95621,997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],"./unicodeTextModelHighlighter":[14818],"./unicodeTextModelHighlighter.js":[14818]};function a(e){if(!s.o(i,e))return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],a=t[0];return Promise.all(t.slice(1).map(s.e)).then(()=>s(a))}a.keys=()=>Object.keys(i),a.id=59135,e.exports=a},62080:()=>{},62627:()=>{},69256:()=>{},78314:()=>{},78675:()=>{},79334:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA5NiA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CiAgICA8IS0tIGJhY2tncm91bmQgLS0+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImJnIiBjeD0iNTAlIiBjeT0iNTAlIiByPSI3MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMWExYTFhIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIvPgogICAgPC9yYWRpYWxHcmFkaWVudD4KCiAgICA8IS0tIE5ldyBncmFkaWVudCAtLT4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0ibmVvbiIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM2MjAwRUUiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0b3AtY29sb3I9IiMwMDY3NEYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjODhFNzg4Ii8+CiAgICA8L2xpbmVhckdyYWRpZW50PgoKICAgIDwhLS0gR2xvdyBmaWx0ZXIgLS0+CiAgICA8ZmlsdGVyIGlkPSJnbG93IiB4PSItNTAlIiB5PSItNTAlIiB3aWR0aD0iMjAwJSIgaGVpZ2h0PSIyMDAlIj4KICAgICAgPGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjAiIHN0ZERldmlhdGlvbj0iMS41IiBmbG9vZC1jb2xvcj0iIzYyMDBFRSIgZmxvb2Qtb3BhY2l0eT0iMC42Ii8+CiAgICAgIDxmZURyb3BTaGFkb3cgZHg9IjAiIGR5PSIwIiBzdGREZXZpYXRpb249IjIuNSIgZmxvb2QtY29sb3I9IiMwMDY3NEYiIGZsb29kLW9wYWNpdHk9IjAuNSIvPgogICAgICA8ZmVEcm9wU2hhZG93IGR4PSIwIiBkeT0iMCIgc3RkRGV2aWF0aW9uPSIzLjUiIGZsb29kLWNvbG9yPSIjODhFNzg4IiBmbG9vZC1vcGFjaXR5PSIwLjQiLz4KICAgIDwvZmlsdGVyPgogIDwvZGVmcz4KCjxwYXRoIGQ9Ik04Ny4zNiAxNy4yOEM4Ny4zNiAxMi41MDgzIDgzLjQ5MTcgOC42NCA3OC43MiA4LjY0SDE3LjI4QzEyLjUwODMgOC42NCA4LjY0IDEyLjUwODMgOC42NCAxNy4yOFY3OC43MkM4LjY0IDgzLjQ5MTcgMTIuNTA4MyA4Ny4zNiAxNy4yOCA4Ny4zNkg3OC43MkM4My40OTE3IDg3LjM2IDg3LjM2IDgzLjQ5MTcgODcuMzYgNzguNzJWMTcuMjhaTTkzLjEyIDc4LjcyQzkzLjEyIDg2LjY3MjkgODYuNjcyOSA5My4xMiA3OC43MiA5My4xMkgxNy4yOEM5LjMyNzEgOTMuMTIgMi44OCA4Ni42NzI5IDIuODggNzguNzJWMTcuMjhDMi44OCA5LjMyNzEgOS4zMjcxIDIuODggMTcuMjggMi44OEg3OC43MkM4Ni42NzI5IDIuODggOTMuMTIgOS4zMjcxIDkzLjEyIDE3LjI4Vjc4LjcyWiIgZmlsbD0idXJsKCNuZW9uKSIvPgoKPHBhdGggZmlsdGVyPSJ1cmwoI2dsb3cpIiBkPSJNODMuNTMzIDI4LjkyMDRDODQuMTc3NCAyNS4yNjU0IDgxLjczNjkgMjEuNzggNzguMDgyIDIxLjEzNTVMMjguOTIwNCAxMi40NjdDMjUuMjY1NCAxMS44MjI2IDIxLjc4IDE0LjI2MzEgMjEuMTM1NiAxNy45MThMMTIuNDY3IDY3LjA3OTZDMTEuODIyNiA3MC43MzQ2IDE0LjI2MzEgNzQuMjIgMTcuOTE4IDc0Ljg2NDRMNjcuMDc5NiA4My41MzNDNzAuNzM0NiA4NC4xNzc0IDc0LjIyIDgxLjczNjkgNzQuODY0NCA3OC4wODJMODMuNTMzIDI4LjkyMDRaTTgwLjUzNjkgNzkuMDgyMkM3OS4zNDAxIDg1Ljg3IDcyLjg2NzIgOTAuNDAyMyA2Ni4wNzk0IDg5LjIwNTVMMTYuOTE3OCA4MC41MzY5QzEwLjEzIDc5LjM0MDEgNS41OTc2NyA3Mi44NjcyIDYuNzk0NTQgNjYuMDc5NEwxNS40NjMxIDE2LjkxNzhDMTYuNjU5OSAxMC4xMyAyMy4xMzI4IDUuNTk3NjcgMjkuOTIwNiA2Ljc5NDU0TDc5LjA4MjIgMTUuNDYzMUM4NS44NyAxNi42NTk5IDkwLjQwMjMgMjMuMTMyOCA4OS4yMDU1IDI5LjkyMDZMODAuNTM2OSA3OS4wODIyWiIgZmlsbD0idXJsKCNuZW9uKSIvPgoKPHBhdGggZmlsdGVyPSJ1cmwoI2dsb3cpIiBkPSJNNzcuMTE5NCAzOC4xNjY0Qzc4LjAyNjEgMzUuNjc1MyA3Ni43NDE3IDMyLjkyMDkgNzQuMjUwNiAzMi4wMTQyTDM4LjE2NjQgMTguODgwNkMzNS42NzUzIDE3Ljk3MzkgMzIuOTIwOCAxOS4yNTgzIDMyLjAxNDIgMjEuNzQ5NEwxOC44ODA2IDU3LjgzMzZDMTcuOTczOSA2MC4zMjQ3IDE5LjI1ODMgNjMuMDc5MiAyMS43NDk0IDYzLjk4NThMNTcuODMzNiA3Ny4xMTk0QzYwLjMyNDcgNzguMDI2MSA2My4wNzkxIDc2Ljc0MTcgNjMuOTg1OCA3NC4yNTA2TDc3LjExOTQgMzguMTY2NFpNNjkuMzk4NSA3Ni4yMjA2QzY3LjQwMzggODEuNzAxIDYxLjM0NCA4NC41MjY3IDU1Ljg2MzYgODIuNTMyTDE5Ljc3OTQgNjkuMzk4NUMxNC4yOTkgNjcuNDAzOCAxMS40NzMyIDYxLjM0NCAxMy40NjggNTUuODYzNkwyNi42MDE1IDE5Ljc3OTRDMjguNTk2MiAxNC4yOTkgMzQuNjU2IDExLjQ3MzMgNDAuMTM2NCAxMy40NjhMNzYuMjIwNiAyNi42MDE1QzgxLjcwMSAyOC41OTYyIDg0LjUyNjcgMzQuNjU2IDgyLjUzMiA0MC4xMzY0TDY5LjM5ODUgNzYuMjIwNloiIGZpbGw9InVybCgjbmVvbikiLz4KCjxwYXRoIGZpbHRlcj0idXJsKCNnbG93KSIgZD0iTTY4Ljg1MzUgNDQuNTIwNkM2OS42NDg4IDQzLjE0MzEgNjkuMTc2OSA0MS4zODE4IDY3Ljc5OTQgNDAuNTg2NUw0NC41MjA2IDI3LjE0NjVDNDMuMTQzMSAyNi4zNTEyIDQxLjM4MTcgMjYuODIzMSA0MC41ODY1IDI4LjIwMDZMMjcuMTQ2NSA1MS40Nzk0QzI2LjM1MTIgNTIuODU2OSAyNi44MjMxIDU0LjYxODIgMjguMjAwNiA1NS40MTM1TDUxLjQ3OTQgNjguODUzNUM1Mi44NTY5IDY5LjY0ODggNTQuNjE4MiA2OS4xNzY5IDU1LjQxMzUgNjcuNzk5NEw2OC44NTM1IDQ0LjUyMDZaTTYwLjQwMTggNzAuNjc5NEM1OC4wMTYgNzQuODExOCA1Mi43MzE4IDc2LjIyNzcgNDguNTk5NCA3My44NDE4TDI1LjMyMDYgNjAuNDAxOEMyMS4xODgyIDU4LjAxNiAxOS43NzIzIDUyLjczMTggMjIuMTU4MiA0OC41OTk0TDM1LjU5ODIgMjUuMzIwNkMzNy45ODQgMjEuMTg4MiA0My4yNjgyIDE5Ljc3MjMgNDcuNDAwNiAyMi4xNTgyTDcwLjY3OTQgMzUuNTk4MkM3NC44MTE4IDM3Ljk4NCA3Ni4yMjc3IDQzLjI2ODIgNzMuODQxOCA0Ny40MDA2TDYwLjQwMTggNzAuNjc5NFoiIGZpbGw9InVybCgjbmVvbikiLz4KCjwvc3ZnPgo="},81463:(e,t,s)=>{var i={"./patch-000.json":48241};function a(e){var t=r(e);return s(t)}function r(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id=81463},85288:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var i=s(50523);const a=(0,i.VP)("setQuery"),r=(0,i.vy)({query:""},e=>{e.addCase(a,(e,t)=>{e.query=t.payload})})},86973:()=>{},87271:(e,t,s)=>{"use strict";s.d(t,{nW:()=>j,Xs:()=>A,jg:()=>U});var i=s(28431),a=s(57822),r=s(66358);class n extends EventTarget{constructor(){super(),this.attributes={},this.schema={},this.schemaZOD=r.object({}),this.state="idle",this.triggers=[]}}const o=n,c=class{constructor(e=null,t,s,i){this.class=null}};class l extends EventTarget{constructor(){super(...arguments),this.appVersion="0.0.1",this.cache={},this.listeners=[],this.modelWorker=null}}const d=l,u=class{constructor(){}},g=["string","number","integer","reference","boolean"],M=e=>!!e.hasOwnProperty("type"),h=e=>!(!e.hasOwnProperty("type")||"class"!==e.type);var y,m=s(85924);class N extends c{constructor(e=null,t,s,i,a){super(e,t,s,a),this.field=m.Ay$.any(),this.setField=()=>{const{name:e,type:t,config:s}=this.model;let i;switch(t){case"string":i=m.Ay$.string(),void 0!==s.maxLength&&(i=i.max(s.maxLength));break;case"integer":i=m.Ay$.number(),"number"==typeof s.min&&(i=i.min(s.min)),"number"==typeof s.max&&(i=i.max(s.max));break;case"decimal":if(i=m.Ay$.number(),"number"==typeof s.min&&(i=i.min(s.min)),"number"==typeof s.max&&(i=i.max(s.max)),"number"==typeof s.precision&&s.precision>=0){const e=e=>{if("number"!=typeof e)return!0;const t=e.toString().split(".")[1];return(t?t.length:0)<=s.precision};i=i.refine(e,`Number cannot have more than ${s.precision} decimals.`)}break;case"boolean":i=m.Ay$.boolean();break;case"foreign_key":if(!s.targetClass)throw new Error(`Attribute '${e}' of type 'foreign_key' is missing a 'targetClass' in its config.`);const a=s.targetClass;i=m.Ay$.string().refine(async e=>{const t=Array.isArray(e)?e:[e];if(0===t.length)return!0;try{if(this.class){const e=this.class.getStack();if(e){const s=t.map(t=>e.db.get(t));return await Promise.all(s),!0}throw new Error("Missing stack connection")}throw new Error("Missing class parentship")}catch(e){if(404===e.status)return!1;throw e}},{message:`One or more documents not found in class '${a}'.`});break;default:throw new Error(`Unsupported schema type: '${t}' for field '${e}'`)}s.defaultValue&&(i=i.default(s.defaultValue)),!0!==s.mandatory&&(i=i.optional()),!0===s.isArray&&(i=m.Ay$.array(i)),this.field=i},this.isPrimaryKey=()=>!!this.getModel().config.primaryKey,this.isMandatory=()=>!!this.model.config.mandatory,this.getModel=()=>this.model,this.getClass=()=>{if(this.class)return this.class;throw Error("Missing class configuration for this attribute")},this.validate=async e=>this.field.safeParseAsync(e),this.setModel=e=>{let t=this.getModel();e=Object.assign(t||{},e),this.model=e,this.defaultValue=e.config.defaultValue},this.getType=e=>{if(this.checkTypeValidity(e))return e;throw Error("Invalid attribute type: "+e)},this.getEmpty=()=>({[this.name]:this.field.parse(void 0)||null}),this.getName=()=>this.name,this.checkTypeValidity=e=>{let t=!1;return g.includes(e)&&(t=!0),t},this.getTypeConf=(e,t)=>{switch(e){case"decimal":t=Object.assign({max:null,min:null,precision:null,isArray:!1},t);break;case"integer":t=Object.assign({max:null,min:null,isArray:!1},t);break;case"string":t=Object.assign({maxLength:50,isArray:!1},t);break;default:throw new Error("Unexpected type: "+e)}return t},this.name=t,this.description=i,this.setModel({name:this.name,description:this.description,type:this.getType(s),config:this.getTypeConf(s,a)||{}}),this.setField(),this.class=e}static async create(e,t,s,i,a){const r=new y(e,t,s,i,a);return await y.build(r),r}}y=N,N.build=async e=>{let t=e.getClass();if(t.getStack())return await t.addAttribute(e),e;throw new Error("Missing db configuration")};const j=N;class D extends u{constructor(e,t){if(super(),this.execute=async e=>{const t=this.classObj?this.classObj.getStack():void 0,s=await this.run(e,this.classObj,t);return void 0===s?(console.warn(`Trigger '${this.model.name}' did not return a document. Returning the original document.`),e):s},this.executeLimited=async e=>{const t=await this.run(e);return void 0===t?(console.warn(`Trigger '${this.model.name}' did not return a document. Returning the original document.`),e):t},this.model=e,this.name=e.name,this.order=e.order,this.classObj=t,"string"!=typeof e.run)throw new Error("Trigger model's 'run' field must be a string representation of a function.");try{this.run=new Function("document","classObj","stack",`\n                "use strict";\n                // The developer's code is placed here.\n                return (async () => {\n                    ${e.run}\n                })();\n            `)}catch(t){throw new Error(`Failed to hydrate trigger '${e.name}': ${t}`)}}}var I;class p extends o{constructor(){super(),this.attributes={},this.schema={},this.schemaZOD=r.object({}),this.state="idle",this.logger=(0,i.A)().child({module:"class",className:this.name}),this.triggers=[],this.build=()=>new Promise(async(e,t)=>{let s=this.getStack();if(s){let i=await s.addClass(this);i?(this.setModel(i),this.logger.info("build - classModel",{classModel:i}),this.setId(i._id),e(this)):t("unable to get classModel. Check logs")}else t("Missing db configuration")}),this.init=(e,t,s,i,a={})=>{this.name=t,this.id=t,this.description=i,this.type=s,this.setModel({type:s,_id:t,active:!0,name:t,description:i,schema:a,triggers:[]}),e&&(this.stack=e)},this.uniqueCheck=async e=>{const t=this.logger.child({method:"uniqueCheck",args:{doc:e}}),s=await this.getByPrimaryKeys(e);return null==s||s._id==e._id?(t.info("No duplicate found for doc"),!0):(t.info("Duplicate found for doc",{duplicate:s}),!1)},this.bulkUniqueCheck=async e=>{var t;const s=this.logger.child({method:"bulkUniqueCheck",args:{pKs:e}}),i=await(null===(t=this.stack)||void 0===t?void 0:t.addDesignDocumentPKs(this.name,e,!0));if(s.info(`Created temporary design document '${i}'`),!this.stack||!i)return s.error("Was unable to create temporary design document to group by"),!1;try{if((await this.stack.db.query(`${i}/by_pKeys`,{group:!0,reduce:"_count"})).rows.some(e=>e.value>1)){s.error("Schema change invalid: new duplicates found.");const e=await this.stack.db.get(i);return await this.stack.db.remove(e),!1}{s.info("Bulk unique check completed: no new duplicates found");const e=await this.stack.db.get(i);return await this.stack.db.remove(e),!0}}catch(e){console.error("Error during schema validation:",e);try{const e=await this.stack.db.get(i);await this.stack.db.remove(e)}catch(e){}return!1}},this.validate=async e=>{const t=this.logger.child({method:"validate"}),s=await this.schemaZOD.safeParseAsync(e);return t.debug("Got result",{result:s}),!!s.success},this.setId=e=>{this.id=e},this.getName=()=>this.name,this.getStack=()=>this.stack,this.getDescription=()=>this.description,this.getType=()=>this.type,this.getId=()=>this.id,this.buildSchema=()=>{let e={};return Object.entries(this.attributes).forEach(t=>{e[t[0]]=t[1].model}),e},this.getModel=()=>{let e=[];for(const t of this.triggers)e.push(t.model);return{_id:this.getName(),name:this.getName(),description:this.getDescription(),type:this.getType(),schema:this.buildSchema(),triggers:e,active:!0,_rev:this.model?this.model._rev:"",createTimestamp:this.model?this.model.createTimestamp:void 0}},this.setModel=e=>{this.logger.info("setModel - got incoming model",{model:e});let t=this.getModel();if((e=Object.assign(t,e)).schema){this.attributes={},this.schemaZOD=r.object({});for(const[t,s]of Object.entries(e.schema)){let e=new j(this,s.name,s.type,s.description,s.config);this.attributes[s.name]=e,this.schemaZOD=this.schemaZOD.extend({[s.name]:e.field})}}if(e.triggers)for(const t of e.triggers){let e=new D(t,this);this.triggers.push(e)}this.name=e.name,this.description=e.description,this.model=e,this.logger.info("setModel - model after processing",{model:e})},this.getPrimaryKeys=()=>Object.values(this.attributes).filter(e=>e.isPrimaryKey()).map(e=>e.getName()),this.getAttributes=(...e)=>{let t={};for(const s of Object.values(this.attributes))if(e.length>0)for(let i of e)null!=i&&s.getName()==i&&(t[s.name]=s);else t[s.name]=s;return t},this.hasAllAttributes=(...e)=>{let t=!1,s=this.getAttributes(...e);for(let i of Object.values(s))if(t=e.includes(i.getName()),!t)break;return t},this.hasAnyAttributes=(...e)=>{let t=!1,s=this.getAttributes(...e);for(let i of Object.values(s))if(t=e.includes(i.getName()),t)break;return t},this.hasAttribute=e=>this.hasAnyAttributes(e),this.addAttribute=async e=>{const t=this.logger.child({method:"addAttribute",args:{attribute:e.name}}),s=e instanceof j?e:new j(this,e.name,e.type,e.description,e.config);try{let e=s.getName();if(this.hasAttribute(e))return t.error("Attribute with name "+e+" already exists within this Class"),this;{t.info("Adding attribute",{name:e,type:s.getModel()}),this.attributes[e]=s;let i=s.getModel();return t.info("Adding attribute to schema",{attributeModel:i}),t.info("Checking for requirements before updating class on db",{stack:null!=this.stack,id:this.id}),this.stack&&this.id?(t.info("Updating class on db"),await this.stack.updateClass(this),this):(t.error("Class not updated on db because of missing stack or id"),this)}}catch(e){return t.error("Falied adding attribute because: ",e),this}},this.modifyAttribute=async(e,t)=>{const s=this.logger.child({method:"modifyAttribute",args:{name:e}}),i=Object.assign({},this.model.schema[e]),a=this.attributes[e],r=t instanceof j?t:new j(this,t.name,t.type,t.description,t.config);try{return s.info("Attempting to change attribute definition."),delete this.model.schema[e],delete this.attributes[e],this.schemaZOD=this.schemaZOD.omit({[e]:!0}),this.addAttribute(r)}catch(t){this.model.schema[e]=i,this.attributes[e]=a,s.error("Failed at removing attribute from class.'")}return this},this.removeAttribute=async e=>{const t=this.logger.child({method:"removeAttribute",args:{name:e}}),s=Object.assign({},this.model.schema[e]),i=this.attributes[e];try{if(t.info("Attempting to remove attribute from class."),delete this.model.schema[e],delete this.attributes[e],this.schemaZOD=this.schemaZOD.omit({[e]:!0}),!this.stack)throw new Error("Missing stack, cannot perform updates.");this.stack.updateClass(this)}catch(a){this.model.schema[e]=s,this.attributes[e]=i,t.error("Failed at removing attribute from class.'")}return this},this.addCard=async e=>await this.stack.createDoc(null,this.getName(),this,e),this.getByPrimaryKeys=async e=>{const t=this.logger.child({method:"getByPrimaryKeys"});let s={},i=this.getPrimaryKeys();if(t.info("Got primary keys",{primaryKeys:i}),i.length){i.reduce((t,s)=>t[s]=e[s],s),t.info("Defined filter",{filter:s});let a=await this.getCards(s,void 0,0,1);return a.length>0?a[0]:(t.info("Did not find any documents with given primary key",{filter:s}),null)}return t.info("Class has no field specified as primary key"),null},this.addOrUpdateCard=async(e,t)=>{const s=this.logger.child({method:"addOrUpdateCard",args:{params:e,cardId:t}});return new Promise(async(i,a)=>{t?(s.info("Provided document's id, performing an update"),i(await this.updateCard(t,e))):(s.info("No document id provided, checking for PKs"),null==await this.getByPrimaryKeys(e)?i(await this.addCard(e)):(s.error("Duplicate card by keys"),a("Duplicate card by keys")))})},this.updateCard=async(e,t)=>new Promise(async(s,i)=>{this.stack?s(await this.stack.createDoc(e,this.getName(),this,t)):(this.logger.info("no stack defined"),s(null))}),this.deleteCard=async e=>{const t=this.logger.child({method:"deleteCard",args:{cardId:e}});return this.stack?await this.stack.deleteDocument(e):(t.error("Stack is not defined"),!1)},this.getCards=async(e,t,s,i)=>{let a=Object.assign(Object.assign({},e),{type:this.name});return this.logger.info("getCards - selector",{selector:a,fields:t,skip:s,limit:i}),(await this.stack.findDocuments(a,t,s,i)).docs},this.addTrigger=async(e,t)=>{const s=this.logger.child({method:"addTrigger"});try{const e=new D(t,this);if(this.triggers.push(e),!this.stack)throw new Error("Stack is not defined. Can't update class");this.setModel(),await this.stack.updateClass(this)}catch(e){s.error(e)}return this},this.removeTrigger=async e=>(this.triggers=this.triggers.filter(t=>t.name!=e),this)}}I=p,p.logger=(0,i.A)().child({module:"class"}),p.get=(e,t,s="class",i,a={})=>{const r=new I;return I.logger.info("Received schema",{schema:a}),r.init(e,t,s,i,a),r.stack.onClassDoc(t).on("change",e=>{console.log("onClassDoc",{change:e});const t=new CustomEvent("doc",{detail:e});r.dispatchEvent(t)}),r},p.create=async(e,t,s="class",i,a={})=>{const r=I.get(e,t,s,i,a);return await r.build(),r},p.buildFromModel=async(e,t)=>(I.logger.info("buildFromModel - Instantiate from model",{classModel:t}),t._rev?I.get(e,t.name,t.type,t.description,t.schema):await I.create(e,t.name,t.type,t.type,t.schema)),p.fetch=async(e,t)=>{let s=await e.getClassModel(t);return s?I.buildFromModel(e,s):null};const A=p,f=e=>{};var z=s(10881),w=s(71558),T=s(93854);const x=async(e,t,s,i)=>{const a=new j(null,t.name,t.type,t.description,t.config);if("add"===e&&(i=Object.assign(Object.assign({},i),a.getEmpty())),"delete"===e)delete i[a.name];else if(!await a.validate(i[a.name]))throw new Error(`Attribute '${s.name}.${a.name}' ${e} fails for current document because of its validation`);if(a.isPrimaryKey()&&!s.bulkUniqueCheck(s.getPrimaryKeys()))throw new Error(`With attribute '${a.name}' ${e} of class '${s.name}', docs fail primary keys check.`);if("delete"!==e&&a.isMandatory()&&null==i[a.name])throw new Error(`Attribute '${s.name}.${a.name}' is mandatory but has no value.`);return i},k=async(e,t,s)=>{const a=(0,i.A)().child({method:"applySchemaDelta"});let r=Object.assign({},e);const n=Object.entries(t);for(const e of n)if(a.debug(`Delta of attribute '${e[0]}'`),Array.isArray(e[1])){if(1===e[1].length){const t=e[1][0];r=await x("add",t,s,r)}if(1===e[1].length){const t=e[1][0];r=await x("change",t,s,r)}if(3===e[1].length){const t=e[1][0];r=await x("delete",t,s,r)}return r}return r},b=(0,i.A)().child({module:"pouchdb"}),O=e=>{const t=w.A.prototype.bulkDocs;return{bulkDocs:async function(s,i,a){const r=b.child({method:"bulkDocs"});"function"==typeof i&&(a=i,i={});const n=()=>a?t.call(this,s,i,a):t.call(this,s,i);let o;o=Array.isArray(s)?s:s.docs;for(const t of o)if(h(t)){r.info("Document is class model, following update propagation procedure.");const s=t._id;try{if(1==(await e.db.get(s,{revs:!0}))._revisions.ids.length)return r.info(`Class '${s}' was just created. Nothing to do.`),n()}catch(e){if("not_found"===e.name)return n()}const i=await e.getClass(s,!0);if(null==i)throw new Error(`Unexpected, can't retrieve class '${s}'`);const a=i.model;r.info("Retrieved documents",{doc:t,previousClassDoc:a});const o=T.Ui(a.schema,t.schema);if(!o)return r.info(`Class '${s}' has no changes on schema.`),n();const c=await i.getCards();if(0===c.length)return r.info(`No documents found for class '${s}' after its update.`),n();const l=await Promise.all(c.map(async e=>await k(e,o,i)));await e.db.bulkDocs(l),r.info("Propagated updates")}else if(M(t)){const s=t.type;try{const i=await e.getClass(s);if(i){const e=i.triggers.filter(e=>"before"===e.order);for(const s of e){const e=await s.execute(t);Object.assign(t,e)}if(!await i.validate(t))throw new Error("Discarded object because object not valid for its Class schema")}}catch(e){return Promise.reject(e)}}return n()}}};var C=s(39907);const L=(0,i.A)().child({module:"stack"}),S={_id:{name:"_id",type:"string",config:{maxLength:100,primaryKey:!0}},type:{name:"type",type:"string",config:{maxLength:100}},createTimestamp:{name:"createTimestamp",type:"integer",config:{min:0}},updateTimestamp:{name:"updateTimestamp",type:"integer",config:{min:0}},description:{name:"description",type:"string",config:{maxLength:1e3}},active:{name:"active",type:"boolean",config:{defaultValue:!0,primaryKey:!0}}},E=Object.assign(Object.assign({},S),{schema:{name:"schema",type:"object",config:{maxLength:1e3,isArray:!0}},parentClass:{name:"parentClass",type:"foreign_key",config:{isArray:!1}}}),v=Object.assign({schema:{name:"schema",type:"object",config:{isArray:!0,defaultValue:[{name:"source",type:"foreign_key",config:{isArray:!1}},{name:"target",type:"foreign_key",config:{isArray:!1}}]}},parentDomain:{name:"parentDomain",type:"foreign_key",config:{isArray:!1}},relation:{name:"relation",type:"string",config:{maxLength:100,isArray:!1}},sourceClass:{name:"sourceClass",type:"foreign_key",config:{isArray:!0}},targetClass:{name:"targetClass",type:"foreign_key",config:{isArray:!0}}},S);class Y extends d{constructor(){super(),this.appVersion="0.0.1",this.listeners=[],this.modelWorker=null,this.patches=[],this.dump=async()=>await this.db.allDocs({include_docs:!0}),this.setListeners=()=>{const e=L.child({method:"setListeners"});this.addEventListener("class-model-propagation-pending",this.onClassModelPropagationStart),this.addEventListener("class-model-propagation-complete",this.onClassModelPropagationComplete),e.info("Setting up class model worker"),this.modelWorker=new Worker(s(47618),{type:"module"}),e.info("Setting up class model changes listener");const t=this.onClassModelChanges();this.modelWorker.onmessage=t=>{const{status:s,className:i,message:a}=t.data;this.dispatchEvent(new CustomEvent("class-model-propagation-complete",{detail:{className:i,success:"success"===s,message:a}})),"error"===s&&e.error(`Model worker error for class '${i}': ${a}`)},this.listeners.push(t)},this.removeAllListeners=()=>{this.removeEventListener("class-model-propagation-pending",this.onClassModelPropagationStart),this.removeEventListener("class-model-propagation-complete",this.onClassModelPropagationComplete),this.listeners=[]},this.onClassModelPropagationStart=e=>{const t=e.detail.className,s=L.child({method:"onClassModelPropagationStart",className:t});this.addClassLock(t).then(()=>{s.info(`Lock created successfully for class: '${t}'`)}).catch(e=>{s.error(`Error creating lock for '${t}': ${e}`)})},this.onClassModelPropagationComplete=e=>{const t=L.child({method:"onClassModelPropagationComplete",args:{event:e}}),s=e.detail.className;this.clearClassLock(s).then(()=>{t.info(`Lock removed successfully for class: '${s}'`)}).catch(e=>{t.error(`Error removing lock for '${s}': ${e}`)})},this.onClassModelChanges=()=>{const e=L.child({listener:"classModelChanges"});return this.db.changes({since:"now",live:!0,include_docs:!0,filter:e=>"class"==e.type}).on("change",async t=>{const s=t.doc;if(s&&h(s)&&s.active){const t=s.name;e.info(`Class model was updated. Clearing '${t}' from cache.`),delete this.cache[t],e.info(`Successfully cleared '${t}' from cache.`)}else if(s&&h(s)&&!s.active){const t=s.name;e.info(`Class was deleted. Removing from '${t} from cache.'`)}})},this.onClassLock=e=>{const t=this.db.changes({since:"now",live:!0,include_docs:!0,filter:t=>"~lock"==t.type&&t._id==`~lock-propagation-${e}`});return this.listeners.push(t),t},this.addClassLock=async e=>{const t=L.child({method:"addClassLock",args:{className:e}});try{const s=await this.db.get(`~lock-propagation-${e}`);let i;s&&(i=s._rev);const a=await this.db.put({_id:`~lock-propagation-${e}`,type:"~Lock",_rev:i});return t.info("Adding class lock response",{response:a}),a.ok}catch(e){return t.error(`Error while adding class lock: ${e}`),!1}},this.clearClassLock=async e=>{const t=L.child({method:"clearClassLock",args:{className:e}});try{const s=await this.db.get(`~lock-propagation-${e}`);t.info("Fetched class lock",{document:s});const i=await this.db.remove(s);return t.info("Removing class lock response",{response:i}),i.ok}catch(e){return t.error(`Error while adding class lock: ${e}`),!1}},this.onClassDoc=e=>{const t=this.db.changes({since:"now",live:!0,include_docs:!0,filter:t=>t.type==e});return this.listeners.push(t),t},this.close=()=>{this.removeAllListeners(),this.modelWorker&&this.modelWorker.terminate()},this.getClass=async(e,t=!1)=>{if(!t&&this.cache[e]&&Date.now()<this.cache[e].ttl)return L.info("getClass -  retrieving class from cache",{ttl:this.cache[e].ttl}),this.cache[e];const s=await A.fetch(this,e);return s&&(s.ttl=Date.now()+9e5,this.cache[e]=s),s},this.findDocuments=async(e,t,s,i)=>{const a=L.child({method:"findDocuments",args:{selector:e,fields:t,skip:s,limit:i}});e.hasOwnProperty("active")||(e.active=!0);let r=Object.keys(e);a.info("Produced index fields from selector",{indexFields:r});let n={docs:[]};try{let r=await this.db.find({selector:e,fields:t,skip:s,limit:i});return a.info("Found",{result:r,selector:e}),n={docs:r.docs,selector:e,skip:s,limit:i},n}catch(t){return a.error("findDocument - error",t),{docs:[],error:t.toString(),selector:e,skip:s,limit:i}}},this.getClassModel=async e=>{let t={type:{$eq:"class"},name:{$eq:e}};try{let e=await this.findDocument(t);if(null==e)return null;let s=e;return L.info("getClassModel - result",{result:s}),s}catch(e){throw L.info("getClassModel - error",e),new Error(e)}},this.getAllClasses=async()=>{const e=L.child({method:"getAllClasses"});e.info("Requesting");let t=await this.getAllClassModels();e.info("Received classes models",{classModels:t});let s=[];for(const i of t){e.info(`Building class "${i.name}" from model`,{classModel:i});const t=await A.buildFromModel(this,i);s.push(t)}return e.info("Completed classes build"),s},this.addClass=async e=>{let t=e.getModel();L.info("addClass - got class model",{classModel:t});let s=await this.getClassModel(t.name);if(null==s){let s=await this.createDoc(t.name,"class",e,t);return L.info("addClass - result",{result:s}),s}return s},this.updateClass=async e=>{let t=await this.createDoc(e.getId(),"class",e,e.getModel());return L.info("updateClass - result",t),t},this.addDesignDocumentPKs=async(e,t,s=!1)=>{const i=L.child({method:"addDesignDocumentPKs",args:{className:e,pKs:t}}),a=t.map(e=>`doc.${e}`).join(", "),r=`function (doc) {\n            const hasAllKeys = ${t.map(e=>`doc.${e}`).join(" && ")};\n            if (hasAllKeys && doc.type === '${e}') {\n            emit([${a}], doc._id);\n            }\n        }`;i.info("Generated map code",{code:r});let n=`_design/${e}-group`;s&&(n=`_design/${e}-group-temp`);const o={_id:n,views:{by_pKeys:{map:r}},_rev:void 0};i.info("Prepared design document",{ddoc:o});try{const e=await this.db.get(n);o._rev=e._rev,await this.db.put(o),i.info("Design document updated successfully.")}catch(e){if("not_found"!==e.name)throw i.error("Error saving design document:",e),e;await this.db.put(o),i.info("Design document created successfully.")}return n},this.validateObjectByType=async(e,t,s)=>{const i=L.child({method:"validateObjectByType",args:{obj:e,type:t,schema:s}});let a={};switch(t){case"class":a=E;break;case"domain":a=v;break;default:if(!s)try{a=(await this.getClassModel(t)).schema}catch(e){return i.error(`Failed because of error: ${e}`),!1}}if(a)return await this.validateObject(e,t,a);throw new Error("Unable to retrieve schema to validate object against")},this.createDoc=async(e,t,s,i)=>{let a=s.buildSchema();L.info("createDoc - args",{docId:e,type:t,params:i,schema:a});let r=this.db,n=null,o=!1;try{if(e){const s=await this.getDocument(e);if(L.info("retrieved doc",{existingDoc:s}),s&&s.type===t)L.info("createDoc - assigning existing doc",{doc:s}),n=Object.assign({},s);else{if(s&&s.type!==t)throw new Error("createDoc - Existing document type differs");o=!0,n=this.prepareDoc(e,t,i)}}else e=`${t}-${this.lastDocId+1}`,n=this.prepareDoc(e,t,i),o=!0,L.info("createDoc - generated docId",e);L.info("createDoc - doc BEFORE elaboration (i.e. merge)",{doc:n,params:i});const s=Object.assign(Object.assign(Object.assign({},n),i),{_id:e,_rev:n._rev,updateTimestamp:(new Date).getTime()});L.info("createDoc - doc AFTER elaboration (i.e. merge)",{doc_:s});let a=await r.put(s);if(L.info("createDoc - Response after put",{response:a}),a.ok&&o)this.incrementLastDocId(),e=a.id;else{if(!a.ok)throw new Error("createDoc - error:"+a.ok);e=a.id}}catch(e){if("conflict"!==e.name)throw L.info("createDoc - Problem while putting doc",{error:e,document:n}),new Error("createDoc - Problem while putting doc"+e);L.info("createDoc - conflict! Ignoring..")}return n},this.deleteDocument=async e=>{const t=L.child({method:"deleteDocument",args:{_id:e}}),s=await this.db.get(e);if(!s)return t.error("Found no document with given id"),!1;try{return await this.db.put(Object.assign(Object.assign({},s),{active:!1})),!0}catch(e){return t.error(`Error while deleting document: ${e}`,{document:s}),!1}},this.cache={}}async initialize(e,t){this.connection=e,this.options=t,(null==t?void 0:t.name)&&(this.name=null==t?void 0:t.name);const i=e.match(/(?<=db-).*/);this.name=i?i[0]:e;let r=(await Promise.all([s.e(997),s.e(9415),s.e(4616),s.e(3729),s.e(8224),s.e(6743),s.e(3367),s.e(9184),s.e(6122),s.e(1590),s.e(8145),s.e(4318),s.e(4671),s.e(5908),s.e(8472),s.e(2353),s.e(9575),s.e(8209),s.e(8049),s.e(6571),s.e(9104),s.e(881),s.e(1929),s.e(1151),s.e(3462),s.e(3245),s.e(730),s.e(8959),s.e(5805),s.e(4635),s.e(386),s.e(7062),s.e(5582),s.e(5699),s.e(2708),s.e(5316),s.e(6556),s.e(799),s.e(7536),s.e(5126),s.e(6931),s.e(8984),s.e(9589),s.e(5403),s.e(2290),s.e(5495),s.e(9122),s.e(5840),s.e(873),s.e(4289),s.e(9761),s.e(4772),s.e(7461),s.e(1165),s.e(6808),s.e(9681),s.e(5850),s.e(5695),s.e(8951),s.e(1502),s.e(1748),s.e(1851),s.e(325),s.e(6055),s.e(6813),s.e(9317),s.e(2573),s.e(1853),s.e(5448),s.e(9955),s.e(5391),s.e(9683),s.e(7243),s.e(5758),s.e(6891),s.e(9765),s.e(1871),s.e(4005),s.e(5546),s.e(8279),s.e(8312),s.e(8409),s.e(9408),s.e(2073),s.e(8969),s.e(6765),s.e(7579),s.e(2721),s.e(2893),s.e(1513),s.e(5506),s.e(979),s.e(3380),s.e(8349),s.e(8646),s.e(689),s.e(9936),s.e(2859),s.e(4669),s.e(4607),s.e(646),s.e(7003),s.e(3566),s.e(1598)]).then(s.bind(s,75312))).default;if(a.A.plugin(r),a.A.plugin(O(this)),null==t?void 0:t.plugins)for(let e of t.plugins)a.A.plugin(e);this.db=new a.A(e),this.cache={}}getDb(){return this.db}async getDbInfo(){return this.db.info()}getDbName(){return this.db.name}static async create(e,t){const s=new Y;return await s.initialize(e,t),await s.initdb(),s}async getLastDocId(){let e=0;try{e=(await this.db.get("lastDocId")).value}catch(t){if("not_found"===t.name)return L.info("getLastDocId - not found. Must be first initialization."),e;L.error("checkdb - something went wrong",{error:t})}return e}async getSystem(){try{return await this.db.get("~system")}catch(e){if("not_found"===e.name)return L.info("get System - not found",e),null;throw L.error("getSystem - something went wrong",{error:e}),new Error(e)}}async loadPatches(){let e="patch";C.env.BUILDING&&(e="patch");try{let t=Number(this.patchCount);L.info(`loadPatches - preparing to load ${t} patches`);let s=await Promise.all(Array.from({length:t}).map((t,s)=>{var i=`${s}`.padStart(3,"0"),a=`${e}/patch-${i}.json`;return L.info("loadPatches - loading patch from path",{path:a}),(0,z.importJsonFile)(a)}));return s=s.map(e=>(L.info("loadPatches - Parsing patch",{patch:e}),e)),L.info("loadPatches - Successfully loaded patches"),L.info("loadPatches - patches",{patches:s}),s}catch(e){throw L.error("loadPatches - something went wrong",e),new Error(e)}}async applyPatch(e){try{return L.info("applyPatch - attempting to apply patch",{patch:e}),await this.db.bulkDocs(e.docs),L.info("applyPatch - Successfully applied patch",{version:e.version}),e.version}catch(e){throw L.error("applyPatch - something went wrong",e),new Error(e)}}async applyPatches(e){let t=e;try{this.patchCount=(0,z.countPatches)();const s=await this.loadPatches();this.patches=s;const i=e?s.findIndex(t=>t.version===e)+1:0;if(L.info(`applyPatches - Starting to apply patches from index ${i}`),-1===i||i===s.length)return L.info("applyPatches - No patches to apply"),this.schemaVersion=e,e;let a=s.slice(i);for(let e of a)t=await this.applyPatch(e);return L.info("applyPatches - Successfully applied patches till version",{version:t}),this.schemaVersion=t,t}catch(e){throw L.error("applyPatches - something went wrong",e),new Error(e)}}async checkSystem(){let e,t=await this.getSystem();const s=await this.getDbInfo();if(L.info("checkSystem - current system doc",{system:t}),t){L.info("checkSystem - system doc already exists. Checking for updates",t);let i=await this.applyPatches(t.schemaVersion);e=Object.assign(Object.assign({},t),{appVersion:this.appVersion,dbInfo:s,schemaVersion:i,startupTime:(new Date).valueOf()})}else{e={_id:"~system",appVersion:this.appVersion,dbInfo:s,schemaVersion:void 0,startupTime:(new Date).valueOf()};let t=await this.applyPatches(e.schemaVersion);e.schemaVersion=t}try{await this.db.put(e)}catch(e){throw L.error("checkSystem - There was a problem while updating system",{error:e}),new Error(e)}L.info("checkSystem - updated system",{system:e})}async initdb(){return await this.initIndex(),await this.checkSystem(),this.setListeners(),this}async initIndex(){try{let e=await this.getLastDocId();if(e)L.info("initdb - db already initialized, consider purge");else{e=Number(e);let t=await this.db.put({_id:"lastDocId",value:++e});if(!t.ok)throw new Error("Got problem while putting doc"+t);this.lastDocId=e}this.lastDocId=Number(e)}catch(e){throw L.error("initdb -  something went wrong",e),new Error(e)}}async getDocument(e){let t;try{t=await this.db.get(e)}catch(e){if("not_found"===e.name)return L.info("getDocument - not found",e),null;throw L.info("getDocument - error",e),new Error(e)}return t}async getDocRevision(e){let t=null;try{let s=await this.getDocument(e);s&&(t=s._rev)}catch(e){throw L.info("getDocRevision - error",e),new Error(e)}return t}async findDocument(e,t=void 0,s=void 0,i=void 0){let a=await this.findDocuments(e,t,s,i);return a.docs.length>0?a.docs[0]:null}async getAllClassModels(){return(await this.findDocuments({type:{$eq:"class"}},["_id","name","description","schema"])).docs}async getClassModels(e){return(await this.getAllClassModels()).filter(t=>e.includes(t.name))}async incrementLastDocId(){let e=await this.getDocRevision("lastDocId");if(e)return await this.db.put({_id:"lastDocId",_rev:e,value:++this.lastDocId}),this.lastDocId}async reset(){return await this.destroyDb(),await new Promise(e=>setTimeout(e,2e3)),await this.initialize(this.connection,this.options),await this.initdb(),this}async destroyDb(){const e=L.child({method:"destroyDb"});try{this.db.destroy(null,()=>(e.info("Destroyed db"),!0))}catch(t){return e.error(`Error while destroying db: ${t}`),!1}}static async clear(e){return new Promise((t,s)=>{try{new a.A(e).destroy(null,()=>{L.info("clear - Destroyed db"),t(!0)})}catch(e){L.error("clear - Error while destroying db"+e),s(!1)}})}async validateObject(e,t,s){L.info("validateObject - given args",{obj:e,schema:s});let i=!0;try{for(let i of Object.values(s)){let s=e[i.name];if(L.info("validateObject - model",{model:i,value:s}),void 0===s&&i.config.mandatory){let e=`Property ${i.name} does not exist on the object.`;throw L.error(e),new Error(e)}if(!i.config.mandatory&&void 0===s){let e=`Property ${i.name} is not mandatory and does not exist on the object. Skipping validation of this attribute`;L.info(e);continue}switch(i.config.defaultValue&&void 0===s&&(L.info(`Property ${i.name} is missing, setting to default value.`),e[i.name]=i.config.defaultValue,s=e[i.name]),i.type){case"string":if(!i.config.isArray&&typeof s!==i.type)return L.info(`Property ${i.name} is not of type ${i.type}.`),!1;if(i.config.isArray&&!Array.isArray(s))return L.info(`Property ${i.name} is not an array.`),!1;if(i.config){if(i.config.maxLength&&s.length>i.config.maxLength)return L.info(`Property ${i.name} is longer than ${i.config.maxLength} characters.`),!1;if(i.config.encrypted){let e=f();if(console.log("decryptedString",e),null===e)return L.info(`Property ${i.name} is not encrypted correctly.`),!1}if(i.config.primaryKey){L.info("primaryKey check",{type:t,model:i,value:s});let e=await this.findDocuments({type:{$eq:t},[i.name]:{$eq:s}});if(e.docs.length>0)throw L.info(`A card with property ${i.name} already exists.`,e),new Error(`A card with property ${i.name} already exists.`)}}break;case"decimal":if(i.config){if(i.config.min&&s<i.config.min)return L.info(`Property ${i.name} is less than ${i.config.min}.`),!1;if(i.config.max&&s>i.config.max)return L.info(`Property ${i.name} is greater than ${i.config.max}.`),!1}break;case"integer":if(i.config.isArray||"number"==typeof s){if(i.config.isArray&&(!Array.isArray(s)||!s.every(e=>"number"==typeof e)))return L.info(`Property ${i.name} is not an array.`),!1}else L.info(`Property ${i.name} is not of type ${i.type}.`);if(i.config){if(i.config.min&&s<i.config.min)return L.info(`Property ${i.name} is less than ${i.config.min}.`),!1;if(i.config.max&&s>i.config.max)return L.info(`Property ${i.name} is greater than ${i.config.max}.`),!1}break;case"foreign_key":if(i.config,null==await this.getDocument(s))return L.info(`Foreign key ${s} does not exist.`),!1;break;case"object":L.info("Missing json validation. Skipping for now.");break;default:throw new Error("Unexpected type received")}}}catch(e){return L.info("validateObject - error",e),!1}return L.info("validateObject - result",{type:t,result:i}),i}prepareDoc(e,t,s){return L.info("prepareDoc - given args",{_id:e,type:t,params:s}),s._id=e,s.type=t,s.createTimestamp=(new Date).getTime(),s.active=!0,L.info("prepareDoc - after elaborations",{params:s}),s}}const Q=Y;class U extends EventTarget{async addStack(e){let t;if("object"==typeof e&&e.name?t=await Q.create(`db-${e.name}`,{plugins:[]}):"string"==typeof e&&(t=await Q.create(`db-${e}`,{plugins:[]})),t){this.stacks.push(t);let e=window;return e.stacks&&e.stacks.push(t),t}}async resetAll(){try{for(const e of this.stacks)await e.reset()}catch(e){throw new Error(e)}}getStacks(){return this.stacks}getReadyState(){return this.readyState}async reset(){try{await this.resetAll(),await this.initStacks(this.config)}catch(e){throw new Error(e)}}constructor(...e){super(),this.config=[],this.stacks=[],this.logger=(0,i.A)().child({module:"client"}),this.initStacks=async e=>{for(const t of e)await this.addStack(t);this.readyState=!0,this.dispatchEvent(new CustomEvent("ready",{detail:{stacks:this.stacks}}))},this.getStack=e=>this.stacks.find(t=>t.name==e||t.connection==e),this.clearConnection=async e=>{const t=this.logger.child({method:"clearConnection"});try{if(!e)throw new Error("Connection name not provided");await Q.clear(e),t.info("Internal database cleared")}catch(e){throw new Error(e)}},this.export=async e=>{const t=this.getStack(e);if(t)return await t.dump();throw new Error(`Did not find any stack for name '${e}'`)},this.createClass=async(e,t)=>{const s=this.logger.child({method:"createClass"}),{type:i,description:a}=t;s.info("Args",{name:e,config:t});try{const t=await A.create(this.store,e,i,a,{});s.info(`class '${e}' created successfully.`,{classModel:t.getModel()})}catch(t){throw new Error(`Error during class '${e} creation. ${t}`)}s.info("Class created successfully")},this.createAttribute=async(e,t)=>{const s=this.logger.child({method:"createAttribute"}),{name:i,type:a,description:r,config:n}=t;s.info(`Creating attribute for class '${e}'`,{name:i,type:a,config:n});try{let t=await this.store.getClass(e);if(!t)throw new Error(`Failed to retrieve Class '${e}'`);{let o=await j.create(t,i,a,r,n);s.info(`Attribute '${i}' added to class '${e}'`,{attributeModel:o.getModel()})}}catch(e){throw s.error(`Error during attribute '${i}' creation: ${e}`),new Error(`Error during attribute '${i}' creation: ${e}`)}},this.readyState=!1;const t=this.logger.child({method:"constructor"});this.initStacks(e),this.addEventListener("ready",()=>t.info("DocStack client successfully initialized"))}}},92749:(e,t,s)=>{"use strict";s.a(e,async(e,t)=>{try{var i=s(31085),a=s(14041),r=s(25873),n=s(43705),o=s(38913),c=s(4002),l=s(73657),d=e([c]);c=(d.then?(await d)():d)[0],(0,r.H)(document.getElementById("root")).render((0,i.jsx)(a.StrictMode,{children:(0,i.jsx)(n.Kq,{store:c.M,children:(0,i.jsx)(l.Kd,{basename:"/docstack/app",children:(0,i.jsx)(o.A,{})})})})),t()}catch(e){t(e)}})},97174:(e,t,s)=>{var i={"./":10881,"./index":10881,"./index.ts":10881,"./patch/patch-000.json":48241};function a(e){var t=r(e);return s(t)}function r(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id=97174},98933:(e,t,s)=>{var i={"./simpleWorker":99246,"./simpleWorker.js":99246};function a(e){return Promise.resolve().then(()=>{if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s(i[e])})}a.keys=()=>Object.keys(i),a.id=98933,e.exports=a},99231:()=>{}},e=>{e.O(0,[997,9415,4616,3729,8224,6743,3367,9184,6122,1590,8145,4318,4671,5908,8472,2353,9575,8209,8049,6571,9104,881,1929,1151,3462,3245,730,8959,5805,4635,386,7062,5582,5699,2708,5316,6556,799,7536,5126,6931,8984,9589,5403,2290,5495,9122,5840,873,4289,9761,4772,7461,1165,6808,9681,5850,5695,8951,1502,1748,1851,325,6055,6813,9317,2573,1853,5448,9955,5391,9683,7243,5758,6891,9765,1871,4005,5546,8279,8312,8409,9408,2073,8969,6765,7579,2721,2893,1513,5506,979,3380,8349,8646,689,9936,2859,4669,4607,646,7003,3566,1598],()=>e(e.s=92749)),e.O()}]);