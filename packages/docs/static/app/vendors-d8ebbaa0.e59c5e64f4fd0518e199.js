"use strict";(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[6748],{3161:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(37709);function o(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}function i(e,t){return function(e,t){return function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}([o(e)],{type:t})}(atob(e),t)}var c=n(96676),u=n(36791),s=n(23541),a=n(6418),d=n(87689),f=n(7726);class l{constructor(){this.promise=new Promise(function(e){e()})}add(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise}finish(){return this.promise}}function y(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}async function h(e,t,n,r,o,i){const c=function(e,t){return y(e)+y(t)+"undefined"}(n,r);let u;if(!o&&(u=e._cachedViews=e._cachedViews||{},u[c]))return u[c];const s=e.info().then(async function(s){const f=s.db_name+"-mrview-"+(o?"temp":(0,d.m)(c));await(0,a.el)(e,"_local/"+i,function(e){e.views=e.views||{};let n=t;-1===n.indexOf("/")&&(n=t+"/"+t);const r=e.views[n]=e.views[n]||{};if(!r[f])return r[f]=!0,e});const l=(await e.registerDependentDatabase(f)).db;l.auto_compaction=!0;const y={name:f,db:l,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let h;try{h=await y.db.get("_local/lastSeq")}catch(e){if(404!==e.status)throw e}return y.seq=h?h.seq:0,u&&y.db.once("destroyed",function(){delete u[c]}),y});return u&&(u[c]=s),s}var p={},_=new l;function w(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function v(e,t,n){try{e.emit("error",t)}catch(e){(0,a.ue)("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),(0,a.ue)("error",t,n)}}const g=function(e,t,n,o){function d(e,t,n){try{t(n)}catch(r){v(e,r,{fun:t,doc:n})}}function y(e,t,n,r,o){try{return{output:t(n,r,o)}}catch(i){return v(e,i,{fun:t,keys:n,values:r,rereduce:o}),{error:i}}}function g(e,t){const n=(0,c.Zc)(e.key,t.key);return 0!==n?n:(0,c.Zc)(e.value,t.value)}function k(e,t,n){return n=n||0,"number"==typeof t?e.slice(n,t+n):n>0?e.slice(n):e}function m(e){const t=e.value;return t&&"object"==typeof t&&t._id||e.id}function b(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach(function(e){const t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){const n=t[e];t[e].data=i(n.data,n.content_type)})})}(t),t}}function B(e,t,n,r){let o=t[e];void 0!==o&&(r&&(o=encodeURIComponent(JSON.stringify(o))),n.push(e+"="+o))}function q(e){if(void 0!==e){const t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function A(e,t){const n=e.descending?"endkey":"startkey",r=e.descending?"startkey":"endkey";if(void 0!==e[n]&&void 0!==e[r]&&(0,c.Zc)(e[n],e[r])>0)throw new f.cf("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new f.cf("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new f.cf("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){const n=function(e){if(e){if("number"!=typeof e)return new f.cf(`Invalid value for integer: "${e}"`);if(e<0)return new f.cf(`Invalid value for positive integer: "${e}"`)}}(e[t]);if(n)throw n})}function D(e){return function(t){if(404===t.status)return e;throw t}}function I(e){const t="string"==typeof e?e:e.name;let n=p[t];return n||(n=p[t]=new l),n}async function S(e,n){return(0,f.An)(I(e),function(){return async function(e,n){let o,i,u;const s=t(e.mapFun,function(e,t){const n={id:i._id,key:(0,c.l5)(e)};null!=t&&(n.value=(0,c.l5)(t)),o.push(n)});let y=e.seq||0;function h(t,n){return function(){return function(e,t,n){var o="_local/lastSeq";return e.db.get(o).catch(D({_id:o,seq:0})).then(function(o){var i=(0,f.t8)(t);return Promise.all(i.map(function(n){return async function(e,t,n){const o="_local/doc_"+e,i={_id:o,keys:[]},c=n.get(e),u=c[0],s=c[1],a=await(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(s)?Promise.resolve(i):t.db.get(o).catch(D(i))),d=await function(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):Promise.resolve({rows:[]})}(a);return function(e,t){const n=[],o=new r.N;for(let e=0,r=t.rows.length;e<r;e++){const r=t.rows[e].doc;if(r&&(n.push(r),o.add(r._id),r._deleted=!u.has(r._id),!r._deleted)){const e=u.get(r._id);"value"in e&&(r.value=e.value)}}const i=(0,f.t8)(u);return i.forEach(function(e){if(!o.has(e)){const t={_id:e},r=u.get(e);"value"in r&&(t.value=r.value),n.push(t)}}),e.keys=(0,f.sb)(i.concat(e.keys)),n.push(e),n}(a,d)}(n,e,t)})).then(function(t){var r=(0,a.Bq)(t);return o.seq=n,r.push(o),e.db.bulkDocs({docs:r})}).then(()=>function(e){return e.sourceDB.get("_local/purges").then(function(t){const n=t.purgeSeq;return e.db.get("_local/purgeSeq").then(function(e){return e._rev}).catch(function(e){if(404!==e.status)throw e}).then(function(t){return e.db.put({_id:"_local/purgeSeq",_rev:t,purgeSeq:n})})}).catch(function(e){if(404!==e.status)throw e})}(e))})}(e,t,n)}}let p=0;const _={view:e.name,indexed_docs:p};e.sourceDB.emit("indexing",_);const w=new l;async function v(){return function(t,c){var a=t.results;if(!a.length&&!c.length)return;for(let e of c)if(a.findIndex(function(t){return t.id===e.docId})<0){const t={_id:e.docId,doc:{_id:e.docId,_deleted:1},changes:[]};e.doc&&(t.doc=e.doc,t.changes.push({rev:e.doc._rev})),a.push(t)}var f=function(t){const n=new r.T;for(let r=0,c=t.length;r<c;r++){const c=t[r];if("_"!==c.doc._id[0]){o=[],i=c.doc,i._deleted||d(e.sourceDB,s,i),o.sort(g);const t=k(o);n.set(c.doc._id,[t,c.changes])}y=c.seq}return n}(a);w.add(h(f,y)),p+=a.length;const l={view:e.name,last_seq:t.last_seq,results_count:a.length,indexed_docs:p};return e.sourceDB.emit("indexing",l),e.sourceDB.activeTasks.update(u,{completed_items:p}),a.length<n.changes_batch_size?void 0:v()}(await e.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:y,limit:n.changes_batch_size}),await e.db.get("_local/purgeSeq").then(function(e){return e.purgeSeq}).catch(function(e){if(e&&404!==e.status)throw e;return-1}).then(function(t){return e.sourceDB.get("_local/purges").then(function(n){const r=n.purges.filter(function(e,n){return n>t}).map(e=>e.docId),o=r.filter(function(e,t){return r.indexOf(e)===t});return Promise.all(o.map(function(t){return e.sourceDB.get(t).then(function(e){return{docId:t,doc:e}}).catch(function(e){if(404!==e.status)throw e;return{docId:t}})}))}).catch(function(e){if(e&&404!==e.status)throw e;return[]})}))}function k(e){const t=new r.T;let n;for(let r=0,o=e.length;r<o;r++){const o=e[r],i=[o.key,o.id];r>0&&0===(0,c.Zc)(o.key,n)&&i.push(r),t.set((0,c.$n)(i),o),n=o.key}return t}try{await e.sourceDB.info().then(function(t){u=e.sourceDB.activeTasks.add({name:"view_indexing",total_items:t.update_seq-y})}),await v(),await w.finish(),e.seq=y,e.sourceDB.activeTasks.remove(u)}catch(t){e.sourceDB.activeTasks.remove(u,t)}}(e,n)})()}function O(e,t){return(0,f.An)(I(e),function(){return async function(e,t){let o;const i=e.reduceFun&&!1!==t.reduce,u=t.skip||0;async function s(t){t.include_docs=!0;const n=await e.db.allDocs(t);return o=n.total_rows,n.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){const t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}const t=(0,c.d0)(e.doc._id);return{key:t[0],id:t[1],value:"value"in e.doc?e.doc.value:null}})}async function d(s){let a;if(a=i?function(e,t,r){0===r.group_level&&delete r.group_level;const o=r.group||r.group_level,i=n(e.reduceFun),u=[],s=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;t.forEach(function(e){const t=u[u.length-1];let n=o?e.key:null;if(o&&Array.isArray(n)&&(n=n.slice(0,s)),t&&0===(0,c.Zc)(t.groupKey,n))return t.keys.push([e.key,e.id]),void t.values.push(e.value);u.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})}),t=[];for(let n=0,r=u.length;n<r;n++){const r=u[n],o=y(e.sourceDB,i,r.keys,r.values,!1);if(o.error&&o.error instanceof f.Oh)throw o.error;t.push({value:o.error?null:o.output,key:r.groupKey})}return{rows:k(t,r.limit,r.skip)}}(e,s,t):void 0===t.keys?{total_rows:o,offset:u,rows:s}:{total_rows:o,offset:u,rows:k(s,t.limit,t.skip)},t.update_seq&&(a.update_seq=e.seq),t.include_docs){const n=(0,f.sb)(s.map(m)),o=await e.sourceDB.allDocs({keys:n,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary});var d=new r.T;return o.rows.forEach(function(e){d.set(e.id,e.doc)}),s.forEach(function(e){var t=m(e),n=d.get(t);n&&(e.doc=n)}),a}return a}if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){const e=t.keys.map(function(e){const n={startkey:(0,c.$n)([e]),endkey:(0,c.$n)([e,{}])};return t.update_seq&&(n.update_seq=!0),s(n)}),n=await Promise.all(e);return d((0,a.Bq)(n))}{const e={descending:t.descending};let n,r;if(t.update_seq&&(e.update_seq=!0),"start_key"in t&&(n=t.start_key),"startkey"in t&&(n=t.startkey),"end_key"in t&&(r=t.end_key),"endkey"in t&&(r=t.endkey),void 0!==n&&(e.startkey=t.descending?(0,c.$n)([n,{}]):(0,c.$n)([n])),void 0!==r){let n=!1!==t.inclusive_end;t.descending&&(n=!n),e.endkey=(0,c.$n)(n?[r,{}]:[r])}if(void 0!==t.key){const n=(0,c.$n)([t.key]),r=(0,c.$n)([t.key,{}]);e.descending?(e.endkey=n,e.startkey=r):(e.startkey=n,e.endkey=r)}return i||("number"==typeof t.limit&&(e.limit=t.limit),e.skip=u),d(await s(e))}}(e,t)})()}return{query:function(t,n,r){const i=this;"function"==typeof n&&(r=n,n={}),n=n?function(e){return e.group_level=q(e.group_level),e.limit=q(e.limit),e.skip=q(e.skip),e}(n):{},"function"==typeof t&&(t={map:t});const c=Promise.resolve().then(function(){return async function(t,n,r){if("function"==typeof t._query)return function(e,t,n){return new Promise(function(r,o){e._query(t,n,function(e,t){if(e)return o(e);r(t)})})}(t,n,r);if((0,a.Vx)(t))return async function(e,t,n){let r,o,i=[],c="GET";if(B("reduce",n,i),B("include_docs",n,i),B("attachments",n,i),B("limit",n,i),B("descending",n,i),B("group",n,i),B("group_level",n,i),B("skip",n,i),B("stale",n,i),B("conflicts",n,i),B("startkey",n,i,!0),B("start_key",n,i,!0),B("endkey",n,i,!0),B("end_key",n,i,!0),B("inclusive_end",n,i),B("key",n,i,!0),B("update_seq",n,i),i=i.join("&"),i=""===i?"":"?"+i,void 0!==n.keys){const e=2e3,o=`keys=${encodeURIComponent(JSON.stringify(n.keys))}`;o.length+i.length+1<=e?i+=("?"===i[0]?"&":"?")+o:(c="POST","string"==typeof t?r={keys:n.keys}:t.keys=n.keys)}if("string"==typeof t){const a=w(t),d=await e.fetch("_design/"+a[0]+"/_view/"+a[1]+i,{headers:new s.Lr({"Content-Type":"application/json"}),method:c,body:JSON.stringify(r)});o=d.ok;const f=await d.json();if(!o)throw f.status=d.status,(0,u.hp)(f);return f.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)}),new Promise(function(e){e(f)}).then(b(n))}r=r||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?r[e]=t[e]:r[e]=t[e].toString()});const a=await e.fetch("_temp_view"+i,{headers:new s.Lr({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(r)});o=a.ok;const d=await a.json();if(!o)throw d.status=a.status,(0,u.hp)(d);return new Promise(function(e){e(d)}).then(b(n))}(t,n,r);const i={changes_batch_size:t.__opts.view_update_changes_batch_size||50};if("string"!=typeof n)return A(r,n),_.add(async function(){const o=await h(t,"temp_view/temp_view",n.map,n.reduce,!0,e);return(0,f.UO)(S(o,i).then(function(){return O(o,r)}),function(){return o.db.destroy()})}),_.finish();{const c=n,u=w(c),s=u[0],d=u[1],l=await t.get("_design/"+s);if(!(n=l.views&&l.views[d]))throw new f.m_(`ddoc ${l._id} has no view named ${d}`);o(l,d),A(r,n);const y=await h(t,c,n.map,n.reduce,!1,e);return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&(0,a.dY)(function(){S(y,i)}),O(y,r)):(await S(y,i),O(y,r))}}(i,t,n)});return(0,f.t6)(c,r),c},viewCleanup:(0,f.Kw)(function(){const t=this;return"function"==typeof t._viewCleanup?function(e){return new Promise(function(t,n){e._viewCleanup(function(e,r){if(e)return n(e);t(r)})})}(t):(0,a.Vx)(t)?async function(e){return(await e.fetch("_view_cleanup",{headers:new s.Lr({"Content-Type":"application/json"}),method:"POST"})).json()}(t):async function(t){try{const n=await t.get("_local/"+e),o=new r.T;Object.keys(n.views).forEach(function(e){const t=w(e),n="_design/"+t[0],i=t[1];let c=o.get(n);c||(c=new r.N,o.set(n,c)),c.add(i)});const i={keys:(0,f.t8)(o),include_docs:!0},c=await t.allDocs(i),u={};c.rows.forEach(function(e){const t=e.key.substring(8);o.get(e.key).forEach(function(r){let o=t+"/"+r;n.views[o]||(o=r);const i=Object.keys(n.views[o]),c=e.doc&&e.doc.views&&e.doc.views[r];i.forEach(function(e){u[e]=u[e]||c})})});const s=Object.keys(u).filter(function(e){return!u[e]}).map(function(e){return(0,f.An)(I(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return Promise.all(s).then(function(){return{ok:!0}})}catch(e){if(404===e.status)return{ok:!0};throw e}}(t)})}}},69501:e=>{e.exports=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]}}]);