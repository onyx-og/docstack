"use strict";(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[4289],{16071:(t,e,n)=>{n.d(e,{R_:()=>o});var i=n(72667),s=n(55818),r=n(92692);class o{constructor(t,e,n,i,s){this.injectionOffsets=t,this.injectionOptions=e,this.breakOffsets=n,this.breakOffsetsVisibleColumn=i,this.wrappedTextIndentLength=s}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(t){return t>0?this.wrappedTextIndentLength:0}getLineLength(t){const e=t>0?this.breakOffsets[t-1]:0;let n=this.breakOffsets[t]-e;return t>0&&(n+=this.wrappedTextIndentLength),n}getMaxOutputOffset(t){return this.getLineLength(t)}translateToInputOffset(t,e){t>0&&(e=Math.max(0,e-this.wrappedTextIndentLength));let n=0===t?e:this.breakOffsets[t-1]+e;if(null!==this.injectionOffsets)for(let t=0;t<this.injectionOffsets.length&&n>this.injectionOffsets[t];t++)n<this.injectionOffsets[t]+this.injectionOptions[t].content.length?n=this.injectionOffsets[t]:n-=this.injectionOptions[t].content.length;return n}translateToOutputPosition(t,e=2){let n=t;if(null!==this.injectionOffsets)for(let i=0;i<this.injectionOffsets.length&&!(t<this.injectionOffsets[i])&&(1===e||t!==this.injectionOffsets[i]);i++)n+=this.injectionOptions[i].content.length;return this.offsetInInputWithInjectionsToOutputPosition(n,e)}offsetInInputWithInjectionsToOutputPosition(t,e=2){let n=0,i=this.breakOffsets.length-1,s=0,r=0;for(;n<=i;){s=n+(i-n)/2|0;const o=this.breakOffsets[s];if(r=s>0?this.breakOffsets[s-1]:0,0===e)if(t<=r)i=s-1;else{if(!(t>o))break;n=s+1}else if(t<r)i=s-1;else{if(!(t>=o))break;n=s+1}}let o=t-r;return s>0&&(o+=this.wrappedTextIndentLength),new l(s,o)}normalizeOutputPosition(t,e,n){if(null!==this.injectionOffsets){const i=this.outputPositionToOffsetInInputWithInjections(t,e),s=this.normalizeOffsetInInputWithInjectionsAroundInjections(i,n);if(s!==i)return this.offsetInInputWithInjectionsToOutputPosition(s,n)}if(0===n){if(t>0&&e===this.getMinOutputOffset(t))return new l(t-1,this.getMaxOutputOffset(t-1))}else if(1===n&&t<this.getOutputLineCount()-1&&e===this.getMaxOutputOffset(t))return new l(t+1,this.getMinOutputOffset(t+1));return new l(t,e)}outputPositionToOffsetInInputWithInjections(t,e){return t>0&&(e=Math.max(0,e-this.wrappedTextIndentLength)),(t>0?this.breakOffsets[t-1]:0)+e}normalizeOffsetInInputWithInjectionsAroundInjections(t,e){const n=this.getInjectedTextAtOffset(t);if(!n)return t;if(2===e){if(t===n.offsetInInputWithInjections+n.length&&a(this.injectionOptions[n.injectedTextIndex].cursorStops))return n.offsetInInputWithInjections+n.length;{let t=n.offsetInInputWithInjections;if(h(this.injectionOptions[n.injectedTextIndex].cursorStops))return t;let e=n.injectedTextIndex-1;for(;e>=0&&this.injectionOffsets[e]===this.injectionOffsets[n.injectedTextIndex]&&!a(this.injectionOptions[e].cursorStops)&&(t-=this.injectionOptions[e].content.length,!h(this.injectionOptions[e].cursorStops));)e--;return t}}if(1===e||4===e){let t=n.offsetInInputWithInjections+n.length,e=n.injectedTextIndex;for(;e+1<this.injectionOffsets.length&&this.injectionOffsets[e+1]===this.injectionOffsets[e];)t+=this.injectionOptions[e+1].content.length,e++;return t}if(0===e||3===e){let t=n.offsetInInputWithInjections,e=n.injectedTextIndex;for(;e-1>=0&&this.injectionOffsets[e-1]===this.injectionOffsets[e];)t-=this.injectionOptions[e-1].content.length,e--;return t}(0,i.xb)(e)}getInjectedText(t,e){const n=this.outputPositionToOffsetInInputWithInjections(t,e),i=this.getInjectedTextAtOffset(n);return i?{options:this.injectionOptions[i.injectedTextIndex]}:null}getInjectedTextAtOffset(t){const e=this.injectionOffsets,n=this.injectionOptions;if(null!==e){let i=0;for(let s=0;s<e.length;s++){const r=n[s].content.length,o=e[s]+i,a=e[s]+i+r;if(o>t)break;if(t<=a)return{injectedTextIndex:s,offsetInInputWithInjections:o,length:r};i+=r}}}}function a(t){return null==t||t===r.VW.Right||t===r.VW.Both}function h(t){return null==t||t===r.VW.Left||t===r.VW.Both}class l{constructor(t,e){this.outputLineIndex=t,this.outputOffset=e}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(t){return new s.y(t+this.outputLineIndex,this.outputOffset+1)}}},24717:(t,e,n)=>{n.d(e,{W:()=>o,c:()=>r});var i=n(81304),s=n(87440);class r{static fromModelContentChanges(t){return t.map(t=>{const e=i.Q.lift(t.range);return new r((0,s.VL)(e.getStartPosition()),(0,s.VL)(e.getEndPosition()),(0,s.rR)(t.text))}).reverse()}constructor(t,e,n){this.startOffset=t,this.endOffset=e,this.newLength=n}toString(){return`[${(0,s.l4)(this.startOffset)}...${(0,s.l4)(this.endOffset)}) -> ${(0,s.l4)(this.newLength)}`}}class o{constructor(t){this.nextEditIdx=0,this.deltaOldToNewLineCount=0,this.deltaOldToNewColumnCount=0,this.deltaLineIdxInOld=-1,this.edits=t.map(t=>a.from(t))}getOffsetBeforeChange(t){return this.adjustNextEdit(t),this.translateCurToOld(t)}getDistanceToNextChange(t){this.adjustNextEdit(t);const e=this.edits[this.nextEditIdx],n=e?this.translateOldToCur(e.offsetObj):null;return null===n?null:(0,s.MS)(t,n)}translateOldToCur(t){return t.lineCount===this.deltaLineIdxInOld?(0,s.qe)(t.lineCount+this.deltaOldToNewLineCount,t.columnCount+this.deltaOldToNewColumnCount):(0,s.qe)(t.lineCount+this.deltaOldToNewLineCount,t.columnCount)}translateCurToOld(t){const e=(0,s.l4)(t);return e.lineCount-this.deltaOldToNewLineCount===this.deltaLineIdxInOld?(0,s.qe)(e.lineCount-this.deltaOldToNewLineCount,e.columnCount-this.deltaOldToNewColumnCount):(0,s.qe)(e.lineCount-this.deltaOldToNewLineCount,e.columnCount)}adjustNextEdit(t){for(;this.nextEditIdx<this.edits.length;){const e=this.edits[this.nextEditIdx],n=this.translateOldToCur(e.endOffsetAfterObj);if(!(0,s.vr)(n,t))break;{this.nextEditIdx++;const t=(0,s.l4)(n),i=(0,s.l4)(this.translateOldToCur(e.endOffsetBeforeObj)),r=t.lineCount-i.lineCount;this.deltaOldToNewLineCount+=r;const o=this.deltaLineIdxInOld===e.endOffsetBeforeObj.lineCount?this.deltaOldToNewColumnCount:0,a=t.columnCount-i.columnCount;this.deltaOldToNewColumnCount=o+a,this.deltaLineIdxInOld=e.endOffsetBeforeObj.lineCount}}}}class a{static from(t){return new a(t.startOffset,t.endOffset,t.newLength)}constructor(t,e,n){this.endOffsetBeforeObj=(0,s.l4)(e),this.endOffsetAfterObj=(0,s.l4)((0,s.QB)(t,n)),this.offsetObj=(0,s.l4)(t)}}},55077:(t,e,n)=>{n.d(e,{I:()=>h});var i=n(22573),s=n(32293),r=n(81304),o=n(41422),a=n(19729);class h extends s.jG{constructor(t){super(),this.textModel=t,this.colorProvider=new l,this.onDidChangeEmitter=new i.vl,this.onDidChange=this.onDidChangeEmitter.event,this.colorizationOptions=t.getOptions().bracketPairColorizationOptions,this._register(t.bracketPairs.onDidChange(t=>{this.onDidChangeEmitter.fire()}))}handleDidChangeOptions(t){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(t,e,n,i){return i||void 0===e?[]:this.colorizationOptions.enabled?this.textModel.bracketPairs.getBracketsInRange(t,!0).map(t=>({id:`bracket${t.range.toString()}-${t.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(t,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:t.range})).toArray():[]}getAllDecorations(t,e){return void 0===t?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new r.Q(1,1,this.textModel.getLineCount(),1),t,e):[]}}class l{constructor(){this.unexpectedClosingBracketClassName="unexpected-closing-bracket"}getInlineClassName(t,e){return t.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(e?t.nestingLevelOfEqualBracketType:t.nestingLevel)}getInlineClassNameOfLevel(t){return"bracket-highlighting-"+t%30}}(0,a.zy)((t,e)=>{const n=[o.sN,o.lQ,o.ss,o.l5,o.sH,o.zp],i=new l;e.addRule(`.monaco-editor .${i.unexpectedClosingBracketClassName} { color: ${t.getColor(o.s7)}; }`);const s=n.map(e=>t.getColor(e)).filter(t=>!!t).filter(t=>!t.isTransparent());for(let t=0;t<30;t++){const n=s[t%s.length];e.addRule(`.monaco-editor .${i.getInlineClassNameOfLevel(t)} { color: ${n}; }`)}})},60439:(t,e,n)=>{n.d(e,{M:()=>o});var i=n(6995),s=n(24717),r=n(87440);function o(t,e){if(0===t.length)return e;if(0===e.length)return t;const n=new i.j3(h(t)),o=h(e);o.push({modified:!1,lengthBefore:void 0,lengthAfter:void 0});let l=n.dequeue();function c(t){if(void 0===t){const t=n.takeWhile(t=>!0)||[];return l&&t.unshift(l),t}const e=[];for(;l&&!(0,r.Vh)(t);){const[i,s]=l.splitAt(t);e.push(i),t=(0,r.MS)(i.lengthAfter,t),l=s??n.dequeue()}return(0,r.Vh)(t)||e.push(new a(!1,t,t)),e}const u=[];function d(t,e,n){if(u.length>0&&(0,r.wP)(u[u.length-1].endOffset,t)){const t=u[u.length-1];u[u.length-1]=new s.c(t.startOffset,e,(0,r.QB)(t.newLength,n))}else u.push({startOffset:t,endOffset:e,newLength:n})}let f=r.Vp;for(const t of o){const e=c(t.lengthBefore);if(t.modified){const n=(0,r.pW)(e,t=>t.lengthBefore),i=(0,r.QB)(f,n);d(f,i,t.lengthAfter),f=i}else for(const t of e){const e=f;f=(0,r.QB)(f,t.lengthBefore),t.modified&&d(e,f,t.lengthAfter)}}return u}class a{constructor(t,e,n){this.modified=t,this.lengthBefore=e,this.lengthAfter=n}splitAt(t){const e=(0,r.MS)(t,this.lengthAfter);return(0,r.wP)(e,r.Vp)?[this,void 0]:this.modified?[new a(this.modified,this.lengthBefore,t),new a(this.modified,r.Vp,e)]:[new a(this.modified,t,t),new a(this.modified,e,e)]}toString(){return`${this.modified?"M":"U"}:${(0,r.l4)(this.lengthBefore)} -> ${(0,r.l4)(this.lengthAfter)}`}}function h(t){const e=[];let n=r.Vp;for(const i of t){const t=(0,r.MS)(n,i.startOffset);(0,r.Vh)(t)||e.push(new a(!1,t,t));const s=(0,r.MS)(i.startOffset,i.endOffset);e.push(new a(!0,s,i.newLength)),n=i.endOffset}return e}},87440:(t,e,n)=>{n.d(e,{C7:()=>o,MS:()=>m,QB:()=>g,Qx:()=>b,VL:()=>O,Vh:()=>h,Vp:()=>a,eu:()=>d,l4:()=>u,o0:()=>x,pW:()=>k,qe:()=>c,rR:()=>T,sS:()=>f,vr:()=>I,wP:()=>p,zG:()=>C});var i=n(60891),s=n(81304),r=n(53334);function o(t,e,n,i){return t!==n?c(n-t,i):c(0,i-e)}const a=0;function h(t){return 0===t}const l=2**26;function c(t,e){return t*l+e}function u(t){const e=t,n=Math.floor(e/l),i=e-n*l;return new r.W(n,i)}function d(t){return Math.floor(t/l)}function f(t){return t}function g(t,e){let n=t+e;return e>=l&&(n-=t%l),n}function k(t,e){return t.reduce((t,n)=>g(t,e(n)),a)}function p(t,e){return t===e}function m(t,e){const n=t,i=e;if(i-n<=0)return a;const s=Math.floor(n/l),r=Math.floor(i/l),o=i-r*l;return s===r?c(0,o-(n-s*l)):c(r-s,o)}function C(t,e){return t<e}function I(t,e){return t<=e}function x(t,e){return t>=e}function O(t){return c(t.lineNumber-1,t.column-1)}function b(t,e){const n=t,i=Math.floor(n/l),r=n-i*l,o=e,a=Math.floor(o/l),h=o-a*l;return new s.Q(i+1,r+1,a+1,h+1)}function T(t){const e=(0,i.uz)(t);return c(e.length-1,e[e.length-1].length)}},95006:(t,e,n)=>{n.d(e,{J:()=>Z});var i=n(6995),s=n(22573),r=n(32293),o=n(81304),a=n(94457),h=n(24979),l=n(96564),c=n(24717),u=n(60891),d=n(73226),f=n(10492),g=n(87440);const k=[];class p{static{this.cache=new Array(129)}static create(t,e){if(t<=128&&0===e.length){let n=p.cache[t];return n||(n=new p(t,e),p.cache[t]=n),n}return new p(t,e)}static{this.empty=p.create(0,k)}static getEmpty(){return this.empty}constructor(t,e){this.items=t,this.additionalItems=e}add(t,e){const n=e.getKey(t);let i=n>>5;if(0===i){const t=1<<n|this.items;return t===this.items?this:p.create(t,this.additionalItems)}i--;const s=this.additionalItems.slice(0);for(;s.length<i;)s.push(0);return s[i]|=1<<(31&n),p.create(this.items,s)}merge(t){const e=this.items|t.items;if(this.additionalItems===k&&t.additionalItems===k)return e===this.items?this:e===t.items?t:p.create(e,k);const n=[];for(let e=0;e<Math.max(this.additionalItems.length,t.additionalItems.length);e++){const i=this.additionalItems[e]||0,s=t.additionalItems[e]||0;n.push(i|s)}return p.create(e,n)}intersects(t){if(0!==(this.items&t.items))return!0;for(let e=0;e<Math.min(this.additionalItems.length,t.additionalItems.length);e++)if(0!==(this.additionalItems[e]&t.additionalItems[e]))return!0;return!1}}const m={getKey:t=>t};class C{constructor(){this.items=new Map}getKey(t){let e=this.items.get(t);return void 0===e&&(e=this.items.size,this.items.set(t,e)),e}}class I{get length(){return this._length}constructor(t){this._length=t}}class x extends I{static create(t,e,n){let i=t.length;return e&&(i=(0,g.QB)(i,e.length)),n&&(i=(0,g.QB)(i,n.length)),new x(i,t,e,n,e?e.missingOpeningBracketIds:p.getEmpty())}get kind(){return 2}get listHeight(){return 0}get childrenLength(){return 3}getChild(t){switch(t){case 0:return this.openingBracket;case 1:return this.child;case 2:return this.closingBracket}throw new Error("Invalid child index")}get children(){const t=[];return t.push(this.openingBracket),this.child&&t.push(this.child),this.closingBracket&&t.push(this.closingBracket),t}constructor(t,e,n,i,s){super(t),this.openingBracket=e,this.child=n,this.closingBracket=i,this.missingOpeningBracketIds=s}canBeReused(t){return null!==this.closingBracket&&!t.intersects(this.missingOpeningBracketIds)}deepClone(){return new x(this.length,this.openingBracket.deepClone(),this.child&&this.child.deepClone(),this.closingBracket&&this.closingBracket.deepClone(),this.missingOpeningBracketIds)}computeMinIndentation(t,e){return this.child?this.child.computeMinIndentation((0,g.QB)(t,this.openingBracket.length),e):Number.MAX_SAFE_INTEGER}}class O extends I{static create23(t,e,n,i=!1){let s=t.length,r=t.missingOpeningBracketIds;if(t.listHeight!==e.listHeight)throw new Error("Invalid list heights");if(s=(0,g.QB)(s,e.length),r=r.merge(e.missingOpeningBracketIds),n){if(t.listHeight!==n.listHeight)throw new Error("Invalid list heights");s=(0,g.QB)(s,n.length),r=r.merge(n.missingOpeningBracketIds)}return i?new T(s,t.listHeight+1,t,e,n,r):new b(s,t.listHeight+1,t,e,n,r)}static getEmpty(){return new w(g.Vp,0,[],p.getEmpty())}get kind(){return 4}get missingOpeningBracketIds(){return this._missingOpeningBracketIds}constructor(t,e,n){super(t),this.listHeight=e,this._missingOpeningBracketIds=n,this.cachedMinIndentation=-1}throwIfImmutable(){}makeLastElementMutable(){this.throwIfImmutable();const t=this.childrenLength;if(0===t)return;const e=this.getChild(t-1),n=4===e.kind?e.toMutable():e;return e!==n&&this.setChild(t-1,n),n}makeFirstElementMutable(){if(this.throwIfImmutable(),0===this.childrenLength)return;const t=this.getChild(0),e=4===t.kind?t.toMutable():t;return t!==e&&this.setChild(0,e),e}canBeReused(t){if(t.intersects(this.missingOpeningBracketIds))return!1;if(0===this.childrenLength)return!1;let e=this;for(;4===e.kind;){const t=e.childrenLength;if(0===t)throw new d.D7;e=e.getChild(t-1)}return e.canBeReused(t)}handleChildrenChanged(){this.throwIfImmutable();const t=this.childrenLength;let e=this.getChild(0).length,n=this.getChild(0).missingOpeningBracketIds;for(let i=1;i<t;i++){const t=this.getChild(i);e=(0,g.QB)(e,t.length),n=n.merge(t.missingOpeningBracketIds)}this._length=e,this._missingOpeningBracketIds=n,this.cachedMinIndentation=-1}computeMinIndentation(t,e){if(-1!==this.cachedMinIndentation)return this.cachedMinIndentation;let n=Number.MAX_SAFE_INTEGER,i=t;for(let t=0;t<this.childrenLength;t++){const s=this.getChild(t);s&&(n=Math.min(n,s.computeMinIndentation(i,e)),i=(0,g.QB)(i,s.length))}return this.cachedMinIndentation=n,n}}class b extends O{get childrenLength(){return null!==this._item3?3:2}getChild(t){switch(t){case 0:return this._item1;case 1:return this._item2;case 2:return this._item3}throw new Error("Invalid child index")}setChild(t,e){switch(t){case 0:return void(this._item1=e);case 1:return void(this._item2=e);case 2:return void(this._item3=e)}throw new Error("Invalid child index")}get children(){return this._item3?[this._item1,this._item2,this._item3]:[this._item1,this._item2]}get item1(){return this._item1}get item2(){return this._item2}get item3(){return this._item3}constructor(t,e,n,i,s,r){super(t,e,r),this._item1=n,this._item2=i,this._item3=s}deepClone(){return new b(this.length,this.listHeight,this._item1.deepClone(),this._item2.deepClone(),this._item3?this._item3.deepClone():null,this.missingOpeningBracketIds)}appendChildOfSameHeight(t){if(this._item3)throw new Error("Cannot append to a full (2,3) tree node");this.throwIfImmutable(),this._item3=t,this.handleChildrenChanged()}unappendChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const t=this._item3;return this._item3=null,this.handleChildrenChanged(),t}prependChildOfSameHeight(t){if(this._item3)throw new Error("Cannot prepend to a full (2,3) tree node");this.throwIfImmutable(),this._item3=this._item2,this._item2=this._item1,this._item1=t,this.handleChildrenChanged()}unprependChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const t=this._item1;return this._item1=this._item2,this._item2=this._item3,this._item3=null,this.handleChildrenChanged(),t}toMutable(){return this}}class T extends b{toMutable(){return new b(this.length,this.listHeight,this.item1,this.item2,this.item3,this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}class B extends O{get childrenLength(){return this._children.length}getChild(t){return this._children[t]}setChild(t,e){this._children[t]=e}get children(){return this._children}constructor(t,e,n,i){super(t,e,i),this._children=n}deepClone(){const t=new Array(this._children.length);for(let e=0;e<this._children.length;e++)t[e]=this._children[e].deepClone();return new B(this.length,this.listHeight,t,this.missingOpeningBracketIds)}appendChildOfSameHeight(t){this.throwIfImmutable(),this._children.push(t),this.handleChildrenChanged()}unappendChild(){this.throwIfImmutable();const t=this._children.pop();return this.handleChildrenChanged(),t}prependChildOfSameHeight(t){this.throwIfImmutable(),this._children.unshift(t),this.handleChildrenChanged()}unprependChild(){this.throwIfImmutable();const t=this._children.shift();return this.handleChildrenChanged(),t}toMutable(){return this}}class w extends B{toMutable(){return new B(this.length,this.listHeight,[...this.children],this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}const L=[];class _ extends I{get listHeight(){return 0}get childrenLength(){return 0}getChild(t){return null}get children(){return L}deepClone(){return this}}class E extends _{get kind(){return 0}get missingOpeningBracketIds(){return p.getEmpty()}canBeReused(t){return!0}computeMinIndentation(t,e){const n=(0,g.l4)(t),i=(0===n.columnCount?n.lineCount:n.lineCount+1)+1,s=(0,g.eu)((0,g.QB)(t,this.length))+1;let r=Number.MAX_SAFE_INTEGER;for(let t=i;t<=s;t++){const n=e.getLineFirstNonWhitespaceColumn(t),i=e.getLineContent(t);if(0===n)continue;const s=f.A.visibleColumnFromColumn(i,n,e.getOptions().tabSize);r=Math.min(r,s)}return r}}class S extends _{static create(t,e,n){return new S(t,e,n)}get kind(){return 1}get missingOpeningBracketIds(){return p.getEmpty()}constructor(t,e,n){super(t),this.bracketInfo=e,this.bracketIds=n}get text(){return this.bracketInfo.bracketText}get languageId(){return this.bracketInfo.languageId}canBeReused(t){return!1}computeMinIndentation(t,e){return Number.MAX_SAFE_INTEGER}}class M extends _{get kind(){return 3}constructor(t,e){super(e),this.missingOpeningBracketIds=t}canBeReused(t){return!t.intersects(this.missingOpeningBracketIds)}computeMinIndentation(t,e){return Number.MAX_SAFE_INTEGER}}var v=n(22519);class N{constructor(t,e,n,i,s){this.length=t,this.kind=e,this.bracketId=n,this.bracketIds=i,this.astNode=s}}class R{constructor(t,e){this.textModel=t,this.bracketTokens=e,this.reader=new A(this.textModel,this.bracketTokens),this._offset=g.Vp,this.didPeek=!1,this.peeked=null,this.textBufferLineCount=t.getLineCount(),this.textBufferLastLineLength=t.getLineLength(this.textBufferLineCount)}get offset(){return this._offset}get length(){return(0,g.qe)(this.textBufferLineCount-1,this.textBufferLastLineLength)}skip(t){this.didPeek=!1,this._offset=(0,g.QB)(this._offset,t);const e=(0,g.l4)(this._offset);this.reader.setPosition(e.lineCount,e.columnCount)}read(){let t;return this.peeked?(this.didPeek=!1,t=this.peeked):t=this.reader.read(),t&&(this._offset=(0,g.QB)(this._offset,t.length)),t}peek(){return this.didPeek||(this.peeked=this.reader.read(),this.didPeek=!0),this.peeked}}class A{constructor(t,e){this.textModel=t,this.bracketTokens=e,this.lineIdx=0,this.line=null,this.lineCharOffset=0,this.lineTokens=null,this.lineTokenOffset=0,this.peekedToken=null,this.textBufferLineCount=t.getLineCount(),this.textBufferLastLineLength=t.getLineLength(this.textBufferLineCount)}setPosition(t,e){t===this.lineIdx?(this.lineCharOffset=e,null!==this.line&&(this.lineTokenOffset=0===this.lineCharOffset?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset))):(this.lineIdx=t,this.lineCharOffset=e,this.line=null),this.peekedToken=null}read(){if(this.peekedToken){const t=this.peekedToken;return this.peekedToken=null,this.lineCharOffset+=(0,g.sS)(t.length),t}if(this.lineIdx>this.textBufferLineCount-1||this.lineIdx===this.textBufferLineCount-1&&this.lineCharOffset>=this.textBufferLastLineLength)return null;null===this.line&&(this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.line=this.lineTokens.getLineContent(),this.lineTokenOffset=0===this.lineCharOffset?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset));const t=this.lineIdx,e=this.lineCharOffset;let n=0;for(;;){const i=this.lineTokens,s=i.getCount();let r=null;if(this.lineTokenOffset<s){const o=i.getMetadata(this.lineTokenOffset);for(;this.lineTokenOffset+1<s&&o===i.getMetadata(this.lineTokenOffset+1);)this.lineTokenOffset++;const a=0===v.x.getTokenType(o),h=v.x.containsBalancedBrackets(o),l=i.getEndOffset(this.lineTokenOffset);if(h&&a&&this.lineCharOffset<l){const t=i.getLanguageId(this.lineTokenOffset),e=this.line.substring(this.lineCharOffset,l),n=this.bracketTokens.getSingleLanguageBracketTokens(t),s=n.regExpGlobal;if(s){s.lastIndex=0;const t=s.exec(e);t&&(r=n.getToken(t[0]),r&&(this.lineCharOffset+=t.index))}}if(n+=l-this.lineCharOffset,r){if(t!==this.lineIdx||e!==this.lineCharOffset){this.peekedToken=r;break}return this.lineCharOffset+=(0,g.sS)(r.length),r}this.lineTokenOffset++,this.lineCharOffset=l}else{if(this.lineIdx===this.textBufferLineCount-1)break;if(this.lineIdx++,this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.lineTokenOffset=0,this.line=this.lineTokens.getLineContent(),this.lineCharOffset=0,n+=33,n>1e3)break}if(n>1500)break}const i=(0,g.C7)(t,e,this.lineIdx,this.lineCharOffset);return new N(i,0,-1,p.getEmpty(),new E(i))}}class P{constructor(t,e){this.text=t,this._offset=g.Vp,this.idx=0;const n=e.getRegExpStr(),i=n?new RegExp(n+"|\n","gi"):null,s=[];let r,o=0,a=0,h=0,l=0;const c=[];for(let t=0;t<60;t++)c.push(new N((0,g.qe)(0,t),0,-1,p.getEmpty(),new E((0,g.qe)(0,t))));const u=[];for(let t=0;t<60;t++)u.push(new N((0,g.qe)(1,t),0,-1,p.getEmpty(),new E((0,g.qe)(1,t))));if(i)for(i.lastIndex=0;null!==(r=i.exec(t));){const t=r.index,n=r[0];if("\n"===n)o++,a=t+1;else{if(h!==t){let e;if(l===o){const n=t-h;if(n<c.length)e=c[n];else{const t=(0,g.qe)(0,n);e=new N(t,0,-1,p.getEmpty(),new E(t))}}else{const n=o-l,i=t-a;if(1===n&&i<u.length)e=u[i];else{const t=(0,g.qe)(n,i);e=new N(t,0,-1,p.getEmpty(),new E(t))}}s.push(e)}s.push(e.getToken(n)),h=t+n.length,l=o}}const d=t.length;if(h!==d){const t=l===o?(0,g.qe)(0,d-h):(0,g.qe)(o-l,d-a);s.push(new N(t,0,-1,p.getEmpty(),new E(t)))}this.length=(0,g.qe)(o,d-a),this.tokens=s}get offset(){return this._offset}read(){return this.tokens[this.idx++]||null}peek(){return this.tokens[this.idx]||null}skip(t){throw new d.EM}}class j{static createFromLanguage(t,e){function n(t){return e.getKey(`${t.languageId}:::${t.bracketText}`)}const i=new Map;for(const e of t.bracketsNew.openingBrackets){const t=(0,g.qe)(0,e.bracketText.length),s=n(e),r=p.getEmpty().add(s,m);i.set(e.bracketText,new N(t,1,s,r,S.create(t,e,r)))}for(const e of t.bracketsNew.closingBrackets){const t=(0,g.qe)(0,e.bracketText.length);let s=p.getEmpty();const r=e.getOpeningBrackets();for(const t of r)s=s.add(n(t),m);i.set(e.bracketText,new N(t,2,n(r[0]),s,S.create(t,e,s)))}return new j(i)}constructor(t){this.map=t,this.hasRegExp=!1,this._regExpGlobal=null}getRegExpStr(){if(this.isEmpty)return null;{const t=[...this.map.keys()];return t.sort(),t.reverse(),t.map(t=>function(t){let e=(0,u.bm)(t);return/^[\w ]+/.test(t)&&(e=`\\b${e}`),/[\w ]+$/.test(t)&&(e=`${e}\\b`),e}(t)).join("|")}}get regExpGlobal(){if(!this.hasRegExp){const t=this.getRegExpStr();this._regExpGlobal=t?new RegExp(t,"gi"):null,this.hasRegExp=!0}return this._regExpGlobal}getToken(t){return this.map.get(t.toLowerCase())}findClosingTokenText(t){for(const[e,n]of this.map)if(2===n.kind&&n.bracketIds.intersects(t))return e}get isEmpty(){return 0===this.map.size}}class z{constructor(t,e){this.denseKeyProvider=t,this.getLanguageConfiguration=e,this.languageIdToBracketTokens=new Map}didLanguageChange(t){return this.languageIdToBracketTokens.has(t)}getSingleLanguageBracketTokens(t){let e=this.languageIdToBracketTokens.get(t);return e||(e=j.createFromLanguage(this.getLanguageConfiguration(t),this.denseKeyProvider),this.languageIdToBracketTokens.set(t,e)),e}}function y(t,e=!1){if(0===t.length)return null;if(1===t.length)return t[0];let n=t.length;for(;n>3;){const i=n>>1;for(let s=0;s<i;s++){const i=s<<1;t[s]=O.create23(t[i],t[i+1],i+3===n?t[i+2]:null,e)}n=i}return O.create23(t[0],t[1],n>=3?t[2]:null,e)}function W(t,e){return Math.abs(t.listHeight-e.listHeight)}function F(t,e){return t.listHeight===e.listHeight?O.create23(t,e,null,!1):t.listHeight>e.listHeight?function(t,e){let n=t=t.toMutable();const i=[];let s;for(;;){if(e.listHeight===n.listHeight){s=e;break}if(4!==n.kind)throw new Error("unexpected");i.push(n),n=n.makeLastElementMutable()}for(let t=i.length-1;t>=0;t--){const e=i[t];s?e.childrenLength>=3?s=O.create23(e.unappendChild(),s,null,!1):(e.appendChildOfSameHeight(s),s=void 0):e.handleChildrenChanged()}return s?O.create23(t,s,null,!1):t}(t,e):function(t,e){let n=t=t.toMutable();const i=[];for(;e.listHeight!==n.listHeight;){if(4!==n.kind)throw new Error("unexpected");i.push(n),n=n.makeFirstElementMutable()}let s=e;for(let t=i.length-1;t>=0;t--){const e=i[t];s?e.childrenLength>=3?s=O.create23(s,e.unprependChild(),null,!1):(e.prependChildOfSameHeight(s),s=void 0):e.handleChildrenChanged()}return s?O.create23(s,t,null,!1):t}(e,t)}class Q{constructor(t){this.lastOffset=g.Vp,this.nextNodes=[t],this.offsets=[g.Vp],this.idxs=[]}readLongestNodeAt(t,e){if((0,g.zG)(t,this.lastOffset))throw new Error("Invalid offset");for(this.lastOffset=t;;){const n=q(this.nextNodes);if(!n)return;const i=q(this.offsets);if((0,g.zG)(t,i))return;if((0,g.zG)(i,t))if((0,g.QB)(i,n.length)<=t)this.nextNodeAfterCurrent();else{const t=V(n);-1!==t?(this.nextNodes.push(n.getChild(t)),this.offsets.push(i),this.idxs.push(t)):this.nextNodeAfterCurrent()}else{if(e(n))return this.nextNodeAfterCurrent(),n;{const t=V(n);if(-1===t)return void this.nextNodeAfterCurrent();this.nextNodes.push(n.getChild(t)),this.offsets.push(i),this.idxs.push(t)}}}}nextNodeAfterCurrent(){for(;;){const t=q(this.offsets),e=q(this.nextNodes);if(this.nextNodes.pop(),this.offsets.pop(),0===this.idxs.length)break;const n=q(this.nextNodes),i=V(n,this.idxs[this.idxs.length-1]);if(-1!==i){this.nextNodes.push(n.getChild(i)),this.offsets.push((0,g.QB)(t,e.length)),this.idxs[this.idxs.length-1]=i;break}this.idxs.pop()}}}function V(t,e=-1){for(;;){if(++e>=t.childrenLength)return-1;if(t.getChild(e))return e}}function q(t){return t.length>0?t[t.length-1]:void 0}function D(t,e,n,i){return new H(t,e,n,i).parseDocument()}class H{constructor(t,e,n,i){if(this.tokenizer=t,this.createImmutableLists=i,this._itemsConstructed=0,this._itemsFromCache=0,n&&i)throw new Error("Not supported");this.oldNodeReader=n?new Q(n):void 0,this.positionMapper=new c.W(e)}parseDocument(){this._itemsConstructed=0,this._itemsFromCache=0;let t=this.parseList(p.getEmpty(),0);return t||(t=O.getEmpty()),t}parseList(t,e){const n=[];for(;;){let i=this.tryReadChildFromCache(t);if(!i){const n=this.tokenizer.peek();if(!n||2===n.kind&&n.bracketIds.intersects(t))break;i=this.parseChild(t,e+1)}4===i.kind&&0===i.childrenLength||n.push(i)}const i=this.oldNodeReader?function(t){if(0===t.length)return null;if(1===t.length)return t[0];let e=0;function n(){if(e>=t.length)return null;const n=e,i=t[n].listHeight;for(e++;e<t.length&&t[e].listHeight===i;)e++;return e-n>=2?y(0===n&&e===t.length?t:t.slice(n,e),!1):t[n]}let i=n(),s=n();if(!s)return i;for(let t=n();t;t=n())W(i,s)<=W(s,t)?(i=F(i,s),s=t):s=F(s,t);return F(i,s)}(n):y(n,this.createImmutableLists);return i}tryReadChildFromCache(t){if(this.oldNodeReader){const e=this.positionMapper.getDistanceToNextChange(this.tokenizer.offset);if(null===e||!(0,g.Vh)(e)){const n=this.oldNodeReader.readLongestNodeAt(this.positionMapper.getOffsetBeforeChange(this.tokenizer.offset),n=>!(null!==e&&!(0,g.zG)(n.length,e))&&n.canBeReused(t));if(n)return this._itemsFromCache++,this.tokenizer.skip(n.length),n}}}parseChild(t,e){this._itemsConstructed++;const n=this.tokenizer.read();switch(n.kind){case 2:return new M(n.bracketIds,n.length);case 0:return n.astNode;case 1:{if(e>300)return new E(n.length);const i=t.merge(n.bracketIds),s=this.parseList(i,e+1),r=this.tokenizer.peek();return r&&2===r.kind&&(r.bracketId===n.bracketId||r.bracketIds.intersects(n.bracketIds))?(this.tokenizer.read(),x.create(n.astNode,s,r.astNode)):x.create(n.astNode,s,null)}default:throw new Error("unexpected")}}}var G=n(60439);class $ extends r.jG{didLanguageChange(t){return this.brackets.didLanguageChange(t)}constructor(t,e){if(super(),this.textModel=t,this.getLanguageConfiguration=e,this.didChangeEmitter=new s.vl,this.denseKeyProvider=new C,this.brackets=new z(this.denseKeyProvider,this.getLanguageConfiguration),this.onDidChange=this.didChangeEmitter.event,this.queuedTextEditsForInitialAstWithoutTokens=[],this.queuedTextEdits=[],t.tokenization.hasTokens)2===t.tokenization.backgroundTokenizationState?(this.initialAstWithoutTokens=void 0,this.astWithTokens=this.parseDocumentFromTextBuffer([],void 0,!1)):(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer([],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens);else{const t=this.brackets.getSingleLanguageBracketTokens(this.textModel.getLanguageId()),e=new P(this.textModel.getValue(),t);this.initialAstWithoutTokens=D(e,[],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens}}handleDidChangeBackgroundTokenizationState(){if(2===this.textModel.tokenization.backgroundTokenizationState){const t=void 0===this.initialAstWithoutTokens;this.initialAstWithoutTokens=void 0,t||this.didChangeEmitter.fire()}}handleDidChangeTokens({ranges:t}){const e=t.map(t=>new c.c((0,g.qe)(t.fromLineNumber-1,0),(0,g.qe)(t.toLineNumber,0),(0,g.qe)(t.toLineNumber-t.fromLineNumber+1,0)));this.handleEdits(e,!0),this.initialAstWithoutTokens||this.didChangeEmitter.fire()}handleContentChanged(t){const e=c.c.fromModelContentChanges(t.changes);this.handleEdits(e,!1)}handleEdits(t,e){const n=(0,G.M)(this.queuedTextEdits,t);this.queuedTextEdits=n,this.initialAstWithoutTokens&&!e&&(this.queuedTextEditsForInitialAstWithoutTokens=(0,G.M)(this.queuedTextEditsForInitialAstWithoutTokens,t))}flushQueue(){this.queuedTextEdits.length>0&&(this.astWithTokens=this.parseDocumentFromTextBuffer(this.queuedTextEdits,this.astWithTokens,!1),this.queuedTextEdits=[]),this.queuedTextEditsForInitialAstWithoutTokens.length>0&&(this.initialAstWithoutTokens&&(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer(this.queuedTextEditsForInitialAstWithoutTokens,this.initialAstWithoutTokens,!1)),this.queuedTextEditsForInitialAstWithoutTokens=[])}parseDocumentFromTextBuffer(t,e,n){const i=e;return D(new R(this.textModel,this.brackets),t,i,n)}getBracketsInRange(t,e){this.flushQueue();const n=(0,g.qe)(t.startLineNumber-1,t.startColumn-1),s=(0,g.qe)(t.endLineNumber-1,t.endColumn-1);return new i.c1(t=>{const i=this.initialAstWithoutTokens||this.astWithTokens;K(i,g.Vp,i.length,n,s,t,0,0,new Map,e)})}getBracketPairsInRange(t,e){this.flushQueue();const n=(0,g.VL)(t.getStartPosition()),s=(0,g.VL)(t.getEndPosition());return new i.c1(t=>{const i=this.initialAstWithoutTokens||this.astWithTokens,r=new X(t,e,this.textModel);J(i,g.Vp,i.length,n,s,r,0,new Map)})}getFirstBracketAfter(t){this.flushQueue();const e=this.initialAstWithoutTokens||this.astWithTokens;return Y(e,g.Vp,e.length,(0,g.VL)(t))}getFirstBracketBefore(t){this.flushQueue();const e=this.initialAstWithoutTokens||this.astWithTokens;return U(e,g.Vp,e.length,(0,g.VL)(t))}}function U(t,e,n,i){if(4===t.kind||2===t.kind){const s=[];for(const i of t.children)n=(0,g.QB)(e,i.length),s.push({nodeOffsetStart:e,nodeOffsetEnd:n}),e=n;for(let e=s.length-1;e>=0;e--){const{nodeOffsetStart:n,nodeOffsetEnd:r}=s[e];if((0,g.zG)(n,i)){const s=U(t.children[e],n,r,i);if(s)return s}}return null}if(3===t.kind)return null;if(1===t.kind){const i=(0,g.Qx)(e,n);return{bracketInfo:t.bracketInfo,range:i}}return null}function Y(t,e,n,i){if(4===t.kind||2===t.kind){for(const s of t.children){if(n=(0,g.QB)(e,s.length),(0,g.zG)(i,n)){const t=Y(s,e,n,i);if(t)return t}e=n}return null}if(3===t.kind)return null;if(1===t.kind){const i=(0,g.Qx)(e,n);return{bracketInfo:t.bracketInfo,range:i}}return null}function K(t,e,n,i,s,r,o,a,h,c,u=!1){if(o>200)return!0;t:for(;;)switch(t.kind){case 4:{const a=t.childrenLength;for(let l=0;l<a;l++){const a=t.getChild(l);if(a){if(n=(0,g.QB)(e,a.length),(0,g.vr)(e,s)&&(0,g.o0)(n,i)){if((0,g.o0)(n,s)){t=a;continue t}if(!K(a,e,n,i,s,r,o,0,h,c))return!1}e=n}}return!0}case 2:{const l=!c||!t.closingBracket||t.closingBracket.bracketInfo.closesColorized(t.openingBracket.bracketInfo);let u=0;if(h){let e=h.get(t.openingBracket.text);void 0===e&&(e=0),u=e,l&&(e++,h.set(t.openingBracket.text,e))}const d=t.childrenLength;for(let f=0;f<d;f++){const d=t.getChild(f);if(d){if(n=(0,g.QB)(e,d.length),(0,g.vr)(e,s)&&(0,g.o0)(n,i)){if((0,g.o0)(n,s)&&1!==d.kind){t=d,l?(o++,a=u+1):a=u;continue t}if((l||1!==d.kind||!t.closingBracket)&&!K(d,e,n,i,s,r,l?o+1:o,l?u+1:u,h,c,!t.closingBracket))return!1}e=n}}return h?.set(t.openingBracket.text,u),!0}case 3:{const t=(0,g.Qx)(e,n);return r(new l.jY(t,o-1,0,!0))}case 1:{const t=(0,g.Qx)(e,n);return r(new l.jY(t,o-1,a-1,u))}case 0:return!0}}class X{constructor(t,e,n){this.push=t,this.includeMinIndentation=e,this.textModel=n}}function J(t,e,n,i,s,r,o,a){if(o>200)return!0;let h=!0;if(2===t.kind){let c=0;if(a){let e=a.get(t.openingBracket.text);void 0===e&&(e=0),c=e,e++,a.set(t.openingBracket.text,e)}const u=(0,g.QB)(e,t.openingBracket.length);let d=-1;if(r.includeMinIndentation&&(d=t.computeMinIndentation(e,r.textModel)),h=r.push(new l.yU((0,g.Qx)(e,n),(0,g.Qx)(e,u),t.closingBracket?(0,g.Qx)((0,g.QB)(u,t.child?.length||g.Vp),n):void 0,o,c,t,d)),e=u,h&&t.child){const l=t.child;if(n=(0,g.QB)(e,l.length),(0,g.vr)(e,s)&&(0,g.o0)(n,i)&&(h=J(l,e,n,i,s,r,o+1,a),!h))return!1}a?.set(t.openingBracket.text,c)}else{let n=e;for(const e of t.children){const t=n;if(n=(0,g.QB)(n,e.length),(0,g.vr)(t,s)&&(0,g.vr)(i,n)&&(h=J(e,t,n,i,s,r,o,a),!h))return!1}}return h}class Z extends r.jG{get canBuildAST(){return this.textModel.getValueLength()<=5e6}constructor(t,e){super(),this.textModel=t,this.languageConfigurationService=e,this.bracketPairsTree=this._register(new r.HE),this.onDidChangeEmitter=new s.vl,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1}handleLanguageConfigurationServiceChange(t){t.languageId&&!this.bracketPairsTree.value?.object.didLanguageChange(t.languageId)||(this.bracketPairsTree.clear(),this.updateBracketPairsTree())}handleDidChangeOptions(t){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(t){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(t){this.bracketPairsTree.value?.object.handleContentChanged(t)}handleDidChangeBackgroundTokenizationState(){this.bracketPairsTree.value?.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(t){this.bracketPairsTree.value?.object.handleDidChangeTokens(t)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const n=new r.Cm;this.bracketPairsTree.value=(t=n.add(new $(this.textModel,t=>this.languageConfigurationService.getLanguageConfiguration(t))),e=n,{object:t,dispose:()=>e?.dispose()}),n.add(this.bracketPairsTree.value.object.onDidChange(t=>this.onDidChangeEmitter.fire(t))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire());var t,e}getBracketPairsInRange(t){return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getBracketPairsInRange(t,!1)||i.c1.empty}getBracketPairsInRangeWithMinIndentation(t){return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getBracketPairsInRange(t,!0)||i.c1.empty}getBracketsInRange(t,e=!1){return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getBracketsInRange(t,e)||i.c1.empty}findMatchingBracketUp(t,e,n){const i=this.textModel.validatePosition(e),s=this.textModel.getLanguageIdAtPosition(i.lineNumber,i.column);if(this.canBuildAST){const n=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew.getClosingBracketInfo(t);if(!n)return null;const i=this.getBracketPairsInRange(o.Q.fromPositions(e,e)).findLast(t=>n.closes(t.openingBracketInfo));return i?i.openingBracketRange:null}{const e=t.toLowerCase(),r=this.languageConfigurationService.getLanguageConfiguration(s).brackets;if(!r)return null;const o=r.textIsBracket[e];return o?nt(this._findMatchingBracketUp(o,i,tt(n))):null}}matchBracket(t,e){if(this.canBuildAST){const e=this.getBracketPairsInRange(o.Q.fromPositions(t,t)).filter(e=>void 0!==e.closingBracketRange&&(e.openingBracketRange.containsPosition(t)||e.closingBracketRange.containsPosition(t))).findLastMaxBy((0,i.VE)(e=>e.openingBracketRange.containsPosition(t)?e.openingBracketRange:e.closingBracketRange,o.Q.compareRangesUsingStarts));return e?[e.openingBracketRange,e.closingBracketRange]:null}{const n=tt(e);return this._matchBracket(this.textModel.validatePosition(t),n)}}_establishBracketSearchOffsets(t,e,n,i){const s=e.getCount(),r=e.getLanguageId(i);let o=Math.max(0,t.column-1-n.maxBracketLength);for(let t=i-1;t>=0;t--){const n=e.getEndOffset(t);if(n<=o)break;if((0,a.Yo)(e.getStandardTokenType(t))||e.getLanguageId(t)!==r){o=n;break}}let h=Math.min(e.getLineContent().length,t.column-1+n.maxBracketLength);for(let t=i+1;t<s;t++){const n=e.getStartOffset(t);if(n>=h)break;if((0,a.Yo)(e.getStandardTokenType(t))||e.getLanguageId(t)!==r){h=n;break}}return{searchStartOffset:o,searchEndOffset:h}}_matchBracket(t,e){const n=t.lineNumber,i=this.textModel.tokenization.getLineTokens(n),s=this.textModel.getLineContent(n),r=i.findTokenIndexAtOffset(t.column-1);if(r<0)return null;const o=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(r)).brackets;if(o&&!(0,a.Yo)(i.getStandardTokenType(r))){let{searchStartOffset:a,searchEndOffset:l}=this._establishBracketSearchOffsets(t,i,o,r),c=null;for(;;){const i=h.Fu.findNextBracketInRange(o.forwardRegex,n,s,a,l);if(!i)break;if(i.startColumn<=t.column&&t.column<=i.endColumn){const t=s.substring(i.startColumn-1,i.endColumn-1).toLowerCase(),n=this._matchFoundBracket(i,o.textIsBracket[t],o.textIsOpenBracket[t],e);if(n){if(n instanceof et)return null;c=n}}a=i.endColumn-1}if(c)return c}if(r>0&&i.getStartOffset(r)===t.column-1){const o=r-1,l=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(o)).brackets;if(l&&!(0,a.Yo)(i.getStandardTokenType(o))){const{searchStartOffset:r,searchEndOffset:a}=this._establishBracketSearchOffsets(t,i,l,o),c=h.Fu.findPrevBracketInRange(l.reversedRegex,n,s,r,a);if(c&&c.startColumn<=t.column&&t.column<=c.endColumn){const t=s.substring(c.startColumn-1,c.endColumn-1).toLowerCase(),n=this._matchFoundBracket(c,l.textIsBracket[t],l.textIsOpenBracket[t],e);if(n)return n instanceof et?null:n}}}return null}_matchFoundBracket(t,e,n,i){if(!e)return null;const s=n?this._findMatchingBracketDown(e,t.getEndPosition(),i):this._findMatchingBracketUp(e,t.getStartPosition(),i);return s?s instanceof et?s:[t,s]:null}_findMatchingBracketUp(t,e,n){const i=t.languageId,s=t.reversedRegex;let r=-1,o=0;const l=(e,i,a,l)=>{for(;;){if(n&&++o%100==0&&!n())return et.INSTANCE;const c=h.Fu.findPrevBracketInRange(s,e,i,a,l);if(!c)break;const u=i.substring(c.startColumn-1,c.endColumn-1).toLowerCase();if(t.isOpen(u)?r++:t.isClose(u)&&r--,0===r)return c;l=c.startColumn-1}return null};for(let t=e.lineNumber;t>=1;t--){const n=this.textModel.tokenization.getLineTokens(t),s=n.getCount(),r=this.textModel.getLineContent(t);let o=s-1,h=r.length,c=r.length;t===e.lineNumber&&(o=n.findTokenIndexAtOffset(e.column-1),h=e.column-1,c=e.column-1);let u=!0;for(;o>=0;o--){const e=n.getLanguageId(o)===i&&!(0,a.Yo)(n.getStandardTokenType(o));if(e)u?h=n.getStartOffset(o):(h=n.getStartOffset(o),c=n.getEndOffset(o));else if(u&&h!==c){const e=l(t,r,h,c);if(e)return e}u=e}if(u&&h!==c){const e=l(t,r,h,c);if(e)return e}}return null}_findMatchingBracketDown(t,e,n){const i=t.languageId,s=t.forwardRegex;let r=1,o=0;const l=(e,i,a,l)=>{for(;;){if(n&&++o%100==0&&!n())return et.INSTANCE;const c=h.Fu.findNextBracketInRange(s,e,i,a,l);if(!c)break;const u=i.substring(c.startColumn-1,c.endColumn-1).toLowerCase();if(t.isOpen(u)?r++:t.isClose(u)&&r--,0===r)return c;a=c.endColumn-1}return null},c=this.textModel.getLineCount();for(let t=e.lineNumber;t<=c;t++){const n=this.textModel.tokenization.getLineTokens(t),s=n.getCount(),r=this.textModel.getLineContent(t);let o=0,h=0,c=0;t===e.lineNumber&&(o=n.findTokenIndexAtOffset(e.column-1),h=e.column-1,c=e.column-1);let u=!0;for(;o<s;o++){const e=n.getLanguageId(o)===i&&!(0,a.Yo)(n.getStandardTokenType(o));if(e)u||(h=n.getStartOffset(o)),c=n.getEndOffset(o);else if(u&&h!==c){const e=l(t,r,h,c);if(e)return e}u=e}if(u&&h!==c){const e=l(t,r,h,c);if(e)return e}}return null}findPrevBracket(t){const e=this.textModel.validatePosition(t);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getFirstBracketBefore(e)||null;let n=null,i=null,s=null;for(let t=e.lineNumber;t>=1;t--){const r=this.textModel.tokenization.getLineTokens(t),o=r.getCount(),l=this.textModel.getLineContent(t);let c=o-1,u=l.length,d=l.length;if(t===e.lineNumber){c=r.findTokenIndexAtOffset(e.column-1),u=e.column-1,d=e.column-1;const t=r.getLanguageId(c);n!==t&&(n=t,i=this.languageConfigurationService.getLanguageConfiguration(n).brackets,s=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew)}let f=!0;for(;c>=0;c--){const e=r.getLanguageId(c);if(n!==e){if(i&&s&&f&&u!==d){const e=h.Fu.findPrevBracketInRange(i.reversedRegex,t,l,u,d);if(e)return this._toFoundBracket(s,e);f=!1}n=e,i=this.languageConfigurationService.getLanguageConfiguration(n).brackets,s=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew}const o=!!i&&!(0,a.Yo)(r.getStandardTokenType(c));if(o)f?u=r.getStartOffset(c):(u=r.getStartOffset(c),d=r.getEndOffset(c));else if(s&&i&&f&&u!==d){const e=h.Fu.findPrevBracketInRange(i.reversedRegex,t,l,u,d);if(e)return this._toFoundBracket(s,e)}f=o}if(s&&i&&f&&u!==d){const e=h.Fu.findPrevBracketInRange(i.reversedRegex,t,l,u,d);if(e)return this._toFoundBracket(s,e)}}return null}findNextBracket(t){const e=this.textModel.validatePosition(t);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getFirstBracketAfter(e)||null;const n=this.textModel.getLineCount();let i=null,s=null,r=null;for(let t=e.lineNumber;t<=n;t++){const n=this.textModel.tokenization.getLineTokens(t),o=n.getCount(),l=this.textModel.getLineContent(t);let c=0,u=0,d=0;if(t===e.lineNumber){c=n.findTokenIndexAtOffset(e.column-1),u=e.column-1,d=e.column-1;const t=n.getLanguageId(c);i!==t&&(i=t,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew)}let f=!0;for(;c<o;c++){const e=n.getLanguageId(c);if(i!==e){if(r&&s&&f&&u!==d){const e=h.Fu.findNextBracketInRange(s.forwardRegex,t,l,u,d);if(e)return this._toFoundBracket(r,e);f=!1}i=e,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew}const o=!!s&&!(0,a.Yo)(n.getStandardTokenType(c));if(o)f||(u=n.getStartOffset(c)),d=n.getEndOffset(c);else if(r&&s&&f&&u!==d){const e=h.Fu.findNextBracketInRange(s.forwardRegex,t,l,u,d);if(e)return this._toFoundBracket(r,e)}f=o}if(r&&s&&f&&u!==d){const e=h.Fu.findNextBracketInRange(s.forwardRegex,t,l,u,d);if(e)return this._toFoundBracket(r,e)}}return null}findEnclosingBrackets(t,e){const n=this.textModel.validatePosition(t);if(this.canBuildAST){const t=o.Q.fromPositions(n),e=this.getBracketPairsInRange(o.Q.fromPositions(n,n)).findLast(e=>void 0!==e.closingBracketRange&&e.range.strictContainsRange(t));return e?[e.openingBracketRange,e.closingBracketRange]:null}const i=tt(e),s=this.textModel.getLineCount(),r=new Map;let l=[];const c=(t,e)=>{if(!r.has(t)){const n=[];for(let t=0,i=e?e.brackets.length:0;t<i;t++)n[t]=0;r.set(t,n)}l=r.get(t)};let u=0;const d=(t,e,n,s,r)=>{for(;;){if(i&&++u%100==0&&!i())return et.INSTANCE;const o=h.Fu.findNextBracketInRange(t.forwardRegex,e,n,s,r);if(!o)break;const a=n.substring(o.startColumn-1,o.endColumn-1).toLowerCase(),c=t.textIsBracket[a];if(c&&(c.isOpen(a)?l[c.index]++:c.isClose(a)&&l[c.index]--,-1===l[c.index]))return this._matchFoundBracket(o,c,!1,i);s=o.endColumn-1}return null};let f=null,g=null;for(let t=n.lineNumber;t<=s;t++){const e=this.textModel.tokenization.getLineTokens(t),i=e.getCount(),s=this.textModel.getLineContent(t);let r=0,o=0,h=0;if(t===n.lineNumber){r=e.findTokenIndexAtOffset(n.column-1),o=n.column-1,h=n.column-1;const t=e.getLanguageId(r);f!==t&&(f=t,g=this.languageConfigurationService.getLanguageConfiguration(f).brackets,c(f,g))}let l=!0;for(;r<i;r++){const n=e.getLanguageId(r);if(f!==n){if(g&&l&&o!==h){const e=d(g,t,s,o,h);if(e)return nt(e);l=!1}f=n,g=this.languageConfigurationService.getLanguageConfiguration(f).brackets,c(f,g)}const i=!!g&&!(0,a.Yo)(e.getStandardTokenType(r));if(i)l||(o=e.getStartOffset(r)),h=e.getEndOffset(r);else if(g&&l&&o!==h){const e=d(g,t,s,o,h);if(e)return nt(e)}l=i}if(g&&l&&o!==h){const e=d(g,t,s,o,h);if(e)return nt(e)}}return null}_toFoundBracket(t,e){if(!e)return null;let n=this.textModel.getValueInRange(e);n=n.toLowerCase();const i=t.getBracketInfo(n);return i?{range:e,bracketInfo:i}:null}}function tt(t){if(void 0===t)return()=>!0;{const e=Date.now();return()=>Date.now()-e<=t}}class et{static{this.INSTANCE=new et}constructor(){this._searchCanceledBrand=void 0}}function nt(t){return t instanceof et?null:t}},95683:(t,e,n)=>{n.d(e,{Th:()=>k,z8:()=>p});var i=n(12003),s=n(73226),r=n(15719),o=n(5839),a=n(5870),h=n(19031),l=n(1268);function c(t){return t.toString()}class u{static create(t,e){const n=t.getAlternativeVersionId(),i=g(t);return new u(n,n,i,i,e,e,[])}constructor(t,e,n,i,s,r,o){this.beforeVersionId=t,this.afterVersionId=e,this.beforeEOL=n,this.afterEOL=i,this.beforeCursorState=s,this.afterCursorState=r,this.changes=o}append(t,e,n,i,s){e.length>0&&(this.changes=(0,a.x)(this.changes,e)),this.afterEOL=n,this.afterVersionId=i,this.afterCursorState=s}static _writeSelectionsSize(t){return 4+16*(t?t.length:0)}static _writeSelections(t,e,n){if(h.Sw(t,e?e.length:0,n),n+=4,e)for(const i of e)h.Sw(t,i.selectionStartLineNumber,n),n+=4,h.Sw(t,i.selectionStartColumn,n),n+=4,h.Sw(t,i.positionLineNumber,n),n+=4,h.Sw(t,i.positionColumn,n),n+=4;return n}static _readSelections(t,e,n){const i=h.bb(t,e);e+=4;for(let s=0;s<i;s++){const i=h.bb(t,e);e+=4;const s=h.bb(t,e);e+=4;const o=h.bb(t,e);e+=4;const a=h.bb(t,e);e+=4,n.push(new r.L(i,s,o,a))}return e}serialize(){let t=10+u._writeSelectionsSize(this.beforeCursorState)+u._writeSelectionsSize(this.afterCursorState)+4;for(const e of this.changes)t+=e.writeSize();const e=new Uint8Array(t);let n=0;h.Sw(e,this.beforeVersionId,n),n+=4,h.Sw(e,this.afterVersionId,n),n+=4,h.Gs(e,this.beforeEOL,n),n+=1,h.Gs(e,this.afterEOL,n),n+=1,n=u._writeSelections(e,this.beforeCursorState,n),n=u._writeSelections(e,this.afterCursorState,n),h.Sw(e,this.changes.length,n),n+=4;for(const t of this.changes)n=t.write(e,n);return e.buffer}static deserialize(t){const e=new Uint8Array(t);let n=0;const i=h.bb(e,n);n+=4;const s=h.bb(e,n);n+=4;const r=h.pJ(e,n);n+=1;const o=h.pJ(e,n);n+=1;const l=[];n=u._readSelections(e,n,l);const c=[];n=u._readSelections(e,n,c);const d=h.bb(e,n);n+=4;const f=[];for(let t=0;t<d;t++)n=a.k.read(e,n,f);return new u(i,s,r,o,l,c,f)}}class d{get type(){return 0}get resource(){return o.r.isUri(this.model)?this.model:this.model.uri}constructor(t,e,n,i){this.label=t,this.code=e,this.model=n,this._data=u.create(n,i)}toString(){return(this._data instanceof u?this._data:u.deserialize(this._data)).changes.map(t=>t.toString()).join(", ")}matchesResource(t){return(o.r.isUri(this.model)?this.model:this.model.uri).toString()===t.toString()}setModel(t){this.model=t}canAppend(t){return this.model===t&&this._data instanceof u}append(t,e,n,i,s){this._data instanceof u&&this._data.append(t,e,n,i,s)}close(){this._data instanceof u&&(this._data=this._data.serialize())}open(){this._data instanceof u||(this._data=u.deserialize(this._data))}undo(){if(o.r.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof u&&(this._data=this._data.serialize());const t=u.deserialize(this._data);this.model._applyUndo(t.changes,t.beforeEOL,t.beforeVersionId,t.beforeCursorState)}redo(){if(o.r.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof u&&(this._data=this._data.serialize());const t=u.deserialize(this._data);this.model._applyRedo(t.changes,t.afterEOL,t.afterVersionId,t.afterCursorState)}heapSize(){return this._data instanceof u&&(this._data=this._data.serialize()),this._data.byteLength+168}}class f{get resources(){return this._editStackElementsArr.map(t=>t.resource)}constructor(t,e,n){this.label=t,this.code=e,this.type=1,this._isOpen=!0,this._editStackElementsArr=n.slice(0),this._editStackElementsMap=new Map;for(const t of this._editStackElementsArr){const e=c(t.resource);this._editStackElementsMap.set(e,t)}this._delegate=null}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(t){const e=c(t);return this._editStackElementsMap.has(e)}setModel(t){const e=c(o.r.isUri(t)?t:t.uri);this._editStackElementsMap.has(e)&&this._editStackElementsMap.get(e).setModel(t)}canAppend(t){if(!this._isOpen)return!1;const e=c(t.uri);return!!this._editStackElementsMap.has(e)&&this._editStackElementsMap.get(e).canAppend(t)}append(t,e,n,i,s){const r=c(t.uri);this._editStackElementsMap.get(r).append(t,e,n,i,s)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const t of this._editStackElementsArr)t.undo()}redo(){for(const t of this._editStackElementsArr)t.redo()}heapSize(t){const e=c(t);return this._editStackElementsMap.has(e)?this._editStackElementsMap.get(e).heapSize():0}split(){return this._editStackElementsArr}toString(){const t=[];for(const e of this._editStackElementsArr)t.push(`${(0,l.P8)(e.resource)}: ${e}`);return`{${t.join(", ")}}`}}function g(t){return"\n"===t.getEOL()?0:1}function k(t){return!!t&&(t instanceof d||t instanceof f)}class p{constructor(t,e){this._model=t,this._undoRedoService=e}pushStackElement(){const t=this._undoRedoService.getLastElement(this._model.uri);k(t)&&t.close()}popStackElement(){const t=this._undoRedoService.getLastElement(this._model.uri);k(t)&&t.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(t,e){const n=this._undoRedoService.getLastElement(this._model.uri);if(k(n)&&n.canAppend(this._model))return n;const s=new d(i.kg("edit","Typing"),"undoredo.textBufferEdit",this._model,t);return this._undoRedoService.pushElement(s,e),s}pushEOL(t){const e=this._getOrCreateEditStackElement(null,void 0);this._model.setEOL(t),e.append(this._model,[],g(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(t,e,n,i){const s=this._getOrCreateEditStackElement(t,i),r=this._model.applyEdits(e,!0),o=p._computeCursorState(n,r),a=r.map((t,e)=>({index:e,textChange:t.textChange}));return a.sort((t,e)=>t.textChange.oldPosition===e.textChange.oldPosition?t.index-e.index:t.textChange.oldPosition-e.textChange.oldPosition),s.append(this._model,a.map(t=>t.textChange),g(this._model),this._model.getAlternativeVersionId(),o),o}static _computeCursorState(t,e){try{return t?t(e):null}catch(t){return(0,s.dz)(t),null}}}}}]);