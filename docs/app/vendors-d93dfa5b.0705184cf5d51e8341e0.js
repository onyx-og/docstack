"use strict";(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[5699],{86972:(t,e,i)=>{i.d(e,{HP:()=>_,Or:()=>m,dQ:()=>w,nd:()=>y});var o,n=i(58574),s=i(99815),r=i(67345),l=i(15365),a=i(28061),u=i(62549),h=i(14333),c=i(71937),d=i(63946);class g{constructor(t=null){this.hitTarget=t,this.type=0}}class f{get hitTarget(){return this.spanNode}constructor(t,e,i){this.position=t,this.spanNode=e,this.injectedText=i,this.type=1}}!function(t){t.createFromDOMInfo=function(t,e,i){const o=t.getPositionFromDOMInfo(e,i);return o?new f(o,e,null):new g(e)}}(o||(o={}));class m{constructor(t,e){this.lastViewCursorsRenderData=t,this.lastTextareaPosition=e}}class _{static _deduceRage(t,e=null){return!e&&t?new a.Q(t.lineNumber,t.column,t.lineNumber,t.column):e??null}static createUnknown(t,e,i){return{type:0,element:t,mouseColumn:e,position:i,range:this._deduceRage(i)}}static createTextarea(t,e){return{type:1,element:t,mouseColumn:e,position:null,range:null}}static createMargin(t,e,i,o,n,s){return{type:t,element:e,mouseColumn:i,position:o,range:n,detail:s}}static createViewZone(t,e,i,o,n){return{type:t,element:e,mouseColumn:i,position:o,range:this._deduceRage(o),detail:n}}static createContentText(t,e,i,o,n){return{type:6,element:t,mouseColumn:e,position:i,range:this._deduceRage(i,o),detail:n}}static createContentEmpty(t,e,i,o){return{type:7,element:t,mouseColumn:e,position:i,range:this._deduceRage(i),detail:o}}static createContentWidget(t,e,i){return{type:9,element:t,mouseColumn:e,position:null,range:null,detail:i}}static createScrollbar(t,e,i){return{type:11,element:t,mouseColumn:e,position:i,range:this._deduceRage(i)}}static createOverlayWidget(t,e,i){return{type:12,element:t,mouseColumn:e,position:null,range:null,detail:i}}static createOutsideEditor(t,e,i,o){return{type:13,element:null,mouseColumn:t,position:e,range:this._deduceRage(e),outsidePosition:i,outsideDistance:o}}static _typeToString(t){return 1===t?"TEXTAREA":2===t?"GUTTER_GLYPH_MARGIN":3===t?"GUTTER_LINE_NUMBERS":4===t?"GUTTER_LINE_DECORATIONS":5===t?"GUTTER_VIEW_ZONE":6===t?"CONTENT_TEXT":7===t?"CONTENT_EMPTY":8===t?"CONTENT_VIEW_ZONE":9===t?"CONTENT_WIDGET":10===t?"OVERVIEW_RULER":11===t?"SCROLLBAR":12===t?"OVERLAY_WIDGET":"UNKNOWN"}static toString(t){return this._typeToString(t.type)+": "+t.position+" - "+t.range+" - "+JSON.stringify(t.detail)}}class p{static isTextArea(t){return 2===t.length&&3===t[0]&&7===t[1]}static isChildOfViewLines(t){return t.length>=4&&3===t[0]&&8===t[3]}static isStrictChildOfViewLines(t){return t.length>4&&3===t[0]&&8===t[3]}static isChildOfScrollableElement(t){return t.length>=2&&3===t[0]&&6===t[1]}static isChildOfMinimap(t){return t.length>=2&&3===t[0]&&9===t[1]}static isChildOfContentWidgets(t){return t.length>=4&&3===t[0]&&1===t[3]}static isChildOfOverflowGuard(t){return t.length>=1&&3===t[0]}static isChildOfOverflowingContentWidgets(t){return t.length>=1&&2===t[0]}static isChildOfOverlayWidgets(t){return t.length>=2&&3===t[0]&&4===t[1]}static isChildOfOverflowingOverlayWidgets(t){return t.length>=1&&5===t[0]}}class w{constructor(t,e,i){this.viewModel=t.viewModel;const o=t.configuration.options;this.layoutInfo=o.get(146),this.viewDomNode=e.viewDomNode,this.lineHeight=o.get(67),this.stickyTabStops=o.get(117),this.typicalHalfwidthCharacterWidth=o.get(50).typicalHalfwidthCharacterWidth,this.lastRenderData=i,this._context=t,this._viewHelper=e}getZoneAtCoord(t){return w.getZoneAtCoord(this._context,t)}static getZoneAtCoord(t,e){const i=t.viewLayout.getWhitespaceAtVerticalOffset(e);if(i){const o=i.verticalOffset+i.height/2,n=t.viewModel.getLineCount();let s,r=null,a=null;return i.afterLineNumber!==n&&(a=new l.y(i.afterLineNumber+1,1)),i.afterLineNumber>0&&(r=new l.y(i.afterLineNumber,t.viewModel.getLineMaxColumn(i.afterLineNumber))),s=null===a?r:null===r?a:e<o?r:a,{viewZoneId:i.id,afterLineNumber:i.afterLineNumber,positionBefore:r,positionAfter:a,position:s}}return null}getFullLineRangeAtCoord(t){if(this._context.viewLayout.isAfterLines(t)){const t=this._context.viewModel.getLineCount(),e=this._context.viewModel.getLineMaxColumn(t);return{range:new a.Q(t,e,t,e),isAfterLines:!0}}const e=this._context.viewLayout.getLineNumberAtVerticalOffset(t),i=this._context.viewModel.getLineMaxColumn(e);return{range:new a.Q(e,1,e,i),isAfterLines:!1}}getLineNumberAtVerticalOffset(t){return this._context.viewLayout.getLineNumberAtVerticalOffset(t)}isAfterLines(t){return this._context.viewLayout.isAfterLines(t)}isInTopPadding(t){return this._context.viewLayout.isInTopPadding(t)}isInBottomPadding(t){return this._context.viewLayout.isInBottomPadding(t)}getVerticalOffsetForLineNumber(t){return this._context.viewLayout.getVerticalOffsetForLineNumber(t)}findAttribute(t,e){return w._findAttribute(t,e,this._viewHelper.viewDomNode)}static _findAttribute(t,e,i){for(;t&&t!==t.ownerDocument.body;){if(t.hasAttribute&&t.hasAttribute(e))return t.getAttribute(e);if(t===i)return null;t=t.parentNode}return null}getLineWidth(t){return this._viewHelper.getLineWidth(t)}visibleRangeForPosition(t,e){return this._viewHelper.visibleRangeForPosition(t,e)}getPositionFromDOMInfo(t,e){return this._viewHelper.getPositionFromDOMInfo(t,e)}getCurrentScrollTop(){return this._context.viewLayout.getCurrentScrollTop()}getCurrentScrollLeft(){return this._context.viewLayout.getCurrentScrollLeft()}}class v{constructor(t,e,i,o){this.editorPos=e,this.pos=i,this.relativePos=o,this.mouseVerticalOffset=Math.max(0,t.getCurrentScrollTop()+this.relativePos.y),this.mouseContentHorizontalOffset=t.getCurrentScrollLeft()+this.relativePos.x-t.layoutInfo.contentLeft,this.isInMarginArea=this.relativePos.x<t.layoutInfo.contentLeft&&this.relativePos.x>=t.layoutInfo.glyphMarginLeft,this.isInContentArea=!this.isInMarginArea,this.mouseColumn=Math.max(0,y._getMouseColumn(this.mouseContentHorizontalOffset,t.typicalHalfwidthCharacterWidth))}}class C extends v{get target(){return this._useHitTestTarget?this.hitTestResult.value.hitTarget:this._eventTarget}get targetPath(){return this._targetPathCacheElement!==this.target&&(this._targetPathCacheElement=this.target,this._targetPathCacheValue=s.L.collect(this.target,this._ctx.viewDomNode)),this._targetPathCacheValue}constructor(t,e,i,o,n){super(t,e,i,o),this.hitTestResult=new d.d((()=>y.doHitTest(this._ctx,this))),this._targetPathCacheElement=null,this._targetPathCacheValue=new Uint8Array(0),this._ctx=t,this._eventTarget=n;const s=Boolean(this._eventTarget);this._useHitTestTarget=!s}toString(){return`pos(${this.pos.x},${this.pos.y}), editorPos(${this.editorPos.x},${this.editorPos.y}), relativePos(${this.relativePos.x},${this.relativePos.y}), mouseVerticalOffset: ${this.mouseVerticalOffset}, mouseContentHorizontalOffset: ${this.mouseContentHorizontalOffset}\n\ttarget: ${this.target?this.target.outerHTML:null}`}get wouldBenefitFromHitTestTargetSwitch(){return!this._useHitTestTarget&&null!==this.hitTestResult.value.hitTarget&&this.target!==this.hitTestResult.value.hitTarget}switchToHitTestTarget(){this._useHitTestTarget=!0}_getMouseColumn(t=null){return t&&t.column<this._ctx.viewModel.getLineMaxColumn(t.lineNumber)?u.A.visibleColumnFromColumn(this._ctx.viewModel.getLineContent(t.lineNumber),t.column,this._ctx.viewModel.model.getOptions().tabSize)+1:this.mouseColumn}fulfillUnknown(t=null){return _.createUnknown(this.target,this._getMouseColumn(t),t)}fulfillTextarea(){return _.createTextarea(this.target,this._getMouseColumn())}fulfillMargin(t,e,i,o){return _.createMargin(t,this.target,this._getMouseColumn(e),e,i,o)}fulfillViewZone(t,e,i){return _.createViewZone(t,this.target,this._getMouseColumn(e),e,i)}fulfillContentText(t,e,i){return _.createContentText(this.target,this._getMouseColumn(t),t,e,i)}fulfillContentEmpty(t,e){return _.createContentEmpty(this.target,this._getMouseColumn(t),t,e)}fulfillContentWidget(t){return _.createContentWidget(this.target,this._getMouseColumn(),t)}fulfillScrollbar(t){return _.createScrollbar(this.target,this._getMouseColumn(t),t)}fulfillOverlayWidget(t){return _.createOverlayWidget(this.target,this._getMouseColumn(),t)}}const M={isAfterLines:!0};function T(t){return{isAfterLines:!1,horizontalDistanceToText:t}}class y{constructor(t,e){this._context=t,this._viewHelper=e}mouseTargetIsWidget(t){const e=t.target,i=s.L.collect(e,this._viewHelper.viewDomNode);return!!(p.isChildOfContentWidgets(i)||p.isChildOfOverflowingContentWidgets(i)||p.isChildOfOverlayWidgets(i)||p.isChildOfOverflowingOverlayWidgets(i))}createMouseTarget(t,e,i,o,n){const s=new w(this._context,this._viewHelper,t),r=new C(s,e,i,o,n);try{const t=y._createMouseTarget(s,r);if(6===t.type&&s.stickyTabStops&&null!==t.position){const e=y._snapToSoftTabBoundary(t.position,s.viewModel),i=a.Q.fromPositions(e,e).plusRange(t.range);return r.fulfillContentText(e,i,t.detail)}return t}catch(t){return r.fulfillUnknown()}}static _createMouseTarget(t,e){if(null===e.target)return e.fulfillUnknown();const i=e;let o=null;return p.isChildOfOverflowGuard(e.targetPath)||p.isChildOfOverflowingContentWidgets(e.targetPath)||p.isChildOfOverflowingOverlayWidgets(e.targetPath)||(o=o||e.fulfillUnknown()),o=o||y._hitTestContentWidget(t,i),o=o||y._hitTestOverlayWidget(t,i),o=o||y._hitTestMinimap(t,i),o=o||y._hitTestScrollbarSlider(t,i),o=o||y._hitTestViewZone(t,i),o=o||y._hitTestMargin(t,i),o=o||y._hitTestViewCursor(t,i),o=o||y._hitTestTextArea(t,i),o=o||y._hitTestViewLines(t,i),o=o||y._hitTestScrollbar(t,i),o||e.fulfillUnknown()}static _hitTestContentWidget(t,e){if(p.isChildOfContentWidgets(e.targetPath)||p.isChildOfOverflowingContentWidgets(e.targetPath)){const i=t.findAttribute(e.target,"widgetId");return i?e.fulfillContentWidget(i):e.fulfillUnknown()}return null}static _hitTestOverlayWidget(t,e){if(p.isChildOfOverlayWidgets(e.targetPath)||p.isChildOfOverflowingOverlayWidgets(e.targetPath)){const i=t.findAttribute(e.target,"widgetId");return i?e.fulfillOverlayWidget(i):e.fulfillUnknown()}return null}static _hitTestViewCursor(t,e){if(e.target){const i=t.lastRenderData.lastViewCursorsRenderData;for(const t of i)if(e.target===t.domNode)return e.fulfillContentText(t.position,null,{mightBeForeignElement:!1,injectedText:null})}if(e.isInContentArea){const i=t.lastRenderData.lastViewCursorsRenderData,o=e.mouseContentHorizontalOffset,n=e.mouseVerticalOffset;for(const s of i){if(o<s.contentLeft)continue;if(o>s.contentLeft+s.width)continue;const i=t.getVerticalOffsetForLineNumber(s.position.lineNumber);if(i<=n&&n<=i+s.height)return e.fulfillContentText(s.position,null,{mightBeForeignElement:!1,injectedText:null})}}return null}static _hitTestViewZone(t,e){const i=t.getZoneAtCoord(e.mouseVerticalOffset);if(i){const t=e.isInContentArea?8:5;return e.fulfillViewZone(t,i.position,i)}return null}static _hitTestTextArea(t,e){return p.isTextArea(e.targetPath)?t.lastRenderData.lastTextareaPosition?e.fulfillContentText(t.lastRenderData.lastTextareaPosition,null,{mightBeForeignElement:!1,injectedText:null}):e.fulfillTextarea():null}static _hitTestMargin(t,e){if(e.isInMarginArea){const i=t.getFullLineRangeAtCoord(e.mouseVerticalOffset),o=i.range.getStartPosition();let n=Math.abs(e.relativePos.x);const s={isAfterLines:i.isAfterLines,glyphMarginLeft:t.layoutInfo.glyphMarginLeft,glyphMarginWidth:t.layoutInfo.glyphMarginWidth,lineNumbersWidth:t.layoutInfo.lineNumbersWidth,offsetX:n};if(n-=t.layoutInfo.glyphMarginLeft,n<=t.layoutInfo.glyphMarginWidth){const r=t.viewModel.coordinatesConverter.convertViewPositionToModelPosition(i.range.getStartPosition()),l=t.viewModel.glyphLanes.getLanesAtLine(r.lineNumber);return s.glyphMarginLane=l[Math.floor(n/t.lineHeight)],e.fulfillMargin(2,o,i.range,s)}return n-=t.layoutInfo.glyphMarginWidth,n<=t.layoutInfo.lineNumbersWidth?e.fulfillMargin(3,o,i.range,s):(n-=t.layoutInfo.lineNumbersWidth,e.fulfillMargin(4,o,i.range,s))}return null}static _hitTestViewLines(t,e){if(!p.isChildOfViewLines(e.targetPath))return null;if(t.isInTopPadding(e.mouseVerticalOffset))return e.fulfillContentEmpty(new l.y(1,1),M);if(t.isAfterLines(e.mouseVerticalOffset)||t.isInBottomPadding(e.mouseVerticalOffset)){const i=t.viewModel.getLineCount(),o=t.viewModel.getLineMaxColumn(i);return e.fulfillContentEmpty(new l.y(i,o),M)}if(p.isStrictChildOfViewLines(e.targetPath)){const i=t.getLineNumberAtVerticalOffset(e.mouseVerticalOffset);if(0===t.viewModel.getLineLength(i)){const o=t.getLineWidth(i),n=T(e.mouseContentHorizontalOffset-o);return e.fulfillContentEmpty(new l.y(i,1),n)}const o=t.getLineWidth(i);if(e.mouseContentHorizontalOffset>=o){const n=T(e.mouseContentHorizontalOffset-o),s=new l.y(i,t.viewModel.getLineMaxColumn(i));return e.fulfillContentEmpty(s,n)}}const i=e.hitTestResult.value;return 1===i.type?y.createMouseTargetFromHitTestPosition(t,e,i.spanNode,i.position,i.injectedText):e.wouldBenefitFromHitTestTargetSwitch?(e.switchToHitTestTarget(),this._createMouseTarget(t,e)):e.fulfillUnknown()}static _hitTestMinimap(t,e){if(p.isChildOfMinimap(e.targetPath)){const i=t.getLineNumberAtVerticalOffset(e.mouseVerticalOffset),o=t.viewModel.getLineMaxColumn(i);return e.fulfillScrollbar(new l.y(i,o))}return null}static _hitTestScrollbarSlider(t,e){if(p.isChildOfScrollableElement(e.targetPath)&&e.target&&1===e.target.nodeType){const i=e.target.className;if(i&&/\b(slider|scrollbar)\b/.test(i)){const i=t.getLineNumberAtVerticalOffset(e.mouseVerticalOffset),o=t.viewModel.getLineMaxColumn(i);return e.fulfillScrollbar(new l.y(i,o))}}return null}static _hitTestScrollbar(t,e){if(p.isChildOfScrollableElement(e.targetPath)){const i=t.getLineNumberAtVerticalOffset(e.mouseVerticalOffset),o=t.viewModel.getLineMaxColumn(i);return e.fulfillScrollbar(new l.y(i,o))}return null}getMouseColumn(t){const e=this._context.configuration.options,i=e.get(146),o=this._context.viewLayout.getCurrentScrollLeft()+t.x-i.contentLeft;return y._getMouseColumn(o,e.get(50).typicalHalfwidthCharacterWidth)}static _getMouseColumn(t,e){return t<0?1:Math.round(t/e)+1}static createMouseTargetFromHitTestPosition(t,e,i,o,n){const s=o.lineNumber,r=o.column,u=t.getLineWidth(s);if(e.mouseContentHorizontalOffset>u){const t=T(e.mouseContentHorizontalOffset-u);return e.fulfillContentEmpty(o,t)}const c=t.visibleRangeForPosition(s,r);if(!c)return e.fulfillUnknown(o);const d=c.left;if(Math.abs(e.mouseContentHorizontalOffset-d)<1)return e.fulfillContentText(o,null,{mightBeForeignElement:!!n,injectedText:n});const g=[];if(g.push({offset:c.left,column:r}),r>1){const e=t.visibleRangeForPosition(s,r-1);e&&g.push({offset:e.left,column:r-1})}if(r<t.viewModel.getLineMaxColumn(s)){const e=t.visibleRangeForPosition(s,r+1);e&&g.push({offset:e.left,column:r+1})}g.sort(((t,e)=>t.offset-e.offset));const f=e.pos.toClientCoordinates(h.zk(t.viewDomNode)),m=i.getBoundingClientRect(),_=m.left<=f.clientX&&f.clientX<=m.right;let p=null;for(let t=1;t<g.length;t++){const i=g[t-1],n=g[t];if(i.offset<=e.mouseContentHorizontalOffset&&e.mouseContentHorizontalOffset<=n.offset){p=new a.Q(s,i.column,s,n.column),o=Math.abs(i.offset-e.mouseContentHorizontalOffset)<Math.abs(n.offset-e.mouseContentHorizontalOffset)?new l.y(s,i.column):new l.y(s,n.column);break}}return e.fulfillContentText(o,p,{mightBeForeignElement:!_||!!n,injectedText:n})}static _doHitTestWithCaretRangeFromPoint(t,e){const i=t.getLineNumberAtVerticalOffset(e.mouseVerticalOffset),o=t.getVerticalOffsetForLineNumber(i),s=o+t.lineHeight;if(!(i===t.viewModel.getLineCount()&&e.mouseVerticalOffset>s)){const i=Math.floor((o+s)/2);let r=e.pos.y+(i-e.mouseVerticalOffset);r<=e.editorPos.y&&(r=e.editorPos.y+1),r>=e.editorPos.y+e.editorPos.height&&(r=e.editorPos.y+e.editorPos.height-1);const l=new n.nz(e.pos.x,r),a=this._actualDoHitTestWithCaretRangeFromPoint(t,l.toClientCoordinates(h.zk(t.viewDomNode)));if(1===a.type)return a}return this._actualDoHitTestWithCaretRangeFromPoint(t,e.pos.toClientCoordinates(h.zk(t.viewDomNode)))}static _actualDoHitTestWithCaretRangeFromPoint(t,e){const i=h.jG(t.viewDomNode);let n;if(n=i?void 0===i.caretRangeFromPoint?function(t,e,i){const o=document.createRange();let n=t.elementFromPoint(e,i);if(null!==n){for(;n&&n.firstChild&&n.firstChild.nodeType!==n.firstChild.TEXT_NODE&&n.lastChild&&n.lastChild.firstChild;)n=n.lastChild;const t=n.getBoundingClientRect(),i=h.zk(n),s=`${i.getComputedStyle(n,null).getPropertyValue("font-style")} ${i.getComputedStyle(n,null).getPropertyValue("font-variant")} ${i.getComputedStyle(n,null).getPropertyValue("font-weight")} ${i.getComputedStyle(n,null).getPropertyValue("font-size")}/${i.getComputedStyle(n,null).getPropertyValue("line-height")} ${i.getComputedStyle(n,null).getPropertyValue("font-family")}`,r=n.innerText;let l,a=t.left,u=0;if(e>t.left+t.width)u=r.length;else{const t=N.getInstance();for(let i=0;i<r.length+1;i++){if(l=t.getCharWidth(r.charAt(i),s)/2,a+=l,e<a){u=i;break}a+=l}}o.setStart(n.firstChild,u),o.setEnd(n.firstChild,u)}return o}(i,e.clientX,e.clientY):i.caretRangeFromPoint(e.clientX,e.clientY):t.viewDomNode.ownerDocument.caretRangeFromPoint(e.clientX,e.clientY),!n||!n.startContainer)return new g;const s=n.startContainer;if(s.nodeType===s.TEXT_NODE){const e=s.parentNode,i=e?e.parentNode:null,l=i?i.parentNode:null;return(l&&l.nodeType===l.ELEMENT_NODE?l.className:null)===r.Gb.CLASS_NAME?o.createFromDOMInfo(t,e,n.startOffset):new g(s.parentNode)}if(s.nodeType===s.ELEMENT_NODE){const e=s.parentNode,i=e?e.parentNode:null;return(i&&i.nodeType===i.ELEMENT_NODE?i.className:null)===r.Gb.CLASS_NAME?o.createFromDOMInfo(t,s,s.textContent.length):new g(s)}return new g}static _doHitTestWithCaretPositionFromPoint(t,e){const i=t.viewDomNode.ownerDocument.caretPositionFromPoint(e.clientX,e.clientY);if(i.offsetNode.nodeType===i.offsetNode.TEXT_NODE){const e=i.offsetNode.parentNode,n=e?e.parentNode:null,s=n?n.parentNode:null;return(s&&s.nodeType===s.ELEMENT_NODE?s.className:null)===r.Gb.CLASS_NAME?o.createFromDOMInfo(t,i.offsetNode.parentNode,i.offset):new g(i.offsetNode.parentNode)}if(i.offsetNode.nodeType===i.offsetNode.ELEMENT_NODE){const e=i.offsetNode.parentNode,n=e&&e.nodeType===e.ELEMENT_NODE?e.className:null,s=e?e.parentNode:null,l=s&&s.nodeType===s.ELEMENT_NODE?s.className:null;if(n===r.Gb.CLASS_NAME){const e=i.offsetNode.childNodes[Math.min(i.offset,i.offsetNode.childNodes.length-1)];if(e)return o.createFromDOMInfo(t,e,0)}else if(l===r.Gb.CLASS_NAME)return o.createFromDOMInfo(t,i.offsetNode,0)}return new g(i.offsetNode)}static _snapToSoftTabBoundary(t,e){const i=e.getLineContent(t.lineNumber),{tabSize:o}=e.model.getOptions(),n=c.s.atomicPosition(i,t.column-1,o,2);return-1!==n?new l.y(t.lineNumber,n+1):t}static doHitTest(t,e){let i=new g;if("function"==typeof t.viewDomNode.ownerDocument.caretRangeFromPoint?i=this._doHitTestWithCaretRangeFromPoint(t,e):t.viewDomNode.ownerDocument.caretPositionFromPoint&&(i=this._doHitTestWithCaretPositionFromPoint(t,e.pos.toClientCoordinates(h.zk(t.viewDomNode)))),1===i.type){const e=t.viewModel.getInjectedTextAt(i.position),o=t.viewModel.normalizePosition(i.position,2);!e&&o.equals(i.position)||(i=new f(o,i.spanNode,e))}return i}}class N{static{this._INSTANCE=null}static getInstance(){return N._INSTANCE||(N._INSTANCE=new N),N._INSTANCE}constructor(){this._cache={},this._canvas=document.createElement("canvas")}getCharWidth(t,e){const i=t+e;if(this._cache[i])return this._cache[i];const o=this._canvas.getContext("2d");o.font=e;const n=o.measureText(t).width;return this._cache[i]=n,n}}},30558:(t,e,i)=>{i.d(e,{J:()=>D});var o=i(51577),n=i(14333),s=i(30474),r=i(48877),l=i(10998),a=i(63339),u=i(9715),h=i(86972),c=i(58574),d=i(84587),g=i(15365),f=i(93702),m=i(92405),_=i(58354);class p extends m.i{constructor(t,e,i){super(),this._mouseLeaveMonitor=null,this._context=t,this.viewController=e,this.viewHelper=i,this.mouseTargetFactory=new h.nd(this._context,i),this._mouseDownOperation=this._register(new w(this._context,this.viewController,this.viewHelper,this.mouseTargetFactory,((t,e)=>this._createMouseTarget(t,e)),(t=>this._getMouseColumn(t)))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(146).height;const o=new c.$z(this.viewHelper.viewDomNode);this._register(o.onContextMenu(this.viewHelper.viewDomNode,(t=>this._onContextMenu(t,!0)))),this._register(o.onMouseMove(this.viewHelper.viewDomNode,(t=>{this._onMouseMove(t),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=n.ko(this.viewHelper.viewDomNode.ownerDocument,"mousemove",(t=>{this.viewHelper.viewDomNode.contains(t.target)||this._onMouseLeave(new c.dO(t,!1,this.viewHelper.viewDomNode))})))}))),this._register(o.onMouseUp(this.viewHelper.viewDomNode,(t=>this._onMouseUp(t)))),this._register(o.onMouseLeave(this.viewHelper.viewDomNode,(t=>this._onMouseLeave(t))));let s=0;this._register(o.onPointerDown(this.viewHelper.viewDomNode,((t,e)=>{s=e}))),this._register(n.ko(this.viewHelper.viewDomNode,n.Bx.POINTER_UP,(t=>{this._mouseDownOperation.onPointerUp()}))),this._register(o.onMouseDown(this.viewHelper.viewDomNode,(t=>this._onMouseDown(t,s)))),this._setupMouseWheelZoomListener(),this._context.addEventHandler(this)}_setupMouseWheelZoomListener(){const t=_.QC.INSTANCE;let e=0,i=d.D.getZoomLevel(),o=!1,s=0;function r(t){return a.zx?(t.metaKey||t.ctrlKey)&&!t.shiftKey&&!t.altKey:t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey}this._register(n.ko(this.viewHelper.viewDomNode,n.Bx.MOUSE_WHEEL,(n=>{if(this.viewController.emitMouseWheel(n),!this._context.configuration.options.get(76))return;const l=new u.$(n);if(t.acceptStandardWheelEvent(l),t.isPhysicalMouseWheel()){if(r(n)){const t=d.D.getZoomLevel(),e=l.deltaY>0?1:-1;d.D.setZoomLevel(t+e),l.preventDefault(),l.stopPropagation()}}else Date.now()-e>50&&(i=d.D.getZoomLevel(),o=r(n),s=0),e=Date.now(),s+=l.deltaY,o&&(d.D.setZoomLevel(i+s/5),l.preventDefault(),l.stopPropagation())}),{capture:!0,passive:!1}))}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(t){if(t.hasChanged(146)){const t=this._context.configuration.options.get(146).height;this._height!==t&&(this._height=t,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(t){return this._mouseDownOperation.onCursorStateChanged(t),!1}onFocusChanged(t){return!1}getTargetAtClientPoint(t,e){const i=new c.Hh(t,e).toPageCoordinates(n.zk(this.viewHelper.viewDomNode)),o=(0,c.wt)(this.viewHelper.viewDomNode);if(i.y<o.y||i.y>o.y+o.height||i.x<o.x||i.x>o.x+o.width)return null;const s=(0,c.i_)(this.viewHelper.viewDomNode,o,i);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),o,i,s,null)}_createMouseTarget(t,e){let i=t.target;if(!this.viewHelper.viewDomNode.contains(i)){const e=n.jG(this.viewHelper.viewDomNode);e&&(i=e.elementsFromPoint(t.posx,t.posy).find((t=>this.viewHelper.viewDomNode.contains(t))))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),t.editorPos,t.pos,t.relativePos,e?i:null)}_getMouseColumn(t){return this.mouseTargetFactory.getMouseColumn(t.relativePos)}_onContextMenu(t,e){this.viewController.emitContextMenu({event:t,target:this._createMouseTarget(t,e)})}_onMouseMove(t){this.mouseTargetFactory.mouseTargetIsWidget(t)||t.preventDefault(),this._mouseDownOperation.isActive()||t.timestamp<this.lastMouseLeaveTime||this.viewController.emitMouseMove({event:t,target:this._createMouseTarget(t,!0)})}_onMouseLeave(t){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=(new Date).getTime(),this.viewController.emitMouseLeave({event:t,target:null})}_onMouseUp(t){this.viewController.emitMouseUp({event:t,target:this._createMouseTarget(t,!0)})}_onMouseDown(t,e){const i=this._createMouseTarget(t,!0),o=6===i.type||7===i.type,n=2===i.type||3===i.type||4===i.type,s=3===i.type,r=this._context.configuration.options.get(110),l=8===i.type||5===i.type,u=9===i.type;let h=t.leftButton||t.middleButton;a.zx&&t.leftButton&&t.ctrlKey&&(h=!1);const c=()=>{t.preventDefault(),this.viewHelper.focusTextArea()};if(h&&(o||s&&r))c(),this._mouseDownOperation.start(i.type,t,e);else if(n)t.preventDefault();else if(l){const o=i.detail;h&&this.viewHelper.shouldSuppressMouseDownOnViewZone(o.viewZoneId)&&(c(),this._mouseDownOperation.start(i.type,t,e),t.preventDefault())}else u&&this.viewHelper.shouldSuppressMouseDownOnWidget(i.detail)&&(c(),t.preventDefault());this.viewController.emitMouseDown({event:t,target:i})}}class w extends l.jG{constructor(t,e,i,o,n,s){super(),this._context=t,this._viewController=e,this._viewHelper=i,this._mouseTargetFactory=o,this._createMouseTarget=n,this._getMouseColumn=s,this._mouseMoveMonitor=this._register(new c.BA(this._viewHelper.viewDomNode)),this._topBottomDragScrolling=this._register(new v(this._context,this._viewHelper,this._mouseTargetFactory,((t,e,i)=>this._dispatchMouse(t,e,i)))),this._mouseState=new M,this._currentSelection=new f.L(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(t){this._lastMouseEvent=t,this._mouseState.setModifiers(t);const e=this._findMousePosition(t,!1);e&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:t,target:e}):13!==e.type||"above"!==e.outsidePosition&&"below"!==e.outsidePosition?(this._topBottomDragScrolling.stop(),this._dispatchMouse(e,!0,1)):this._topBottomDragScrolling.start(e,t))}start(t,e,i){this._lastMouseEvent=e,this._mouseState.setStartedOnLineNumbers(3===t),this._mouseState.setStartButtons(e),this._mouseState.setModifiers(e);const o=this._findMousePosition(e,!0);if(!o||!o.position)return;this._mouseState.trySetCount(e.detail,o.position),e.detail=this._mouseState.count;const s=this._context.configuration.options;if(!s.get(92)&&s.get(35)&&!s.get(22)&&!this._mouseState.altKey&&e.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&6===o.type&&o.position&&this._currentSelection.containsPosition(o.position))return this._mouseState.isDragAndDrop=!0,this._isActive=!0,void this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,e.buttons,(t=>this._onMouseDownThenMove(t)),(t=>{const e=this._findMousePosition(this._lastMouseEvent,!1);n.kx(t)?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:e?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()}));this._mouseState.isDragAndDrop=!1,this._dispatchMouse(o,e.shiftKey,1),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,e.buttons,(t=>this._onMouseDownThenMove(t)),(()=>this._stop())))}_stop(){this._isActive=!1,this._topBottomDragScrolling.stop()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onCursorStateChanged(t){this._currentSelection=t.selections[0]}_getPositionOutsideEditor(t){const e=t.editorPos,i=this._context.viewModel,o=this._context.viewLayout,n=this._getMouseColumn(t);if(t.posy<e.y){const i=e.y-t.posy,s=Math.max(o.getCurrentScrollTop()-i,0),r=h.dQ.getZoneAtCoord(this._context,s);if(r){const t=this._helpPositionJumpOverViewZone(r);if(t)return h.HP.createOutsideEditor(n,t,"above",i)}const l=o.getLineNumberAtVerticalOffset(s);return h.HP.createOutsideEditor(n,new g.y(l,1),"above",i)}if(t.posy>e.y+e.height){const s=t.posy-e.y-e.height,r=o.getCurrentScrollTop()+t.relativePos.y,l=h.dQ.getZoneAtCoord(this._context,r);if(l){const t=this._helpPositionJumpOverViewZone(l);if(t)return h.HP.createOutsideEditor(n,t,"below",s)}const a=o.getLineNumberAtVerticalOffset(r);return h.HP.createOutsideEditor(n,new g.y(a,i.getLineMaxColumn(a)),"below",s)}const s=o.getLineNumberAtVerticalOffset(o.getCurrentScrollTop()+t.relativePos.y);if(t.posx<e.x){const i=e.x-t.posx;return h.HP.createOutsideEditor(n,new g.y(s,1),"left",i)}if(t.posx>e.x+e.width){const o=t.posx-e.x-e.width;return h.HP.createOutsideEditor(n,new g.y(s,i.getLineMaxColumn(s)),"right",o)}return null}_findMousePosition(t,e){const i=this._getPositionOutsideEditor(t);if(i)return i;const o=this._createMouseTarget(t,e);if(!o.position)return null;if(8===o.type||5===o.type){const t=this._helpPositionJumpOverViewZone(o.detail);if(t)return h.HP.createViewZone(o.type,o.element,o.mouseColumn,t,o.detail)}return o}_helpPositionJumpOverViewZone(t){const e=new g.y(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),i=t.positionBefore,o=t.positionAfter;return i&&o?i.isBefore(e)?i:o:null}_dispatchMouse(t,e,i){t.position&&this._viewController.dispatchMouse({position:t.position,mouseColumn:t.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,revealType:i,inSelectionMode:e,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:6===t.type&&null!==t.detail.injectedText})}}class v extends l.jG{constructor(t,e,i,o){super(),this._context=t,this._viewHelper=e,this._mouseTargetFactory=i,this._dispatchMouse=o,this._operation=null}dispose(){super.dispose(),this.stop()}start(t,e){this._operation?this._operation.setPosition(t,e):this._operation=new C(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,t,e)}stop(){this._operation&&(this._operation.dispose(),this._operation=null)}}class C extends l.jG{constructor(t,e,i,o,s,r){super(),this._context=t,this._viewHelper=e,this._mouseTargetFactory=i,this._dispatchMouse=o,this._position=s,this._mouseEvent=r,this._lastTime=Date.now(),this._animationFrameDisposable=n.PG(n.zk(r.browserEvent),(()=>this._execute()))}dispose(){this._animationFrameDisposable.dispose(),super.dispose()}setPosition(t,e){this._position=t,this._mouseEvent=e}_tick(){const t=Date.now(),e=t-this._lastTime;return this._lastTime=t,e}_getScrollSpeed(){const t=this._context.configuration.options.get(67),e=this._context.configuration.options.get(146).height/t,i=this._position.outsideDistance/t;return i<=1.5?Math.max(30,e*(1+i)):i<=3?Math.max(60,e*(2+i)):Math.max(200,e*(7+i))}_execute(){const t=this._context.configuration.options.get(67),e=this._getScrollSpeed()*(this._tick()/1e3)*t,i="above"===this._position.outsidePosition?-e:e;this._context.viewModel.viewLayout.deltaScrollNow(0,i),this._viewHelper.renderNow();const o=this._context.viewLayout.getLinesViewportData(),s="above"===this._position.outsidePosition?o.startLineNumber:o.endLineNumber;let r;{const t=(0,c.wt)(this._viewHelper.viewDomNode),e=this._context.configuration.options.get(146).horizontalScrollbarHeight,i=new c.nz(this._mouseEvent.pos.x,t.y+t.height-e-.1),o=(0,c.i_)(this._viewHelper.viewDomNode,t,i);r=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),t,i,o,null)}r.position&&r.position.lineNumber===s||(r="above"===this._position.outsidePosition?h.HP.createOutsideEditor(this._position.mouseColumn,new g.y(s,1),"above",this._position.outsideDistance):h.HP.createOutsideEditor(this._position.mouseColumn,new g.y(s,this._context.viewModel.getLineMaxColumn(s)),"below",this._position.outsideDistance)),this._dispatchMouse(r,!0,2),this._animationFrameDisposable=n.PG(n.zk(r.element),(()=>this._execute()))}}class M{static{this.CLEAR_MOUSE_DOWN_COUNT_TIME=400}get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get count(){return this._lastMouseDownCount}setModifiers(t){this._altKey=t.altKey,this._ctrlKey=t.ctrlKey,this._metaKey=t.metaKey,this._shiftKey=t.shiftKey}setStartButtons(t){this._leftButton=t.leftButton,this._middleButton=t.middleButton}setStartedOnLineNumbers(t){this._startedOnLineNumbers=t}trySetCount(t,e){const i=(new Date).getTime();i-this._lastSetMouseDownCountTime>M.CLEAR_MOUSE_DOWN_COUNT_TIME&&(t=1),this._lastSetMouseDownCountTime=i,t>this._lastMouseDownCount+1&&(t=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(e)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=e,this._lastMouseDownCount=Math.min(t,this._lastMouseDownPositionEqualCount)}}var T=i(93344);class y extends p{constructor(t,e,i){super(t,e,i),this._register(s.q.addTarget(this.viewHelper.linesContentDomNode)),this._register(n.ko(this.viewHelper.linesContentDomNode,s.B.Tap,(t=>this.onTap(t)))),this._register(n.ko(this.viewHelper.linesContentDomNode,s.B.Change,(t=>this.onChange(t)))),this._register(n.ko(this.viewHelper.linesContentDomNode,s.B.Contextmenu,(t=>this._onContextMenu(new c.dO(t,!1,this.viewHelper.viewDomNode),!1)))),this._lastPointerType="mouse",this._register(n.ko(this.viewHelper.linesContentDomNode,"pointerdown",(t=>{const e=t.pointerType;this._lastPointerType="mouse"!==e?"touch"===e?"touch":"pen":"mouse"})));const o=new c.DW(this.viewHelper.viewDomNode);this._register(o.onPointerMove(this.viewHelper.viewDomNode,(t=>this._onMouseMove(t)))),this._register(o.onPointerUp(this.viewHelper.viewDomNode,(t=>this._onMouseUp(t)))),this._register(o.onPointerLeave(this.viewHelper.viewDomNode,(t=>this._onMouseLeave(t)))),this._register(o.onPointerDown(this.viewHelper.viewDomNode,((t,e)=>this._onMouseDown(t,e))))}onTap(t){t.initialTarget&&this.viewHelper.linesContentDomNode.contains(t.initialTarget)&&(t.preventDefault(),this.viewHelper.focusTextArea(),this._dispatchGesture(t,!1))}onChange(t){"touch"===this._lastPointerType&&this._context.viewModel.viewLayout.deltaScrollNow(-t.translationX,-t.translationY),"pen"===this._lastPointerType&&this._dispatchGesture(t,!0)}_dispatchGesture(t,e){const i=this._createMouseTarget(new c.dO(t,!1,this.viewHelper.viewDomNode),!1);i.position&&this.viewController.dispatchMouse({position:i.position,mouseColumn:i.position.column,startedOnLineNumbers:!1,revealType:1,mouseDownCount:t.tapCount,inSelectionMode:e,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,leftButton:!1,middleButton:!1,onInjectedText:6===i.type&&null!==i.detail.injectedText})}_onMouseDown(t,e){"touch"!==t.browserEvent.pointerType&&super._onMouseDown(t,e)}}class N extends p{constructor(t,e,i){super(t,e,i),this._register(s.q.addTarget(this.viewHelper.linesContentDomNode)),this._register(n.ko(this.viewHelper.linesContentDomNode,s.B.Tap,(t=>this.onTap(t)))),this._register(n.ko(this.viewHelper.linesContentDomNode,s.B.Change,(t=>this.onChange(t)))),this._register(n.ko(this.viewHelper.linesContentDomNode,s.B.Contextmenu,(t=>this._onContextMenu(new c.dO(t,!1,this.viewHelper.viewDomNode),!1))))}onTap(t){t.preventDefault(),this.viewHelper.focusTextArea();const e=this._createMouseTarget(new c.dO(t,!1,this.viewHelper.viewDomNode),!1);if(e.position){const t=document.createEvent("CustomEvent");t.initEvent(T.$D.Tap,!1,!0),this.viewHelper.dispatchTextAreaEvent(t),this.viewController.moveTo(e.position,1)}}onChange(t){this._context.viewModel.viewLayout.deltaScrollNow(-t.translationX,-t.translationY)}}class D extends l.jG{constructor(t,e,i){super(),(a.un||a.m0&&a.Fr)&&o.e.pointerEvents?this.handler=this._register(new y(t,e,i)):r.G.TouchEvent?this.handler=this._register(new N(t,e,i)):this.handler=this._register(new p(t,e,i))}getTargetAtClientPoint(t,e){return this.handler.getTargetAtClientPoint(t,e)}}}}]);