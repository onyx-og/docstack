"use strict";(self.webpackChunk_docstack_ui=self.webpackChunk_docstack_ui||[]).push([[9955],{7726:(e,n,t)=>{t.d(n,{An:()=>f,Kw:()=>d,Oh:()=>u,UO:()=>c,cf:()=>o,m_:()=>s,sb:()=>l,t6:()=>a,t8:()=>y});var r=t(37709),i=t(6418);class o extends Error{constructor(e){super(),this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,o)}catch(e){}}}class s extends Error{constructor(e){super(),this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,s)}catch(e){}}}class u extends Error{constructor(e){super(),this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,u)}catch(e){}}}function a(e,n){return n&&e.then(function(e){(0,i.dY)(function(){n(null,e)})},function(e){(0,i.dY)(function(){n(e)})}),e}function d(e){return function(...n){var t=n.pop(),r=e.apply(this,n);return"function"==typeof t&&a(r,t),r}}function c(e,n){return e.then(function(e){return n().then(function(){return e})},function(e){return n().then(function(){throw e})})}function f(e,n){return function(){var t=arguments,r=this;return e.add(function(){return n.apply(r,t)})}}function l(e){var n=new r.N(e),t=new Array(n.size),i=-1;return n.forEach(function(e){t[++i]=e}),t}function y(e){var n=new Array(e.size),t=-1;return e.forEach(function(e,r){n[++t]=r}),n}},23541:(e,n,t)=>{t.d(n,{Lr:()=>r}),"undefined"!=typeof AbortController&&AbortController;var r=Headers},36791:(e,n,t)=>{t.d(n,{hp:()=>o});class r extends Error{constructor(e,n,t){super(),this.status=e,this.name=n,this.message=t,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new r(401,"unauthorized","Name or password is incorrect."),new r(400,"bad_request","Missing JSON list of 'docs'"),new r(404,"not_found","missing"),new r(409,"conflict","Document update conflict"),new r(400,"bad_request","_id field must contain a string"),new r(412,"missing_id","_id is required for puts"),new r(400,"bad_request","Only reserved document ids may start with underscore."),new r(412,"precondition_failed","Database not open");var i=new r(500,"unknown_error","Database encountered an unknown error");function o(e){if("object"!=typeof e){var n=e;(e=i).data=n}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=(new Error).stack),e}new r(500,"badarg","Some query argument is invalid"),new r(400,"invalid_request","Request was invalid"),new r(400,"query_parse_error","Some query parameter is invalid"),new r(500,"doc_validation","Bad special document member"),new r(400,"bad_request","Something wrong with the request"),new r(400,"bad_request","Document must be a JSON object"),new r(404,"not_found","Database not found"),new r(500,"indexed_db_went_bad","unknown"),new r(500,"web_sql_went_bad","unknown"),new r(500,"levelDB_went_went_bad","unknown"),new r(403,"forbidden","Forbidden by design doc validate_doc_update function"),new r(400,"bad_request","Invalid rev format"),new r(412,"file_exists","The database could not be created, the file already exists."),new r(412,"missing_stub","A pre-existing attachment stub wasn't found"),new r(413,"invalid_url","Provided URL is invalid")},75312:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Z});var r=t(36791),i=t(23541),o=t(3161),s=t(87689),u=t(96676),a=t(11195),d=t(6418);function c(e){return(e=(0,d.o8)(e)).index||(e.index={}),["type","name","ddoc"].forEach(function(n){e.index[n]&&(e[n]=e.index[n],delete e.index[n])}),e.fields&&(e.index.fields=e.fields,delete e.fields),e.type||(e.type="json"),e}function f(e,n,t){var r="",i=n,o=!0;if(-1!==["$in","$nin","$or","$and","$mod","$nor","$all"].indexOf(e)&&(Array.isArray(n)||(r="Query operator "+e+" must be an array.")),-1!==["$not","$elemMatch","$allMatch"].indexOf(e)&&(Array.isArray(n)||"object"!=typeof n||null===n)&&(r="Query operator "+e+" must be an object."),"$mod"===e&&Array.isArray(n))if(2!==n.length)r="Query operator $mod must be in the format [divisor, remainder], where divisor and remainder are both integers.";else{var s=n[0],u=n[1];0===s&&(r="Query operator $mod's divisor cannot be 0, cannot divide by zero.",o=!1),"number"==typeof s&&parseInt(s,10)===s||(r="Query operator $mod's divisor is not an integer.",i=s),parseInt(u,10)!==u&&(r="Query operator $mod's remainder is not an integer.",i=u)}if("$exists"===e&&"boolean"!=typeof n&&(r="Query operator $exists must be a boolean."),"$type"===e){var a=["null","boolean","number","string","array","object"],d='"'+a.slice(0,a.length-1).join('", "')+'", or "'+a[a.length-1]+'"';("string"!=typeof n||-1==a.indexOf(n))&&(r="Query operator $type must be a string. Supported values: "+d+".")}if("$size"===e&&parseInt(n,10)!==n&&(r="Query operator $size must be a integer."),"$regex"===e&&"string"!=typeof n&&(t?r="Query operator $regex must be a string.":n instanceof RegExp||(r="Query operator $regex must be a string or an instance of a javascript regular expression.")),r)throw o&&(r+=" Received"+(null===i?" ":Array.isArray(i)?" array":" "+typeof i)+": "+("object"==typeof i&&null!==i?JSON.stringify(i,null,"\t"):i)),new Error(r)}var l=["$all","$allMatch","$and","$elemMatch","$exists","$in","$mod","$nin","$nor","$not","$or","$regex","$size","$type"],y=["$in","$nin","$mod","$all"],h=["$eq","$gt","$gte","$lt","$lte"];function p(e,n){if(Array.isArray(e))for(var t of e)"object"==typeof t&&null!==s&&p(t,n);else for(var r=Object.keys(e),i=0;i<r.length;i++){var o=r[i],s=e[o];-1!==l.indexOf(o)&&f(o,s,n),-1===h.indexOf(o)&&-1===y.indexOf(o)&&"object"==typeof s&&null!==s&&p(s,n)}}function v(e,n,t,o){var s,u;t.headers=new i.Lr({"Content-type":"application/json"}),e.fetch(n,t).then(function(e){return s=e.status,u=e.ok,e.json()}).then(function(e){if(u)o(null,e);else{e.status=s;var n=(0,r.hp)(e);o(n)}}).catch(o)}function m(e,n,t){n=c(n),v(e,"_index",{method:"POST",body:JSON.stringify(n)},t)}function g(e,n,t){p(n.selector,!0),v(e,"_find",{method:"POST",body:JSON.stringify(n)},t)}function _(e,n,t){v(e,"_explain",{method:"POST",body:JSON.stringify(n)},t)}function w(e,n){v(e,"_index",{method:"GET"},n)}function b(e,n,t){var r=n.ddoc,i=n.type||"json",o=n.name;return r?o?void v(e,"_index/"+[r,i,o].map(encodeURIComponent).join("/"),{method:"DELETE"},t):t(new Error("you must provide an index's name")):t(new Error("you must provide an index's ddoc"))}function k(e){return function(...n){var t=n.pop(),r=e.apply(this,n);return function(e,n){e.then(function(e){(0,d.dY)(function(){n(null,e)})},function(e){(0,d.dY)(function(){n(e)})})}(r,t),r}}var x=function(...e){for(var n=[],t=0,r=e.length;t<r;t++){var i=e[t];Array.isArray(i)?n=n.concat(x.apply(null,i)):n.push(i)}return n};function $(e){for(var n={},t=0,r=e.length;t<r;t++)n=(0,d.kp)(n,e[t]);return n}function O(e,n){for(var t=0,r=Math.min(e.length,n.length);t<r;t++)if(e[t]!==n[t])return!1;return!0}function q(e,n){if(e.length!==n.length)return!1;for(var t=0,r=e.length;t<r;t++)if(e[t]!==n[t])return!1;return!0}var j=(0,o.A)("indexes",function(e,n){return function(e,n,t){var r=function(e){for(var n=0,t=e.length;n<t;n++)if(-1!==e[n].indexOf("."))return!1;return!0}(e),i=1===e.length;return r?i?function(e,n,t){return function(r){t&&!(0,a.B5)(r,t)||n(r[e])}}(e[0],n,t):function(e,n,t){return function(r){if(!t||(0,a.B5)(r,t)){for(var i=[],o=0,s=e.length;o<s;o++)i.push(r[e[o]]);n(i)}}}(e,n,t):i?function(e,n,t){var r=(0,a.cn)(e);return function(e){if(!t||(0,a.B5)(e,t)){for(var i=e,o=0,s=r.length;o<s;o++)if(void 0===(i=i[r[o]]))return;n(i)}}}(e[0],n,t):function(e,n,t){return function(r){if(!t||(0,a.B5)(r,t)){for(var i=[],o=0,s=e.length;o<s;o++){for(var u=(0,a.cn)(e[o]),d=r,c=0,f=u.length;c<f;c++)if(void 0===(d=d[u[c]]))return;i.push(d)}n(i)}}}(e,n,t)}(Object.keys(e.fields),n,e.partial_filter_selector)},function(){throw new Error("reduce not supported")},function(e,n){var t=e.views[n];if(!t.map||!t.map.fields)throw new Error("ddoc "+e._id+" with view "+n+" doesn't have map.fields defined. maybe it wasn't created by this plugin?")});function E(e){return e._customFindAbstractMapper?{query:function(n,t){var r=j.query.bind(this);return e._customFindAbstractMapper.query.call(this,n,t,r)},viewCleanup:function(){var n=j.viewCleanup.bind(this);return e._customFindAbstractMapper.viewCleanup.call(this,n)}}:j}function A(e){return e.fields=e.fields.map(function(e){if("string"==typeof e){var n={};return n[e]="asc",n}return e}),e.partial_filter_selector&&(e.partial_filter_selector=(0,a.DB)(e.partial_filter_selector)),e}function M(e,n){for(var t=[],r=0;r<n.def.fields.length;r++){var i=(0,a.i7)(n.def.fields[r]);t.push((0,a.JK)(e,(0,a.cn)(i)))}return t}function S(e){return e.allDocs({startkey:"_design/",endkey:"_design/￿",include_docs:!0}).then(function(e){var n={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};return n.indexes=x(n.indexes,e.rows.filter(function(e){return"query"===e.doc.language}).map(function(e){return(void 0!==e.doc.views?Object.keys(e.doc.views):[]).map(function(n){var t=e.doc.views[n];return{ddoc:e.id,name:n,type:"json",def:A(t.options.def)}})})),n.indexes.sort(function(e,n){return(0,a.UD)(e.name,n.name)}),n.total_rows=n.indexes.length,n})}var N=null,U={"￿":{}};const D={queryOpts:{limit:0,startkey:U,endkey:N},inMemoryFields:[]};function F(e,n){for(var t=e.def.fields.map(a.i7),r=0,i=t.length;r<i;r++)if(n===t[r])return!0;return!1}function C(e,n){var t=e[n];return"$eq"!==(0,a.i7)(t)}function Q(e,n){var t=n.def.fields.map(a.i7);return e.slice().sort(function(e,n){var r=t.indexOf(e),i=t.indexOf(n);return-1===r&&(r=Number.MAX_VALUE),-1===i&&(i=Number.MAX_VALUE),(0,a.UD)(r,i)})}function T(e,n,t,r){var i=x(e,function(e,n,t){for(var r=!1,i=0,o=(t=Q(t,e)).length;i<o;i++){var s=t[i];if(r||!F(e,s))return t.slice(i);i<o-1&&C(n,s)&&(r=!0)}return[]}(n,t,r),function(e){var n=[];return Object.keys(e).forEach(function(t){var r=e[t];Object.keys(r).forEach(function(e){"$ne"===e&&n.push(t)})}),n}(t));return Q(function(e){for(var n={},t=0;t<e.length;t++)n["$"+e[t]]=!0;return Object.keys(n).map(function(e){return e.substring(1)})}(i),n)}var J=["$eq","$gt","$gte","$lt","$lte"];function I(e){return-1===J.indexOf(e)}function V(e,n,t,r){var i=e.def.fields.map(a.i7);return!!function(e,n,t){if(n){var r=(s=e,!((o=n).length>s.length)&&O(o,s)),i=O(t,e);return r&&i}var o,s;return function(e,n){e=e.slice();for(var t=0,r=n.length;t<r;t++){var i=n[t];if(!e.length)break;var o=e.indexOf(i);if(-1===o)return!1;e.splice(o,1)}return!0}(t,e)}(i,n,t)&&function(e,n){var t=n[e[0]];return void 0===t||!(1===Object.keys(t).length&&"$ne"===(0,a.i7)(t))}(i,r)}function z(e,n){switch(e){case"$eq":return{startkey:n,endkey:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}}function B(e,n){return n.defaultUsed?function(e){return{queryOpts:{startkey:null},inMemoryFields:[Object.keys(e)]}}(e):1===n.def.fields.length?function(e,n){var t,r=(0,a.i7)(n.def.fields[0]),i=e[r]||{},o=[];return Object.keys(i).forEach(function(e){I(e)&&o.push(r);var n=function(e,n){switch(e){case"$eq":return{key:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}return{startkey:N}}(e,i[e]);t=t?$([t,n]):n}),{queryOpts:t,inMemoryFields:o}}(e,n):function(e,n){var t,r,i=n.def.fields.map(a.i7),o=[],s=[],u=[];function d(e){!1!==t&&s.push(N),!1!==r&&u.push(U),o=i.slice(e)}for(var c=0,f=i.length;c<f;c++){var l=e[i[c]];if(!l||!Object.keys(l).length){d(c);break}if(Object.keys(l).some(I)){d(c);break}if(c>0){var y="$gt"in l||"$gte"in l||"$lt"in l||"$lte"in l,h=Object.keys(e[i[c-1]]),p=q(h,["$eq"]),v=q(h,Object.keys(l));if(y&&!p&&!v){d(c);break}}for(var m=Object.keys(l),g=null,_=0;_<m.length;_++){var w=m[_],b=z(w,l[w]);g=g?$([g,b]):b}s.push("startkey"in g?g.startkey:N),u.push("endkey"in g?g.endkey:U),"inclusive_start"in g&&(t=g.inclusive_start),"inclusive_end"in g&&(r=g.inclusive_end)}var k={startkey:s,endkey:u};return void 0!==t&&(k.inclusive_start=t),void 0!==r&&(k.inclusive_end=r),{queryOpts:k,inMemoryFields:o}}(e,n)}function L(e,n){var t=e.selector,r=e.sort;if(function(e){return Object.keys(e).map(function(n){return e[n]}).some(function(e){return"object"==typeof e&&0===Object.keys(e).length})}(t))return(0,d.kp)({},D,{index:n[0]});var i=function(e,n){var t,r=Object.keys(e),i=n?n.map(a.i7):[];return t=r.length>=i.length?r:i,0===i.length?{fields:t}:{fields:t=t.sort(function(e,n){var t=i.indexOf(e);-1===t&&(t=Number.MAX_VALUE);var r=i.indexOf(n);return-1===r&&(r=Number.MAX_VALUE),t<r?-1:t>r?1:0}),sortOrder:n.map(a.i7)}}(t,r),o=i.fields,s=function(e,n,t,r,i){var o=function(e,n,t,r){return r.filter(function(r){return V(r,t,n,e)})}(e,n,t,r);if(0===o.length){if(i)throw{error:"no_usable_index",message:"There is no index available for this selector."};var s=r[0];return s.defaultUsed=!0,s}if(1===o.length&&!i)return o[0];var u=function(e){for(var n={},t=0,r=e.length;t<r;t++)n[e[t]]=!0;return n}(n);if(i){var d="_design/"+i[0],c=2===i.length&&i[1],f=o.find(function(e){return!(!c||e.ddoc!==d||c!==e.name)||e.ddoc===d});if(!f)throw{error:"unknown_error",message:"Could not find that index or could not use that index for the query"};return f}return function(e,n){for(var t=null,r=-1,i=0,o=e.length;i<o;i++){var s=e[i],u=n(s);u>r&&(r=u,t=s)}return t}(o,function(e){for(var n=e.def.fields.map(a.i7),t=0,r=0,i=n.length;r<i;r++){var o=n[r];u[o]&&t++}return t})}(t,o,i.sortOrder,n,e.use_index),u=B(t,s);return{queryOpts:u.queryOpts,index:s,inMemoryFields:T(u.inMemoryFields,s,t,o)}}function P(e,n,t){var r,i;return n.selector&&(p(n.selector,!1),n.selector=(0,a.DB)(n.selector)),n.sort&&(n.sort=function(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map(function(e){if("string"==typeof e){var n={};return n[e]="asc",n}return e})}(n.sort)),n.use_index&&(n.use_index=(i=[],"string"==typeof(r=n.use_index)?i.push(r):i=r,i.map(function(e){return e.replace("_design/","")}))),function(e){if("object"!=typeof e.selector)throw new Error("you must provide a selector when you find()")}(n),S(e).then(function(r){e.constructor.emit("debug",["find","planning query",n]);var i=L(n,r.indexes);e.constructor.emit("debug",["find","query plan",i]);var o=i.index;!function(e,n){if(n.defaultUsed&&e.sort){var t=e.sort.filter(function(e){return"_id"!==Object.keys(e)[0]}).map(function(e){return Object.keys(e)[0]});if(t.length>0)throw new Error('Cannot sort on field(s) "'+t.join(",")+'" when using the default index')}n.defaultUsed}(n,o);var s=(0,d.kp)({include_docs:!0,reduce:!1,indexes_count:r.total_rows},i.queryOpts);return"startkey"in s&&"endkey"in s&&(0,u.Zc)(s.startkey,s.endkey)>0?{docs:[]}:(n.sort&&"string"!=typeof n.sort[0]&&"desc"===(0,a._W)(n.sort[0])&&(s.descending=!0,s=function(e){var n=(0,d.o8)(e);return delete n.startkey,delete n.endkey,delete n.inclusive_start,delete n.inclusive_end,"endkey"in e&&(n.startkey=e.endkey),"startkey"in e&&(n.endkey=e.startkey),"inclusive_start"in e&&(n.inclusive_end=e.inclusive_start),"inclusive_end"in e&&(n.inclusive_start=e.inclusive_end),n}(s)),i.inMemoryFields.length||("limit"in n&&(s.limit=n.limit),"skip"in n&&(s.skip=n.skip)),t?Promise.resolve(i,s):Promise.resolve().then(function(){if("_all_docs"===o.name)return function(e,n){var t=(0,d.o8)(n);return t.descending?("endkey"in t&&"string"!=typeof t.endkey&&(t.endkey=""),"startkey"in t&&"string"!=typeof t.startkey&&(t.limit=0)):("startkey"in t&&"string"!=typeof t.startkey&&(t.startkey=""),"endkey"in t&&"string"!=typeof t.endkey&&(t.limit=0)),"key"in t&&"string"!=typeof t.key&&(t.limit=0),t.limit>0&&t.indexes_count&&(t.original_limit=t.limit,t.limit+=t.indexes_count),e.allDocs(t).then(function(e){return e.rows=e.rows.filter(function(e){return!/^_design\//.test(e.id)}),t.original_limit&&(t.limit=t.original_limit),e.rows=e.rows.slice(0,t.limit),e})}(e,s);var n,t=(n=o).ddoc.substring(8)+"/"+n.name;return E(e).query.call(e,t,s)}).then(function(e){!1===s.inclusive_start&&(e.rows=function(e,n,t){for(var r=t.def.fields,i=0,o=e.length;i<o;i++){var s=M(e[i].doc,t);if(1===r.length)s=s[0];else for(;s.length>n.length;)s.pop();if(Math.abs((0,u.Zc)(s,n))>0)break}return i>0?e.slice(i):e}(e.rows,s.startkey,o)),i.inMemoryFields.length&&(e.rows=(0,a._9)(e.rows,n,i.inMemoryFields));var t={docs:e.rows.map(function(e){var t=e.doc;return n.fields?function(e,n){for(var t={},r=0,i=n.length;r<i;r++){var o=(0,a.cn)(n[r]),s=(0,a.JK)(e,o);void 0!==s&&(0,a.Gm)(t,o,s)}return t}(t,n.fields):t})};return o.defaultUsed&&(t.warning="No matching index found, create an index to optimize query time."),t}))})}var R=k(function(e,n){n=c(n);var t,r=(0,d.o8)(n.index);function i(){return t||(t=(0,s.m)(JSON.stringify(n)))}n.index=A(n.index),function(e){var n=e.fields.filter(function(e){return"asc"===(0,a._W)(e)});if(0!==n.length&&n.length!==e.fields.length)throw new Error("unsupported mixed sorting")}(n.index);var o=n.name||"idx-"+i(),u=n.ddoc||"idx-"+i(),f="_design/"+u,l=!1,y=!1;return e.constructor.emit("debug",["find","creating index",f]),(0,d.el)(e,f,function(e){return e._rev&&"query"!==e.language&&(l=!0),e.language="query",e.views=e.views||{},!(y=!!e.views[o])&&(e.views[o]={map:{fields:$(n.index.fields),partial_filter_selector:n.index.partial_filter_selector},reduce:"_count",options:{def:r}},e)}).then(function(){if(l)throw new Error('invalid language for ddoc with id "'+f+'" (should be "query")')}).then(function(){var n=u+"/"+o;return E(e).query.call(e,n,{limit:0,reduce:!1}).then(function(){return{id:f,name:o,result:y?"exists":"created"}})})}),X=k(P),Y=k(function(e,n){return P(e,n,!0).then(function(t){return{dbname:e.name,index:t.index,selector:n.selector,range:{start_key:t.queryOpts.startkey,end_key:t.queryOpts.endkey},opts:{use_index:n.use_index||[],bookmark:"nil",limit:n.limit,skip:n.skip,sort:n.sort||{},fields:n.fields,conflicts:!1,r:[49]},limit:n.limit,skip:n.skip||0,fields:n.fields}})}),K=k(S),G=k(function(e,n){if(!n.ddoc)throw new Error("you must supply an index.ddoc when deleting");if(!n.name)throw new Error("you must supply an index.name when deleting");var t=n.ddoc,r=n.name;return(0,d.el)(e,t,function(e){return 1===Object.keys(e.views).length&&e.views[r]?{_id:t,_deleted:!0}:(delete e.views[r],e)}).then(function(){return E(e).viewCleanup.apply(e)}).then(function(){return{ok:!0}})}),W={};W.createIndex=(0,d.hq)(function(e,n){if("object"!=typeof e)return n(new Error("you must provide an index to create"));((0,d.Vx)(this)?m:R)(this,e,n)}),W.find=(0,d.hq)(function(e,n){if(void 0===n&&(n=e,e=void 0),"object"!=typeof e)return n(new Error("you must provide search parameters to find()"));((0,d.Vx)(this)?g:X)(this,e,n)}),W.explain=(0,d.hq)(function(e,n){if(void 0===n&&(n=e,e=void 0),"object"!=typeof e)return n(new Error("you must provide search parameters to explain()"));((0,d.Vx)(this)?_:Y)(this,e,n)}),W.getIndexes=(0,d.hq)(function(e){((0,d.Vx)(this)?w:K)(this,e)}),W.deleteIndex=(0,d.hq)(function(e,n){if("object"!=typeof e)return n(new Error("you must provide an index to delete"));((0,d.Vx)(this)?b:G)(this,e,n)});const Z=W},87689:(e,n,t)=>{t.d(n,{m:()=>o});var r=t(88110),i=t.n(r);function o(e){return i().hash(e)}self.setImmediate||self.setTimeout}}]);